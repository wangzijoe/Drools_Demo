<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><title xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory">Drools Introduction and General User Guide</title><link rel="stylesheet" href="css/jbossorg.css" type="text/css"/><meta xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" name="generator" content="DocBook XSL-NS Stylesheets V1.74.0"/><meta xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" http-equiv="Content-Type" content="text/html; charset=UTF-8"/></head><body><div class="book" lang="en-US"><div class="titlepage"><div><p xmlns:d="http://docbook.org/ns/docbook" id="title"><a href="http://www.jboss.org" class="site_href"><strong>JBoss.org</strong></a><a href="http://docs.jboss.org/" class="doc_href"><strong>Community Documentation</strong></a></p><div><h1 class="title"><a id="d0e1"/>Drools Introduction and General User Guide</h1></div><div><div xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="authorgroup"><div class="authors">by <span xmlns="http://www.w3.org/1999/xhtml" class="orgname"><a class="link" href="http://www.jboss.org/drools/team.html" target="">The JBoss Drools team</a></span></div><div class="editors"/><div class="others"/></div></div><div><p class="releaseinfo">Version 5.5.0.Final</p></div></div><hr/></div><div class="toc"><dl><dt><span class="preface"><a href="#d0e19"/></span></dt><dt><span class="chapter"><a href="#welcome">1. Welcome</a></span></dt><dt><span class="chapter"><a href="#installationAndSetup">2. Installation and Setup (Core and IDE)</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e47">2.1. Installing and using</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e58">2.1.1. Dependencies and jars</a></span></dt><dt><span class="section"><a href="#d0e90">2.1.2. Runtime</a></span></dt><dt><span class="section"><a href="#d0e95">2.1.3. Installing IDE (Rule Workbench)</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e197">2.2. Building from source</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e200">2.2.1. Getting the sources</a></span></dt><dt><span class="section"><a href="#d0e223">2.2.2. Building the sources</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e243">2.3. Eclipse</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e246">2.3.1. Importing Eclipse Projects</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#gettingstarted">3. Getting Involved</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e319">3.1. Sign up to jboss.org</a></span></dt><dt><span class="section"><a href="#d0e330">3.2. Sign the Contributor Agreement</a></span></dt><dt><span class="section"><a href="#d0e341">3.3. Submitting issues via JIRA</a></span></dt><dt><span class="section"><a href="#d0e361">3.4. Fork Github</a></span></dt><dt><span class="section"><a href="#d0e372">3.5. Writing Tests</a></span></dt><dt><span class="section"><a href="#d0e385">3.6. Commit with Correct Conventions</a></span></dt><dt><span class="section"><a href="#d0e395">3.7. Submit Pull Requests</a></span></dt></dl></dd><dt><span class="chapter"><a href="#releaseNotes">4. Drools Release Notes</a></span></dt><dd><dl><dt><span class="section"><a href="#releaseNotes_5.5.0">4.1. What is New and Noteworthy in Drools 5.5.0</a></span></dt><dd><dl><dt><span class="section"><a href="#releaseNotes_5.5.0_Expert">4.1.1. Drools Expert</a></span></dt><dt><span class="section"><a href="#releaseNotes_5.5.0_Guvnor">4.1.2. Guvnor</a></span></dt><dt><span class="section"><a href="#releaseNotes_5.5.0_Planner">4.1.3. Planner</a></span></dt><dt><span class="section"><a href="#releaseNotes_5.5.0_Drools Integration">4.1.4. Drools Integration</a></span></dt></dl></dd><dt><span class="section"><a href="#releaseNotes_5.4.0">4.2. What is New and Noteworthy in Drools 5.4.0</a></span></dt><dd><dl><dt><span class="section"><a href="#releaseNotes_5.4.0_Expert">4.2.1. Drools Expert</a></span></dt><dt><span class="section"><a href="#releaseNotes_5.4.0_Fusion">4.2.2. Drools Fusion</a></span></dt><dt><span class="section"><a href="#releaseNotes_5.4.0_Guvnor">4.2.3. Guvnor</a></span></dt><dt><span class="section"><a href="#releaseNotes_5.4.0_Planner">4.2.4. Planner</a></span></dt><dt><span class="section"><a href="#releaseNotes_5.4.0_Eclipse">4.2.5. Eclipse plugin</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e1709">4.3. What is New and Noteworthy in Drools 5.3.0</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e1712">4.3.1. Drools Expert</a></span></dt><dt><span class="section"><a href="#d0e1848">4.3.2. Guvnor</a></span></dt><dt><span class="section"><a href="#d0e2046">4.3.3. Drools Planner</a></span></dt><dt><span class="section"><a href="#d0e2123">4.3.4. Drools Integration</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e2143">4.4. What is New and Noteworthy in Drools 5.2.0</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e2146">4.4.1. Knowledge API (renamed from Drools API)</a></span></dt><dt><span class="section"><a href="#d0e2168">4.4.2. Drools Expert and Fusion</a></span></dt><dt><span class="section"><a href="#d0e2291">4.4.3. Drools and jBPM integration</a></span></dt><dt><span class="section"><a href="#d0e2303">4.4.4. Merging Drools Flow into jBPM5</a></span></dt><dt><span class="section"><a href="#d0e2314">4.4.5. Guvnor</a></span></dt><dt><span class="section"><a href="#d0e2485">4.4.6. Eclipse</a></span></dt><dt><span class="section"><a href="#d0e2493">4.4.7. Maven artifactId changes</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e2797">4.5. What is New and Noteworthy in Drools 5.1.0</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e2800">4.5.1. Drools API</a></span></dt><dt><span class="section"><a href="#d0e2813">4.5.2. Core</a></span></dt><dt><span class="section"><a href="#d0e2940">4.5.3. Expert</a></span></dt><dt><span class="section"><a href="#d0e3029">4.5.4. Flow</a></span></dt><dt><span class="section"><a href="#d0e3095">4.5.5. Guvnor</a></span></dt><dt><span class="section"><a href="#d0e3390">4.5.6. Eclipse</a></span></dt><dt><span class="section"><a href="#d0e3415">4.5.7. Known Issues</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e3426">4.6. What is New and Noteworthy in Drools 5.0.0</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e3429">4.6.1. Drools API</a></span></dt><dt><span class="section"><a href="#d0e3550">4.6.2. Drools Guvnor</a></span></dt><dt><span class="section"><a href="#d0e3634">4.6.3. Drools Expert</a></span></dt><dt><span class="section"><a href="#d0e4013">4.6.4. Drools Flow</a></span></dt><dt><span class="section"><a href="#d0e4184">4.6.5. Drools Fusion</a></span></dt><dt><span class="section"><a href="#d0e4342">4.6.6. Eclipse IDE</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e4371">4.7. What is new in Drools 4.0</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e4376">4.7.1. Language Expressiveness Enhancements</a></span></dt><dt><span class="section"><a href="#d0e4413">4.7.2. Core Engine Enhancements</a></span></dt><dt><span class="section"><a href="#d0e4453">4.7.3. IDE Enhancements</a></span></dt><dt><span class="section"><a href="#d0e4469">4.7.4. Business Rules Management System - BRMS</a></span></dt><dt><span class="section"><a href="#d0e4500">4.7.5. Miscellaneous Enhancements</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e4507">4.8. Upgrade tips from Drools 3.0.x to Drools 4.0.x</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e4514">4.8.1. API changes</a></span></dt><dt><span class="section"><a href="#d0e4571">4.8.2. Rule Language Changes</a></span></dt><dt><span class="section"><a href="#d0e4630">4.8.3. Drools Update Tool</a></span></dt><dt><span class="section"><a href="#d0e4656">4.8.4. DSL Grammars in Drools 4.0</a></span></dt><dt><span class="section"><a href="#d0e4673">4.8.5. Rule flow Update for 4.0.2</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#compatibility">5. Drools compatibility matrix</a></span></dt></dl></div><div class="preface" lang="en-US"><div class="titlepage"/><div class="mediaobject"><img src="images/droolsPlatformLogo.png"/></div></div><div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="welcome"/>Chapter 1. Welcome</h2></div></div></div><p>I've always stated that end business users struggle understanding the
  differences between rules and processes, and more recently rules and event
  processing. For them they have this problem in their mind and they just want
  to model it using some software. The traditional way of using two vendor
  offerings forces the business user to work with a process oriented or rules
  oriented approach which just gets in the way, often with great confusion
  over which tool they should be using to model which bit.</p><p>PegaSystems and Microsoft have done a great job of showing that the
  two can be combined and a behavioural modelling approach can be used. This
  allows the business user to work more naturally where the full range of
  approaches is available to them, without the tools getting in the way. From
  being process oriented to rule oriented or shades of grey in the middle -
  whatever suites the problem being modelled at that time.</p><p>Drools 5.0 takes this one step further by not only adding BPMN2 based
  workflow with Drools Flow but also adding event processing with Drools
  Fusion, creating a more holistic approach to software development. Where the
  term holistic is used for emphasizing the importance of the whole and the
  interdependence of its parts.</p><p>Drools 5.0 is now split into 5 modules, each with their own manual -
  Guvnor (BRMS/BPMS), Expert (Rules), Fusion (CEP), Flow (Process/Workflow)
  and Planner. Guvnor is our web based governance system, traditionally
  referred to in the rules world as a BRMS. We decided to move away from the
  BRMS term to a play on governance as it's not rules specific. Expert is the
  traditional rules engine. Fusion is the event processing side, it's a play
  on data/sensor fusion terminology. Flow is our workflow module, Kris
  Verlaenen leads this and has done some amazing work; he's currently moving
  flow to be incorporated into jBPM 5. The fith module called Planner,
  authored by Geoffrey De Smet, solves allocation and scheduling type problem
  and while still in the early stage of development is showing a lot of
  promise. We hope to add Semantics for 2011, based around description logc,
  and that is being work on as part of the next generaion Drools
  designs.</p><p>I've been working in the rules field now for around 7 years and I
  finally feel like I'm getting to grips with things and ideas are starting to
  gel and the real innovation is starting to happen. To me It feels like we
  actually know what we are doing now, compared to the past where there was a
  lot of wild guessing and exploration. I've been working hard on the next
  generation Drools Expert design document with Edson Tirelli and Davide
  Sottara. I invite you to read the document and get involved, <a class="link" href="http://community.jboss.org/wiki/DroolsLanguageEnhancements" target="">http://community.jboss.org/wiki/DroolsLanguageEnhancements</a>.
  The document takes things to the next level pushing Drools forward as a
  hybrid engine, not just a capable production rule system, but also melding
  in logic programming (prolog) with functional programming and description
  logic along with a host of other ideas for a more expressive and modern
  feeling language.</p><p>I hope you can feel the passion that my team and I have while working
  on Drools, and that some of it rubs off on you during your
  adventures.</p><div class="mediaobject"><img src="images/Chapter-Welcome/mark.png"/></div></div><div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="installationAndSetup"/>Chapter 2. Installation and Setup (Core and IDE)</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#d0e47">2.1. Installing and using</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e58">2.1.1. Dependencies and jars</a></span></dt><dt><span class="section"><a href="#d0e90">2.1.2. Runtime</a></span></dt><dt><span class="section"><a href="#d0e95">2.1.3. Installing IDE (Rule Workbench)</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e197">2.2. Building from source</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e200">2.2.1. Getting the sources</a></span></dt><dt><span class="section"><a href="#d0e223">2.2.2. Building the sources</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e243">2.3. Eclipse</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e246">2.3.1. Importing Eclipse Projects</a></span></dt></dl></dd></dl></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e47"/>2.1. Installing and using</h2></div></div></div><p>Drools provides an Eclipse-based IDE (which is optional), but at its core only Java 1.5 (Java SE) is
  required.</p><p>A simple way to get started is to download and install the Eclipse plug-in - this will also require the Eclipse
  GEF framework to be installed (see below, if you don't have it installed already). This will provide you with all the
  dependencies you need to get going: you can simply create a new rule project and everything will be done for you.
  Refer to the chapter on the Rule Workbench and IDE for detailed instructions on this. Installing the Eclipse plug-in
  is generally as simple as unzipping a file into your Eclipse plug-in directory.</p><p>Use of the Eclipse plug-in is not required. Rule files are just textual input (or spreadsheets as the case may
  be) and the IDE (also known as the Rule Workbench) is just a convenience. People have integrated the rule engine in
  many ways, there is no "one size fits all".</p><p>Alternatively, you can download the binary distribution, and include the relevant jars in your projects
  classpath.</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e58"/>2.1.1. Dependencies and jars</h3></div></div></div><p>Drools is broken down into a few modules, some are required during rule development/compiling, and some are
    required at runtime. In many cases, people will simply want to include all the dependencies at runtime, and this is
    fine. It allows you to have the most flexibility. However, some may prefer to have their "runtime" stripped down to
    the bare minimum, as they will be deploying rules in binary form - this is also possible. The core runtime engine
    can be quite compact, and only requires a few 100 kilobytes across 3 jar files.</p><p>The following is a description of the important libraries that make up JBoss Drools</p><div class="itemizedlist"><ul><li><p>knowledge-api.jar - this provides the interfaces and factories. It also helps clearly show what is
        intended as a user api and what is just an engine api.</p></li><li><p>knowledge-internal-api.jar - this provides internal interfaces and factories.</p></li><li><p>drools-core.jar - this is the core engine, runtime component. Contains both the RETE engine and the LEAPS
        engine. This is the only runtime dependency if you are pre-compiling rules (and deploying via Package or
        RuleBase objects).</p></li><li><p>drools-compiler.jar - this contains the compiler/builder components to take rule source, and build
        executable rule bases. This is often a runtime dependency of your application, but it need not be if you are
        pre-compiling your rules. This depends on drools-core.</p></li><li><p>drools-jsr94.jar - this is the JSR-94 compliant implementation, this is essentially a layer over the
        drools-compiler component. Note that due to the nature of the JSR-94 specification, not all features are easily
        exposed via this interface. In some cases, it will be easier to go direct to the Drools API, but in some
        environments the JSR-94 is mandated.</p></li><li><p>drools-decisiontables.jar - this is the decision tables 'compiler' component, which uses the
        drools-compiler component. This supports both excel and CSV input formats.</p></li></ul></div><p>There are quite a few other dependencies which the above components require, most of which are for the
    drools-compiler, drools-jsr94 or drools-decisiontables module. Some key ones to note are "POI" which provides the
    spreadsheet parsing ability, and "antlr" which provides the parsing for the rule language itself.</p><p>NOTE: if you are using Drools in J2EE or servlet containers and you come across classpath issues with "JDT",
    then you can switch to the janino compiler. Set the system property "drools.compiler": For example:
    -Ddrools.compiler=JANINO.</p><p>For up to date info on dependencies in a release, consult the released poms, which can be found on the maven
    repository.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e90"/>2.1.2. Runtime</h3></div></div></div><p>The "runtime" requirements mentioned here are if you are deploying rules as their binary form (either as
    KnowledgePackage objects, or KnowledgeBase objects etc). This is an optional feature that allows you to keep your
    runtime very light. You may use drools-compiler to produce rule packages "out of process", and then deploy them to a
    runtime system. This runtime system only requires drools-core.jar and knowledge-api for execution. This is an optional
    deployment pattern, and many people do not need to "trim" their application this much, but it is an ideal option for
    certain environments.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e95"/>2.1.3. Installing IDE (Rule Workbench)</h3></div></div></div><p>The rule workbench (for Eclipse) requires that you have Eclipse 3.4 or greater, as well as Eclipse GEF 3.4 or
    greater. You can install it either by downloading the plug-in or, or using the update site.</p><p>Another option is to use the JBoss IDE, which comes with all the plug-in requirements pre packaged, as well as
    a choice of other tools separate to rules. You can choose just to install rules from the "bundle" that JBoss IDE
    ships with.</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e102"/>2.1.3.1. Installing GEF (a required dependency)</h4></div></div></div><p>GEF is the Eclipse Graphical Editing Framework, which is used for graph viewing components in the
      plug-in.</p><p>If you don't have GEF installed, you can install it using the built in update mechanism (or downloading GEF
      from the Eclipse.org website not recommended). JBoss IDE has GEF already, as do many other "distributions" of
      Eclipse, so this step may be redundant for some people.</p><p>Open the Help-&gt;Software updates...-&gt;Available Software-&gt;Add Site... from the help menu. Location
      is:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">http://download.eclipse.org/tools/gef/updates/releases/</pre><p>Next you choose the GEF plug-in:</p><div class="screenshot"><div class="mediaobject"><img src="images/Chapter-Install/install_gef.png"/></div></div><p>Press next, and agree to install the plug-in (an Eclipse restart may be required). Once this is completed,
      then you can continue on installing the rules plug-in.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e121"/>2.1.3.2. Installing GEF from zip file</h4></div></div></div><p>To install from the zip file, download and unzip the file. Inside the zip you will see a plug-in directory,
      and the plug-in jar itself. You place the plug-in jar into your Eclipse applications plug-in directory, and
      restart Eclipse.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e126"/>2.1.3.3. Installing Drools plug-in from zip file</h4></div></div></div><p>Download the Drools Eclipse IDE plugin from the link below. Unzip the downloaded file in your main eclipse
      folder (do not just copy the file there, extract it so that the feature and plugin jars end up in the features and
      plugin directory of eclipse) and (re)start Eclipse.</p><p><a class="ulink" href="http://www.jboss.org/drools/downloads.html">http://www.jboss.org/drools/downloads.html</a></p><p>To check that the installation was successful, try opening the Drools perspective: Click the 'Open
      Perspective' button in the top right corner of your Eclipse window, select 'Other...' and pick the Drools
      perspective. If you cannot find the Drools perspective as one of the possible perspectives, the installation
      probably was unsuccessful. Check whether you executed each of the required steps correctly: Do you have the right
      version of Eclipse (3.4.x)? Do you have Eclipse GEF installed (check whether the org.eclipse.gef_3.4.*.jar exists
      in the plugins directory in your eclipse root folder)? Did you extract the Drools Eclipse plugin correctly (check
      whether the org.drools.eclipse_*.jar exists in the plugins directory in your eclipse root folder)? If you cannot
      find the problem, try contacting us (e.g. on irc or on the user mailing list), more info can be found no our
      homepage here:</p><p><a class="ulink" href="http://www.jboss.org/drools/">http://www.jboss.org/drools/</a></p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e139"/>2.1.3.4. Drools Runtimes</h4></div></div></div><p>A Drools runtime is a collection of jars on your file system that represent one specific release of the
      Drools project jars. To create a runtime, you must point the IDE to the release of your choice. If you want to
      create a new runtime based on the latest Drools project jars included in the plugin itself, you can also easily do
      that. You are required to specify a default Drools runtime for your Eclipse workspace, but each individual project
      can override the default and select the appropriate runtime for that project specifically.</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h5 class="title"><a id="d0e144"/>2.1.3.4.1. Defining a Drools runtime</h5></div></div></div><p>You are required to define one or more Drools runtimes using the Eclipse preferences view. To open up your
        preferences, in the menu Window select the Preferences menu item. A new preferences dialog should show all your
        preferences. On the left side of this dialog, under the Drools category, select "Installed Drools runtimes". The
        panel on the right should then show the currently defined Drools runtimes. If you have not yet defined any
        runtimes, it should like something like the figure below.</p><div class="mediaobject" align="center"><img src="images/Chapter-Install/drools-runtimes.png" align="middle"/></div><p>To define a new Drools runtime, click on the add button. A dialog as shown below should pop up, requiring
        the name for your runtime and the location on your file system where it can be found.</p><div class="mediaobject" align="center"><img src="images/Chapter-Install/drools-runtimes-add.png" align="middle"/></div><p>In general, you have two options:</p><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="orderedlist"><ol><li><p>If you simply want to use the default jars as included in the Drools Eclipse plugin, you can create a
            new Drools runtime automatically by clicking the "Create a new Drools 5 runtime ..." button. A file browser
            will show up, asking you to select the folder on your file system where you want this runtime to be created.
            The plugin will then automatically copy all required dependencies to the specified folder. After selecting
            this folder, the dialog should look like the figure shown below.</p></li><li><p>If you want to use one specific release of the Drools project, you should create a folder on your file
            system that contains all the necessary Drools libraries and dependencies. Instead of creating a new Drools
            runtime as explained above, give your runtime a name and select the location of this folder containing all
            the required jars.</p></li></ol></div><div class="mediaobject" align="center"><img src="images/Chapter-Install/drools-runtimes-add2.png" align="middle"/></div><p>After clicking the OK button, the runtime should show up in your table of installed Drools runtimes, as
        shown below. Click on checkbox in front of the newly created runtime to make it the default Drools runtime. The
        default Drools runtime will be used as the runtime of all your Drools project that have not selected a
        project-specific runtime.</p><div class="mediaobject" align="center"><img src="images/Chapter-Install/drools-runtimes2.png" align="middle"/></div><p>You can add as many Drools runtimes as you need. For example, the screenshot below shows a configuration
        where three runtimes have been defined: a Drools 4.0.7 runtime, a Drools 5.0.0 runtime and a Drools
        5.0.0.SNAPSHOT runtime. The Drools 5.0.0 runtime is selected as the default one.</p><div class="mediaobject" align="center"><img src="images/Chapter-Install/drools-runtimes3.png" align="middle"/></div><p>Note that you will need to restart Eclipse if you changed the default runtime and you want to make sure
        that all the projects that are using the default runtime update their classpath accordingly.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h5 class="title"><a id="d0e181"/>2.1.3.4.2. Selecting a runtime for your Drools project</h5></div></div></div><p>Whenever you create a Drools project (using the New Drools Project wizard or by converting an existing
        Java project to a Drools project using the "Convert to Drools Project" action that is shown when you are in the
        Drools perspective and you right-click an existing Java project), the plugin will automatically add all the
        required jars to the classpath of your project.</p><p>When creating a new Drools project, the plugin will automatically use the default Drools runtime for that
        project, unless you specify a project-specific one. You can do this in the final step of the New Drools Project
        wizard, as shown below, by deselecting the "Use default Drools runtime" checkbox and selecting the appropriate
        runtime in the drop-down box. If you click the "Configure workspace settings ..." link, the workspace
        preferences showing the currently installed Drools runtimes will be opened, so you can add new runtimes
        there.</p><div class="mediaobject" align="center"><img src="images/Chapter-Install/drools-runtimes-newproject.png" align="middle"/></div><p>You can change the runtime of a Drools project at any time by opening the project properties (right-click
        the project and select Properties) and selecting the Drools category, as shown below. Check the "Enable project
        specific settings" checkbox and select the appropriate runtime from the drop-down box. If you click the
        "Configure workspace settings ..." link, the workspace preferences showing the currently installed Drools
        runtimes will be opened, so you can add new runtimes there. If you deselect the "Enable project specific
        settings" checkbox, it will use the default runtime as defined in your global preferences.</p><div class="mediaobject" align="center"><img src="images/Chapter-Install/drools-runtimes-project.png" align="middle"/></div></div></div></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e197"/>2.2. Building from source</h2></div></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e200"/>2.2.1. Getting the sources</h3></div></div></div><p>The source code of each maven artifact is available in the JBoss maven repository as a source jar. The same
    source jars are also included in the download zips. However, if you want to build from source, it's highly
    recommended to get our sources from our source control.</p><p>Drools and jBPM use <a class="link" href="http://git-scm.com/" target="">Git</a> for source control. The blessed git
    repositories are hosted on <a class="link" href="https://github.com" target="">Github</a>:</p><div class="itemizedlist"><ul><li><p><a class="link" href="https://github.com/droolsjbpm" target="">https://github.com/droolsjbpm</a></p></li></ul></div><p>Git allows you to fork our code, independently make personal changes on it, yet still merge in our latest
    changes regularly and optionally share your changes with us. To learn more about git, read the free book <a class="link" href="http://progit.org/book/" target="">Git Pro</a>.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e223"/>2.2.2. Building the sources</h3></div></div></div><p>In essense, building from source is very easy, for example if you want to build the
    <em class="firstterm">guvnor</em> project:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">$ git clone git@github.com:droolsjbpm/guvnor.git
...
$ cd guvnor
$ mvn clean install -DskipTests -Dfull
...</pre><p>However, <span class="emphasis"><em>there are a lot potential pitfalls</em></span>, so if you're serious about building from
    source and possibly contributing to the project, <span class="bold"><strong>follow the instructions <a class="link" href="https://github.com/droolsjbpm/droolsjbpm-build-bootstrap/blob/master/README.md" target="">in the README file in
    droolsjbpm-build-bootstrap</a>. </strong></span></p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e243"/>2.3. Eclipse</h2></div></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e246"/>2.3.1. Importing Eclipse Projects</h3></div></div></div><p>With the <a id="d0e251" class="indexterm"/>Eclipse project files generated they can now be imported into Eclipse. When starting Eclipse open the
    workspace in the root of your subversion checkout.</p><div class="screenshot"><div class="mediaobject"><img src="images/Chapter-Install/eclipse_import1.jpg"/></div></div><div class="screenshot"><div class="mediaobject"><img src="images/Chapter-Install/eclipse_import2.jpg"/></div></div><div class="screenshot"><div class="mediaobject"><img src="images/Chapter-Install/eclipse_import3.jpg"/></div></div><div class="screenshot"><div class="mediaobject"><img src="images/Chapter-Install/eclipse_import4.jpg"/></div></div><p>When calling <code class="command">mvn install</code> all the project dependencies were downloaded and added to the
    local Maven repository. Eclipse cannot find those dependencies unless you tell it where that repository is. To do
    this setup an <code class="literal">M2_REPO</code> classpath variable.</p><div class="screenshot"><div class="mediaobject"><img src="images/Chapter-Install/eclipse_import6.jpg"/></div></div><div class="screenshot"><div class="mediaobject"><img src="images/Chapter-Install/eclipse_import7.jpg"/></div></div><div class="screenshot"><div class="mediaobject"><img src="images/Chapter-Install/eclipse_import8.jpg"/></div></div><div class="screenshot"><div class="mediaobject"><img src="images/Chapter-Install/eclipse_import9.jpg"/></div></div></div></div></div><div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="gettingstarted"/>Chapter 3. Getting Involved</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#d0e319">3.1. Sign up to jboss.org</a></span></dt><dt><span class="section"><a href="#d0e330">3.2. Sign the Contributor Agreement</a></span></dt><dt><span class="section"><a href="#d0e341">3.3. Submitting issues via JIRA</a></span></dt><dt><span class="section"><a href="#d0e361">3.4. Fork Github</a></span></dt><dt><span class="section"><a href="#d0e372">3.5. Writing Tests</a></span></dt><dt><span class="section"><a href="#d0e385">3.6. Commit with Correct Conventions</a></span></dt><dt><span class="section"><a href="#d0e395">3.7. Submit Pull Requests</a></span></dt></dl></div><p>We are often asked "How do I get involved". Luckily the answer is
  simple, just write some code and submit it :) There are no hoops you have to
  jump through or secret handshakes. We have a very minimal "overhead" that we
  do request to allow for scalable project development. Below we provide a
  general overview of the tools and "workflow" we request, along with some
  general advice.</p><p>If you contribute some good work, don't forget to blog about it
  :)</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e319"/>3.1. Sign up to jboss.org</h2></div></div></div><p>Signing to jboss.org will give you access to the JBoss wiki, forums and Jira. Go to 
    <a class="link" href="http://www.jboss.org/" target="">http://www.jboss.org/</a> and click "Register".</p><div class="mediaobject"><img src="images/Chapter-Getting_Involved/sign_jbossorg.png"/></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e330"/>3.2. Sign the Contributor Agreement</h2></div></div></div><p>The only form you need to sign is the contributor agreement, which
    is fully automated via the web. As the image below says "This establishes
    the terms and conditions for your contributions and ensures that source
    code can be licensed appropriately"</p><p><a class="link" href="https://cla.jboss.org/" target="">https://cla.jboss.org/</a></p><div class="mediaobject"><img src="images/Chapter-Getting_Involved/sign_contributor.png"/></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e341"/>3.3. Submitting issues via JIRA</h2></div></div></div><p>To be able to interact with the core development team you will need
    to use JIRA, the issue tracker. This ensures that all requests are logged
    and allocated to a release schedule and all discussions captured in one
    place. Bug reports, bug fixes, feature requests and feature submissions
    should all go here. General questions should be undertaken at the mailing
    lists.</p><p>Minor code submissions, like format or documentation fixes do not
    need an associated JIRA issue created.</p><p><a class="link" href="???" target="">https://issues.jboss.org/browse/JBRULES
    </a>(Drools)</p><p><a class="link" href="https://issues.jboss.org/browse/JBPM" target="">https://issues.jboss.org/browse/JBPM</a></p><p><a class="link" href="https://issues.jboss.org/browse/GUVNOR" target="">https://issues.jboss.org/browse/GUVNOR</a></p><div class="mediaobject"><img src="images/Chapter-Getting_Involved/submit_jira.png"/></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e361"/>3.4. Fork Github</h2></div></div></div><p>With the contributor agreement signed and your requests submitted to
    jira you should now be ready to code :) Create a github account and fork
    any of the drools, jbpm or guvnor sub modules. The fork will create a copy
    in your own github space which you can work on at your own pace. If you
    make a mistake, don't worry blow it away and fork again. Note each github
    repository provides you the clone (checkout) URL, github will provide you
    URLs specific to your fork.</p><p><a class="link" href="https://github.com/droolsjbpm" target="">https://github.com/droolsjbpm</a></p><div class="mediaobject"><img src="images/Chapter-Getting_Involved/fork_github.png"/></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e372"/>3.5. Writing Tests</h2></div></div></div><p>When writing tests, try and keep them minimal and self contained. We
    prefer to keep the drl fragments within the test, as it makes for quicker
    reviewing. If their are a large number of rules then using a String is not
    practical so then by all means place them in separate drl files instead to
    be loaded from the classpath. If your tests need to use a model, please
    try to use those that already exist for other unit tests; such as Person,
    Cheese or Order. If no classes exist that have the fields you need, try
    and update fields of existing classes before adding a new class.</p><p>There are a vast number of tests to look over to get an idea,
    MiscTest is a good place to start.</p><p><a class="link" href="https://github.com/droolsjbpm" target="">https://github.com/droolsjbpm/drools/blob/master/drools-compiler/src/test/java/org/drools/integrationtests/MiscTest.java</a></p><div class="mediaobject"><img src="images/Chapter-Getting_Involved/unit_test.png"/></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e385"/>3.6. Commit with Correct Conventions</h2></div></div></div><p>When you commit, make sure you use the correct conventions. The
    commit must start with the JIRA issue id, such as JBRULES-220. This
    ensures the commits are cross referenced via JIRA, so we can see all
    commits for a given issue in the same place. After the id the title of the
    issue should come next. Then use a newline, indented with a dash, to
    provide additional information related to this commit. Use an additional
    new line and dash for each separate point you wish to make. You may add
    additional JIRA cross references to the same commit, if it's appropriate.
    In general try to avoid combining unrelated issues in the same
    commit.</p><p>Don't forget to rebase your local fork from the original master and
    then push your commits back to your fork.</p><div class="mediaobject"><img src="images/Chapter-Getting_Involved/jira_crossreferenced.png"/></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e395"/>3.7. Submit Pull Requests</h2></div></div></div><p>With your code rebased from original master and pushed to your
    personal github area, you can now submit your work as a pull request. If
    you look at the top of the page in github for your work area their will be
    a "Pull Request" button. Selecting this will then provide a gui to
    automate the submission of your pull request.</p><p>The pull request then goes into a queue for everyone to see and
    comment on. Below you can see a typical pull request. The pull requests
    allow for discussions and it shows all associated commits and the diffs
    for each commit. The discussions typically involve code reviews which
    provide helpful suggestions for improvements, and allows for us to leave
    inline comments on specific parts of the code. Don't be disheartened if we
    don't merge straight away, it can often take several revisions before we
    accept a pull request. Luckily github makes it very trivial to go back to
    your code, do some more commits and then update your pull request to your
    latest and greatest.</p><p>It can take time for us to get round to responding to pull requests,
    so please be patient. Submitted tests that come with a fix will generally
    be applied quite quickly, where as just tests will often way until we get
    time to also submit that with a fix. Don't forget to rebase and resubmit
    your request from time to time, otherwise over time it will have merge
    conflicts and core developers will general ignore those.</p><div class="mediaobject"><img src="images/Chapter-Getting_Involved/submit_pull_request.png"/></div></div></div><div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="releaseNotes"/>Chapter 4. Drools Release Notes</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#releaseNotes_5.5.0">4.1. What is New and Noteworthy in Drools 5.5.0</a></span></dt><dd><dl><dt><span class="section"><a href="#releaseNotes_5.5.0_Expert">4.1.1. Drools Expert</a></span></dt><dt><span class="section"><a href="#releaseNotes_5.5.0_Guvnor">4.1.2. Guvnor</a></span></dt><dt><span class="section"><a href="#releaseNotes_5.5.0_Planner">4.1.3. Planner</a></span></dt><dt><span class="section"><a href="#releaseNotes_5.5.0_Drools Integration">4.1.4. Drools Integration</a></span></dt></dl></dd><dt><span class="section"><a href="#releaseNotes_5.4.0">4.2. What is New and Noteworthy in Drools 5.4.0</a></span></dt><dd><dl><dt><span class="section"><a href="#releaseNotes_5.4.0_Expert">4.2.1. Drools Expert</a></span></dt><dt><span class="section"><a href="#releaseNotes_5.4.0_Fusion">4.2.2. Drools Fusion</a></span></dt><dt><span class="section"><a href="#releaseNotes_5.4.0_Guvnor">4.2.3. Guvnor</a></span></dt><dt><span class="section"><a href="#releaseNotes_5.4.0_Planner">4.2.4. Planner</a></span></dt><dt><span class="section"><a href="#releaseNotes_5.4.0_Eclipse">4.2.5. Eclipse plugin</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e1709">4.3. What is New and Noteworthy in Drools 5.3.0</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e1712">4.3.1. Drools Expert</a></span></dt><dt><span class="section"><a href="#d0e1848">4.3.2. Guvnor</a></span></dt><dt><span class="section"><a href="#d0e2046">4.3.3. Drools Planner</a></span></dt><dt><span class="section"><a href="#d0e2123">4.3.4. Drools Integration</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e2143">4.4. What is New and Noteworthy in Drools 5.2.0</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e2146">4.4.1. Knowledge API (renamed from Drools API)</a></span></dt><dt><span class="section"><a href="#d0e2168">4.4.2. Drools Expert and Fusion</a></span></dt><dt><span class="section"><a href="#d0e2291">4.4.3. Drools and jBPM integration</a></span></dt><dt><span class="section"><a href="#d0e2303">4.4.4. Merging Drools Flow into jBPM5</a></span></dt><dt><span class="section"><a href="#d0e2314">4.4.5. Guvnor</a></span></dt><dt><span class="section"><a href="#d0e2485">4.4.6. Eclipse</a></span></dt><dt><span class="section"><a href="#d0e2493">4.4.7. Maven artifactId changes</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e2797">4.5. What is New and Noteworthy in Drools 5.1.0</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e2800">4.5.1. Drools API</a></span></dt><dt><span class="section"><a href="#d0e2813">4.5.2. Core</a></span></dt><dt><span class="section"><a href="#d0e2940">4.5.3. Expert</a></span></dt><dt><span class="section"><a href="#d0e3029">4.5.4. Flow</a></span></dt><dt><span class="section"><a href="#d0e3095">4.5.5. Guvnor</a></span></dt><dt><span class="section"><a href="#d0e3390">4.5.6. Eclipse</a></span></dt><dt><span class="section"><a href="#d0e3415">4.5.7. Known Issues</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e3426">4.6. What is New and Noteworthy in Drools 5.0.0</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e3429">4.6.1. Drools API</a></span></dt><dt><span class="section"><a href="#d0e3550">4.6.2. Drools Guvnor</a></span></dt><dt><span class="section"><a href="#d0e3634">4.6.3. Drools Expert</a></span></dt><dt><span class="section"><a href="#d0e4013">4.6.4. Drools Flow</a></span></dt><dt><span class="section"><a href="#d0e4184">4.6.5. Drools Fusion</a></span></dt><dt><span class="section"><a href="#d0e4342">4.6.6. Eclipse IDE</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e4371">4.7. What is new in Drools 4.0</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e4376">4.7.1. Language Expressiveness Enhancements</a></span></dt><dt><span class="section"><a href="#d0e4413">4.7.2. Core Engine Enhancements</a></span></dt><dt><span class="section"><a href="#d0e4453">4.7.3. IDE Enhancements</a></span></dt><dt><span class="section"><a href="#d0e4469">4.7.4. Business Rules Management System - BRMS</a></span></dt><dt><span class="section"><a href="#d0e4500">4.7.5. Miscellaneous Enhancements</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e4507">4.8. Upgrade tips from Drools 3.0.x to Drools 4.0.x</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e4514">4.8.1. API changes</a></span></dt><dt><span class="section"><a href="#d0e4571">4.8.2. Rule Language Changes</a></span></dt><dt><span class="section"><a href="#d0e4630">4.8.3. Drools Update Tool</a></span></dt><dt><span class="section"><a href="#d0e4656">4.8.4. DSL Grammars in Drools 4.0</a></span></dt><dt><span class="section"><a href="#d0e4673">4.8.5. Rule flow Update for 4.0.2</a></span></dt></dl></dd></dl></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="releaseNotes_5.5.0"/>4.1. What is New and Noteworthy in Drools 5.5.0</h2></div></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="releaseNotes_5.5.0_Expert"/>4.1.1. Drools Expert</h3></div></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e416"/>4.1.1.1. Grouped accessors for nested objects</h4></div></div></div><p>We already allow nested accessors to be used as follows, where address is the nested object:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">Person( name == "mark", address.city == "london", address.country == "uk" )</pre><p>Now these accessors to nested objects can be grouped with a '.(...)' syntax providing more readable rules as
      it follows:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">Person( name==  "mark", address.( city == "london", country ==  "uk") )</pre><p>Note the '.' prefix, this is necessary to differentiate the nested object constraints from a method
      call.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e429"/>4.1.1.2. Inline casts and coercion</h4></div></div></div><p>When dealing with nested objects, we may need to cast to a subtype. Now it is possible to do that via the #
      symbol as in:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">Person( name=="mark", address#LongAddress.country == "uk" )</pre><p>This example casts Address to LongAddress, making its getters available. If the cast is not possible
      (instanceof returns false), the evaluation will be considered false. Also fully qualified names are
      supported:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">Person( name=="mark", address#org.domain.LongAddress.country == "uk" )</pre><p>It is possible to use multiple inline casts in the same expression:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">Person( name == "mark", address#LongAddress.country#DetailedCountry.population &gt; 10000000 )</pre><p>moreover, since we also support the instanceof operator, if that is used we will infer its results for
      further uses of that field, within that pattern:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">Person(  name=="mark", address instanceof LongAddress, address.country == "uk" )</pre></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e448"/>4.1.1.3. Conditional named consequences</h4></div></div></div><p>Sometimes the constraint of having one single consequence for each rule can be somewhat limiting and leads
      to verbose and difficult to be maintained repetitions like in the following example:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">rule "Give 10% discount to customers older than 60"
when
    $customer : Customer( age &gt; 60 )
then
    modify($customer) { setDiscount( 0.1 ) };
end

rule "Give free parking to customers older than 60"
when
    $customer : Customer( age &gt; 60 )
    $car : Car ( owner == $customer )
then
    modify($car) { setFreeParking( true ) };
end</pre><p>It is already possible to partially overcome this problem by making the second rule extending the first one
      like in:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">rule "Give 10% discount to customers older than 60"
when
    $customer : Customer( age &gt; 60 )
then
    modify($customer) { setDiscount( 0.1 ) };
end

rule "Give free parking to customers older than 60"
    extends "Give 10% discount to customers older than 60"
when
    $car : Car ( owner == $customer )
then
    modify($car) { setFreeParking( true ) };
end</pre><p>Anyway this feature makes it possible to define more labelled consequences other than the default one in a
      single rule, so, for example, the 2 former rules can be compacted in only one like it follows:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">rule "Give 10% discount and free parking to customers older than 60"
when
    $customer : Customer( age &gt; 60 )
    do[giveDiscount]
    $car : Car ( owner == $customer )
then
    modify($car) { setFreeParking( true ) };
then[giveDiscount]
    modify($customer) { setDiscount( 0.1 ) };
end</pre><p>This last rule has 2 consequences, the usual default one, plus another one named "giveDiscount" that is
      activated, using the keyword do, as soon as a customer older than 60 is found in the knowledge base, regardless of
      the fact that he owns a car or not. The activation of a named consequence can be also guarded by an additional
      condition like in this further example:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">rule "Give free parking to customers older than 60 and 10% discount to golden ones among them"
when
    $customer : Customer( age &gt; 60 )
    if ( type == "Golden" ) do[giveDiscount]
    $car : Car ( owner == $customer )
then
    modify($car) { setFreeParking( true ) };
then[giveDiscount]
    modify($customer) { setDiscount( 0.1 ) };
end</pre><p>The condition in the if statement is always evaluated on the pattern immediately preceding it. In the end
      this last, a bit more complicated, example shows how it is possible to switch over different conditions using a
      nested if/else statement:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">rule "Give free parking and 10% discount to over 60 Golden customer and 5% to Silver ones"
when
    $customer : Customer( age &gt; 60 )
    if ( type == "Golden" ) do[giveDiscount10]
    else if ( type == "Silver" ) break[giveDiscount5]
    $car : Car ( owner == $customer )
then
    modify($car) { setFreeParking( true ) };
then[giveDiscount10]
    modify($customer) { setDiscount( 0.1 ) };
then[giveDiscount5]
    modify($customer) { setDiscount( 0.05 ) };
end</pre><p>Here the purpose is to give a 10% discount AND a free parking to Golden customers over 60, but only a 5%
      discount (without free parking) to the Silver ones. This result is achieved by activating the consequence named
      "giveDiscount5" using the keyword break instead of do. In fact do just schedules a consequence in the agenda,
      allowing the remaining part of the LHS to continue of being evaluated as per normal, while break also blocks any
      further pattern matching evaluation. Note, of course, that the activation of a named consequence not guarded by
      any condition with break doesn't make sense (and generates a compile time error) since otherwise the LHS part
      following it would be never reachable.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e473"/>4.1.1.4. Logging support</h4></div></div></div><p>Drools now has logging support. It can log to your favorite logger (such as logback, log4j, commons-logging,
      JDK logger, no logging, ...) through the SFL4J API.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e478"/>4.1.1.5. Null-safe dereferencing operator in Drools patterns</h4></div></div></div><p>The !. operator allows to derefencing in a null-safe way. More in details the matching algorithm requires
      the value to the left of the !. operator to be not null in order to give a positive result for pattern matching
      itself. In other words the pattern:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">Person( $streetName : address!.street )</pre><p>will be internally translated in:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">Person( address != null, $streetName : address.street )</pre><p>More information about the rationals that drove the decisions related to this implementation are available
      <a class="link" href="https://plus.google.com/u/0/b/101003552532172845268/101003552532172845268/posts/E5Q1geu8p6P" target="">here</a>.</p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="releaseNotes_5.5.0_Guvnor"/>4.1.2. Guvnor</h3></div></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e497"/>4.1.2.1. Improved consistency of BRL editor</h4></div></div></div><p>The Guided Rule Editor (BRL) has been made more consistent with the other editors in Guvnor.</p><p>The left-hand side (WHEN) part of the rule is now authored in a similar manner to the right-hand side
      (THEN).</p><div class="itemizedlist"><ul><li><p>Additional popups for literal values have been removed</p></li><li><p>Date selectors are consistent with Decision Tables and Rule Templates</p></li></ul></div><div class="figure"><a id="d0e511"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Release_Notes/brl-consistency.png" align="middle" alt="Improved consistency"/></div></div><p class="title"><b>Figure 4.1. Improved consistency</b></p></div><br class="figure-break"/></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e517"/>4.1.2.2. Exposure of non-Java Bean compliant class members</h4></div></div></div><p>In response to a request (https://issues.jboss.org/browse/GUVNOR-1756) to be able to build a rule that bound
      a variable to the size of a java.util.List we have now exposed model class members that do not adhere to the Java
      Bean conventions. i.e. you can now select model class members that are not "getXXX" or "setXXX".</p><p>If you import a Java POJO model be prepared to see more members listed than you may have had
      previously.</p><div class="figure"><a id="d0e524"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Release_Notes/brl-additional-members1.png" align="middle" alt="Additional members"/></div></div><p class="title"><b>Figure 4.2. Additional members</b></p></div><br class="figure-break"/><div class="figure"><a id="d0e530"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Release_Notes/brl-additional-members2.png" align="middle" alt="An example rule"/></div></div><p class="title"><b>Figure 4.3. An example rule</b></p></div><br class="figure-break"/></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e536"/>4.1.2.3. Valid indicator for assets</h4></div></div></div><p>A valid indicator has now been added to the asset lists as well as the asset editors. The indicator shows
      whether an asset is valid, invalid or if the validity of the asset is undetermined. For already existing assets
      the validity of the asset will remain undetermined until the next time either validation is run on the asset or
      the asset has been saved again.</p><div class="figure"><a id="d0e541"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Release_Notes/valid_indicator.png" align="middle" alt="Indicator in asset list"/></div></div><p class="title"><b>Figure 4.4. Indicator in asset list</b></p></div><br class="figure-break"/><div class="figure"><a id="d0e547"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Release_Notes/toolbar_valid_indicator.png" align="middle" alt="Toolbar indicator"/></div></div><p class="title"><b>Figure 4.5. Toolbar indicator</b></p></div><br class="figure-break"/></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e553"/>4.1.2.4. Guided rule editor supports "entry-points" in Accumlates and Collects</h4></div></div></div><p>The guided rule editor now supports nesting entry-points in "from accumulate" and "from collect" constructs.
      Define a "from accumulate" or "from collect" in the usual manner and then choose "from entry-point" when defining
      the inner pattern. This feature is also available in Rule Templates and the guided web-based Decision Table's BRL
      fragment columns.</p><div class="figure"><a id="d0e558"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Release_Notes/guided-editor-accumulate-from-entry-point.png" align="middle" alt="Accumulate with entry-point"/></div></div><p class="title"><b>Figure 4.6. Accumulate with entry-point</b></p></div><br class="figure-break"/></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e564"/>4.1.2.5. Guided Decision Table receives an Audit Log</h4></div></div></div><p>An audit log has been added to the web-guided Decision Table editor to track additions, deletions and
      modifications.</p><p>By default the audit log is not configured to record any events, however, users can easily select the events
      in which they are interested.</p><p>The audit log is persisted whenever the asset is checked in.</p><div class="figure"><a id="d0e573"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Release_Notes/audit-log1.png" align="middle" alt="An empty audit log"/></div></div><p class="title"><b>Figure 4.7. An empty audit log</b></p></div><br class="figure-break"/><p>Once the capture of events has been enabled all subsequent operations are recorded. Users are able to
      perform the following:</p><div class="itemizedlist"><ul><li><p>Record an explanatory note beside each event.</p></li><li><p>Delete an event from the log. Event details remain in the underlying repository.</p></li></ul></div><div class="figure"><a id="d0e588"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Release_Notes/audit-log2.png" align="middle" alt="Example of audit events"/></div></div><p class="title"><b>Figure 4.8. Example of audit events</b></p></div><br class="figure-break"/></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e594"/>4.1.2.6. Guided Rule Editor - Remove frozen sections</h4></div></div></div><p>Sections of the Guided Rule Editor can become "frozen" if the Fact Type on which they rely is deleted from
      the available models, or the entire model is removed. Up until now the frozen section could not be removed and the
      whole rule had to be deleted and re-created from scratch. With this release frozen sections can be deleted.</p><p>The section is also marked with an icon indicating the error.</p><div class="figure"><a id="d0e601"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Release_Notes/guided-editor-frozen-sections.png" align="middle" alt="Deleting frozen sections"/></div></div><p class="title"><b>Figure 4.9. Deleting frozen sections</b></p></div><br class="figure-break"/></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e607"/>4.1.2.7. **INCUBATOR FEATURE** New Rule Asset - Scorecards</h4></div></div></div><p>A scorecard is a graphical representation of a formula used to calculate an overall score. A scorecard can
      be used to predict the likelihood or probability of a certain outcome. Drools now supports additive scorecards. An
      additive scorecard calculates an overall score by adding all partial scores assigned to individual rule
      conditions.</p><p>Additionally, Drools Scorecards will allows for reason codes to be set, which help in identifying the
      specific rules (buckets) that have contributed to the overall score. Drools Scorecards will be based on the PMML
      4.1 Standard.</p><p>The New Rule Wizard now allows for creation of scorecard assets.</p><div class="figure"><a id="d0e616"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Release_Notes/scorecard_new_asset.png" align="middle" alt="New Rule Dialog with New Asset Types"/></div></div><p class="title"><b>Figure 4.10. New Rule Dialog with New Asset Types</b></p></div><br class="figure-break"/><div class="figure"><a id="d0e622"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Release_Notes/scorecard_xls_asset.png" align="middle" alt="Scorecard Asset - Upload from Excel"/></div></div><p class="title"><b>Figure 4.11. Scorecard Asset - Upload from Excel</b></p></div><br class="figure-break"/><div class="figure"><a id="d0e628"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Release_Notes/scorecard_asset_webeditor.png" align="middle" alt="Scorecard Asset - Guided Editor"/></div></div><p class="title"><b>Figure 4.12. Scorecard Asset - Guided Editor</b></p></div><br class="figure-break"/></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="releaseNotes_5.5.0_Planner"/>4.1.3. Planner</h3></div></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e637"/>4.1.3.1. New selector architecture</h4></div></div></div><p>The new selector architecture is far more flexible and powerful. It works great out-of-the-box, but it can
      also be easily tailored to your use case for additional gain.</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">unionMoveSelector</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">cacheType</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">JUST_IN_TIME</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">cacheType</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">selectionOrder</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">RANDOM</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">selectionOrder</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">changeMoveSelector</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">swapMoveSelector</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...</span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">unionMoveSelector</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre><div class="mediaobject"><img src="images/Chapter-Release_Notes/selectorTree.png"/></div><p>Custom move factories are often no longer needed (but still supported). For now, the new selector
      architecture is only applied on local search (tabu search, simulated annealing, ...), but it will be applied on
      construction heuristics too.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e649"/>4.1.3.2. Highly scalable planning with Just In Time random selection</h4></div></div></div><p>The new selector architecture allows for Just In Time random selection. For very large use cases, this
      configuration uses far <span class="bold"><strong>less memory</strong></span> and is several times <span class="bold"><strong>faster in performance</strong></span> than the older configurations. Every move is generated just in time
      and there's no move list that needs shuffling:</p><div class="mediaobject"><img src="images/Chapter-Release_Notes/jitRandomSelection.png"/></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e663"/>4.1.3.3. Filtered selection</h4></div></div></div><p>Filtered selection allows you to discard specific moves easily, such as a pointless move that swaps 2
      lectures of the same course:</p><div class="mediaobject"><img src="images/Chapter-Release_Notes/filteredSelection.png"/></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e671"/>4.1.3.4. Probability selection</h4></div></div></div><p>Probability selection allows you to favor certain moves more than others.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e676"/>4.1.3.5. Richer benchmarker report</h4></div></div></div><p>The benchmarker report has been improved, both visually:</p><div class="mediaobject"><img src="images/Chapter-Release_Notes/benchmarkReportTwitterBootstrap.png"/></div><p>... and in content:</p><div class="itemizedlist"><ul><li><p>New chart and table: Worst score difference percentage</p></li><li><p>Every chart that shows a score, now exists for every score level, so there is now a hard score chart
          too.</p></li><li><p>Each chart now has a table with the data too. This is especially useful for matrix benchmarks when the
          graphs become cluttered due to too much data.</p></li><li><p>Each solver configuration is now shown in the report.</p></li><li><p>General benchmark information (such as warm up time) is now also recorded.</p></li><li><p>The favorite solver configuration is clearly marked in charts.</p></li></ul></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e705"/>4.1.3.6. Matrix benchmarking and parallel benchmarking (thanks to Lukas Petrovicky)</h4></div></div></div><p>The benchmarker now supports matrix benchmarking based on a template, which allows you to benchmark a
      combination of ranges of values easily.</p><p>And if you have multiple CPU's in your computer, the benchmarker can now take advantage of them thanks to
      parallel benchmarking.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e712"/>4.1.3.7. Improved continuous planning with movableEntitySelectionFilter (AKA entity locking)</h4></div></div></div><p>It's now possible to prevent a planning entity from being changed at all. This is very useful for continuous
      planning where last week's entities shouldn't change.</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">@PlanningEntity(movableEntitySelectionFilter = MovableShiftAssignmentSelectionFilter.class)
public class ShiftAssignment {
    ...
}</pre></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e719"/>4.1.3.8. Late acceptance</h4></div></div></div><p>There's a new local search algorithm: late acceptance.</p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="releaseNotes_5.5.0_Drools Integration"/>4.1.4. Drools Integration</h3></div></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e727"/>4.1.4.1. Environment Definition</h4></div></div></div><p>drools-spring module now supports declarative definition of Environment
      (org.drools.runtime.Environment)</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
&lt;drools:environment id="..."&gt;
  &lt;drools:entity-manager-factory ref=".."/&gt;
  &lt;drools:transaction-manager ref=".."/&gt;
  &lt;drools:globals ref=".."/&gt;
  &lt;drools:object-marshalling-strategies&gt;
    ...
  &lt;/drools:object-marshalling-strategies&gt;
  &lt;drools:scoped-entity-manager scope="app|cmd" ref="..."/&gt;
&lt;/drools:environment&gt;
        </pre></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e734"/>4.1.4.2. Knowledge Loggers</h4></div></div></div><p>Using Spring XML, you can configure the knowledge runtime loggers (console, file, threaded-file).</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
  &lt;drools:ksession id="k1" type="stateless" kbase="kbase1"&gt;
    &lt;drools:consoleLogger id=".."/&gt;
    &lt;drools:fileLogger file="..." threaded="true|false"/&gt;
  &lt;/drools:ksession&gt;
</pre></div></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="releaseNotes_5.4.0"/>4.2. What is New and Noteworthy in Drools 5.4.0</h2></div></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="releaseNotes_5.4.0_Expert"/>4.2.1. Drools Expert</h3></div></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e747"/>4.2.1.1. Traits</h4></div></div></div><p>Traits were introduced in the 5.3 release, and details on them can be found in the N&amp;N for there. This
      release adds an example so that people have something simple to run, to help them understand. In the
      drools-examples source project open the classes and drl for the namespace "/org/drools/examples/traits". There you
      will find an example around classifications of students and workers.</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">rule "Students and Workers" no-loop when
    $p : Person( $name : name, 
                 $age : age &lt; 25,  
                 $weight : weight )
then
    IWorker w = don( $p, IWorker.class, true );
    w.setWage( 1200 );
    update( w );

    IStudent s = don( $p, IStudent.class, true );
    s.setSchool( "SomeSchool" );
    update( s );
end


rule "Working Students" salience -10 when
    $s : IStudent( $school : school, 
                   $name : name,
                   this isA IWorker, 
                   $wage : fields[ "wage" ] )
then
    System.out.println( $name + " : I have " + $wage + " to pay the fees at " + $school );
end</pre><p>A two part detailed article has been written up at a blog, which will later be improved and rolled into the
      main documentation. For now you can read them here.</p><div class="itemizedlist"><ul><li><p><a class="link" href="http://blog.athico.com/2011/12/new-feature-spotlight-traits-part-1.html" target="">http://blog.athico.com/2011/12/new-feature-spotlight-traits-part-1.html</a></p></li><li><p><a class="link" href="http://blog.athico.com/2011/12/dynamic-typing-in-rules-traits-part-2.html" target="">http://blog.athico.com/2011/12/dynamic-typing-in-rules-traits-part-2.html</a></p></li></ul></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e765"/>4.2.1.2. Simulation and Test</h4></div></div></div><p>The simulation project that was first started in 2009, <a class="link" href="http://blog.athico.com/2009/07/drools-simulation-and-test-framework.html" target="">http://blog.athico.com/2009/07/drools-simulation-and-test-framework.html</a>,
      has undergone an over haul and is now in a usable state. We have not yet promoted this to
      <code class="literal">knowledge-api</code>, so it's considered unstable and will change during the beta process. For now
      though, the adventurous people can take a look at the unit tests and start playing.</p><div class="mediaobject"><img src="images/Chapter-Release_Notes/simulation.jpg"/></div></div><div class="section" lang="en-US"><div class="titlepage"/><p>The Simulator runs the Simulation. The Simulation is your scenario definition. The Simulation consists of 1
      to n Paths, you can think of a Path as a sort of Thread. The Path is a chronological line on which Steps are
      specified at given temporal distances from the start. You don't specify a time unit for the Step, say 12:00am,
      instead it is always a relative time distance from the start of the Simulation (note: in Beta2 this will be
      relative time distance from the last step in the same path). Each Step contains one or more Commands, i.e. create
      a <code class="literal">StatefulKnowledgeSession</code> or insert an object or start a process. These are the very same
      commands that you would use to script a knowledge session using the batch execution, so it's re-using existing
      concepts.</p><div class="itemizedlist"><ul><li><p>1.1 Simulation</p><div class="itemizedlist"><ul><li><p>1..n Paths</p><div class="itemizedlist"><ul><li><p>1..n Steps</p><div class="itemizedlist"><ul><li><p>1..n Commands</p></li></ul></div></li></ul></div></li></ul></div></li></ul></div><p>All the steps, from all paths, are added to a priority queue which is ordered by the temporal distance, and
      allows us to incrementally execute the engine using a time slicing approach. The simulator pops of the steps from
      the queue in turn. For each Step it increments the engine clock and then executes all the Step's Commands.</p><p>Here is an example Command (notice it uses the same Commands as used by the CommandExecutor):</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">new InsertObjectCommand( new Person( "darth", 97 ) )</pre><p>Commands can be grouped together, especially Assertion commands, via test groups. The test groups are mapped
      to JUnit "test methods", so as they pass or fail using a specialised JUnit Runner the Eclipse GUI is updated - as
      illustrated in the above image, showing two passed test groups named "test1" and "test2".</p><p>Using the JUnit integration is trivial. Just annotate the class with @RunWith(JUnitSimulationRunner.class).
      Then any method that is annotated with @Test and returns a Simulation instance will be invoked executing the
      returned Simulation instance in the Simulator. As test groups are executed the JUnit GUI is updated.</p><p>When executing any commands on a KnowledgeBuilder, KnowledgeBase or StatefulKnowledgeSession the system
      assumes a "register" approach. To get a feel for this look at the <a class="link" href="https://github.com/droolsjbpm/droolsjbpm-integration/blob/8100e28668537aa5fe04ce5dd0a62f3dc779b30f/drools-simulator/src/test/java/org/drools/simulation/impl/SimulationTest.java" target="">org.drools.simulation.impl.SimulationTest</a> at github
      (path may change over time).</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">cmds.add( new NewKnowledgeBuilderCommand( null ) );
cmds.add( new SetVariableCommandFromLastReturn( "path1",
                                                KnowledgeBuilder.class.getName() ) );

cmds.add( new KnowledgeBuilderAddCommand( ResourceFactory.newByteArrayResource( str.getBytes() ),
                                          ResourceType.DRL, null ) );</pre><p>Notice the set command. "path1" is the context, each path has it's own variable context. All paths inherit
      from a "root" context. "KnowledgeBuilder.class.getName() " is the name that we are setting the return value of the
      last command. As mentioned before we consider the class names of those classes as registers, any further commands
      that attempt to operate on a knowledge builder will use what ever is assigned to that, as in the case of
      KnowledgeBuilderAddCommand. This allows multiple kbuilders, kbases and ksessions to exist in one context under
      different variable names, but only the one assigned to the register name is the one that is currently executed
      on.</p><p>The code below show the rough outline used in SimulationTest:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">Simulation simulation = new SimulationImpl();
PathImpl path = new PathImpl( simulation,
                              "path1" );                              
simulation.getPaths().put( "path1",
                           path );                                      
List&lt;Step&gt; steps = new ArrayList&lt;Step&gt;();
path.setSteps( steps );
List&lt;Command&gt; cmds = new ArrayList&lt;Command&gt;();
.... add commands to step here ....
// create a step at temporal distance of 2000ms from start
steps.add( new StepImpl( path,
                         cmds,
                         2000 ) ); </pre><p>We know the above looks quite verbose. SimulationTest just shows our low level canonical model, the idea is
      that high level representations are built ontop of this. As this is a builder API we are currently focusing on two
      sets of fluents, compact and standard. We will also work on a spreadsheet UI for building these, and eventually a
      dedicated textual dsl.</p><p>The compact fluent is designed to provide the absolute minimum necessary to run against a single ksession. A
      good place to start is <a class="link" href="https://github.com/droolsjbpm/droolsjbpm-integration/blob/8100e28668537aa5fe04ce5dd0a62f3dc779b30f/drools-simulator/src/test/java/org/drools/simulation/impl/CompactFluentTest.java" target="">org.drools.simulation.impl.CompactFluentTest</a>,
      a snippet of which is shown below. Notice we set "yoda" to "y" and can then assert on that. Currently inside of
      the test string it executes using mvel. The eventual goal is to build out a set of <a class="link" href="http://code.google.com/p/hamcrest/" target="">hamcrest</a> matchers that will allow assertions against the
      state of the engine, such as what rules have fired and optionally with with data.</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">FluentCompactSimulation f = new FluentCompactSimulationImpl();
f.newStatefulKnowledgeSession()
    .getKnowledgeBase()
    .addKnowledgePackages( ResourceFactory.newByteArrayResource( str.getBytes() ),
                           ResourceType.DRL )
    .end()
    .newStep( 100 ) // increases the time 100ms
    .insert( new Person( "yoda",
                         150 ) ).set( "y" )
    .fireAllRules()
    // show testing inside of ksession execution
    .test( "y.name == 'yoda'" )
    .test( "y.age == 160" );</pre><p>Note that the test is not executing at build time, it's building a script to be executed later. The script
      underneath matches what you saw in SimulationTest. Currently the way to run a simulation manually is shown below.
      Although you already saw in SimulationTest that JUnit will execute these automatically. We'll improve this over
      time.</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">SimulationImpl sim = (SimulationImpl) ((FluentCompactSimulationImpl) f).getSimulation();
Simulator simulator = new Simulator( sim,
                                     new Date().getTime() );
simulator.run();</pre><p>The standard fluent is almost a 1 to 1 mapping to the canonical path, step and command structure in
      SimulationTest- just more compact. Start by looking in <a class="link" href="https://github.com/droolsjbpm/droolsjbpm-integration/blob/8100e28668537aa5fe04ce5dd0a62f3dc779b30f/drools-simulator/src/test/java/org/drools/simulation/impl/StandardFluentTest.java" target="">org.drools.simulation.impl.StandardFluentTest</a>. This fluent allows you to run any number of
      paths and steps, along with a lot more control over multiple kbuilders, kbases and ksessions.</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">FluentStandardSimulation f = new FluentStandardSimulationImpl();      
f.newPath("init")
     .newStep( 0 )
          // set to ROOT, as I want paths to share this
         .newKnowledgeBuilder()
             .add( ResourceFactory.newByteArrayResource( str.getBytes() ),
                   ResourceType.DRL )
         .end(ContextManager.ROOT, KnowledgeBuilder.class.getName() )
         .newKnowledgeBase()
             .addKnowledgePackages()
         .end(ContextManager.ROOT, KnowledgeBase.class.getName() )
    .end()
 .newPath( "path1" )
    .newStep( 1000 )
        .newStatefulKnowledgeSession()
            .insert( new Person( "yoda", 150 ) ).set( "y" )
            .fireAllRules()
            .test( "y.name == 'yoda'" )
            .test( "y.age == 160" )
        .end()
    .end()
 .newPath( "path2" )
    .newStep( 800 )
        .newStatefulKnowledgeSession()
            .insert( new Person( "darth", 70 ) ).set( "d" )
            .fireAllRules()
            .test( "d.name == 'darth'" )
            .test( "d.age == 80" )
        .end()
    .end()
 .end</pre><p>There is still an awful lot to do, this is designed to eventually provide a unified simulation and testing
      environment for rules, workflow and event processing over time, and eventually also over distributed
      architectures.</p><div class="itemizedlist"><ul><li><p>Flesh out the api to support more commands, and also to encompass jBPM commands</p></li><li><p>Improve out of the box usability, including moving interfaces to knowledge-api and hiding "new"
          constructors with factory methods</p></li><li><p>Commands are already marshallable to json and xml. They should be updated to allow full round tripping
          from java api commands and json/xml documents.</p></li><li><p>Develop hamcrest matchers for testing state</p><div class="itemizedlist"><ul><li><p>What rule(s) fired, including optionally what data was used with the executing rule (Drools)</p></li><li><p>What rules are active for a given fact</p></li><li><p>What rules activated and de-activated for a given fact change</p></li><li><p>Process variable state (jBPM)</p></li><li><p>Wait node states (jBPM)</p></li></ul></div></li><li><p>Design and build tabular authoring tools via spreadsheet, targeting the web with round tripping to
          excel.</p></li><li><p>Design and develop textual DSL for authoring - maybe part of DRL (long term task).</p></li></ul></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e884"/>4.2.1.4. Accumulate syntax improvements</h4></div></div></div><p>Multi-function accumulate now supports inline constraints. The
        simplified EBNF is:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">lhsAccumulate := ACCUMULATE LEFT_PAREN lhsAnd (COMMA|SEMICOLON)
                     accumulateFunctionBinding (COMMA accumulateFunctionBinding)*
                    (SEMICOLON constraints)?
                 RIGHT_PAREN SEMICOLON?</pre><p>E.g.:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">rule "Accumulate example"
when
     accumulate( Cheese( $price : price );
                 $a1 : average( $price ),
                 $m1 : min( $price ),
                 $M1 : max( $price );    // a semicolon, followed by inline constraints
                 $a1 &gt; 10 &amp;&amp; $M1 &lt;= 100, // inline constraint
                 $m1 == 5                // inline constraint
               )
then
     // do something
end
</pre></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e895"/>4.2.1.5. XLS \ CSV Decision tables support declared types</h4></div></div></div><p>A new RuleSet property has been added called "Declare".</p><p>This provides a slot in the RuleSet definition to define declared
        types.</p><p>In essence the slot provides a discrete location to add type
        declarations where, previously, they may have been added to a Queries or
        Functions definition.</p><div class="figure"><a id="d0e904"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Release_Notes/dtable-xls-declare.png" align="middle" alt="RuleSet &#34;Declare&#34;"/></div></div><p class="title"><b>Figure 4.13. RuleSet "Declare"</b></p></div><br class="figure-break"/></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e910"/>4.2.1.6. Wumpus World</h4></div></div></div><p>A working version of Wumpus World, an AI example covered in in the
        book "Artificial Intelligence : A Modern Approach", is now available
        among the other examples. A more detailed overview of Wumpus World can
        be found <a class="link" href="http://www.cis.temple.edu/~giorgio/cis587/readings/wumpus.shtml" target="">here</a></p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e917"/>4.2.1.7. Decision Tables support "timer" and "calendar" attributes</h4></div></div></div><p>Support has been added for the "timer" and "calendar" attributes.</p><div class="table"><a id="d0e922"/><p class="title"><b>Table 4.1. New attributes</b></p><div class="table-contents"><table summary="New attributes" border="1"><colgroup><col/><col/><col/></colgroup><thead><tr><th>Keyword</th><th>Initial</th><th>Value</th></tr></thead><tbody><tr><td>TIMER</td><td>T</td><td>A timer definition. See "Timers and Calendars".</td></tr><tr><td>CALENDARS</td><td>E</td><td>A calendars definition. See "Timers and Calendars".</td></tr></tbody></table></div></div><br class="table-break"/></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e949"/>4.2.1.8. KnowledgeBuilder supports building of cross referencing drl files</h4></div></div></div><p>KnowledgeBuilder has a new batch mode, with a fluent interface, that allows to build multiple DRLs at once
        as in the following example:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">KnowledgeBuilder kbuilder = KnowledgeBuilderFactory.newKnowledgeBuilder();
kbuilder.batch()
      .add(ResourceFactory.newByteArrayResource(rules1.getBytes()), ResourceType.DRL)
      .add(ResourceFactory.newByteArrayResource(rules2.getBytes()), ResourceType.DRL)
      .add(ResourceFactory.newByteArrayResource(declarations.getBytes()), ResourceType.DRL)
      .build();</pre><p>In this way it is no longer necessary to build the DRLs files in the right order (e.g. first the DRLs
      containing the type declarations and then the ones with the rules using them) and it will also be possible to have
      circular references among them.</p><p>Moreover the KnowledgeBuilder (regardless if you are using the batch mode or not) also allows to discard
      what has been added with the last DRL(s) building. This can be useful to recover from having added a wrong DRL to
      the KnowledgeBuilder as it follows:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">kbuilder.add(ResourceFactory.newByteArrayResource(wrongDrl.getBytes()), ResourceType.DRL);
if ( kbuilder.hasErrors() ) {
    kbuilder.undo();
}</pre></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e962"/>4.2.1.9. Fine grained property change listeners (Property Reactive)</h4></div></div></div><p>Currently when in a RHS you invoke update() or modify() on a given object it will trigger a revaluation of all
        patterns of the matching object type in the knowledge base. As some have experienced, this can be a problem that
        often can lead to unwanted and useless evaluations and in the worst cases to infinite recursions. The only
        workaround to avoid it was to split up your objects into smaller ones having a 1 to 1 relationship with the
        original object.</p><p>This new feature allows the pattern matching to only react to modification of properties actually
        constrained or bound inside of a given pattern. That will help with performance and recursion and avoid artificial
        object splitting. The implementation is bit mask based, so very efficient. When the engine executes a modify statement
        it uses a bit mask of fields being changed, the pattern will only respond if it has an overlapping bit mask. This does
        not work for update(), and is one of the reason why we promote modify() as it encapsulates the field changes within
        the statement.</p><p>By default this feature is off in order to make the behavior of the rule engine backward compatible with the
        former releases. When you want to activate it on a specific bean you have to annotate it with @propertyReactive.
        This annotation works both on drl type declarations:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">declare Person
    @propertyReactive
    firstName : String
    lastName : String
end</pre><p>and on Java classes:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">@PropertyReactive
public static class Person {
    private String firstName;
    private String lastName;
}</pre><p>In this way, for instance, if you have a rule like the following:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">rule "Every person named Mario is a male" when
    $person : Person( firstName == "Mario" )
then
    modify ( $person )  { setMale( true ) }
end</pre><p>you won't have to add the no-loop attribute to it in order to avoid an infinite recursion because the engine
        recognizes that the pattern matching is done on the 'firstName' property while the RHS of the rule modifies the
        'male' one. Note that this feature does not work for update(), and this is one of the reasons why we promote
        modify() since it encapsulates the field changes within the statement. Moreover, on Java classes, you can also
        annotate any method to say that its invocation actually modifies other properties. For instance in the former
        Person class you could have a method like:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">@Modifies( { "firstName", "lastName" } )
public void setName(String name) {
    String[] names = name.split("\\s");
    this.firstName = names[0];
    this.lastName = names[1];
}</pre><p>That means that if a rule has a RHS like the following:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">modify($person) { setName("Mario Fusco") }</pre><p>it will correctly recognize that the values of both properties 'firstName' and 'lastName' could have
        potentially been modified and act accordingly, not missing of reevaluating the patterns constrained on them. At
        the moment the usage of @Modifies is not allowed on fields but only on methods. This is coherent with the most
        common scenario where the @Modifies will be used for methods that are not related with a class field as in the
        Person.setName() in the former example. Also note that @Modifies is not transitive, meaning that if another method
        internally invokes the Person.setName() one it won't be enough to annotate it with @Modifies( { "name" } ), but it
        is necessary to use @Modifies( { "firstName", "lastName" } ) even on it. Very likely @Modifies transitivity will
        be implemented in the next release.</p><p>For what regards nested accessors, the engine will be notified only for top level fields. In other words a
        pattern matching like:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">Person ( address.city.name == "London ) </pre><p>will be reevaluated only for modification of the 'address' property of a Person object. In the same way the
        constraints analysis is currently strictly limited to what there is inside a pattern. Another example could help
        to clarify this. An LHS like the following:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">$p : Person( )
Car( owner = $p.name )</pre><p>will not listen on modifications of the person's name, while this one will do:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">Person( $name : name )
Car( owner = $name )</pre><p>To overcome this problem it is possible to annotate a pattern with @watch as it follows:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">$p : Person( ) @watch ( name )
Car( owner = $p.name )</pre><p>Indeed, annotating a pattern with @watch allows you to modify the inferred set of properties for which that
        pattern will react. Note that the properties named in the @watch annotation are actually added to the ones
        automatically inferred, but it is also possible to explicitly exclude one or more of them prepending their name
        with a ! and to make the pattern to listen for all or none of the properties of the type used in the pattern
        respectively with the wildcards * and !*. So, for example, you can annotate a pattern in the LHS of a rule
        like:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">// listens for changes on both firstName (inferred) and lastName
Person( firstName == $expectedFirstName ) @watch( lastName )

// listens for all the properties of the Person bean
Person( firstName == $expectedFirstName ) @watch( * )

// listens for changes on lastName and explicitly exclude firstName
Person( firstName == $expectedFirstName ) @watch( lastName, !firstName )

// listens for changes on all the properties except the age one
Person( firstName == $expectedFirstName ) @watch( *, !age )</pre><p>Since doesn't make sense to use this annotation on a pattern using a type not annotated with
        @PropertyReactive the rule compiler will raise a compilation error if you try to do so. Also the duplicated usage
        of the same property in @watch (for example like in: @watch( firstName, ! firstName ) ) will end up in a
        compilation error. In a next release we will make the automatic detection of the properties to be listened smarter
        by doing analysis even outside of the pattern.</p><p>It also possible to enable this feature by default on all the types of your model or to completely disallow
        it by using on option of the KnowledgeBuilderConfiguration. In particular this new PropertySpecificOption can have
        one of the following 3 values:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">- DISABLED =&gt; the feature is turned off and all the other related annotations are just ignored
- ALLOWED =&gt; this is the default behavior: types are not property reactive unless they are not annotated with @PropertySpecific
- ALWAYS =&gt; all types are property reactive by default</pre><p>So, for example, to have a KnowledgeBuilder generating property reactive types by default you could
        do:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">KnowledgeBuilderConfiguration config = KnowledgeBuilderFactory.newKnowledgeBuilderConfiguration();
config.setOption(PropertySpecificOption.ALWAYS);
KnowledgeBuilder kbuilder = KnowledgeBuilderFactory.newKnowledgeBuilder(config);</pre><p>In this last case it will be possible to disable the property reactivity feature on a specific type by
        annotating it with @ClassReactive.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e1023"/>4.2.1.10. Fluent simulation testing</h4></div></div></div><p><span class="emphasis"><em>This API is experimental: future backwards incompatible changes are possible.</em></span></p><p>Using the new fluent simulation testing, you can test your rules in unit tests more easily:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><!-- <br/> --><span class="java_type">Test</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;rejectMinors</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">SimulationFluent</span><span class="java_plain">&nbsp;simulationFluent&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">DefaultSimulationFluent</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">Driver</span><span class="java_plain">&nbsp;john&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">Driver</span><span class="java_separator">(</span><span class="java_literal">&quot;John&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;Smith&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">LocalDate</span><span class="java_separator">().</span><span class="java_plain">minusYears</span><span class="java_separator">(</span><span class="java_literal">10</span><span class="java_separator">));</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">Car</span><span class="java_plain">&nbsp;mini&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">Car</span><span class="java_separator">(</span><span class="java_literal">&quot;MINI-01&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">CarType</span><span class="java_separator">.</span><span class="java_plain">SMALL</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_literal">false</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">BigDecimal</span><span class="java_separator">(</span><span class="java_literal">&quot;10000.00&quot;</span><span class="java_separator">));</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">PolicyRequest</span><span class="java_plain">&nbsp;johnMiniPolicyRequest&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">PolicyRequest</span><span class="java_separator">(</span><span class="java_plain">john</span><span class="java_separator">,</span><span class="java_plain">&nbsp;mini</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;johnMiniPolicyRequest</span><span class="java_separator">.</span><span class="java_plain">addCoverageRequest</span><span class="java_separator">(</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">CoverageRequest</span><span class="java_separator">(</span><span class="java_type">CoverageType</span><span class="java_separator">.</span><span class="java_plain">COLLISION</span><span class="java_separator">));</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;johnMiniPolicyRequest</span><span class="java_separator">.</span><span class="java_plain">addCoverageRequest</span><span class="java_separator">(</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">CoverageRequest</span><span class="java_separator">(</span><span class="java_type">CoverageType</span><span class="java_separator">.</span><span class="java_plain">COMPREHENSIVE</span><span class="java_separator">));</span>
</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;simulationFluent</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">newKnowledgeBuilder</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">add</span><span class="java_separator">(</span><span class="java_type">ResourceFactory</span><span class="java_separator">.</span><span class="java_plain">newClassPathResource</span><span class="java_separator">(</span><span class="java_literal">&quot;org/drools/examples/carinsurance/rule/policyRequestApprovalRules.drl&quot;</span><span class="java_separator">),</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">ResourceType</span><span class="java_separator">.</span><span class="java_plain">DRL</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">end</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">newKnowledgeBase</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">addKnowledgePackages</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">end</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">newStatefulKnowledgeSession</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">insert</span><span class="java_separator">(</span><span class="java_plain">john</span><span class="java_separator">).</span><span class="java_plain">set</span><span class="java_separator">(</span><span class="java_literal">&quot;john&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">insert</span><span class="java_separator">(</span><span class="java_plain">mini</span><span class="java_separator">).</span><span class="java_plain">set</span><span class="java_separator">(</span><span class="java_literal">&quot;mini&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">insert</span><span class="java_separator">(</span><span class="java_plain">johnMiniPolicyRequest</span><span class="java_separator">).</span><span class="java_plain">set</span><span class="java_separator">(</span><span class="java_literal">&quot;johnMiniPolicyRequest&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">fireAllRules</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">test</span><span class="java_separator">(</span><span class="java_literal">&quot;johnMiniPolicyRequest.automaticallyRejected&nbsp;==&nbsp;true&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">test</span><span class="java_separator">(</span><span class="java_literal">&quot;johnMiniPolicyRequest.rejectedMessageList.size()&nbsp;==&nbsp;1&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">end</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">runSimulation</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span></pre><p>You can even test your CEP rules in unit tests without suffering from slow tests:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><!-- <br/> --><span class="java_type">Test</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;lyingAboutAge</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">SimulationFluent</span><span class="java_plain">&nbsp;simulationFluent&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">DefaultSimulationFluent</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">Driver</span><span class="java_plain">&nbsp;realJohn&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">Driver</span><span class="java_separator">(</span><span class="java_literal">&quot;John&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;Smith&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">LocalDate</span><span class="java_separator">().</span><span class="java_plain">minusYears</span><span class="java_separator">(</span><span class="java_literal">10</span><span class="java_separator">));</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">Car</span><span class="java_plain">&nbsp;realMini&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">Car</span><span class="java_separator">(</span><span class="java_literal">&quot;MINI-01&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">CarType</span><span class="java_separator">.</span><span class="java_plain">SMALL</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_literal">false</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">BigDecimal</span><span class="java_separator">(</span><span class="java_literal">&quot;10000.00&quot;</span><span class="java_separator">));</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">PolicyRequest</span><span class="java_plain">&nbsp;realJohnMiniPolicyRequest&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">PolicyRequest</span><span class="java_separator">(</span><span class="java_plain">realJohn</span><span class="java_separator">,</span><span class="java_plain">&nbsp;realMini</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;realJohnMiniPolicyRequest</span><span class="java_separator">.</span><span class="java_plain">addCoverageRequest</span><span class="java_separator">(</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">CoverageRequest</span><span class="java_separator">(</span><span class="java_type">CoverageType</span><span class="java_separator">.</span><span class="java_plain">COLLISION</span><span class="java_separator">));</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;realJohnMiniPolicyRequest</span><span class="java_separator">.</span><span class="java_plain">addCoverageRequest</span><span class="java_separator">(</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">CoverageRequest</span><span class="java_separator">(</span><span class="java_type">CoverageType</span><span class="java_separator">.</span><span class="java_plain">COMPREHENSIVE</span><span class="java_separator">));</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;realJohnMiniPolicyRequest</span><span class="java_separator">.</span><span class="java_plain">setAutomaticallyRejected</span><span class="java_separator">(</span><span class="java_literal">true</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;realJohnMiniPolicyRequest</span><span class="java_separator">.</span><span class="java_plain">addRejectedMessage</span><span class="java_separator">(</span><span class="java_literal">&quot;Too&nbsp;young.&quot;</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">Driver</span><span class="java_plain">&nbsp;fakeJohn&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">Driver</span><span class="java_separator">(</span><span class="java_literal">&quot;John&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;Smith&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">LocalDate</span><span class="java_separator">().</span><span class="java_plain">minusYears</span><span class="java_separator">(</span><span class="java_literal">30</span><span class="java_separator">));</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">Car</span><span class="java_plain">&nbsp;fakeMini&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">Car</span><span class="java_separator">(</span><span class="java_literal">&quot;MINI-01&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">CarType</span><span class="java_separator">.</span><span class="java_plain">SMALL</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_literal">false</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">BigDecimal</span><span class="java_separator">(</span><span class="java_literal">&quot;10000.00&quot;</span><span class="java_separator">));</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">PolicyRequest</span><span class="java_plain">&nbsp;fakeJohnMiniPolicyRequest&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">PolicyRequest</span><span class="java_separator">(</span><span class="java_plain">fakeJohn</span><span class="java_separator">,</span><span class="java_plain">&nbsp;fakeMini</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fakeJohnMiniPolicyRequest</span><span class="java_separator">.</span><span class="java_plain">addCoverageRequest</span><span class="java_separator">(</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">CoverageRequest</span><span class="java_separator">(</span><span class="java_type">CoverageType</span><span class="java_separator">.</span><span class="java_plain">COLLISION</span><span class="java_separator">));</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fakeJohnMiniPolicyRequest</span><span class="java_separator">.</span><span class="java_plain">addCoverageRequest</span><span class="java_separator">(</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">CoverageRequest</span><span class="java_separator">(</span><span class="java_type">CoverageType</span><span class="java_separator">.</span><span class="java_plain">COMPREHENSIVE</span><span class="java_separator">));</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fakeJohnMiniPolicyRequest</span><span class="java_separator">.</span><span class="java_plain">setAutomaticallyRejected</span><span class="java_separator">(</span><span class="java_literal">false</span><span class="java_separator">);</span>
</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;simulationFluent</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">newStep</span><span class="java_separator">(</span><span class="java_literal">0</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">newKnowledgeBuilder</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">add</span><span class="java_separator">(</span><span class="java_type">ResourceFactory</span><span class="java_separator">.</span><span class="java_plain">newClassPathResource</span><span class="java_separator">(</span><span class="java_literal">&quot;org/drools/examples/carinsurance/cep/policyRequestFraudDetectionRules.drl&quot;</span><span class="java_separator">),</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">ResourceType</span><span class="java_separator">.</span><span class="java_plain">DRL</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">end</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">newKnowledgeBase</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">addKnowledgePackages</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">end</span><span class="java_separator">(</span><span class="java_type">World</span><span class="java_separator">.</span><span class="java_plain">ROOT</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">KnowledgeBase</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">.</span><span class="java_plain">getName</span><span class="java_separator">())</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">newStatefulKnowledgeSession</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">end</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">newStep</span><span class="java_separator">(</span><span class="java_literal">1000</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">getStatefulKnowledgeSession</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">insert</span><span class="java_separator">(</span><span class="java_plain">realJohn</span><span class="java_separator">).</span><span class="java_plain">set</span><span class="java_separator">(</span><span class="java_literal">&quot;realJohn&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">insert</span><span class="java_separator">(</span><span class="java_plain">realMini</span><span class="java_separator">).</span><span class="java_plain">set</span><span class="java_separator">(</span><span class="java_literal">&quot;realMini&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">insert</span><span class="java_separator">(</span><span class="java_plain">realJohnMiniPolicyRequest</span><span class="java_separator">).</span><span class="java_plain">set</span><span class="java_separator">(</span><span class="java_literal">&quot;realJohnMiniPolicyRequest&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">fireAllRules</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">test</span><span class="java_separator">(</span><span class="java_literal">&quot;realJohnMiniPolicyRequest.requiresManualApproval&nbsp;==&nbsp;false&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">end</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">newStep</span><span class="java_separator">(</span><span class="java_literal">5000</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">getStatefulKnowledgeSession</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">insert</span><span class="java_separator">(</span><span class="java_plain">fakeJohn</span><span class="java_separator">).</span><span class="java_plain">set</span><span class="java_separator">(</span><span class="java_literal">&quot;fakeJohn&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">insert</span><span class="java_separator">(</span><span class="java_plain">fakeMini</span><span class="java_separator">).</span><span class="java_plain">set</span><span class="java_separator">(</span><span class="java_literal">&quot;fakeMini&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">insert</span><span class="java_separator">(</span><span class="java_plain">fakeJohnMiniPolicyRequest</span><span class="java_separator">).</span><span class="java_plain">set</span><span class="java_separator">(</span><span class="java_literal">&quot;fakeJohnMiniPolicyRequest&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">fireAllRules</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">test</span><span class="java_separator">(</span><span class="java_literal">&quot;fakeJohnMiniPolicyRequest.requiresManualApproval&nbsp;==&nbsp;true&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">end</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">runSimulation</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span></pre></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e1037"/>4.2.1.11. UnMatch Listener for Compensation Actions</h4></div></div></div><p>It is now possible to register an UnMatch listener on the Agenda in order to be notified
      when a given activation gets unmatched and take the appropriate compensation actions, as in the follwing example:
      </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">AgendaItem</span><!-- <br/> --><span class="java_plain">&nbsp;item&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">AgendaItem</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">)</span><!-- <br/> --><span class="java_plain">&nbsp;knowledgeHelper</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">getActivation</span><!-- <br/> --><span class="java_separator">();</span>
<!--  --><br/><span class="java_keyword">final</span><span class="java_plain">&nbsp;</span><span class="java_type">Cheese</span><span class="java_plain">&nbsp;cheese&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_type">Cheese</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span><span class="java_plain">&nbsp;item</span><span class="java_separator">.</span><span class="java_plain">getTuple</span><span class="java_separator">().</span><span class="java_plain">getHandle</span><span class="java_separator">().</span><span class="java_plain">getObject</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_keyword">final</span><span class="java_plain">&nbsp;</span><span class="java_type">int</span><span class="java_plain">&nbsp;oldPrice&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;cheese</span><span class="java_separator">.</span><span class="java_plain">getPrice</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">cheese</span><span class="java_separator">.</span><span class="java_plain">setPrice</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">100</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_plain">item</span><span class="java_separator">.</span><span class="java_plain">setActivationUnMatchListener</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">ActivationUnMatchListener</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;unMatch</span><span class="java_separator">(</span><span class="java_plain">&nbsp;org</span><span class="java_separator">.</span><span class="java_plain">drools</span><span class="java_separator">.</span><span class="java_plain">runtime</span><span class="java_separator">.</span><span class="java_plain">rule</span><span class="java_separator">.</span><span class="java_type">WorkingMemory</span><span class="java_plain">&nbsp;wm</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;org</span><span class="java_separator">.</span><span class="java_plain">drools</span><span class="java_separator">.</span><span class="java_plain">runtime</span><span class="java_separator">.</span><span class="java_plain">rule</span><span class="java_separator">.</span><span class="java_type">Activation</span><span class="java_plain">&nbsp;activation&nbsp;</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cheese</span><span class="java_separator">.</span><span class="java_plain">setPrice</span><span class="java_separator">(</span><span class="java_plain">&nbsp;oldPrice&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_separator">}</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span></pre><p>Note that, at the moment, this is an internal impelmentation, that will be eventually
      moved to a stable API in the future. This is why it is only present in our internal API and
      so you need to explicitly cast to AgendaItem in order to be able to use it.</p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="releaseNotes_5.4.0_Fusion"/>4.2.2. Drools Fusion</h3></div></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e1049"/>4.2.2.1. Entry-Point Declaration</h4></div></div></div><p>The engine now supports the declaration of entry-points. This
        allow tools and the application to inspect, select and restrict the use
        of entry-points in rules.</p><p>The simplified EBNF to declare an entry-point is:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">entryPointDeclaration := DECLARE ENTRY-POINT epName annotation* END
epName := stringId
</pre><p>Example:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">declare entry-point STStream
    @doc("A stream of StockTicks")
end
</pre></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e1062"/>4.2.2.2. Window Declaration</h4></div></div></div><p>The engine now supports the declaration of Windows. This promotes
        a clear separation between what are the filters applied to the window
        and what are the constraints applied to the result of window. It also
        allows easy reuse of windows among multiple rules.</p><p>Another benefit is a new implementation of the basic window
        support in the engine, increasing the overall performance of the rules
        that use sliding windows.</p><p>The simplified EBNF to declare a window is:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">windowDeclaration := DECLARE WINDOW ID annotation* lhsPatternBind END</pre><p>Example:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">declare window Ticks
    @doc("last 10 stock ticks")
    StockTick( source == "NYSE" )
        over window:length( 10 )
        from entry-point STStream
end
</pre><p>Rules can then use the declared window by referencing using a FROM
        CE. Example:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">rule "RHT ticks in the window"
when
    accumulate( StockTick( symbol == "RHT" ) from window Ticks,
                $cnt : count(1) )
then
    // there has been $cnt RHT ticks over the last 10 ticks
end
</pre></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="releaseNotes_5.4.0_Guvnor"/>4.2.3. Guvnor</h3></div></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e1084"/>4.2.3.1. Guided Decision Table - Limited Entry</h4></div></div></div><p>The Guided Decision Table editor and wizard now support the creation of "Limited Entry" tables.</p><div class="figure"><a id="d0e1089"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Release_Notes/limited-entry-1.png" align="middle" alt="Selecting the table format"/></div></div><p class="title"><b>Figure 4.14. Selecting the table format</b></p></div><br class="figure-break"/><div class="figure"><a id="d0e1095"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Release_Notes/limited-entry-2.png" align="middle" alt="Defining Limited Entry constraints with the Wizard"/></div></div><p class="title"><b>Figure 4.15. Defining Limited Entry constraints with the Wizard</b></p></div><br class="figure-break"/><div class="figure"><a id="d0e1101"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Release_Notes/limited-entry-3.png" align="middle" alt="Defining Limited Entry actions with the Wizard"/></div></div><p class="title"><b>Figure 4.16. Defining Limited Entry actions with the Wizard</b></p></div><br class="figure-break"/><div class="figure"><a id="d0e1107"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Release_Notes/limited-entry-4.png" align="middle" alt="An example expanded, limited entry table"/></div></div><p class="title"><b>Figure 4.17. An example expanded, limited entry table</b></p></div><br class="figure-break"/><div class="figure"><a id="d0e1113"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Release_Notes/limited-entry-5.png" align="middle" alt="Editing a constraint in the editor"/></div></div><p class="title"><b>Figure 4.18. Editing a constraint in the editor</b></p></div><br class="figure-break"/><div class="figure"><a id="d0e1119"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Release_Notes/limited-entry-6.png" align="middle" alt="Editing an action in the editor"/></div></div><p class="title"><b>Figure 4.19. Editing an action in the editor</b></p></div><br class="figure-break"/></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e1125"/>4.2.3.2. Guided Decision Table - Improved formatting</h4></div></div></div><p>With the introduction of support for Limited Entry, the decision table format was improved to better
      differentiate between Condition and Action columns. Furthermore the table header was improved to show more
      information for Action columns.</p><div class="figure"><a id="d0e1130"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Release_Notes/dtable-column-formatting.png" align="middle" alt="Improved formatting and header"/></div></div><p class="title"><b>Figure 4.20. Improved formatting and header</b></p></div><br class="figure-break"/></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e1136"/>4.2.3.3. Guided Decision Table - Rearranging columns</h4></div></div></div><p>The ability to rearrange whole patterns as well as individual conditions in the constraints section of the
      table has been added. This allows the table author to arrange constraints to maximise performance of the resulting
      rules, by placing generalised constraints before more specific. Action columns can also be re-arranged. Both
      patterns and columns are re-arranged by dragging and dropping.</p><div class="figure"><a id="d0e1141"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Release_Notes/dtable-rearranging-patterns.png" align="middle" alt="Re-arranging Condition patterns"/></div></div><p class="title"><b>Figure 4.21. Re-arranging Condition patterns</b></p></div><br class="figure-break"/><div class="figure"><a id="d0e1147"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Release_Notes/dtable-rearranging-columns.png" align="middle" alt="Re-arranging columns"/></div></div><p class="title"><b>Figure 4.22. Re-arranging columns</b></p></div><br class="figure-break"/></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e1153"/>4.2.3.4. Guided Decision Table - Actions to retract Facts</h4></div></div></div><p>This release brings the ability to define Action columns to retract Facts.</p><p>If you are authoring an Extended Entry decision table the column definition contains basic information and
      the fact being retracted is held in the table itself.</p><div class="figure"><a id="d0e1160"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Release_Notes/dtable-retract-extended-entry.png" align="middle" alt="Defining an Extended Entry retraction"/></div></div><p class="title"><b>Figure 4.23. Defining an Extended Entry retraction</b></p></div><br class="figure-break"/><p>If however you are authoring a Limited Entry decision table the Fact being retracted is defined in the
      column definition.</p><div class="figure"><a id="d0e1168"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Release_Notes/dtable-retract-limited-entry.png" align="middle" alt="Defining a Limited Entry retraction"/></div></div><p class="title"><b>Figure 4.24. Defining a Limited Entry retraction</b></p></div><br class="figure-break"/></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e1174"/>4.2.3.5. Guided Decision Table - Binding condition fields</h4></div></div></div><p>You can now bind fields in Conditions to variables. These variables can then be used in Predicate or Formula
      conditions, and Work Item actions.</p><div class="figure"><a id="d0e1179"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Release_Notes/dtable-field-binding1.png" align="middle" alt="Binding a field"/></div></div><p class="title"><b>Figure 4.25. Binding a field</b></p></div><br class="figure-break"/><div class="figure"><a id="d0e1185"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Release_Notes/dtable-field-binding2.png" align="middle" alt="A Decision Table using bound fields"/></div></div><p class="title"><b>Figure 4.26. A Decision Table using bound fields</b></p></div><br class="figure-break"/></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e1191"/>4.2.3.6. Guided Decision Table - Using jBPM Work Item actions</h4></div></div></div><p>jBPM Work Items can now be used as Actions; and the corresponding Work Item Handler invoked at runtime. Work
      Item Handlers should be added to the runtime session as normal.</p><p>Work Item input parameters can either be defined as a literal value in the column definition or as a Fact or
      Fact Field binding.</p><p>New Actions have been created to perform the following functions:-</p><div class="itemizedlist"><ul><li><p>Execute a Work Item</p></li><li><p>Set the value of a field on an existing Fact to the value of a Work Item output (result)
          parameter.</p></li><li><p>Set the value of a field on a new Fact to the value of a Work Item output (result) parameter.</p></li></ul></div><div class="figure"><a id="d0e1210"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Release_Notes/dtable-workitems1.png" align="middle" alt="New Actions"/></div></div><p class="title"><b>Figure 4.27. New Actions</b></p></div><br class="figure-break"/><div class="figure"><a id="d0e1216"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Release_Notes/dtable-workitems2.png" align="middle" alt="Calling a Work Item"/></div></div><p class="title"><b>Figure 4.28. Calling a Work Item</b></p></div><br class="figure-break"/><div class="figure"><a id="d0e1222"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Release_Notes/dtable-workitems3.png" align="middle" alt="Setting a field from a Work Item output (result) parameter"/></div></div><p class="title"><b>Figure 4.29. Setting a field from a Work Item output (result) parameter</b></p></div><br class="figure-break"/></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e1228"/>4.2.3.7. Decision table analysis</h4></div></div></div><p>On the bottom of Web decision tables, there's now a button <span class="guilabel"><strong>Analyze...</strong></span> which will check
      if there issues in your decision table, such as impossible matches and conflicting matches.</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h5 class="title"><a id="d0e1236"/>4.2.3.7.1. Impossible match detection</h5></div></div></div><p>An impossible match is a row in a decision table that can never match. For example:</p><div class="mediaobject"><img src="images/Chapter-Release_Notes/impossibleMatch.png"/></div><p>In the decision table above, row 2 is an impossible match, because there is no Person with a minimum age
        of 21 and a maximum age of 20.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h5 class="title"><a id="d0e1246"/>4.2.3.7.2. Conflicting match detection</h5></div></div></div><p>A conflicting match are 2 rows in a decision table that can both match.</p><div class="mediaobject"><img src="images/Chapter-Release_Notes/conflictingMatch.png"/></div><p>In the decision table above, row 2 and 3 are a conflicting match, because a Person of age 67 will match
        both rows: it's unclear whether that Person has to pay a fee of 200 or 100.</p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e1256"/>4.2.3.8. REST api changes</h4></div></div></div><div class="itemizedlist"><ul><li><p>Added support to create (PUT) and delete (DELETE) a Category with
          <code class="literal">rest/categories/{categoryName}</code>.</p></li><li><p>Removed buggy <code class="literal">category</code> property from <code class="literal">Package</code>: it was
          <code class="literal">null</code> upon GET and ignored upon PUT.</p></li><li><p>The REST resource to get the assets for a certain category has been moved from
          <code class="literal">rest/categories/{categoryName}</code> to
          <code class="literal">rest/categories/{categoryName}/assets</code>.</p></li><li><p>The REST resources now properly encode and decode the URL's. Note that URL path encoding is different
          than URL query encoding: the former does not accept <code class="literal">+</code> as encoding for space.</p></li></ul></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e1293"/>4.2.3.9. JBoss AS 6 war is no longer shipped in the release</h4></div></div></div><p>This does not mean that Guvnor can not be made to work in AS 6. We are just focusing on JBoss AS 7 and
      Tomcat.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e1298"/>4.2.3.10. Rule Templates - Interpolation keys in free-form DRL</h4></div></div></div><p>When using Rule Templates you can now define interpolation variables in free-form DRL blocks. Template Keys
      are formatted as documented in Drools Expert User Guide; i.e. @{keyName}. All Template Keys in 'free-form' LHS or
      RHS elements are considered 'Text' (i.e. you'll get a TextBox in the Template data screen). Data-types should be
      correctly escaped in the 'free-form' entry. For example: System.out.println("@{key}");</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e1303"/>4.2.3.11. Relational operators for Strings</h4></div></div></div><p>All guided rule editors (BRL, Rule Templates and Decision Tables) now support relation operators for String
      values.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e1308"/>4.2.3.12. Guvnor requirements change</h4></div></div></div><p>Guvnor 5.4.x requires at least Java 6 to run. The Drools and jBPM
        will still run on Java 5. Guvnor 5.3.x hotfixes will still run on Java 5
        too.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e1313"/>4.2.3.13. Guvnor configuration change</h4></div></div></div><p>Any custom configuration in the guvnor war in
        <code class="filename">WEB-INF/components.xml</code> must now happen in
        <code class="filename">WEB-INF/beans.xml</code>.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e1324"/>4.2.3.14. Decision table analysis</h4></div></div></div><p>On the bottom of Web decision tables, the button
        <span class="guilabel"><strong>Analyze...</strong></span> that checks for issues in your decision
        table, now also checks for 2 new detections:</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h5 class="title"><a id="d0e1332"/>4.2.3.14.1. Duplicate match detection</h5></div></div></div><p>A duplicate match are 2 rows in a decision table that can both
          match but have the same actions.</p><p>For example: a person between 20 and 40 has to pay a fee of 400
          and a person between 30 and 50 has to pay a fee of 400 too. These 2
          rows duplicate each other. If the fee would be different between them,
          then they would conflict each other.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h5 class="title"><a id="d0e1339"/>4.2.3.14.2. Multiple values for one action detection</h5></div></div></div><p>A multiple values for one action match is 1 row in a decision
          table who's actions contradict itself. This is a common problem in
          limited entry tables, but rare in non-limited entry tables.</p><p>For example: a person below 40 has to pay the standard fee (400)
          and also has to pay the youngster fee (200). Since fee can only be set
          once, that's a problem.</p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e1346"/>4.2.3.15. Decision table - BRL fragments</h4></div></div></div><p>BRL fragments can now be used for Condition and/or Action
        columns.</p><div class="figure"><a id="d0e1351"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Release_Notes/dtable-advanced-columns.png" align="middle" alt="Adding a BRL fragment"/></div></div><p class="title"><b>Figure 4.30. Adding a BRL fragment</b></p></div><br class="figure-break"/><p>A BRL fragment is a section of a rule created using Guvnor's (BRL)
        Guided Rule Editor: Condition columns permit the definition of "WHEN"
        sections and Action columns the definition of "THEN" sections. Fields
        defined therein as "Template Keys" become columns in the decision
        table.</p><div class="figure"><a id="d0e1359"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Release_Notes/dtable-brl-condition.png" align="middle" alt="A Condition BRL fragment"/></div></div><p class="title"><b>Figure 4.31. A Condition BRL fragment</b></p></div><br class="figure-break"/><div class="figure"><a id="d0e1365"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Release_Notes/dtable-brl-action.png" align="middle" alt="An Action BRL fragment"/></div></div><p class="title"><b>Figure 4.32. An Action BRL fragment</b></p></div><br class="figure-break"/><p>Consequently any rule that could be defined with the (BRL) Guided
        Rule Editor can now be defined with a decision table; including
        free-format DRL and DSL Sentences.</p><p>BRL fragments are fully integrated with other columns in the
        decision table, so that a Pattern or field defined in a regular column
        can be referenced in the BRL fragments and vice-versa.</p><div class="figure"><a id="d0e1375"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Release_Notes/dtable-brl-columns.png" align="middle" alt="A decision table with BRL fragments and regular columns"/></div></div><p class="title"><b>Figure 4.33. A decision table with BRL fragments and regular columns</b></p></div><br class="figure-break"/></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e1381"/>4.2.3.16. Decision table \ Template data copy and paste rows</h4></div></div></div><p>You can now copy and paste rows in both the guided Decision Table
        and Template Data editors.</p><p>Simply right-click a row in the tables' left hand-side selector
        column and choose the appropriate operation.</p><div class="figure"><a id="d0e1388"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Release_Notes/dtable-copy-paste-rows.png" align="middle" alt="Copying a row"/></div></div><p class="title"><b>Figure 4.34. Copying a row</b></p></div><br class="figure-break"/></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e1394"/>4.2.3.17. BRL Editor - Remove Constraint\Action Value definition</h4></div></div></div><p>When creating new constraints or actions in the BRL guided (rule)
        editor it is simple to define a value as literal, or formula or
        expression. However, up until now, changing the value type required
        deletion of the whole constraint or action. This release brings the
        ability to remove the value definition thus enabling you to change a
        literal value to a formula etc without needing to delete the whole
        constraint or action.</p><div class="figure"><a id="d0e1399"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Release_Notes/brl-remove-value-types.png" align="middle" alt="Copying a row"/></div></div><p class="title"><b>Figure 4.35. Copying a row</b></p></div><br class="figure-break"/></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e1405"/>4.2.3.18. New Change-Set Editor</h4></div></div></div><p>A new Editor to create Change-Sets was added in Guvnor. Using this
        new editor you can create change-sets referencing packages, snapshots
        and even particular assets inside a package and expose them to external
        applications. For further information refer to the documentation.</p><div class="figure"><a id="d0e1410"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Release_Notes/NewChangeSet1.png" align="middle" alt="Change-Set Editor"/></div></div><p class="title"><b>Figure 4.36. Change-Set Editor</b></p></div><br class="figure-break"/></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e1416"/>4.2.3.19. Custom Forms in DSL sentences</h4></div></div></div><p>Custom Forms is a feature that exists in Guvnor since 5.1.1. It
        basically allows you to define external applications that will be
        invoked by Rule Editor when a particular field of a particular Fact Type
        is being used in a rule.</p><p>This feature is now also available to be used in DSL sentences.
        When defining a variable in a sentence you can now use this syntax for
        variable's definition:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">{&lt;varName&gt;:CF:&lt;factType.fieldName&gt;}</pre><p>If you have an active Working-Set defining a Custom Form
        configuration for factType.fieldName, the Custom Form will be invoked by
        Rule Editor while setting the value of that variable.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e1427"/>4.2.3.20. BRL editor supports "timer" and "calendar" attributes</h4></div></div></div><p>Support has been added for the "timer" and "calendar" attributes.</p><div class="figure"><a id="d0e1432"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Release_Notes/timerAndCalendarAttributes-guvnor-brl.png" align="middle" alt="Timer and Calendar"/></div></div><p class="title"><b>Figure 4.37. Timer and Calendar</b></p></div><br class="figure-break"/></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e1438"/>4.2.3.21. Decision Tables support "timer" and "calendar" attributes</h4></div></div></div><p>Support has been added for the "timer" and "calendar" attributes.</p><div class="figure"><a id="d0e1443"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Release_Notes/timerAndCalendarAttributes-guvnor-dtable.png" align="middle" alt="Timer and Calendar"/></div></div><p class="title"><b>Figure 4.38. Timer and Calendar</b></p></div><br class="figure-break"/></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e1449"/>4.2.3.22. Guided Decision Tables import from XLS</h4></div></div></div><p>Uploading a XLS decision table results in the creation of numerous new assets, including (obviously)
        web-guided Decision Tables, functions, declarative types and modifications to package globals and imports etc
        (Queries are not converted, although supported in the XLS form, as Guvnor doesn't support them <a class="link" href="https://issues.jboss.org/browse/GUVNOR-1532" target="">yet</a>).</p><div class="figure"><a id="d0e1457"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Release_Notes/dtable-xls.png" align="middle" alt="XLS decision table"/></div></div><p class="title"><b>Figure 4.39. XLS decision table</b></p></div><br class="figure-break"/><div class="figure"><a id="d0e1463"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Release_Notes/dtable-converted.png" align="middle" alt="Guided decision table"/></div></div><p class="title"><b>Figure 4.40. Guided decision table</b></p></div><br class="figure-break"/><p>This is the first stage of "round-tripping" decision tables. We still need to add the ability to export a
        guided decision table back to XLS, plus we'd like to add tighter integration of updated XLS assets to their
        original converted cousins - so if a new version of the XLS decision table is uploaded the related assets'
        versions are updated (rather than creating new) upon conversion.</p><p>This is a powerful enhancement and as such your feedback is critical to ensure we implement the feature as
        you'd like it to operate. Check it out, feedback your opinions and help guide the future work.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e1473"/>4.2.3.23. Improved value editors for numerical types</h4></div></div></div><p>Numerical "value editors" (i.e. the text boxes for numerical values) in the BRL, Rule Template, Test
        Scenarios and Decision Table editors now support the types Byte, Short, Integer, Long, Double, Float, BigDecimal
        and BigInteger (and their primitive counterparts) correctly. The generated DRL is automatically appended with "B"
        or "I" type classifiers for BigDecimal and BigInteger values respectively, as provided for by Drools Expert. The
        Right-hand Side generates applicable DRL for BigDecimal and BigInteger values according to the rule's
        dialect.</p><div class="figure"><a id="d0e1478"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Release_Notes/guvnor-numeric-value-editors.png" align="middle" alt="Example of using a BigDecimal"/></div></div><p class="title"><b>Figure 4.41. Example of using a BigDecimal</b></p></div><br class="figure-break"/></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e1484"/>4.2.3.24. Improved dependent enumerations support</h4></div></div></div><p>Dependent enumerations can now be used in both the Web Guided Decision Table editor and the Rule Template
        Data grid. Furthermore improvements were made to the operation of dependent enumerations in the BRL Guided Rule
        editor for sub-fields and expressions.</p><div class="figure"><a id="d0e1489"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Release_Notes/dtable-dependent-enums.png" align="middle" alt="Dependent enumerations in the Web Guided Decision Table editor"/></div></div><p class="title"><b>Figure 4.42. Dependent enumerations in the Web Guided Decision Table editor</b></p></div><br class="figure-break"/></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e1495"/>4.2.3.25. Improved Guided Decision Table default value support</h4></div></div></div><p>The editor to define a default value has been greatly improved:-</p><div class="itemizedlist"><ul><li><p>A default value editor is correct for the data-type of the column's Fact\.</p></li><li><p>If a "Value List" is provided, the default value needs to be one of the values in the list.</p></li><li><p>If the column represents a field with an enumeration the default value must be one of the enumeration's
            members.</p></li><li><p>If the column uses an operator that does not need a value (e.g. "is null") a default value cannot be
            provided.</p></li><li><p>If the column field is a "dependent enumeration" the default value must be one of the permitted values
            based upon parent enumeration default values, if any.</p></li><li><p>Default values are not required for Limited Entry tables.</p></li></ul></div><div class="figure"><a id="d0e1519"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Release_Notes/dtable-default-1.png" align="middle" alt="Setting the default value of a Date column"/></div></div><p class="title"><b>Figure 4.43. Setting the default value of a Date column</b></p></div><br class="figure-break"/><div class="figure"><a id="d0e1525"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Release_Notes/dtable-default-2.png" align="middle" alt="Setting the default value of a cell with a Value List"/></div></div><p class="title"><b>Figure 4.44. Setting the default value of a cell with a Value List</b></p></div><br class="figure-break"/></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e1531"/>4.2.3.26. New Service Editor</h4></div></div></div><p>A new editor to create services was added in Guvnor. Service is a
        special asset that enables users configure KnowledgeBases and KSessions
        to be executed remotely for any sort of client application (via REST
        or SOAP).</p><p>In order to expose those services, the editor generates automatically a
        war file that can be deployed on most platforms on most containers.
        For further information refer to the documentation.</p><div class="figure"><a id="d0e1538"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Release_Notes/NewServiceConfig1.png" align="middle" alt="The new Service Editor"/></div></div><p class="title"><b>Figure 4.45. The new Service Editor</b></p></div><br class="figure-break"/></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="releaseNotes_5.4.0_Planner"/>4.2.4. Planner</h3></div></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e1547"/>4.2.4.1. Build-in move factories</h4></div></div></div><p>Planner now comes with 2 build-in move factories: <code class="literal">GenericChangeMoveFactory</code> and
      <code class="literal">GenericSwapMoveFactory</code>. Here's an example that uses both of them:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">  &lt;localSearch&gt;
    &lt;selector&gt;
      &lt;selector&gt;
        &lt;moveFactoryClass&gt;org.drools.planner.core.move.generic.GenericChangeMoveFactory&lt;/moveFactoryClass&gt;
      &lt;/selector&gt;
      &lt;selector&gt;
        &lt;moveFactoryClass&gt;org.drools.planner.core.move.generic.GenericSwapMoveFactory&lt;/moveFactoryClass&gt;
      &lt;/selector&gt;
    &lt;/selector&gt;
    ...
  &lt;/localSearch&gt;</pre><p>It's no longer required to write your own Move and MoveFactory implementations, but you still can (and mix
      those in too).</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e1562"/>4.2.4.2. Benchmarker supports custom input and output files</h4></div></div></div><p>The Benchmarker can now read and write the input and output files
        from any format, through the <code class="literal">ProblemIO</code> interface. The
        default is still an XStream implementation.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e1570"/>4.2.4.3. New example selection screen</h4></div></div></div><div class="mediaobject"><img src="images/Chapter-Release_Notes/plannerExamplesAppScreenshot.png"/></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e1576"/>4.2.4.4. New example: TSP</h4></div></div></div><p>This is an implementation of the classic <span class="emphasis"><em>Traveling Salesman Problem</em></span>: given a list of
        cities, find the shortest tour for a salesman that visits each city exactly once.</p><p>See <a class="link" href="http://www.youtube.com/watch?v=T5D3hTjZlRc" target="">this video</a>.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e1589"/>4.2.4.5. New example: Vehicle Routing</h4></div></div></div><p>This is an implementation of capacitated vehicle routing: Using a fleet of vehicles, transport items from
        the depot(s) to customers at different locations. Each vehicle can service multiple locations, but it has a
        limited capacity for items.</p><p>In the screenshot below, there are 6 vehicles (the lines in different colors) that drop off 541 items at 33
        customer locations. Each vehicle can carry 100 items.</p><div class="mediaobject"><img src="images/Chapter-Release_Notes/vehicleRoutingScreenshot.png"/></div><p>See <a class="link" href="http://www.youtube.com/watch?v=GybpV0uLrxc" target="">this video</a>.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e1604"/>4.2.4.6. Employee rostering example: better GUI</h4></div></div></div><p>The employee rostering example's GUI has been reworked to show shift assignment more clearly.</p><p>See <a class="link" href="http://www.youtube.com/watch?v=Gxd-DqtK5Xc" target="">this video</a>.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e1614"/>4.2.4.7. Chaining support makes it easy to implement TSP and Vehicle Routing</h4></div></div></div><p>Until now, implementing TSP or Vehicle Routing like problems in Planner was hard. The new chaining support
        makes it easy.</p><p>You simply declare that a planning variable (<code class="literal">previousAppearance</code>) of this planning entity
        (<code class="literal">VrpCustomer</code>) is chained and therefor possibly referencing another planning entity
        (<code class="literal">VrpCustomer</code>) itself, creating a chain with that entity.</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">public</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">class</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">VrpCustomer</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">implements</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">VrpAppearance</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">...</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">PlanningVariable</span><span class="java_separator">(</span><span class="java_plain">chained&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">true</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">ValueRanges</span><span class="java_separator">({</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">ValueRange</span><span class="java_separator">(</span><span class="java_plain">type&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">ValueRangeType</span><span class="java_separator">.</span><span class="java_plain">FROM_SOLUTION_PROPERTY</span><span class="java_separator">,</span><span class="java_plain">&nbsp;solutionProperty&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;vehicleList&quot;</span><span class="java_separator">),</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">ValueRange</span><span class="java_separator">(</span><span class="java_plain">type&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">ValueRangeType</span><span class="java_separator">.</span><span class="java_plain">FROM_SOLUTION_PROPERTY</span><span class="java_separator">,</span><span class="java_plain">&nbsp;solutionProperty&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;customerList&quot;</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;excludeUninitializedPlanningEntity&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">true</span><span class="java_separator">)})</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">VrpAppearance</span><span class="java_plain">&nbsp;getPreviousAppearance</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;previousAppearance</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span></pre><p>This triggers automatic chain correction:</p><div class="mediaobject"><img src="images/Chapter-Release_Notes/chainCorrection.png"/></div><p>Without any extra boilerplate code, this is compatible with:</p><div class="itemizedlist"><ul><li><p>Every optimization algorithm: including construction heuristics (first fit, first fit decreasing, ...),
            local search (tabu search, simulated annealing), ...</p></li><li><p>The generic build-in move factories. Note: currently there are chained alternatives for each move
            factory, but those will be unified with the originals soon.</p></li><li><p>Repeated planning, including real-time planning</p></li></ul></div><p>For more information, <a class="link" href="http://www.jboss.org/drools/documentation" target="">read the Planner
        reference manual</a>.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e1654"/>4.2.4.8. New Tabu Search implementation: planning value tabu</h4></div></div></div><p>Property tabu has been renamed to planning entity tabu. Planning value tabu has been added. The generic
        moves support this out-of-the-box.</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">acceptor</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">planningValueTabuSize</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">5</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">planningValueTabuSize</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">acceptor</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e1661"/>4.2.4.9. Score calculation with plain Java (no DRL)</h4></div></div></div><p>Planner can now alternatively, use a score calculation written in plain Java. Just implement this
      interface:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">public</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">interface</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">SimpleScoreCalculator</span><!-- <br/> --><span class="java_operator">&lt;</span><!-- <br/> --><span class="java_type">Sol</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">extends</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">Solution</span><!-- <br/> --><span class="java_operator">&gt;</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">Score</span><span class="java_plain">&nbsp;calculateScore</span><span class="java_separator">(</span><span class="java_type">Sol</span><span class="java_plain">&nbsp;solution</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_separator">}</span></pre><p>See the CloudBalance example for an implementation.</p><p>In this way, Planner does not use Drools at all. This allows you to:</p><div class="itemizedlist"><ul><li><p>Use Planner, even if your company forbids any other language than Java (including DRL).</p></li><li><p>Hook Planner up to an existing score calculation system, which you don't want to migrate to DRL at this
            time.</p></li><li><p>Or just use Java if you prefer that over DRL.</p></li></ul></div><p>There is 2 Java ways implemented: <code class="literal">SimpleScoreCalculator</code> (which is simple and slow)
        and <code class="literal">IncrementalScoreCalculator</code> (which is fast).</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e1690"/>4.2.4.10. Quick start tutorial</h4></div></div></div><p>The documentation now has a new chapter <span class="emphasis"><em>Quick start tutorial</em></span>. It explains how to write
        the CloudBalance example from scratch. <a class="link" href="http://www.jboss.org/drools/documentation" target="">Read the
          Planner reference manual</a>.</p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="releaseNotes_5.4.0_Eclipse"/>4.2.5. Eclipse plugin</h3></div></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e1704"/>4.2.5.1. Breakpoints in Rule RHS are not working with Java dialect</h4></div></div></div><p>Debugging with Java is not working. Debugging with MVEL is not affected. This will be fixed in the future releases before 5.4.0.Final</p></div></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e1709"/>4.3. What is New and Noteworthy in Drools 5.3.0</h2></div></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e1712"/>4.3.1. Drools Expert</h3></div></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e1715"/>4.3.1.1. Core and Compiler compatility will no longer be maintained</h4></div></div></div><p>This is the last release where compatibility in core/compilier and other submodules will be maintained, as we refactor for cleanliness in the following releases. All developers should be using the knowledge-api.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e1720"/>4.3.1.2. Queries and Backward Chaining</h4></div></div></div><p>Queries and Backward Chaining have had extensive bug fixing as it had many cases that didn't work,
      especially with "open" queries. Anyone using backward chaining queries in 5.2 should stop straight away and start
      using this.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e1725"/>4.3.1.3. Declarative Agenda</h4></div></div></div><p>5.3 Introduces the declarative agenda, where rules can be used to control which rules can fire and when.
      While this will add a lot more overhead than the simple use of salience, the advantage is it is declarative and
      thus more readable and maintainable and should allow more use cases to be achieved in a simpler fashion.</p><p>This feature is off by default and must be explicitly enabled, that is because it is considered highly
      experimental for the moment and will be subject to change.</p><div class="example"><a id="d0e1732"/><p class="title"><b>Example 4.1. Enabling the Declarative Agenda</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">KnowledgeBaseConfiguration kconf = KnowledgeBaseFactory.newKnowledgeBaseConfiguration();
kconf.setOption( DeclarativeAgendaOption.ENABLED );
KnowledgeBase kbase = KnowledgeBaseFactory.newKnowledgeBase(  kconf );</pre></div></div><br class="example-break"/><p>The basic idea is:</p><div class="itemizedlist"><ul><li><p>All matched rule's Activations are inserted into WorkingMemory as facts. So you can now match against an
          Activation. The rule's metadata and declarations are available as fields on the Activation object.</p></li><li><p>You can use the kcontext.blockActivation( Activation match ) for the current rule to block the selected
          activation. Only when that rule becomes false will the activation be eligible for firing. If it is already
          eligible for firing and is later blocked, it will be removed from the agenda until it is unblocked.</p></li><li><p>An activation may have multiple blockers and a count is kept. All blockers must became false for the
          counter to reach zero to enable the Activation to be eligible for firing.</p></li><li><p>kcontext.unblockAllActivations( $a ) is an over-ride rule that will remove all blockers
          regardless</p></li><li><p>An activation may also be cancelled, so it never fires with cancelActivation</p></li><li><p>An unblocked Activation is added to the Agenda and obeys normal salience, agenda groups, ruleflow groups
          etc.</p></li><li><p>@activationListener('direct') allows a rule to fire as soon as it's matched, this is to be used for
          rules that block/unblock activations, it is not desirable for these rules to have side effects that impact
          else where. The name may change later, this is actually part of the pluggable terminal node handlers I made,
          which is an "internal" feature for the moment.</p></li></ul></div><div class="example"><a id="d0e1761"/><p class="title"><b>Example 4.2. New RuleContext methods</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">void blockActivation(Activation match);
void unblockAllActivations(Activation match);
void cancelActivation(Activation match);</pre></div></div><br class="example-break"/><p>Here is a basic example that will block all activations from rules that have metadata @department('sales').
      They will stay blocked until the blockerAllSalesRules rule becomes false, i.e. "go2" is retracted.</p><div class="example"><a id="d0e1768"/><p class="title"><b>Example 4.3. Block rules based on rule metadata</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">rule rule1 @department('sales') when 
     $s : String( this == 'go1' ) 
then 
    list.add( kcontext.rule.name + ':' + $s ); 
end 
rule rule2 @department('sales') when 
     $s : String( this == 'go1' ) 
then 
    list.add( kcontext.rule.name + ':' + $s ); 
end 
rule blockerAllSalesRules @activationListener('direct') when 
     $s : String( this == 'go2' ) 
     $i : Activation( department == 'sales' ) 
then 
    list.add( $i.rule.name + ':' + $s  ); 
    kcontext.blockActivation( $i ); 
end</pre></div></div><br class="example-break"/><p>This example shows how you can use active property to count the number of active or inactive (already fired)
      activations.</p><div class="example"><a id="d0e1775"/><p class="title"><b>Example 4.4. Count the number of active/inactive Activations</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">rule rule1 @department('sales') when 
     $s : String( this == 'go1' ) 
then 
    list.add( kcontext.rule.name + ':' + $s ); 
end 
rule rule2 @department('sales') when 
     $s : String( this == 'go1' ) 
then 
    list.add( kcontext.rule.name + ':' + $s ); 
end 
rule rule3 @department('sales') when 
     $s : String( this == 'go1' ) 
then 
    list.add( kcontext.rule.name + ':' + $s ); 
end 
rule countActivateInActive @activationListener('direct') when 
     $s : String( this == 'go2' ) 
     $active : Number( this == 1 ) from accumulate( $a : Activation( department == 'sales', active == true ), count( $a ) )
     $inActive : Number( this == 2 ) from  accumulate( $a : Activation( department == 'sales', active == false ), count( $a ) )
then 
    kcontext.halt( ); 
end </pre></div></div><br class="example-break"/></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e1780"/>4.3.1.4. Faster compilation</h4></div></div></div><p>Thanks to many improvements and optimizations made on both MVEL
      library and Drools internals, the DRL compilation is now at least 3
      times faster for both MVEL and Java dialects.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e1785"/>4.3.1.5. Entry-point declarations</h4></div></div></div><p>Entry points can now be explicitly declared. Syntax is:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">entryPointDeclaration := DECLARE ENTRY-POINT stringId annotation* END</pre><p>Example
      use:</p><div class="example"><a id="d0e1794"/><p class="title"><b>Example 4.5. </b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">declare entry-point X
    @doc( "This entry point is receives events from the message queue X" )
end
</pre></div></div><p><br class="example-break"/></p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e1797"/>4.3.1.6. Traits (experimental)</h4></div></div></div><p>A Drools Trait is a bean interface which can be attached - and removed - to and from an individual object at runtime.
            While an object wears a trait, a reference of the trait type is returned, so methods defined in the trait interface can
            be called normally. A trait, then, adds a type and some fields to an object. If a bean has a field of the given name and
            type, that field will be used to support the interface. ''Virtual'' fields, instead, will be stored as entries in a map,
            or as triples in an in-memory store.</p><p>Traits are <code class="literal">declared</code> with the notation <code class="literal">declare trait</code>. Unlike normal beans,
            declared traits will generate interfaces instead of classes: the declared fields will be mapped to getters/setters.
            Notice that multiple traits can be worn at the same time.</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h5 class="title"><a id="d0e1810"/>4.3.1.6.1. <code class="literal">IsA operator</code></h5></div></div></div><p>The operator isA can be used in patterns to check whether an object is wearing a trait or not</p><p>E.g. <code class="literal">Worker( this isA Student )</code></p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h5 class="title"><a id="d0e1820"/>4.3.1.6.2. Special Classes</h5></div></div></div><div class="itemizedlist"><ul><li><p><code class="literal">Thing</code> : Interface, automatically extended by all traits </p></li><li><p><code class="literal">Entity</code> : Class without concrete fields, optimized for virtual fields </p></li></ul></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h5 class="title"><a id="d0e1834"/>4.3.1.6.3. Usage</h5></div></div></div><p>To add/remove a trait to an object, in the RHS:</p><div class="itemizedlist"><ul><li><p><code class="literal">TraitClass traited = don( $object, TraitClass )</code></p></li><li><p><code class="literal">Thing stripped = shed( $traitedObject, TraitClass )</code></p></li></ul></div></div></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e1848"/>4.3.2. Guvnor</h3></div></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e1851"/>4.3.2.1. Declarative type extension</h4></div></div></div><p>Following the enhancement to Drools Expert type declaration in Guvnor now support 'extends' to inherit from
      super-classes. Sub-classes can extend either other types declared in the same package or imported Java classes. In
      order to extend a type declared in Java by a declared subtype, repeat the supertype in a declare statement without
      any fields.</p><div class="figure"><a id="d0e1856"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Release_Notes/declarative-model-extends1.png" align="middle" alt="Extending a class"/></div></div><p class="title"><b>Figure 4.46. Extending a class</b></p></div><br class="figure-break"/><div class="figure"><a id="d0e1862"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Release_Notes/declarative-model-extends2.png" align="middle" alt="Declarative model showing extensions"/></div></div><p class="title"><b>Figure 4.47. Declarative model showing extensions</b></p></div><br class="figure-break"/></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e1868"/>4.3.2.2. Improved Knowledge Bases view</h4></div></div></div><p>Thanks to the help of a community member the tree-view shown in the Knowledge Bases view has been
      improved.</p><p>We also took the opportunity to make a few improvements of our own.</p><div class="itemizedlist"><ul><li><p>The view no longer repeats intermediate level sub-package names that are empty (community led
          effort).</p></li><li><p>The package view can be viewed hierarchically, as has been the default up to 5.2.0.Final.</p></li><li><p>The package view can now also be viewed "flat" with no nesting</p></li><li><p>The tree's nodes can be fully expanded or collapsed.</p></li></ul></div><div class="figure"><a id="d0e1888"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Release_Notes/improved-knowledgebases-view1.png" align="middle" alt="Hierarchical view"/></div></div><p class="title"><b>Figure 4.48. Hierarchical view</b></p></div><br class="figure-break"/><div class="figure"><a id="d0e1894"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Release_Notes/improved-knowledgebases-view2.png" align="middle" alt="Flat view"/></div></div><p class="title"><b>Figure 4.49. Flat view</b></p></div><br class="figure-break"/></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e1900"/>4.3.2.3. Asset Viewer</h4></div></div></div><p>Guvnor continues to grow and improve with every passing release. One of the requirements we have is to move
      Guvnor away from a pure "Rules" or "Knowledge" repository management and authoring environment to a more generic
      one, in which consumers of different technologies can tailor their experience to their domain's
      requirements.</p><p>One of the more noticeable changes we are making to support this has been to de-couple asset types and
      groups from the code. What was once previously static code is now defined by compile-time configuration. Due to
      limitations in GWT (no client-side reflection), the technology with which Guvnor is implemented, we are
      unfortunately not able to offer runtime configuration at this moment.</p><p>The asset groups are configurable within source file; src/main/resources/drools-asseteditors.xml. This file
      is used at GWT compile time to wire-up asset types with their respective editor, group and group icon. An example
      extract from the foregoing file looks like this:-</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">&lt;asseteditor&gt;
    &lt;class&gt;org.drools.guvnor.client.modeldriven.ui.RuleModeller&lt;/class&gt;
    &lt;format&gt;brl&lt;/format&gt;
    &lt;icon&gt;images.ruleAsset()&lt;/icon&gt; &lt;title&gt;constants.BusinessRuleAssets()&lt;/title&gt;
&lt;/asseteditor&gt;</pre><p>To emphasis the separation, asset groups have become their own "editor" appearing as a tab in Guvnor's main,
      central panel.</p><div class="figure"><a id="d0e1913"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Release_Notes/asset-viewer.png" align="middle" alt="Asset Viewer"/></div></div><p class="title"><b>Figure 4.50. Asset Viewer</b></p></div><br class="figure-break"/><p>The format of the new screen is being tried for 5.3.0.Beta1. There has been some discussion whether a single
      table containing all assets would be better - with collapsible rows to group different types of asset. The
      immediate problem with this approach is however that finding different asset types on a "paged table" becomes more
      cumbersome for the user; as they'd have to sort by type and page through.</p><p>We therefore ask for community feedback.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e1923"/>4.3.2.4. Guvnor enumeration improvements</h4></div></div></div><p>Previously Guvnor enumerations that had a "display value" and a "DRL value" (i.e. the value substituted for
      the display value when DRL was generated) could be defined with "&lt;DRL value&gt;=&lt;Display value&gt;". Various
      community users have been using Guvnor enumerations to support complex rule definitions in both DSL and the guided
      Decision Table editor.</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">'Fact.operator' : ['equals=\\=\\=', 'not equals=!\\=']</pre></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e1930"/>4.3.2.5. Guvnor Guided Decision Table</h4></div></div></div><p>A couple of minor enhancements have been made to Guvnor's guided decision table editor:-</p><div class="itemizedlist"><ul><li><p>Removal of sorting</p><p>You are now able to restore the original sort order of a column by clicking on the sort icon through:
          ascending, descending and none.</p></li><li><p>Formulae and Predicates support value lists</p><p>Up until now only literal value columns could take advantage of value lists; either "Guvnor enums" or
          the Decision Table's "Optional value list". This been rectified with this release bringing the advantage of
          predefined choices for these types of fields to the business user.</p><div class="figure"><a id="d0e1946"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Release_Notes/dtable-predicate-value-list1.png" align="middle" alt="Defining a predicate with a value list"/></div></div><p class="title"><b>Figure 4.51. Defining a predicate with a value list</b></p></div><br class="figure-break"/><div class="figure"><a id="d0e1952"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Release_Notes/dtable-predicate-value-list2.png" align="middle" alt="Using the predicate column"/></div></div><p class="title"><b>Figure 4.52. Using the predicate column</b></p></div><br class="figure-break"/></li></ul></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e1958"/>4.3.2.6. Solid URLs and working browser history</h4></div></div></div><p>Guvnor URLs point to what ever is currently open in the active
      tab. Because of this you can bookmark the URL or email it to your
      colleague. Forward and next page directs you to the previously opened
      tab or to the next tab.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e1963"/>4.3.2.7. Guvnor Guided Decision Table - Wizard</h4></div></div></div><p>A wizard has been created to assist with the construction of a new
      table.</p><p>The wizard takes the user through the definition process, from
      adding patterns to creating constraints and generating an expanded
      form.</p><div class="figure"><a id="d0e1970"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Release_Notes/wizard-invoke.png" align="middle" alt="Invoke the ewizard"/></div></div><p class="title"><b>Figure 4.53. Invoke the ewizard</b></p></div><br class="figure-break"/><div class="figure"><a id="d0e1976"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Release_Notes/wizard1.png" align="middle" alt="Summary page"/></div></div><p class="title"><b>Figure 4.54. Summary page</b></p></div><br class="figure-break"/><div class="figure"><a id="d0e1982"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Release_Notes/wizard2.png" align="middle" alt="Add facts"/></div></div><p class="title"><b>Figure 4.55. Add facts</b></p></div><br class="figure-break"/><div class="figure"><a id="d0e1988"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Release_Notes/wizard3.png" align="middle" alt="Add constraints to facts"/></div></div><p class="title"><b>Figure 4.56. Add constraints to facts</b></p></div><br class="figure-break"/><div class="figure"><a id="d0e1994"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Release_Notes/wizard4.png" align="middle" alt="Add actions to set fields on bound facts"/></div></div><p class="title"><b>Figure 4.57. Add actions to set fields on bound facts</b></p></div><br class="figure-break"/><div class="figure"><a id="d0e2000"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Release_Notes/wizard5.png" align="middle" alt="Add actions to insert new facts"/></div></div><p class="title"><b>Figure 4.58. Add actions to insert new facts</b></p></div><br class="figure-break"/><div class="figure"><a id="d0e2006"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Release_Notes/wizard6a.png" align="middle" alt="Choose how rows are created - all columns"/></div></div><p class="title"><b>Figure 4.59. Choose how rows are created - all columns</b></p></div><br class="figure-break"/><div class="figure"><a id="d0e2012"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Release_Notes/wizard6b.png" align="middle" alt="Choose how rows are created - select the columns you want to expand upon"/></div></div><p class="title"><b>Figure 4.60. Choose how rows are created - select the columns you want to
        expand upon</b></p></div><br class="figure-break"/><div class="figure"><a id="d0e2018"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Release_Notes/wizard7.png" align="middle" alt="An extract of the resulting decision table"/></div></div><p class="title"><b>Figure 4.61. An extract of the resulting decision table</b></p></div><br class="figure-break"/></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e2024"/>4.3.2.8. Asset Viewer</h4></div></div></div><p>The Asset Viewer now only shows sections that contain
      Assets.</p><div class="figure"><a id="d0e2029"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Release_Notes/asset-viewer2.png" align="middle" alt="A package with assets"/></div></div><p class="title"><b>Figure 4.62. A package with assets</b></p></div><br class="figure-break"/><div class="figure"><a id="d0e2035"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Release_Notes/asset-viewer3.png" align="middle" alt="An empty package"/></div></div><p class="title"><b>Figure 4.63. An empty package</b></p></div><br class="figure-break"/></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e2041"/>4.3.2.9. Works on JBoss AS 7</h4></div></div></div><p>The Guvnor distribution now includes a war that runs on JBoss AS
      7.0.1 (not on JBoss AS 7.0.0).</p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e2046"/>4.3.3. Drools Planner</h3></div></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e2049"/>4.3.3.1. Construction heuristics</h4></div></div></div><p>As an alternative to writing a long, complex <code class="literal">StartingSolutionInitializer</code>, you can now
      simply configure a powerful construction heuristic:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">&lt;solver&gt;
  ...
  &lt;constructionheuristic&gt;
    &lt;constructionheuristicType&gt;FIRST_FIT&lt;/constructionheuristicType&gt;
  &lt;/constructionheuristic&gt;
  &lt;localSearch&gt;
    ...
  &lt;/localSearch&gt;
&lt;/solver&gt;</pre><p>Planner already supports:</p><div class="itemizedlist"><ul><li><p>First Fit</p></li><li><p>First Fit Decreasing (this is how most of the examples implemented their
          <code class="literal">StartingSolutionInitializer</code>)</p></li><li><p>Best Fit</p></li><li><p>Best Fit Decreasing</p></li></ul></div><p>Future versions will support more construction heuristics.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e2079"/>4.3.3.2. Phasing</h4></div></div></div><p>Planner can now run several solver phases sequentially: each phase is a different optimization algorithm.
      For example: run First Fit Decreasing, then Simulated Annealing, then Tabu Search: </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">&lt;solver&gt;
  ...
  &lt;constructionheuristic&gt;
    ... &lt;!-- First Fit Decreasing --&gt;
  &lt;/constructionheuristic&gt;
  &lt;localSearch&gt;
    ... &lt;!-- Simulated Annealing --&gt;
  &lt;/localSearch&gt;
  &lt;localSearch&gt;
    ... &lt;!-- Tabu Search --&gt;
  &lt;/localSearch&gt;
&lt;/solver&gt;</pre></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e2086"/>4.3.3.3. Real-time planning</h4></div></div></div><p>Planner now supports real-time planning. Real-time planning means that the planning problem can change up to
      a few milliseconds before a solution needs to be executed.</p><p>If one of the planning facts change while a planning problem is being solved, Planner can now process such a
      planning fact change and incrementally continue from the best solution found before that planning fact change. In
      practice, this means it can find a good solution for a big planning problem only a few milliseconds after a
      planning fact changes.</p><p>Planner's documentation now covers several common techniques such as backup planning, continuous planning
      and real-time planning.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e2095"/>4.3.3.4. Documentation expanded</h4></div></div></div><p>The documentation now includes:</p><div class="itemizedlist"><ul><li><p>detailed documentation on planning entity and planning
          variable</p></li><li><p>an optimization algorithms overview</p></li><li><p>guidelines on what's the easiest path to get started</p></li><li><p>Info on common pitfalls and solutions</p></li></ul></div><p>The <code class="literal">NQueens</code> examples has been refactored to
      feel more like a real-world example.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e2118"/>4.3.3.5. Logging revised</h4></div></div></div><p>INFO and DEBUG logging is far less verbose. Use TRACE logging to
      see everything. The log is also now easier to read.</p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e2123"/>4.3.4. Drools Integration</h3></div></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e2126"/>4.3.4.1. Event Listeners</h4></div></div></div><p>Drools supports adding 3 types of listeners to KnowledgeSessions -
          <span class="emphasis"><em>AgendaListener</em></span>,
          <span class="emphasis"><em>WorkingMemoryListener</em></span>,
          <span class="emphasis"><em>ProcessEventListener</em></span></p><p>The drools-spring module allows you to configure these listeners
        to KnowledgeSessions using XML tags. These tags have identical names as
        the actual listener interfaces i.e.,
        &lt;drools:agendaEventListener....&gt;,
        &lt;drools:workingMemoryEventListener....&gt; and
        &lt;drools:processEventListener....&gt;.</p><p>drools-spring provides features to define the listeners as
        standalone (individual) listeners and also to define them as a
        group.</p></div></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e2143"/>4.4. What is New and Noteworthy in Drools 5.2.0</h2></div></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e2146"/>4.4.1. Knowledge API (renamed from Drools API)</h3></div></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e2149"/>4.4.1.1. Core</h4></div></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h5 class="title"><a id="d0e2152"/>4.4.1.1.1. MVEL</h5></div></div></div><p>The MVEL dialect has been improved. We have moved all variable
        lookups to the new indexed factories, which should allow faster
        execution, as well as being simpler code. The build process for mvel
        has been reviewed to streamline it to avoid wasteless object creation
        so that the build time is faster. We still have some more improvements
        on this to share the ParserConfiguration which will make each MVEL
        compilation unit faster to initalise and use less memory, as they will
        share import information for each package.</p><p>It was always possible to execute with MVEL in both dynamic and
        strict mode, with strict mode for static type safety the default. This
        is configurable via the MVEL dialect configuration:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">drools.dialect.mvel.strict = &lt;true|false&gt;</pre><p>However there were some places in execution when strict mode was
        not enforced. Effort has now been done to ensure that type safety is
        enforced through out, unless "strict == false". This means that some
        bad code that compiled before may not compile now, because it is not
        type safe. For those cases where the type safety cannot be achieved at
        compile time we added the @typesafe annotation, discussed in it's own
        section.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h5 class="title"><a id="d0e2163"/>4.4.1.1.2. Classloader</h5></div></div></div><p>The Classloader has been improved to use a CompositeClassLoader
        instead of the previous hierarchical "parent" classloader. This was
        necessary for OSGi where each module needs it's own classpath, but
        reflection will not work if classloader cannot be found. Modules now
        add themselves to the composite classloader when first initialised.
        This is also exposed to the user where the previous Classloader
        argument on the kbase and kbuilder configuration now takes vararg of
        ClassLoaders, all of which are now searchable.</p></div></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e2168"/>4.4.2. Drools Expert and Fusion</h3></div></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e2171"/>4.4.2.1. Lazy Truth Maintenance</h4></div></div></div><p>You no longer need to enable or disable truth maintenance, via the
      kbase configuration. It is now handled automatically and turned on only
      when needed. This was done along with the code changes so that all entry
      points use the same code, previous to this the default entry point and
      named entry points used different code, to avoid TMS overhead for event
      processing.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e2176"/>4.4.2.2. Multi-function Accumulates</h4></div></div></div><p>The accumulate CE now supports multiple functions. For instance,
      if one needs to find the minimum, maximum and average value for the same
      set of data, instead of having to repeat the accumulate statement 3
      times, a single accumulate can be used.</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">rule "Max, min and average" 
    when
        accumulate( Cheese( $price : price ),
                    $max : max( $price ),
                    $min : min( $price ),
                    $avg : average( $price ) )
    then
        // do something
end </pre></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e2183"/>4.4.2.3. Parameterized constructors for declared types</h4></div></div></div><p>Generate constructors with parameters for declared types.</p><p>Example: for a declared type like the following:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">declare Person
    firstName : String @key
    lastName : String @key
    age : int
end
</pre><p>The compiler will implicitly generate 3 constructors: one without
      parameters, one with the @key fields, and one with all fields.</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">Person() // parameterless constructor
Person( String firstName, String lastName )
Person( String firstName, String lastName, int age )</pre></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e2196"/>4.4.2.4. Type Declaration 'extends'</h4></div></div></div><p>Type declarations now support 'extends' keyword for
      inheritance</p><p>In order to extend a type declared in Java by a DRL declared
      subtype, repeat the supertype in a declare statement without any
      fields.</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">import org.people.Person

declare Person
end

declare Student extends Person
    school : String
end

declare LongTermStudent extends Student
    years : int
    course : String
end</pre></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e2205"/>4.4.2.5. Free Form expressions in Constraints (New Parser)</h4></div></div></div><p>The parser has been rewritten. We had reached the limitations of
      what we could achieve in pure ANTLR and moved to a hybrid parser, that
      adds flexibility to the language.</p><p>The main benefit with the new parser is that the language now
      support free form expressions for constraints and 'from' statements. So
      complex expressions on nested accessors, method calls etc should now all
      be possible as simple constraints without wrapping them with an
      eval(.....). This was also important for us to start to move towards a
      single consistent grammer for both the "when" left hand side and "then"
      right hand side. As previously we had to document the restricted
      limitations of a field constraint on the LHS compared to expressions
      used inside of an 'eval' or used on the RHS. Complex expressions are
      still internally rewritten as evals, so it's just syntacic sugar.</p><p>Examples:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">Person( age * 2 &gt; $anotherPersonsAge + 2 ) // mathematical expressions
Person( addresses["home"].streetName.startsWith( "High Park" ) ) // method calls and collections simplified syntax
Person( isAdult() ) // boolean expression without relational operator</pre><p>The new parser also support free form expressions on the "from"
      clause, allowing for instance, new syntaxes, like inline creation for
      lists:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">Cheese( ) from [ $stilton, $brie, $provolone ] // inline list creation and iteration
</pre></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e2220"/>4.4.2.6. Rule API</h4></div></div></div><p>A fluent API was created to allow programmatic creation of rules
      as an alternative to the previously suggested method of template
      creation.</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">PackageDescr pkg = DescrFactory.newPackage()
       .name("org.drools.example")
       .newRule().name("Xyz")
           .attribute("ruleflow-grou","bla")
       .lhs()
           .and()
               .pattern("Foo").id( "$foo", false ).constraint("bar==baz").constraint("x&gt;y").end()
               .not().pattern("Bar").constraint("a+b==c").end().end()
           .end()
       .end()
       .rhs( "System.out.println();" ).end()
       .getDescr();</pre></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e2227"/>4.4.2.7. Positional Arguments</h4></div></div></div><p>Patterns now support positional arguments on type
      declarations.</p><p>Positional arguments are ones where you don't need to specify the
      field name, as the position maps to a known named field. i.e. Person(
      name == "mark" ) can be rewritten as Person( "mark"; ). The semicolon
      ';' is important so that the engine knows that everything before it is a
      positional argument. Otherwise we might assume it was a boolean
      expression, which is how it could be interpretted after the semicolon.
      You can mix positional and named arguments on a pattern by using the
      semicolon ';' to separate them. Any variables used in a positional that
      have not yet been bound will be bound to the field that maps to that
      position.</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">declare Cheese
    name : String
    shop : String
    price : int
end
</pre><p>The default order is the declared order, but this can be overiden
      using @Position</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">declare Cheese
    name : String @position(1)
    shop : String @position(2)
    price : int @position(0)
end
</pre><p>The @Position annotation, in the org.drools.definition.type
      package, can be used to annotate original pojos on the classpath.
      Currently only fields on classes can be annotated. Inheritence of
      classes is supported, but not interfaces of methods yet.</p><p>Example patterns, with two constraints and a binding. Remember
      semicolon ';' is used to differentiate the positional section from the
      named argument section. Variables and literals and expressions using
      just literals are supported in posional arguments, but not
      variables.</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
Cheese( "stilton", "Cheese Shop", p; )
Cheese( "stilton", "Cheese Shop"; p : price )
Cheese( "stilton"; shop == "Cheese Shop", p : price )
Cheese( name == "stilton"; shop == "Cheese Shop", p : price )
</pre></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e2246"/>4.4.2.8. Backward Chaining</h4></div></div></div><p>Drools now provides Prolog style derivation queries, as an
      experimental feature. What this means is that a query or the 'when' part
      of a rule may call a query, via a query element. This is also recursive
      so that a query may call itself. A query element may be prefixed with a
      question mark '?' which indicuates that we have a pattern construct that
      will pull data, rather than the normal reactive push nature of patterns.
      If the ? is ommitted the query will be executed as a live "open query"
      with reactiveness, similar to how normal patterns work.</p><p>A key aspect of BC is unification. This is where a query parameter
      may be bound or unbound, when unbound it is considered an output
      variable and will bind to each found value.</p><p>In the example below x and y are parameters. Unification is done
      by subsequent bindings inside of patterns. If a value for x is passed
      in, it's as though the pattern says "thing == x". If a value for x is
      not passed in it's as though "x: thing" and x will be bound to each
      found thing.</p><p>Because Drools does not allow multiple bindings on the same
      variable we introduce ':=' unification symbol to support this.</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">declare Location
    thing : String 
    location : String 
end

query isContainedIn( String x, String y ) 
    Location( x := thing, y := location)
    or 
    ( Location(z := thing, y := location) and ?isContainedIn( x := x, z := y ) )
end
</pre><p>Positional and mixed positional/named are supported.</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">declare Location
    thing : String 
    location : String 
end

query isContainedIn( String x, String y ) 
    Location(x, y;)
    or 
    ( Location(z, y;) and ?isContainedIn(x, z;) )
end
</pre><p>Here is an example of query element inside of a rule using mixed
      positional/named arguments.</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">package org.drools.test

import java.util.List
import java.util.ArrayList

dialect "mvel"

declare Here
   place : String
end

declare Door
   fromLocation : String
   toLocation : String
end

declare Location
   thing : String
   location : String
end

declare Edible
   thing : String
end

query connect( String x, String y )
   Door(x, y;)
   or 
   Door(y, x;)
end

query whereFood( String x, String y )
   ( Location(x, y;) and
      Edible(x;) )
   or 
   ( Location(z, y;) and
      whereFood(x, z;) )
end

query look(String place, List things, List food, List exits)
   Here(place;)
   things := List() from accumulate( Location(thing, place;), collectList( thing ) )
   food := List() from accumulate( ?whereFood(thing, place;), collectList( thing ) )
   exits := List() from accumulate( ?connect(place, exit;), collectList( exit ) )
end

rule reactiveLook 
   when
      Here( $place : place)
      ?look($place, $things; $food := food, $exits := exits)
   then
      System.out.println( \"You are in the \" + $place);
      System.out.println( \"  You can see \" + $things );
      System.out.println( \"  You can eat \" + $food );
      System.out.println( \"  You can go to \" + $exits );
end</pre><p>As previously mentioned you can use live "open" queries to
      reactively receive changes over time from the query results, as the
      underlying data it queries against changes. Notice the "look" rule calls
      the query without using '?'.</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">query isContainedIn( String x, String y ) 
    Location(x, y;)
    or 
    ( Location(z, y;) and isContainedIn(x, z;) )
end

rule look when 
    Person( $l : likes ) 
    isContainedIn( $l, 'office'; )
then
   insertLogical( $l + 'is in the office' );
end 
</pre><p>Literal expressions can passed as query arguments, but at this
      stage you cannot mix expressions with variables.</p><p>It is possible to call queries from java leaving arguments
      unspecified using the static field org.drools.runtime.rule.Variable.v -
      note you must use 'v' and not an alternative instanceof Variable. The
      following example will return all objects contained in the
      office.</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">results = ksession.getQueryResults( "isContainedIn", new Object[] {  Variable.v, "office" } );
l = new ArrayList&lt;List&lt;String&gt;&gt;();
for ( QueryResultsRow r : results ) {
    l.add( Arrays.asList( new String[] { (String) r.get( "x" ), (String) r.get( "y" ) } ) );
}  
</pre><p>The algorithm uses stacks to handle recursion, so the method stack
      will not blow up.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e2279"/>4.4.2.9. Non Typesafe Classes</h4></div></div></div><p>@typesafe( &lt;boolean&gt;) has been added to type declarations.
      By default all type declarations are compiled with type safety enabled;
      @typesafe( false ) provides a means to override this behaviour by
      permitting a fall-back, to type unsafe evaluation where all constraints
      are generated as MVEL constraints and executed dynamically. This can be
      important when dealing with collections that do not have any generics or
      mixed type collections.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e2284"/>4.4.2.10. Session Reports</h4></div></div></div><p>Added experimental framework to inspect a session and generate a
      report, either based on a predefined template or with a user created
      template.</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">// Creates an inspector
SessionInspector inspector = new SessionInspector( ksession );
// Collects the session info
StatefulKnowledgeSessionInfo info = inspector.getSessionInfo();
// Generate a report using the "simple" report template
String report = SessionReporter.generateReport( "simple", info, null );
</pre></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e2291"/>4.4.3. Drools and jBPM integration</h3></div></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e2294"/>4.4.3.1. Improved Camel integration</h4></div></div></div><p>Camel integration using the Drools EndPoint was improved with the
      creation of both DroolsConsumer and DroolsProducer components.
      Configurations were added to support the insertion of either Camel's
      Exchange, Message or Body into the Drools session, allowing for the easy
      development of dynamic content based routing applications. Also, support
      to entry points was added.</p><p>Examples of routes:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">from( "direct:test-no-ep" ).to( "drools://node/ksession1?action=insertBody" );
from( "direct:test-with-ep" ).to( "drools://node/ksession1?action=insertBody&amp;entryPoint=ep1" );
from( "direct:test-message" ).to( "drools://node/ksession1?action=insertMessage" );
from( "direct:test-exchange" ).to( "drools://node/ksession1?action=insertExchange" );
</pre></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e2303"/>4.4.4. Merging Drools Flow into jBPM5</h3></div></div></div><p>The Drools Flow project and the jBPM project have been merged into
    the the newest version of the jBPM project, called jBPM5. jBPM5 combines
    the best of both worlds: merging the experience that was built up with the
    jBPM project over several years in supporting stable, long-living business
    processes together with the improvements that were prototyped as part of
    Drools Flow to support more flexible and adaptive processes. Now that jBPM
    5.0 has been released, the Drools project will be using jBPM5 as the
    engine to support process capabilities. Drools Flow as a subproject will
    no longer exist, but its vision will continue as part of the jBPM project,
    still allowing (optional but) advanced integration between business rules,
    business processes and complex event processing and a unified environment
    for all three paradigms.</p><p>The impact for the end user however should be minimal, as the
    existing (knowledge) API is still supported, the underlying implementation
    has just been replaced with a newer version. All existing features should
    still be supported, and many more.</p><p>For more information, visit <a class="ulink" href="http://www.jboss.org/jbpm">http://www.jboss.org/jbpm</a></p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e2314"/>4.4.5. Guvnor</h3></div></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e2317"/>4.4.5.1. Guvnor Look &amp; Feel Moving Closer To Native GWT Look</h4></div></div></div><p>We have removed GWT-Ext from Guvnor and now only use GWT.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e2322"/>4.4.5.2. Embed Guvnor Editors</h4></div></div></div><p>Embed Guvnor Editor's in external applications. You can create or
      edit assets like Business Rules, Technical Rules, DSL definitions and
      Decision Tables in your applications using Guvnor's specific editors.
      You can even edit multiple assets at once.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e2327"/>4.4.5.3. Annotations come to Declarative Models</h4></div></div></div><p>The ability to add annotations in Guvnor to declarative models has
      been added. This allows Fact Types to be defined as events.</p><div class="figure"><a id="d0e2332"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Release_Notes/declarative-model-annotations.png" align="middle" alt="Annotations"/></div></div><p class="title"><b>Figure 4.64. Annotations</b></p></div><br class="figure-break"/><div class="figure"><a id="d0e2338"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Release_Notes/declarative-model-annotations-editor.png" align="middle" alt="Annotation editor"/></div></div><p class="title"><b>Figure 4.65. Annotation editor</b></p></div><br class="figure-break"/></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e2344"/>4.4.5.4. Support for Complex Event Processing in the guided
      editors</h4></div></div></div><p>The guided editors have been enhanced to allow full use of Drools
      Fusion's Complex Event Processing operators, sliding windows and
      entry-points.</p><div class="figure"><a id="d0e2349"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Release_Notes/cep-guided-editor.png" align="middle" alt="Complex Event Processing"/></div></div><p class="title"><b>Figure 4.66. Complex Event Processing</b></p></div><br class="figure-break"/></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e2355"/>4.4.5.5. Decision Tables</h4></div></div></div><p>The existing Guided Decision Table has been replaced to provide a
      foundation on which to build our future guided Decision Table toolset.
      The initial release largely provides an equivalent feature-set to the
      obsolete Guided Decision Table with a few improvements, as explained in
      more detail below. A change from the legacy table was essential for us
      to begin to realise our desire to provide the number one web-based
      decision table available. With this foundation we will be able to expand
      the capabilities of our Guided Decision Table toolset to provide a
      feature rich, user-friendly environment.</p><div class="figure"><a id="d0e2360"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Release_Notes/dtable-basic.png" align="middle" alt="Basic Decision Table"/></div></div><p class="title"><b>Figure 4.67. Basic Decision Table</b></p></div><br class="figure-break"/><div class="section" lang="en-US"><div class="titlepage"><div><div><h5 class="title"><a id="d0e2366"/>4.4.5.5.1. Cell Merging</h5></div></div></div><p>Adjacent cells in the same column with the same value can be
        merged thus eliminating the need for otherwise cluttered views of
        multiple rows containing the same value.</p><div class="figure"><a id="d0e2371"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Release_Notes/dtable-merged.png" align="middle" alt="Merged Decision Table"/></div></div><p class="title"><b>Figure 4.68. Merged Decision Table</b></p></div><br class="figure-break"/></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h5 class="title"><a id="d0e2377"/>4.4.5.5.2. Typed-columns</h5></div></div></div><p>The major basic data-types (numeric, date, text and Boolean) are
        handled as such and respond as you'd expect to sorting.</p><div class="figure"><a id="d0e2382"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Release_Notes/dtable-datatype-sorting.png" align="middle" alt="Datatype Sorting"/></div></div><p class="title"><b>Figure 4.69. Datatype Sorting</b></p></div><br class="figure-break"/></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h5 class="title"><a id="d0e2388"/>4.4.5.5.3. Improved header</h5></div></div></div><p>The table header section has been improved to show more verbose
        information to facilitate design-time understanding. The table has a
        fixed header that remains as you'd expect, at the top of the table,
        whilst scrolling larger decision tables.</p><div class="figure"><a id="d0e2393"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Release_Notes/dtable-scrolling.png" align="middle" alt="Scrolling Decision Table"/></div></div><p class="title"><b>Figure 4.70. Scrolling Decision Table</b></p></div><br class="figure-break"/></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h5 class="title"><a id="d0e2399"/>4.4.5.5.4. Tighter integration</h5></div></div></div><p>The decision table responds better to changes made to column
        definitions; so changes to column Fact Type, Fact Type field,
        calculation type, value list etc are reflected in the table
        itself.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h5 class="title"><a id="d0e2404"/>4.4.5.5.5. Negation of Fact patterns</h5></div></div></div><p>Fact Patterns in condition columns can be negated to match when
        the defined pattern does not exist in WorkingMemory. In essence it is
        now possible to construct rules within the decision table equivalent
        to the following DRL fragment:-</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">not Cheese( name == "Cheddar" ) </pre><div class="figure"><a id="d0e2411"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Release_Notes/negate-fact-pattern.png" align="middle" alt="Negation of Fact Patterns"/></div></div><p class="title"><b>Figure 4.71. Negation of Fact Patterns</b></p></div><br class="figure-break"/></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h5 class="title"><a id="d0e2417"/>4.4.5.5.6. Negation of rules</h5></div></div></div><p>Entire rules can be negated, giving rise to DRL fragements such
        as:-</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">rule "no cheddar liked by Fred"
  when
    not (
      $c : Cheese( name == "Cheddar" )
      Person( name == "Fred", favouriteCheese == $c )
    )
  then
    ..
end
 </pre><div class="figure"><a id="d0e2424"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Release_Notes/negate-rule-option.png" align="middle" alt="Negation of rules"/></div><div class="mediaobject" align="center"><img src="images/Chapter-Release_Notes/negate-rule.png" align="middle" alt="Negation of rules"/></div></div><p class="title"><b>Figure 4.72. Negation of rules</b></p></div><br class="figure-break"/></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h5 class="title"><a id="d0e2433"/>4.4.5.5.7. Support for "otherwise"</h5></div></div></div><p>Condition columns containing literal values that use the
        equality (==, equal to) or inequality (!=, not equal to) operators can
        now contain a meta-value for "otherwise" which represents all other
        values not explicitly defined in the column. This feature gives rise
        to DRL fragments such as the following:-</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">// from row number: 1
rule "Row 1 dtable"
  salience 1
  dialect "mvel"
when
  $p : Person( name == "Bill" , age != "30" )
then
  $p.setAge( 12345 );
end

// from row number: 2
rule "Row 2 dtable"
  salience 2
  dialect "mvel"
when
  $p : Person( name == "Ben" , age in ( "30", "40", "50" ) )
then
  $p.setAge( 12345 );
end

// from row number: 3
rule "Row 3 dtable"
  salience 3
  dialect "mvel"
when
  $p : Person( name == "Weed" , age != "40" )
then
  $p.setAge( 12345 );
end

// from row number: 4
rule "Row 4 dtable"
  salience 4
  dialect "mvel"
when
  $p : Person( name not in ( "Bill", "Ben", "Weed" ) , age != "50" )
then
  $p.setAge( 12345 );
end</pre><div class="figure"><a id="d0e2440"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Release_Notes/otherwise.png" align="middle" alt="Support for &#34;otherwise&#34;"/></div></div><p class="title"><b>Figure 4.73. Support for "otherwise"</b></p></div><br class="figure-break"/></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h5 class="title"><a id="d0e2446"/>4.4.5.5.8. Enhanced Package's Report</h5></div></div></div><p>Templates Rules and Decision Tables rules are now included in
        the package's report.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h5 class="title"><a id="d0e2451"/>4.4.5.5.9. Spring Context Editor</h5></div></div></div><p>Now it is possible to create and mange Spring Context files
        inside Guvnor. These Context Files are exposed through URLs so
        external applications can use them.</p><div class="figure"><a id="d0e2456"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Release_Notes/editspringcontextguvnor.png" align="middle" alt="Editing Spring Context"/></div></div><p class="title"><b>Figure 4.74. Editing Spring Context</b></p></div><br class="figure-break"/></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h5 class="title"><a id="d0e2462"/>4.4.5.5.10. Configuring Multiple Guvnor Instances In a Jackrabbit
        Cluster</h5></div></div></div><p>We added a new task in drools-ant which helps with configuring
        multiple Guvnor instances to be able to share their Jackrabbit
        content.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h5 class="title"><a id="d0e2467"/>4.4.5.5.11. Configuring Guvnor to use an external RDBMS made easier</h5></div></div></div><p>The default Guvnor repository configuration uses embedded Derby
        databases which writes the workspace and version information to the
        local file system. This is not always optimal for a production system
        where it makes sense to use an external RDBMS.</p><p>We added a new section under the "Administration" tab called
        "Repository Configuration" which helps generate the repository.xml
        configuration file for a number of databases (Microsoft SQL Server,
        MySQL, Oracle, PostgreSQL, Derby, H2)</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h5 class="title"><a id="d0e2474"/>4.4.5.5.12. Web-based BPMN2 authoring in Guvnor</h5></div></div></div><p>We have completed big parts of the integration between Guvnor
        and the Oryx web-based business process editor. Our primary use cases
        supported by this integration are:</p><p>- Viewing existing jBPM5 processes in Guvnor</p><p>- Prototyping new jBPM5 processes in Guvnor.</p><p>Please note that we are still working on full round-tripping
        support between the web-based Oryx editor and our BPMN2 support
        provided through the eclipse plugin</p></div></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e2485"/>4.4.6. Eclipse</h3></div></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e2488"/>4.4.6.1. Removal of BRL Guided Editor</h4></div></div></div><p>The BRL Guided Editor has been removed due to lack of interest and
      it falling behind. Its removal allows more focus on the GWT based Guided
      Editor in Guvnor. The DRL, text-based, Guided Editor remains
      unaffected.</p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e2493"/>4.4.7. Maven artifactId changes</h3></div></div></div><p>A couple of maven artifacts (jars, wars, ...) have been renamed so
    it is more clear what they do. Below is the list of the GAV changes,
    adjust your <code class="literal">pom.xml</code> files accordingly when upgrading to
    the new version.</p><div class="table"><a id="d0e2501"/><p class="title"><b>Table 4.2. Maven GAV changes overview</b></p><div class="table-contents"><table summary="Maven GAV changes overview" border="1"><colgroup><col/><col/><col/><col/></colgroup><thead><tr><th align="center">Old groupId</th><th align="center">Old artifactId</th><th align="center">New groupId</th><th align="center">New artifactId</th></tr></thead><tbody><tr><td>org.drools</td><td>drools (the parent pom)</td><td>org.drools</td><td>droolsjbpm-parent</td></tr><tr><td>org.drools</td><td><span class="bold"><strong>drools-api</strong></span></td><td>org.drools</td><td><span class="bold"><strong>knowledge-api</strong></span></td></tr><tr><td>org.drools</td><td>drools-docs-introduction</td><td>org.drools</td><td>droolsjbpm-introduction-docs</td></tr><tr><td>org.drools</td><td>drools-examples-drl</td><td>org.drools</td><td>drools-examples</td></tr><tr><td>org.drools</td><td>drools-examples-fusion / drools-examples-drl (jBPM using
            parts)</td><td>org.drools</td><td>droolsjbpm-integration-examples</td></tr><tr><td>org.drools</td><td>drools-docs-expert</td><td>org.drools</td><td>droolsjbpm-expert-docs</td></tr><tr><td>org.drools</td><td>drools-docs-fusion</td><td>org.drools</td><td>droolsjbpm-fusion-docs</td></tr><tr><td>org.drools</td><td><span class="bold"><strong>drools-repository</strong></span></td><td>org.drools</td><td><span class="bold"><strong>guvnor-repository</strong></span></td></tr><tr><td>org.drools</td><td><span class="bold"><strong>drools-ide-common</strong></span></td><td>org.drools</td><td><span class="bold"><strong>droolsjbpm-ide-common</strong></span></td></tr><tr><td>org.drools</td><td><span class="bold"><strong>drools-guvnor</strong></span></td><td>org.drools</td><td><span class="bold"><strong>guvnor-webapp</strong></span></td></tr><tr><td>org.jboss.drools.guvnor.tools</td><td>guvnor-importer</td><td>org.drools</td><td>guvnor-bulk-importer</td></tr><tr><td>org.drools</td><td>drools-docs-guvnor</td><td>org.drools</td><td>guvnor-docs</td></tr><tr><td>org.drools</td><td><span class="bold"><strong>drools-server</strong></span></td><td>org.drools</td><td><span class="bold"><strong>drools-camel-server</strong></span></td></tr><tr><td>org.drools</td><td>drools-docs-integration</td><td>org.drools</td><td>droolsjbpm-integration-docs</td></tr><tr><td>org.drools</td><td><span class="bold"><strong>drools-flow-core</strong></span></td><td>org.jbpm</td><td><span class="bold"><strong>jbpm-flow</strong></span></td></tr><tr><td>org.drools</td><td><span class="bold"><strong>drools-flow-compiler</strong></span></td><td>org.jbpm</td><td><span class="bold"><strong>jbpm-flow-builder</strong></span></td></tr><tr><td>org.drools</td><td><span class="bold"><strong>drools-bpmn2</strong></span></td><td>org.jbpm</td><td><span class="bold"><strong>jbpm-bpmn2</strong></span></td></tr><tr><td>org.drools</td><td><span class="bold"><strong>drools-flow-persistence-jpa</strong></span></td><td>org.jbpm</td><td><span class="bold"><strong>jbpm-persistence-jpa</strong></span></td></tr><tr><td>org.drools</td><td>drools-bam</td><td>org.jbpm</td><td>jbpm-bam</td></tr><tr><td>org.drools</td><td>drools-process-task</td><td>org.jbpm</td><td>jbpm-human-task</td></tr><tr><td>org.drools</td><td>drools-gwt-console</td><td>org.jbpm</td><td>jbpm-gwt-console</td></tr><tr><td>org.drools</td><td>drools-gwt-form</td><td>org.jbpm</td><td>jbpm-gwt-form</td></tr><tr><td>org.drools</td><td>drools-gwt-graph</td><td>org.jbpm</td><td>jbpm-gwt-graph</td></tr><tr><td>org.drools</td><td>drools-gwt-war</td><td>org.jbpm</td><td>jbpm-gwt-war</td></tr><tr><td>org.drools</td><td>drools-gwt-server-war</td><td>org.jbpm</td><td>jbpm-gwt-server-war</td></tr><tr><td>org.drools</td><td>drools-workitems</td><td>org.jbpm</td><td>jbpm-workitems</td></tr><tr><td>org.drools</td><td>drools-docs-flow</td><td>org.jbpm</td><td>jbpm-docs</td></tr></tbody></table></div></div><br class="table-break"/><p>For example: before, in your <code class="literal">pom.xml</code> files, you
    declared <code class="literal">drools-api</code> like this:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">  &lt;dependency&gt;
    &lt;groupId&gt;org.drools&lt;/groupId&gt;
    &lt;artifactId&gt;drools-api&lt;/artifactId&gt;
    ...
  &lt;/dependency&gt;</pre><p>And now, afterwards, in your <code class="literal">pom.xml</code> files, you
    declare <code class="literal">knowledge-api</code> like this instead:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">  &lt;dependency&gt;
    &lt;groupId&gt;org.drools&lt;/groupId&gt;
    &lt;artifactId&gt;knowledge-api&lt;/artifactId&gt;
    ...
  &lt;/dependency&gt;</pre></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e2797"/>4.5. What is New and Noteworthy in Drools 5.1.0</h2></div></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e2800"/>4.5.1. Drools API</h3></div></div></div><p>As in Drools 5.0 it is still possible to configure a <code class="code">KnowledgeBase</code>
    using configuration, via a xml change set, instead of programmatically. However the change-set namespace
    is now versioned. This means that for Drools 5.1, the 1.0.0 xsd should be referenced.
    </p><div class="example"><a id="d0e2808"/><p class="title"><b>Example 4.6. Here is a simple version 1.0.0 change set</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">change-set</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">xmlns</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">'http://drools.org/drools-5.0/change-set'</span><span class="xml_plain"></span><br />
<span class="xml_attribute_name">xmlns:xs</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">'http://www.w3.org/2001/XMLSchema-instance'</span><span class="xml_plain"></span><br />
<span class="xml_attribute_name">xs:schemaLocation</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">'http://drools.org/drools-5.0/change-set&nbsp;change-set-5.0.xsd&nbsp;http://anonsvn.jboss.org/repos/labs/labs/jbossrules/trunk/drools-api/src/main/resources/change-set-1.0.0.xsd'</span><span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">add</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">resource</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">source</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">'classpath:org/domain/someRules.drl'</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">type</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">'DRL'</span><span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">resource</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">source</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">'classpath:org/domain/aFlow.drf'</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">type</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">'DRF'</span><span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">add</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">change-set</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre></div></div><br class="example-break"/></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e2813"/>4.5.2. Core</h3></div></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e2816"/>4.5.2.1. JMX Monitoring</h4></div></div></div><p>JMX monitoring was added to support KnowledgeBase monitoring. This
      is specially importand for long running processes like the ones usually
      required for event processing. Initial integration with JOPR was also
      added. JMX can be inabled with using the properties setting the
      knowledge base:</p><p>drools.mbeans = &lt;enabled|disabled&gt;</p><p>or this option at runtime</p><p>kbaseConf.setOption( MBeansOption.ENABLED )</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e2827"/>4.5.2.2. Spring</h4></div></div></div><p>Drools now has extensive Spring support, the XSD can be found in
      the the drools-spring jar. The namespace is
      "http://drools.org/schema/drools-spring"</p><div class="example"><a id="d0e2832"/><p class="title"><b>Example 4.7. KnowledgeBuilder example</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_processing_instruction">&lt;?xml&nbsp;version=&quot;1.0&quot;&nbsp;encoding=&quot;UTF-8&quot;?&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">beans</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">xmlns</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;http://www.springframework.org/schema/beans&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">xmlns:xsi</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">xmlns:drools</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;http://drools.org/schema/drools-spring&quot;</span><span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">xmlns:camel</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;http://camel.apache.org/schema/spring&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">xsi:schemaLocation</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;http://www.springframework.org/schema/beans&nbsp;http://www.springframework.org/schema/beans/spring-beans-2.0.xsd</span><br />
<span class="xml_attribute_value">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;http://drools.org/schema/drools-spring&nbsp;http://anonsvn.jboss.org/repos/labs/labs/jbossrules/trunk/drools-container/drools-spring/src/main/resources/org/drools/container/spring/drools-spring-1.0.0.xsd</span><br />
<span class="xml_attribute_value">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;http://camel.apache.org/schema/spring&nbsp;http://camel.apache.org/schema/spring/camel-spring.xsd&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">drools:resource</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">id</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;resource1&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">type</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;DRL&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">source</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;classpath:org/drools/container/spring/testSpring.drl&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">drools:kbase</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">id</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;kbase1&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">drools:resources</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">drools:resource</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">type</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;DRL&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">source</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;classpath:org/drools/container/spring/testSpring.drl&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">drools:resource</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">ref</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;resource1&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">drools:resource</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">source</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;classpath:org/drools/container/spring/IntegrationExampleTest.xls&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">type</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;DTABLE&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">drools:decisiontable-conf</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">input-type</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;XLS&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">worksheet-name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;Tables_2&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">drools:resource</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">drools:resources</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">drools:configuration</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">drools:mbeans</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">enabled</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;true&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">drools:event-processing-mode</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">mode</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;STREAM&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">drools:configuration</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">drools:kbase</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">beans</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre></div></div><br class="example-break"/><p>KnowledgeBase takes the following configurations:
      "advanced-process-rule-integration, multithread, mbeans,
      event-processing-mode, accumulate-functions, evaluators and
      assert-behavior".</p><p>From the the kbase reference ksessions can be created</p><div class="example"><a id="d0e2841"/><p class="title"><b>Example 4.8. Knowlege Sessions</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">drools:ksession</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">id</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;ksession1&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">type</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;stateless&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;stateless1&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">kbase</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;kbase1&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">drools:ksession</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">id</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;ksession2&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">type</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;stateful&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">kbase</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;kbase1&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
</pre></div></div><br class="example-break"/><p>Like KnowledgeBases Knowlege sessions can take a number of
      configurations, including "work-item-handlers, "keep-references",
      "clock-type", "jpa-persistence".</p><div class="example"><a id="d0e2848"/><p class="title"><b>Example 4.9. Knowlege Sessions Configurations</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">drools:ksession</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">id</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;ksession1&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">type</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;stateful&quot;</span><span class="xml_plain">&nbsp;&nbsp;</span><span class="xml_attribute_name">kbase</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;kbase1&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">drools:configuration</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">drools:work-item-handlers</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">drools:work-item-handler</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;handlername&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">ref</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;handlerid&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">drools:work-item-handlers</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">drools:keep-reference</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">enabled</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;true&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">drools:clock-type</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">type</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;REALTIME&quot;</span><span class="xml_plain">&nbsp;&nbsp;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain">&nbsp;</span><br />
<span class="xml_plain">&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">drools:configuration</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">drools:ksession</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre></div></div><br class="example-break"/><p>StatefulKnowledgeSessions can be configured for JPA
      persistence</p><div class="example"><a id="d0e2855"/><p class="title"><b>Example 4.10. JPA configuration for StatefulKnowledgeSessions</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">bean</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">id</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;ds&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">class</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;org.springframework.jdbc.datasource.DriverManagerDataSource&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">property</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;driverClassName&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">value</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;org.h2.Driver&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">property</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;url&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">value</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;jdbc:h2:tcp://localhost/DroolsFlow&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">property</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;username&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">value</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;sa&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">property</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;password&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">value</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">bean</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">bean</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">id</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;myEmf&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">class</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">property</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;dataSource&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">ref</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;ds&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">property</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;persistenceUnitName&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">value</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;org.drools.persistence.jpa.local&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">bean</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">bean</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">id</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;txManager&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">class</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;org.springframework.orm.jpa.JpaTransactionManager&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">property</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;entityManagerFactory&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">ref</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;myEmf&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">bean</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">drools:ksession</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">id</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;jpaSingleSessionCommandService&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">type</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;stateful&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">kbase</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;kbase1&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">drools:configuration</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">drools:jpa-persistence</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">drools:transaction-manager</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">ref</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;txManager&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">drools:entity-manager-factory</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">ref</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;myEmf&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">drools:variable-persisters</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">drools:persister</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">for-class</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;javax.persistence.Entity&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">implementation</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;org.drools.persistence.processinstance.persisters.JPAVariablePersister&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">drools:persister</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">for-class</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;java.lang.String&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">implementation</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;org.drools.container.spring.beans.persistence.StringVariablePersister&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">drools:persister</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">for-class</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;java.io.Serializable&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">implementation</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;org.drools.persistence.processinstance.persisters.SerializableVariablePersister&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">drools:variable-persisters</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">&nbsp;&nbsp;</span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">drools:jpa-persistence</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">drools:configuration</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">drools:ksession</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre></div></div><br class="example-break"/><p>Knowledge Sessions can support startup batch scripts, previous
      versions used the "script" element name, this will be updated to
      "batch". The following commands are supported: "insert-object",
      "set-global", "fire-all-rules", "fire-until-halt", "start-process",
      "signal-event". Anonymous beans or named "ref" attributes may be
      used.</p><div class="example"><a id="d0e2862"/><p class="title"><b>Example 4.11. Startup Batch Commands</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">drools:ksession</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">id</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;jpaSingleSessionCommandService&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">type</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;stateful&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">kbase</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;kbase1&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">drools:script</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">drools:insert-object</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">ref</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;person1&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">drools:start-process</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">process-id</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;proc&nbsp;name&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">drools:parameter</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">identifier</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;varName&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">ref</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;varRef&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">drools:start-process</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">drools:fire-all-rules</span><span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">drools:script</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">drools:ksession</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre></div></div><br class="example-break"/><p>ExecutionNodes are supported in Spring , these provide a Context
      of registered ksessions; this can be used with Camel to provide ksession
      routing.</p><div class="example"><a id="d0e2869"/><p class="title"><b>Example 4.12. Execution Nodes</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">execution-node</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">id</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;node1&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">drools:ksession</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">id</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;ksession1&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">type</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;stateless&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;stateless1&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">kbase</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;kbase1&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">node</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;node1&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">drools:ksession</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">id</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;ksession2&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">type</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;stateful&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">kbase</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;kbase1&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">node</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;node1&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
</pre></div></div><br class="example-break"/></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e2874"/>4.5.2.3. Camel</h4></div></div></div><p>Spring can be combined with Camel to provide declarative rule
      services. a Camel Policy is added from Drools which provides magic for
      injecting the ClassLoader used by the ksession for any data formatters,
      it also augments the Jaxb and XStream data formatters. In the case lf
      Jaxb it adds additional Drools related path info and with XStream it
      registers Drools related converters and aliases.</p><p>You can create as many endpoints as you require, using different
      addresses. The CommandMessagBodyReader is needed to allow the payload to
      be handled by Camel.</p><div class="example"><a id="d0e2881"/><p class="title"><b>Example 4.13. Rest Endpoint Configuration</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">cxf:rsServer</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">id</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;rsServer&quot;</span><span class="xml_plain">&nbsp;&nbsp;</span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">address</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;/kservice/rest&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">serviceClass</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;org.drools.jax.rs.CommandExecutorImpl&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">cxf:providers</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">bean</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">class</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;org.drools.jax.rs.CommandMessageBodyReader&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">cxf:providers</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">cxf:rsServer</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">&nbsp;</span><br />
</pre></div></div><br class="example-break"/><p>Camel routes can then be attached to CXF endpoints, allowing you
      control over the payload for things like data formatting and executing
      against Drools ksessions. The DroolsPolicy adds some smarts to the
      route. If JAXB or XStream are used, it would inject custom paths and
      converters, it can also set the classloader too on the server side,
      based on the target ksession. On the client side it automatically
      unwrapes the Response object.</p><p>This example unmarshalls the payload using an augmented XStream
      DataFormat and executes it against the ksession1 instance. The "node"
      there refers to the ExecutionContext, which is a context of registered
      ksessions.</p><div class="example"><a id="d0e2890"/><p class="title"><b>Example 4.14. Camel Route</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">bean</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">id</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;droolsPolicy&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">class</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;org.drools.camel.component.DroolsPolicy&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain">&nbsp;&nbsp;</span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><br />
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">camelContext</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">id</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;camel&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">xmlns</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;http://camel.apache.org/schema/spring&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">route</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">from</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">uri</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;cxfrs://bean://rsServer&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">policy</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">ref</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;droolsPolicy&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">unmarshal</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">ref</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;xstream&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">to</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">uri</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;drools://node/ksession1&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">marshal</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">ref</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;xstream&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">policy</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">route</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">camelContext</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre></div></div><br class="example-break"/><p>The Drools endpoint "drools:node/ksession1" consists of the
      execution node name followed by a separator and optional knowledge
      session name. If the knowledge session is not specified the route will
      look at the "lookup" attribute on the incoming payload instace or in the
      head attribute "DroolsLookup" to find it.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e2897"/>4.5.2.4. Drools Server</h4></div></div></div><p>Spring, Camel and CXF can be combined for declarative services,
      drools-server is a .war that combines these with some sample xml that
      works out of the box to get you started, acting like a sort of template.
      If you are using the war in JBoss container you'll need to add this
      component, http://camel.apache.org/camel-jboss.html. The war includes a
      test.jsp showing an echo like example to get you started. This example
      just executes a simple "echo" type application. It sends a message to
      the rule server that pre-appends the word "echo" to the front and sends
      it back. By default the message is "Hello World", different messages can
      be passed using the url parameter msg - test.jsp?msg="My Custom
      Message".</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e2902"/>4.5.2.5. Knowledge Agent Incremental Change Support</h4></div></div></div><p>The new version of the Knowledge Agent supports newInstance =
      false in its configuration (incremental change-set build).</p><p>When setting this property to false, the KnowledgeAgent uses the
      exisitng KnowledgeBase references apply the incremental changes. Now
      KnowledgeAgent's can process monitored resource modifications in an
      incremental way. Modified definitions are compiled and compared against
      the original version. According to definition's type, the behaves in
      different ways:</p><div class="itemizedlist"><ul><li><p>Rules: For rules, the Agent searches for modifications in its
          attributes, LHS and RHS.</p></li><li><p>Queries: queries are always replaced on kbase wether they are
          modified or not.</p></li><li><p>Other definitions: All other definitions are always replaced
          in kbase (like if they were modified). We expect to add better
          support for definition's modification detection in further
          versions.</p></li></ul></div><p>The current implementation only supports the deletion of rules,
      querries and functions definitions. Type declarations cannot be
      deleted.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e2921"/>4.5.2.6. Session Inspection and Reporting framework</h4></div></div></div><p>A new API based framework for runtime session inspection and
      reporting was introduced, allowing for better data gathering during
      debugging or profiling of the application. This inspection framework
      will become the basis of the tooling features to help providing more
      detailed information about the contents of each session. This api is
      experimental and not in drools-api for now, but feel free to play and
      help us improve it.</p><p>To inspect a session, one can use the following API calls:</p><div class="example"><a id="d0e2928"/><p class="title"><b>Example 4.15. Creating a SessionInspector</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">StatefulKnowledgeSession</span><!-- <br/> --><span class="java_plain">&nbsp;ksession&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">...</span>
<!--  --><br/><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_plain">&nbsp;</span><span class="java_separator">...</span><span class="java_plain">&nbsp;insert&nbsp;facts</span><span class="java_separator">,</span><span class="java_plain">&nbsp;fire&nbsp;rules</span><span class="java_separator">,</span><span class="java_plain">&nbsp;etc</span>
<!--  --><br/><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_type">SessionInspector</span><span class="java_plain">&nbsp;inspector&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">SessionInspector</span><span class="java_separator">(</span><span class="java_plain">&nbsp;ksession&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_type">StatefulKnowledgeSessionInfo</span><span class="java_plain">&nbsp;info&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;inspector</span><span class="java_separator">.</span><span class="java_plain">getSessionInfo</span><span class="java_separator">();</span></pre></div></div><br class="example-break"/><p>The StatefulKnowledgeSessionInfo instance will contain a lot of
      relevant data gathered during the analysis of the session. A simple
      example report template is provided and can be generated with the
      following API call:</p><div class="example"><a id="d0e2935"/><p class="title"><b>Example 4.16. Generating a Report</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">String</span><!-- <br/> --><span class="java_plain">&nbsp;report&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">SessionReporter</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">generateReport</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_literal">&quot;simple&quot;</span><!-- <br/> --><span class="java_separator">,</span><!-- <br/> --><span class="java_plain">&nbsp;info</span><!-- <br/> --><span class="java_separator">,</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_literal">null</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">);</span></pre></div></div><br class="example-break"/></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e2940"/>4.5.3. Expert</h3></div></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e2943"/>4.5.3.1. Differential Update</h4></div></div></div><p>Rete traditional does an update as a retract + assert, for a given
      fact this causes all partial matches to be destroyed, however during the
      assert some of which will be recreated again; because they were true
      before the update and still true after the update. This causes a lot of
      uneccessary object destruction and creation which puts more load on the
      Garbage Collector. Now an update is a single pass and inspects the
      partial matches in place avoiding the unecessary destruction of partial
      matches. It also removes the need to under go a normalisation process
      for events and truth maintenance; the normalisation process was where we
      would look at the activations retracted and activations inserted to
      figure out what was truly added and what was truly inserted to determine
      the "diff".</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e2948"/>4.5.3.2. Channels</h4></div></div></div><p>Exit Points have been replaced by the more aptly named channels,
      we felt this was more appropriate as they may be used by more than juse
      the rule engine and not an exact oppposte if Entry Points. Where entry
      points are explicitey related to entering a partition in the Rete
      network.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e2953"/>4.5.3.3. Live Querries</h4></div></div></div><p>Drools has always had query support, but the result was returned
      as an iterable set; this makes it hard to monitor changes over
      time.</p><p>We have now complimented this with Live Querries, which has a
      listener attached instead of returning an iterable result set. These
      live querries stay open creating a view and publish change events for
      the contents of this view. So now you can execute your query, with
      parameters and listen to changes in the resulting view.</p><div class="example"><a id="d0e2960"/><p class="title"><b>Example 4.17. Implementing ViewChangedEventListener</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">final</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">List</span><!-- <br/> --><span class="java_plain">&nbsp;updated&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">new</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">ArrayList</span><!-- <br/> --><span class="java_separator">();</span>
<!--  --><br/><span class="java_keyword">final</span><span class="java_plain">&nbsp;</span><span class="java_type">List</span><span class="java_plain">&nbsp;removed&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">ArrayList</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_keyword">final</span><span class="java_plain">&nbsp;</span><span class="java_type">List</span><span class="java_plain">&nbsp;added&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">ArrayList</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_type">ViewChangedEventListener</span><span class="java_plain">&nbsp;listener&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">ViewChangedEventListener</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;rowUpdated</span><span class="java_separator">(</span><span class="java_type">Row</span><span class="java_plain">&nbsp;row</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;updated</span><span class="java_separator">.</span><span class="java_plain">add</span><span class="java_separator">(</span><span class="java_plain">&nbsp;row</span><span class="java_separator">.</span><span class="java_plain">get</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;$price&quot;</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;rowRemoved</span><span class="java_separator">(</span><span class="java_type">Row</span><span class="java_plain">&nbsp;row</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;removed</span><span class="java_separator">.</span><span class="java_plain">add</span><span class="java_separator">(</span><span class="java_plain">&nbsp;row</span><span class="java_separator">.</span><span class="java_plain">get</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;$price&quot;</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;rowAdded</span><span class="java_separator">(</span><span class="java_type">Row</span><span class="java_plain">&nbsp;row</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;added</span><span class="java_separator">.</span><span class="java_plain">add</span><span class="java_separator">(</span><span class="java_plain">&nbsp;row</span><span class="java_separator">.</span><span class="java_plain">get</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;$price&quot;</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_separator">};</span><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_plain">&nbsp;</span><span class="java_type">Open</span><span class="java_plain">&nbsp;the&nbsp;</span><span class="java_type">LiveQuery</span>
<!--  --><br/><span class="java_type">LiveQuery</span><span class="java_plain">&nbsp;query&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;ksession</span><span class="java_separator">.</span><span class="java_plain">openLiveQuery</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;cheeses&quot;</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">Object</span><span class="java_separator">[]</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;cheddar&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;stilton&quot;</span><span class="java_plain">&nbsp;</span><span class="java_separator">},</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;listener&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">...</span>
<!--  --><br/><span class="java_plain">query</span><span class="java_separator">.</span><span class="java_plain">dispose</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;make&nbsp;sure&nbsp;you&nbsp;call&nbsp;dispose&nbsp;when&nbsp;you&nbsp;want&nbsp;the&nbsp;query&nbsp;to&nbsp;close</span></pre></div></div><br class="example-break"/><p>A Drools blog article contains an example of Glazed Lists
      integration for live queries,</p><p><a class="link" href="http://blog.athico.com/2010/07/glazed-lists-examples-for-drools-live.html" target="">http://blog.athico.com/2010/07/glazed-lists-examples-for-drools-live.html</a></p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e2970"/>4.5.3.4. Timers and Calendars</h4></div></div></div><p>Rule's now suport both interval and cron based timers, which
      replace the now deprecated duration attribute.</p><div class="example"><a id="d0e2975"/><p class="title"><b>Example 4.18. Sample timer attribute uses</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">timer&nbsp;</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">int</span><!-- <br/> --><span class="java_operator">:</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_operator">&lt;</span><!-- <br/> --><span class="java_plain">initial&nbsp;delay</span><!-- <br/> --><span class="java_operator">&gt;</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_operator">&lt;</span><!-- <br/> --><span class="java_plain">repeat&nbsp;interval</span><!-- <br/> --><span class="java_operator">&gt;?</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">timer&nbsp;</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_type">int</span><span class="java_operator">:</span><span class="java_plain">&nbsp;</span><span class="java_literal">30</span><span class="java_plain">s&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">timer&nbsp;</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_type">int</span><span class="java_operator">:</span><span class="java_plain">&nbsp;</span><span class="java_literal">30</span><span class="java_plain">s&nbsp;</span><span class="java_literal">5</span><span class="java_plain">m&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_plain">timer&nbsp;</span><span class="java_separator">(</span><span class="java_plain">&nbsp;cron</span><span class="java_operator">:</span><span class="java_plain">&nbsp;</span><span class="java_operator">&lt;</span><span class="java_plain">cron&nbsp;expression</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">timer&nbsp;</span><span class="java_separator">(</span><span class="java_plain">&nbsp;cron</span><span class="java_operator">:*</span><span class="java_plain">&nbsp;</span><span class="java_literal">0</span><span class="java_operator">/</span><span class="java_literal">15</span><span class="java_plain">&nbsp;</span><span class="java_operator">*</span><span class="java_plain">&nbsp;</span><span class="java_operator">*</span><span class="java_plain">&nbsp;</span><span class="java_operator">*</span><span class="java_plain">&nbsp;</span><span class="java_operator">?</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span></pre></div></div><br class="example-break"/><p>Interval "int:" timers follow the JDK semantics for initial delay
      optionally followed by a repeat interval. Cron "cron:" timers follow
      standard cron expressions:</p><div class="example"><a id="d0e2982"/><p class="title"><b>Example 4.19. A Cron Example</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">rule&nbsp;</span><!-- <br/> --><span class="java_literal">&quot;Send&nbsp;SMS&nbsp;every&nbsp;15&nbsp;minutes&quot;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;timer&nbsp;</span><span class="java_separator">(</span><span class="java_plain">cron</span><span class="java_operator">:*</span><span class="java_plain">&nbsp;</span><span class="java_literal">0</span><span class="java_operator">/</span><span class="java_literal">15</span><span class="java_plain">&nbsp;</span><span class="java_operator">*</span><span class="java_plain">&nbsp;</span><span class="java_operator">*</span><span class="java_plain">&nbsp;</span><span class="java_operator">*</span><span class="java_plain">&nbsp;</span><span class="java_operator">?</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">when</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;$a&nbsp;</span><span class="java_operator">:</span><span class="java_plain">&nbsp;</span><span class="java_type">Alarm</span><span class="java_separator">(</span><span class="java_plain">&nbsp;on&nbsp;</span><span class="java_operator">==</span><span class="java_plain">&nbsp;</span><span class="java_literal">true</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">then</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;channels</span><span class="java_separator">[</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;sms&quot;</span><span class="java_plain">&nbsp;</span><span class="java_separator">].</span><span class="java_plain">insert</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">Sms</span><span class="java_separator">(</span><span class="java_plain">&nbsp;$a</span><span class="java_separator">.</span><span class="java_plain">mobileNumber</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;The&nbsp;alarm&nbsp;is&nbsp;still&nbsp;on&quot;</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">end</span></pre></div></div><br class="example-break"/><p>Calendars can now controll when rules can fire. The Calendar api
      is modelled on <a class="link" href="http://www.quartz-scheduler.org/" target="">Quartz
      http://www.quartz-scheduler.org/</a> :</p><div class="example"><a id="d0e2992"/><p class="title"><b>Example 4.20. Adapting a Quartz Calendar</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">Calendar</span><!-- <br/> --><span class="java_plain">&nbsp;weekDayCal&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">QuartzHelper</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">quartzCalendarAdapter</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_plain">org</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">quartz</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_type">Calendar</span><!-- <br/> --><span class="java_plain">&nbsp;quartzCal</span><!-- <br/> --><span class="java_separator">)</span></pre></div></div><br class="example-break"/><p>Calendars are registered with the StatefulKnowledgeSession:</p><div class="example"><a id="d0e2999"/><p class="title"><b>Example 4.21. Registering a Calendar</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">ksession</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">getCalendars</span><!-- <br/> --><span class="java_separator">().</span><!-- <br/> --><span class="java_plain">set</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_literal">&quot;week&nbsp;day&quot;</span><!-- <br/> --><span class="java_separator">,</span><!-- <br/> --><span class="java_plain">&nbsp;weekDayCal&nbsp;</span><!-- <br/> --><span class="java_separator">);</span></pre></div></div><br class="example-break"/><p>They can be used in conjunction with normal rules and rules
      including timers. The rule calendar attribute can have one or more comma
      calendar names.</p><div class="example"><a id="d0e3006"/><p class="title"><b>Example 4.22. Using Calendars and Timers together</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">rule&nbsp;</span><!-- <br/> --><span class="java_literal">&quot;weekdays&nbsp;are&nbsp;high&nbsp;priority&quot;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;calendars&nbsp;</span><span class="java_literal">&quot;weekday&quot;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;timer&nbsp;</span><span class="java_separator">(</span><span class="java_type">int</span><span class="java_operator">:</span><span class="java_literal">0</span><span class="java_plain">&nbsp;</span><span class="java_literal">1</span><span class="java_plain">h</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">when&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">Alarm</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">then</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;send</span><span class="java_separator">(</span><span class="java_plain">&nbsp;&quot;priority&nbsp;high&nbsp;</span><span class="java_operator">-</span><span class="java_plain">&nbsp;we&nbsp;have&nbsp;an&nbsp;alarm&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">end&nbsp;</span>
</span>
<!--  --><br/><span class="java_plain">rule&nbsp;</span><span class="java_literal">&quot;weekend&nbsp;are&nbsp;low&nbsp;priority&quot;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;calendars&nbsp;</span><span class="java_literal">&quot;weekend&quot;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;timer&nbsp;</span><span class="java_separator">(</span><span class="java_type">int</span><span class="java_operator">:</span><span class="java_literal">0</span><span class="java_plain">&nbsp;</span><span class="java_literal">4</span><span class="java_plain">h</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">when&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">Alarm</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">then</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;send</span><span class="java_separator">(</span><span class="java_plain">&nbsp;&quot;priority&nbsp;low&nbsp;</span><span class="java_operator">-</span><span class="java_plain">&nbsp;we&nbsp;have&nbsp;an&nbsp;alarm&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">end</span></pre></div></div><br class="example-break"/></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e3011"/>4.5.3.5. Decision Tables (Excel)</h4></div></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h5 class="title"><a id="d0e3014"/>4.5.3.5.1. Simple templating for variable length comma separated lists
        within cells</h5></div></div></div><p>It is now possible to have a comma separated list of values in a
        cell and render those with a forall template</p><div class="example"><a id="d0e3019"/><p class="title"><b>Example 4.23. DTable forall syntax</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">forall</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_operator">&lt;</span><!-- <br/> --><span class="java_plain">separator</span><!-- <br/> --><span class="java_operator">&gt;?</span><!-- <br/> --><span class="java_separator">){</span><!-- <br/> --><span class="java_operator">&lt;</span><!-- <br/> --><span class="java_plain">codesnippt</span><!-- <br/> --><span class="java_operator">&gt;</span><!-- <br/> --><span class="java_separator">}</span></pre></div></div><br class="example-break"/><div class="example"><a id="d0e3024"/><p class="title"><b>Example 4.24. DTable forall examples</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">forall</span><!-- <br/> --><span class="java_separator">(,)</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">{</span><!-- <br/> --><span class="java_plain">propertyName&nbsp;</span><!-- <br/> --><span class="java_operator">==</span><!-- <br/> --><span class="java_plain">&nbsp;$</span><!-- <br/> --><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">forall</span><span class="java_separator">(</span><span class="java_operator">&amp;&amp;</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">propertyName&nbsp;</span><span class="java_operator">==</span><span class="java_plain">&nbsp;$</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">forall</span><span class="java_separator">(</span><span class="java_operator">||</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">propertyName&nbsp;</span><span class="java_operator">==</span><span class="java_plain">&nbsp;$</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">forall</span><span class="java_separator">(</span><span class="java_operator">||</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">propertyNameA&nbsp;</span><span class="java_operator">==</span><span class="java_plain">&nbsp;$</span><span class="java_separator">}</span><span class="java_plain">&nbsp;</span><span class="java_operator">&amp;&amp;</span><span class="java_plain">&nbsp;forall</span><span class="java_separator">(</span><span class="java_operator">||</span><span class="java_separator">){</span><span class="java_plain">propertyNameB&nbsp;</span><span class="java_operator">==</span><span class="java_plain">&nbsp;$</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">etc&nbsp;</span></pre></div></div><br class="example-break"/></div></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e3029"/>4.5.4. Flow</h3></div></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e3032"/>4.5.4.1. BPMN2</h4></div></div></div><p>As we already announced earlier, the Drools team has decided to
      support the use of the upcoming BPMN 2.0 specification for specifying
      business processes using XML. This milestone includes a significant
      extension of the BPMN2 parser to support more of the BPMN2 features
      using Drools Flow. More specifically:</p><div class="itemizedlist"><ul><li><p>more extensive event support: much more combinations of event
          types (start, intermediate and end) and event triggers (including
          for example error, escalation, timer, conditional and signal
          events), have been included, as well as (interrupting and
          non-interrupting) boundary events</p></li><li><p>sub-process parameters</p></li><li><p>diverging inclusive gateway</p></li><li><p>etc.</p></li></ul></div><p>BPMN2 processes have also been integrated in the entire Drools
      tool chain, to support the entire life cycle of the business process.
      This includes</p><div class="itemizedlist"><ul><li><p>The ability to use BPMN2 processes in combination with our
          Eclipse tooling</p></li><li><p>Guvnor as process repository</p></li><li><p>web-based management using the BPM console</p></li><li><p>auditing and debugging</p></li><li><p>domain-specific processes</p></li><li><p>etc.</p></li></ul></div><p>As a result, Drools Flow is not only the first open-source process
      engine that supports such a significant set of BPMN2 constructs
      natively, our knowledge-oriented approach also allows you to easily
      combine your BPMN2 processes with business rules and complex event
      processing, all using the same APIs and tools.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e3073"/>4.5.4.2. Web-based Management console</h4></div></div></div><p>Drools Flow processes can now also be managed through a web
      console. This includes features like managing your process instances
      (starting/stopping/inspecting), inspecting your (human) task list and
      executing those tasks, and generating reports.</p><p>This console is actually the (excellent!) work of Heiko Braun, who
      has created a generic BPM console that can be used to support multiple
      process languages. We have therefore implemented the necessary
      components to allow this console to communicate with the Drools Flow
      engine.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e3080"/>4.5.4.3. Pluggable Variable Persistence</h4></div></div></div><p>Drools Flow can persist the runtime state of the running processes
      to a database (so they don't all need to be in memory and can be
      restored in case of failure). Our default persistence mechanism stores
      all the runtime information related to one process instance as a binary
      object (with associated metadata). The data associated with this process
      instance (aka process instance variables) were also stored as part of
      that binary object. This however could generate problem (1) when the
      data was not Serializable, (2) when the objects were too large to
      persist as part of the process instance state or (3) when they were
      already persisted elsewhere. We have therefor implemented pluggable
      variable persisters where the user can define how variable values are
      stored. This for example allows you to store variable values separately,
      and does support JPA entities to be stored separately and referenced
      (avoiding duplication of state).</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e3085"/>4.5.4.4. Improved Process Instance Migration</h4></div></div></div><p>Over time, processes may evolve. Whenever a process is updated, it
      is important to determine what should happen to the already running
      process instances. We have improved our support for migrating running
      process instances to a newer version of the process definition. Check
      out the Drools Flow documentation for more information.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e3090"/>4.5.4.5. Installation Script</h4></div></div></div><p>The Drools build now exports an installer that simplifies
      installing the Eclipse plugin, Guvnor and the gwt-console. It creates
      and copies the necessary jars and wars and deploys them to the JBoss AS.
      It also includes a simple evaluation process example you can use to test
      your setup. For more info, download the drools installer and take a look
      at the readme within.</p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e3095"/>4.5.5. Guvnor</h3></div></div></div><p>Appearance has been cleaned, for example less pop ups. Reminders for
    save after changes in assets and information about actions that were
    taken, also better error reporting if something goes wrong.</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e3100"/>4.5.5.1. Discussions</h4></div></div></div><p>The comments are below the "documentation" section (and of course
      optional) (and there is an Atom feed to them).</p><div class="figure"><a id="d0e3105"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Release_Notes/discussion1.png" align="middle" alt="Realtime Discussions"/></div></div><p class="title"><b>Figure 4.75. Realtime Discussions</b></p></div><br class="figure-break"/><p>A "backchannel" type connection that is kept open from the browser
      to allow messages to push back - this means (when enabled) that messages
      show up in real time (and other handy things like if something is added
      to a list - the list is updated).</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e3113"/>4.5.5.2. Inbox</h4></div></div></div><p>The inbox feature provides the ability to track what you have
      opened, or edited - this shows up under an "Inbox" item in the main
      navigator. <a class="link" href="http://blog.athico.com/2009/09/inbox-feature-to-track-recent-changes.html" target="">http://blog.athico.com/2009/09/inbox-feature-to-track-recent-changes.html</a></p><div class="figure"><a id="d0e3119"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Release_Notes/inbox1.png" align="middle" alt="Inbox Categories"/></div></div><p class="title"><b>Figure 4.76. Inbox Categories</b></p></div><br class="figure-break"/><div class="itemizedlist"><ul><li><p><span class="bold"><strong>Recently Opened </strong></span></p><div class="itemizedlist"><ul><li><p>Clicking on the recently opened item will open a listing
              of all items you have "recently" opened (it tracks a few hundred
              items that you were last to look at).</p></li></ul></div></li><li><p><span class="bold"><strong>Recently Edited</strong></span></p><div class="itemizedlist"><ul><li><p>Any items that you save changes to, or comment on will
              show up here, once again.</p></li></ul></div></li><li><p><span class="bold"><strong>Incoming changes</strong></span></p><div class="itemizedlist"><ul><li><p>This tracks changes made by *other people* to items that
              are in *your* "Recently Edited" list. When you open these items
              they then are removed from this list (but remain in your
              Recently Edited list).</p></li></ul></div></li></ul></div><div class="figure"><a id="d0e3150"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Release_Notes/inbox2.png" align="middle" alt="Inbox Item Lists"/></div></div><p class="title"><b>Figure 4.77. Inbox Item Lists</b></p></div><br class="figure-break"/></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e3156"/>4.5.5.3. Bulk Importer</h4></div></div></div><p>The Guvnor-Importer is a maven build tool that recurses your rules
      directory structure and constructs an xml import file that can be
      manually imported into the Drools-Guvnor web interface via the
      import/export administration feature.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e3161"/>4.5.5.4. DroolsDoc</h4></div></div></div><p>PDF document containing information about the package and each DRL
      asset. DroolsDoc for knowledge package can be downloaded from package
      view under "Information and important URLs"</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e3166"/>4.5.5.5. Update to GWT 2.0</h4></div></div></div><p>GWT was updated, making Guvnor faster.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e3171"/>4.5.5.6. Build in Selector</h4></div></div></div><p>The built in selector allows user to choose what assets to build
      according to:</p><div class="itemizedlist"><ul><li><p>Status (eg, Dev, QA etc)</p></li><li><p>Category</p></li><li><p>Metadata</p></li></ul></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e3186"/>4.5.5.7. Single Asset Verification</h4></div></div></div><p>It is possible to verify just the asset you are working on (
      ruleflow, rule, decision table ). Verification finds issues like
      conflicting restrictions in a rule or redundant rows in decision
      tables.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e3191"/>4.5.5.8. Global Area</h4></div></div></div><p>Assets stored in Global area can be shared to all packages.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e3196"/>4.5.5.9. Diff Check between Snapshots</h4></div></div></div><p>Lists the changes between two snapshots.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e3201"/>4.5.5.10. View Multiple Assets in One Tab</h4></div></div></div><p>Makes it possible to open more than one asset into one view. All
      the assets can be saved and edited as a group.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e3206"/>4.5.5.11. From/Collect/Accumulate support</h4></div></div></div><p>Guided Editor has basic support for From, Accumulate and Collect
      Patterns. You can add any of these structures as regular Patterns. New
      expression builder component was created to add support for nested
      method calls of a variable. Using the “plus” button at the top of rule’s
      WHEN section or using the new “Add after” button present in every
      Pattern will open the popup to add new conditional elements to your
      rule. In the list of possible elements you will find three new entries:
      ”From”, “From Accumulate” and “From Collect”.</p><p>When you add a new “From” element, you will see something like the
      image below in the guided editor. The left pattern of the “From”
      conditional element is a regular Pattern. You can add there any type of
      conditional element you want.The right section of the “From” pattern is
      an expression builder.</p><div class="figure"><a id="d0e3213"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Release_Notes/from_builder.png" align="middle" alt="From CE Builder"/></div></div><p class="title"><b>Figure 4.78. From CE Builder</b></p></div><br class="figure-break"/><p>When using 'from collect' In the left pattern you can choose from
      “java.util.Collection”, “java.util.List” or “java.util.Set” Fact Types.
      This Fact Types will be automatically included in the package’s Fact
      Types list.</p><p>The right pattern of the collect conditional element could be one
      of this patterns:</p><div class="itemizedlist"><ul><li><p>Fact Type Pattern</p></li><li><p>Free Form Expression</p></li><li><p>From Pattern</p></li><li><p>From Collect Pattern</p></li><li><p>From Accumulate Pattern</p></li></ul></div><div class="figure"><a id="d0e3239"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Release_Notes/fromcollect.png" align="middle" alt="From Collect CE Builder"/></div></div><p class="title"><b>Figure 4.79. From Collect CE Builder</b></p></div><br class="figure-break"/><p>When using 'from accumulate' The left pattern could be any Fact
      Type Pattern. The right section of this conditional element is splited
      in two:</p><div class="figure"><a id="d0e3247"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Release_Notes/fromaccumulate.png" align="middle" alt="From Accumulate CE Builder"/></div></div><p class="title"><b>Figure 4.80. From Accumulate CE Builder</b></p></div><br class="figure-break"/><p>The left pattern could be any Fact Type Pattern. The right section
      of this conditional element is splited in two:</p><div class="itemizedlist"><ul><li><p>Source Pattern: (Bed $n, in the screenshot) could be any Fact
          Type, From, Collect or Accumulate pattern.</p></li><li><p>Accumulate function: Here you will find a tabbed panel where
          you can enter an accumulate function (sum() in the screenshot) or
          you can create an online custom function using the “Custom Code”
          tab.</p></li></ul></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e3262"/>4.5.5.12. Rule Templates</h4></div></div></div><p>Rule Templates allow the Guided editor to be used to build complex
      rules that can then be authored easily through a spreadsheet's tabular
      data metaphor. Instead of a field's value, simply mark it as a named
      "Template Key" and that key is available as a column in the grid. Each
      row will be applied to the rule template to generate a rule.</p><div class="figure"><a id="d0e3267"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Release_Notes/ruletemplate1.png" align="middle" alt="Adding a Template Key in the 'WHEN' Section"/></div></div><p class="title"><b>Figure 4.81. Adding a Template Key in the 'WHEN' Section</b></p></div><br class="figure-break"/><div class="figure"><a id="d0e3273"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Release_Notes/ruletemplate2.png" align="middle" alt="Adding a Template Key in the &#34;THEN&#34; Section"/></div></div><p class="title"><b>Figure 4.82. Adding a Template Key in the "THEN" Section</b></p></div><br class="figure-break"/><div class="figure"><a id="d0e3279"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Release_Notes/ruletemplate3.png" align="middle" alt="Populating Rows against those Template Keys"/></div></div><p class="title"><b>Figure 4.83. Populating Rows against those Template Keys</b></p></div><br class="figure-break"/><div class="figure"><a id="d0e3285"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Release_Notes/ruletemplate4.png" align="middle" alt="Each Row generates a Rule"/></div></div><p class="title"><b>Figure 4.84. Each Row generates a Rule</b></p></div><br class="figure-break"/></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e3291"/>4.5.5.13. Working Sets</h4></div></div></div><p>When modelling rules the user gets exposed to all the fact types
      which can be a bit over whelming. Working Sets allow related fact types
      can be grouped together, provided a more managable view of selecting
      fact types, when authoring rules</p><div class="figure"><a id="d0e3296"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Release_Notes/facttypes.png" align="middle" alt="Show the imported types"/></div></div><p class="title"><b>Figure 4.85. Show the imported types</b></p></div><br class="figure-break"/><div class="figure"><a id="d0e3302"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Release_Notes/workingsets1.png" align="middle" alt="Create Animals Working Set"/></div></div><p class="title"><b>Figure 4.86. Create Animals Working Set</b></p></div><br class="figure-break"/><div class="figure"><a id="d0e3308"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Release_Notes/workingsets2.png" align="middle" alt="Without the Working Set all types are visible"/></div></div><p class="title"><b>Figure 4.87. Without the Working Set all types are visible</b></p></div><br class="figure-break"/><div class="figure"><a id="d0e3314"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Release_Notes/workingsets3.png" align="middle" alt="Select the Animals Working Set"/></div></div><p class="title"><b>Figure 4.88. Select the Animals Working Set</b></p></div><br class="figure-break"/><div class="figure"><a id="d0e3320"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Release_Notes/workingsets4.png" align="middle" alt="The available types are reduced"/></div></div><p class="title"><b>Figure 4.89. The available types are reduced</b></p></div><br class="figure-break"/></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e3326"/>4.5.5.14. Fact Constraints</h4></div></div></div><p>Working Sets can be combined with fact consraints to provide
      additional design time validation. For instance if you are authoring a
      rule on someone's age, we can know the valid ranges at design time and
      use this to constrain the author. The fact constraints are part of the
      workingset and when authoring a rule you must select the work set
      constraints that you wish to be applied as part of the validation
      process.</p><div class="figure"><a id="d0e3331"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Release_Notes/factconstraints1.png" align="middle" alt="Selecting the field"/></div></div><p class="title"><b>Figure 4.90. Selecting the field</b></p></div><br class="figure-break"/><div class="figure"><a id="d0e3337"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Release_Notes/factconstraints2.png" align="middle" alt="Selectng the type of field constraint"/></div></div><p class="title"><b>Figure 4.91. Selectng the type of field constraint</b></p></div><br class="figure-break"/><div class="figure"><a id="d0e3343"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Release_Notes/factconstraints3.png" align="middle" alt="A example range constraint"/></div></div><p class="title"><b>Figure 4.92. A example range constraint</b></p></div><br class="figure-break"/><div class="figure"><a id="d0e3349"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Release_Notes/factconstraints4.png" align="middle" alt="Select the working set to validate the age field"/></div></div><p class="title"><b>Figure 4.93. Select the working set to validate the age field</b></p></div><br class="figure-break"/><div class="figure"><a id="d0e3355"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Release_Notes/factconstraints5.png" align="middle" alt="A age of 5 is invalid"/></div></div><p class="title"><b>Figure 4.94. A age of 5 is invalid</b></p></div><br class="figure-break"/></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e3361"/>4.5.5.15. Guided Rule Editor</h4></div></div></div><p>Editing rules is made more explicit. Editor is less "boxy" and
      rules are written more as a normal text. "contains" keyword was added
      and binding variables to restrictions is now easier.</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h5 class="title"><a id="d0e3366"/>4.5.5.15.1. Pattern Order</h5></div></div></div><p>Guided Editor supports Pattern reordering in LHS and RHS
        sections, as well as positional inserting, new Patterns can be
        inserted in any order (and not always at the end).</p><div class="figure"><a id="d0e3371"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Release_Notes/patternordering1.png" align="middle" alt="Move elements up or down"/></div></div><p class="title"><b>Figure 4.95. Move elements up or down</b></p></div><br class="figure-break"/><div class="figure"><a id="d0e3377"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Release_Notes/patternordering2.png" align="middle" alt="Insert Element at any position"/></div></div><p class="title"><b>Figure 4.96. Insert Element at any position</b></p></div><br class="figure-break"/></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e3383"/>4.5.5.16. Decision Table (Guvnor)</h4></div></div></div><p>Keyword "in" was added.</p><p>Columns can be moved and location of a new row can be selected
      freely.</p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e3390"/>4.5.6. Eclipse</h3></div></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e3393"/>4.5.6.1. Group Rules in outline view</h4></div></div></div><p>You can now use sorting and grouping for Agenda Groups.</p><div class="figure"><a id="d0e3398"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Release_Notes/Group By.jpg" align="middle" alt="Group by Agenda Group"/></div></div><p class="title"><b>Figure 4.97. Group by Agenda Group</b></p></div><br class="figure-break"/><div class="figure"><a id="d0e3404"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Release_Notes/SortBy.jpg" align="middle" alt="Sort by Agenda Group"/></div></div><p class="title"><b>Figure 4.98. Sort by Agenda Group</b></p></div><br class="figure-break"/></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e3410"/>4.5.6.2. Drag/Drop File support in audit View</h4></div></div></div><p>It is now possible to drag and drop log files into the audit
      view.</p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e3415"/>4.5.7. Known Issues</h3></div></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e3418"/>4.5.7.1. Multithread mode</h4></div></div></div><p>There is a known issue with the experimental multi-thread
      execution mode as described in the following JIRA.</p><p><a class="link" href="https://jira.jboss.org/browse/JBRULES-2125" target="">https://jira.jboss.org/browse/JBRULES-2125</a></p></div></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e3426"/>4.6. What is New and Noteworthy in Drools 5.0.0</h2></div></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e3429"/>4.6.1. Drools API</h3></div></div></div><p>Drools now has complete api/implementation separation that is no
    longer rules oriented. This is an important strategy as we move to support
    other forms of logic, such as workflow and event processing. The main
    change is that we are now knowledge oriented, instead of rule oriented.
    The module drools-api provide the interfaces and factories and we have
    made pains to provide much better javadocs, with lots of code snippets,
    than we did before. Drools-api also helps clearly show what is intended as
    a user api and what is just an engine api, drools-core and drools-compiler
    did not make this clear enough. The most common interfaces you will use
    are:</p><div class="itemizedlist"><ul><li><p>org.drools.builder.KnowledgeBuilder</p></li><li><p>org.drools.KnowledgeBase</p></li><li><p>org.drools.agent.KnowledgeAgent</p></li><li><p>org.drools.runtime.StatefulKnowledgeSession</p></li><li><p>org.drools.runtime.StatelessKnowledgeSession</p></li></ul></div><p>Factory classes, with static methods, provide instances
    of the above interfaces. A pluggable provider approach is used to allow
    provider implementations to be wired up to the factories at runtime. The
    Factories you will most commonly used are:</p><div class="itemizedlist"><ul><li><p>org.drools.builder.KnowledgeBuilderFactory</p></li><li><p>org.drools.io.ResourceFactory</p></li><li><p>org.drools.KnowledgeBaseFactory</p></li><li><p>org.drools.agent.KnowledgeAgentFactory</p></li></ul></div><div class="example"><a id="d0e3465"/><p class="title"><b>Example 4.25. A Typical example to load a rule resource</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"></span>
<!--  --><br/><span class="java_type">KnowledgeBuilder</span><span class="java_plain">&nbsp;kbuilder&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">KnowledgeBuilderFactory</span><span class="java_separator">.</span><span class="java_plain">newKnowledgeBuilder</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">kbuilder</span><span class="java_separator">.</span><span class="java_plain">add</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_type">ResourceFactory</span><span class="java_separator">.</span><span class="java_plain">newUrlResource</span><span class="java_separator">(</span><span class="java_plain">&nbsp;url&nbsp;</span><span class="java_separator">),</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">ResourceType</span><span class="java_separator">.</span><span class="java_plain">DRL&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_keyword">if</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_plain">&nbsp;kbuilder</span><span class="java_separator">.</span><span class="java_plain">hasErrors</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_type">System</span><span class="java_separator">.</span><span class="java_plain">err</span><span class="java_separator">.</span><span class="java_plain">println</span><span class="java_separator">(</span><span class="java_plain">&nbsp;builder</span><span class="java_separator">.</span><span class="java_plain">getErrors</span><span class="java_separator">().</span><span class="java_plain">toString</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_separator">}</span><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
</span>
<!--  --><br/><span class="java_type">KnowledgeBase</span><span class="java_plain">&nbsp;kbase&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">KnowledgeBaseFactory</span><span class="java_separator">.</span><span class="java_plain">newKnowledgeBase</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">kbase</span><span class="java_separator">.</span><span class="java_plain">addKnowledgePackages</span><span class="java_separator">(</span><span class="java_plain">&nbsp;builder</span><span class="java_separator">.</span><span class="java_plain">getKnowledgePackages</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_type">StatefulKnowledgeSession</span><span class="java_plain">&nbsp;ksession&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;knowledgeBase</span><span class="java_separator">.</span><span class="java_plain">newStatefulKnowledgeSession</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">ksession</span><span class="java_separator">.</span><span class="java_plain">insert</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">Fibonacci</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">10</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">ksession</span><span class="java_separator">.</span><span class="java_plain">fireAllRules</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_plain">ksession</span><span class="java_separator">.</span><span class="java_plain">dispose</span><span class="java_separator">();</span></pre></div></div><br class="example-break"/><p> A Typical example to load a process resource. Notice the
    <code class="code">ResourceType</code> is changed, in accordance with the
    <code class="code">Resource</code> type:</p><div class="example"><a id="d0e3478"/><p class="title"><b>Example 4.26. A Typical example to load a process resource. Notice the
        <code class="code">ResourceType</code> is changed, in accordance with the
        <code class="code">Resource</code> type</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"></span>
<!--  --><br/><span class="java_type">KnowledgeBuilder</span><span class="java_plain">&nbsp;kbuilder&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">KnowledgeBuilderFactory</span><span class="java_separator">.</span><span class="java_plain">newKnowledgeBuilder</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">kbuilder</span><span class="java_separator">.</span><span class="java_plain">add</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_type">ResourceFactory</span><span class="java_separator">.</span><span class="java_plain">newUrlResource</span><span class="java_separator">(</span><span class="java_plain">&nbsp;url&nbsp;</span><span class="java_separator">),</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">ResourceType</span><span class="java_separator">.</span><span class="java_plain">DRF&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_keyword">if</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_plain">&nbsp;kbuilder</span><span class="java_separator">.</span><span class="java_plain">hasErrors</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_type">System</span><span class="java_separator">.</span><span class="java_plain">err</span><span class="java_separator">.</span><span class="java_plain">println</span><span class="java_separator">(</span><span class="java_plain">&nbsp;builder</span><span class="java_separator">.</span><span class="java_plain">getErrors</span><span class="java_separator">().</span><span class="java_plain">toString</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_separator">}</span><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
</span>
<!--  --><br/><span class="java_type">KnowledgeBase</span><span class="java_plain">&nbsp;kbase&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">KnowledgeBaseFactory</span><span class="java_separator">.</span><span class="java_plain">newKnowledgeBase</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">kbase</span><span class="java_separator">.</span><span class="java_plain">addKnowledgePackages</span><span class="java_separator">(</span><span class="java_plain">&nbsp;builder</span><span class="java_separator">.</span><span class="java_plain">getKnowledgePackages</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_type">StatefulKnowledgeSession</span><span class="java_plain">&nbsp;ksession&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;knowledgeBase</span><span class="java_separator">.</span><span class="java_plain">newStatefulKnowledgeSession</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">ksession</span><span class="java_separator">.</span><span class="java_plain">startProcess</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;Buy&nbsp;Order&nbsp;Process&quot;</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_plain">ksession</span><span class="java_separator">.</span><span class="java_plain">dispose</span><span class="java_separator">();</span>
</pre></div></div><br class="example-break"/><p> 'kbuilder', 'kbase', 'ksession' are the variable identifiers
    often used, the k prefix is for 'knowledge'.</p><div class="example"><a id="d0e3491"/><p class="title"><b>Example 4.27. We have uniformed how decision trees are loaded, and they are
        now consistent with no need to pre generate the DRL with the
        spreadsheet compiler</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"></span>
<!--  --><br/><span class="java_type">DecisionTableConfiguration</span><span class="java_plain">&nbsp;dtconf&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">KnowledgeBuilderFactory</span><span class="java_separator">.</span><span class="java_plain">newDecisionTableConfiguration</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">dtconf</span><span class="java_separator">.</span><span class="java_plain">setInputType</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_type">DecisionTableInputType</span><span class="java_separator">.</span><span class="java_plain">XLS&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">dtconf</span><span class="java_separator">.</span><span class="java_plain">setWorksheetName</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;Tables_2&quot;</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">kbuilder</span><span class="java_separator">.</span><span class="java_plain">add</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_type">ResourceFactory</span><span class="java_separator">.</span><span class="java_plain">newUrlResource</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;file://IntegrationExampleTest.xls&quot;</span><span class="java_plain">&nbsp;</span><span class="java_separator">),</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">ResourceType</span><span class="java_separator">.</span><span class="java_plain">DTABLE</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dtconf&nbsp;</span><span class="java_separator">);</span>
</pre></div></div><br class="example-break"/><p>It is also possible to configure a <code class="code">KnowledgeBase</code>
    using configuration, via a xml change set, instead of programmatically.</p><div class="example"><a id="d0e3501"/><p class="title"><b>Example 4.28. Here is a simple change set</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">change-set</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">xmlns</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">'http://drools.org/drools-5.0/change-set'</span><span class="xml_plain"></span><br />
<span class="xml_attribute_name">xmlns:xs</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">'http://www.w3.org/2001/XMLSchema-instance'</span><span class="xml_plain"></span><br />
<span class="xml_attribute_name">xs:schemaLocation</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">'http://drools.org/drools-5.0/change-set&nbsp;change-set-5.0.xsd'</span><span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">add</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">resource</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">source</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">'classpath:org/domain/someRules.drl'</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">type</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">'DRL'</span><span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">resource</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">source</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">'classpath:org/domain/aFlow.drf'</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">type</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">'DRF'</span><span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">add</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">change-set</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre></div></div><br class="example-break"/><div class="example"><a id="d0e3506"/><p class="title"><b>Example 4.29. And it is added just like any other ResourceType</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"></span>
<!--  --><br/><span class="java_type">KnowledgeBuilder</span><span class="java_plain">&nbsp;kbuilder&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">KnowledgeBuilderFactory</span><span class="java_separator">.</span><span class="java_plain">newKnowledgeBuilder</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">kbuilder</span><span class="java_separator">.</span><span class="java_plain">add</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_type">ResourceFactory</span><span class="java_separator">.</span><span class="java_plain">newUrlResource</span><span class="java_separator">(</span><span class="java_plain">&nbsp;url&nbsp;</span><span class="java_separator">),</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">ResourceType</span><span class="java_separator">.</span><span class="java_type">ChangeSet</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
</pre></div></div><br class="example-break"/><p> The other big change for the <code class="code">KnowledgeAgent</code>,
    compared to the <code class="code">RuleAgent</code>, is that polling scanner is now a
    service. further to this there is an abstraction between the agent
    notification and the resource monitoring, to allow other mechanisms to be
    used other than polling.</p><div class="example"><a id="d0e3519"/><p class="title"><b>Example 4.30. These services currently are not started by default, to start
        them do the following</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"></span>
<!--  --><br/><span class="java_type">ResourceFactory</span><span class="java_separator">.</span><span class="java_plain">getResourceChangeNotifierService</span><span class="java_separator">().</span><span class="java_plain">start</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_type">ResourceFactory</span><span class="java_separator">.</span><span class="java_plain">getResourceChangeScannerService</span><span class="java_separator">().</span><span class="java_plain">start</span><span class="java_separator">();</span>
</pre></div></div><br class="example-break"/><p> There are two new interfaces added,
    <code class="code">ResourceChangeNotifier</code> and
    <code class="code">ResourceChangeMonitor</code>. <code class="code">KnowlegeAgents</code> subscribe
    for resource change notifications using the
    <code class="code">ResourceChangeNotifier</code> implementation. The
    <code class="code">ResourceChangeNotifier</code> is informed of resource changes by the
    added <code class="code">ResourceChangeMonitors</code>. We currently only provide one
    out of the box monitor, <code class="code">ResourceChangeScannerService</code>, which
    polls resources for changes. However the api is there for users to add
    their own monitors, and thus use a push based monitor such as JMS.</p><p><code class="code">
    ResourceFactory.getResourceChangeNotifierService().addResourceChangeMonitor(
    myJmsMonitor); </code></p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e3550"/>4.6.2. Drools Guvnor</h3></div></div></div><div class="itemizedlist"><ul><li><p>New look web tooling </p><div class="figure"><a id="d0e3557"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Release_Notes/guvnor1.png" align="middle" alt="New Look"/></div></div><p class="title"><b>Figure 4.99. New Look</b></p></div><p><br class="figure-break"/></p></li><li><p>Web based decision table editor </p><div class="figure"><a id="d0e3566"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Release_Notes/WebDT.png" align="middle" alt="Web based decision table editor"/></div></div><p class="title"><b>Figure 4.100. Web based decision table editor</b></p></div><p><br class="figure-break"/></p></li><li><p>Integrated scenario testing </p><div class="figure"><a id="d0e3575"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Release_Notes/ScenarioSuite.png" align="middle" alt="Running all scenarios"/></div></div><p class="title"><b>Figure 4.101. Running all scenarios</b></p></div><p><br class="figure-break"/> </p><div class="figure"><a id="d0e3582"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Release_Notes/Scenario.png" align="middle" alt="Running single scenario"/></div></div><p class="title"><b>Figure 4.102. Running single scenario</b></p></div><p><br class="figure-break"/></p></li><li><p>WebDAV file based interface to repository </p><div class="figure"><a id="d0e3591"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Release_Notes/WebDav.png" align="middle" alt="WebDAV"/></div></div><p class="title"><b>Figure 4.103. WebDAV</b></p></div><p><br class="figure-break"/></p></li><li><p>Declarative modelling of types (types that are not in pojos)
        </p><div class="figure"><a id="d0e3600"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Release_Notes/DeclaringModel.png" align="middle" alt="&gt;Declarative modelling"/></div></div><p class="title"><b>Figure 4.104. &gt;Declarative modelling</b></p></div><p><br class="figure-break"/> This works with the new "declare" statement - you can now
        declare types in drl itself. You can then populate these without using
        a pojo (if you like). These types are then available in the
        rulebase.</p></li><li><p>Fine grained security (lock down access to the app per package
        or per category). Users who only have category permissions have
        limited UI capability (ideal for business users)</p></li><li><p>Execution server - access rules via XML or JSON for
        execution</p></li><li><p>Category rules allows you to set 'parent rules' for a category.
        Any rules appearing in the given category will 'extend' the rule
        specified - ie inherit the conditions/LHS. The base rule for the
        category can be set on package configuration tab. RHS is not
        inherited, only the LHS</p></li><li><p>Scenario runner detects infinite loops</p></li><li><p>Scenario runner can show event trace that was recorded by audit
        logger</p></li><li><p>DSL sentences in guided editor can now be set to show enums as a
        dropdown, dates as a date picker, booleans as a checkbox and use
        regular expressions to validate the inputs (DSL Widgets in
        Guvnor)</p></li><li><p>Functions can be edited with text editor</p></li><li><p>It is possible to add objects to global collections.</p></li><li><p>Translations to English, Spanish, Chinese and Japanese</p></li></ul></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e3634"/>4.6.3. Drools Expert</h3></div></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e3637"/>4.6.3.1. Asymmetrical Rete algorithm implementation</h4></div></div></div><p>Shadow proxies are no longer needed. Shadow proxies protected the
      engine from information change on facts, which if occurred outside of
      the engine's control it could not be modified or retracted.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e3642"/>4.6.3.2. <code class="code">PackageBuilder</code> can now build multiple
      namespaces</h4></div></div></div><p>You no longer need to confine one <code class="code">PackageBuilder</code> to
      one package namespace. Just keeping adding your DRLs for any namespace
      and <code class="code">getPackages()</code> returns an array of Packages for each of
      the used namespaces.</p><div class="example"><a id="d0e3655"/><p class="title"><b>Example 4.31. Getting multiple packages</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">Package</span><!-- <br/> --><span class="java_separator">[]</span><!-- <br/> --><span class="java_plain">&nbsp;packages&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;pkgBuilder</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">getPackages</span><!-- <br/> --><span class="java_separator">();</span></pre></div></div><br class="example-break"/></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e3660"/>4.6.3.3. <code class="code">RuleBase</code> attachment to
      <code class="code">PackageBuilder</code></h4></div></div></div><p>It is now possible to attach a <code class="code">RuleBase</code> to a
      <code class="code">PackageBuilder</code>, this means that rules are built and added
      to the rulebase at the same time. <code class="code">PackageBuilder</code> uses the
      <code class="code">Package</code> instances of the actual <code class="code">RuleBase</code> as
      it's source, removing the need for additional <code class="code">Package</code>
      creation and merging that happens in the existing approach.</p><div class="example"><a id="d0e3687"/><p class="title"><b>Example 4.32. Attaching <code class="code">RuleBase</code> to
          <code class="code">PackageBuilder</code></b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">RuleBase</span><!-- <br/> --><span class="java_plain">&nbsp;ruleBase&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">RuleBaseFactory</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">newRuleBase</span><!-- <br/> --><span class="java_separator">();</span>
<!--  --><br/><span class="java_type">PackageBuilder</span><span class="java_plain">&nbsp;pkgBuilder&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">PackageBuilder</span><span class="java_separator">(</span><span class="java_plain">&nbsp;ruleBase</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_literal">null</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span></pre></div></div><br class="example-break"/></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e3697"/>4.6.3.4. Binary marshalling of stateful sessions</h4></div></div></div><p>Stateful sessions can now saved and resumed at a later date.
      Pre-loaded data sessions can now be created. Pluggable strategies can be
      used for user object persistence, i.e. hibernate or identity
      maps.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e3702"/>4.6.3.5. Type Declaration</h4></div></div></div><p>Drools now supports a new base construct called Type Declaration.
      This construct fulfils two purposes: the ability to declare fact
      metadata, and the ability to dynamically generate new fact types local
      to the rule engine. The Guvnor modelling tool uses this underneath. One
      example of the construct is:</p><div class="example"><a id="d0e3707"/><p class="title"><b>Example 4.33. Declaring <code class="code">StockTick</code></b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">declare StockTick
  @role( event )
  @timestamp( timestampAttr )

  companySymbol : String
  stockPrice : double
  timestampAttr : long
end</pre></div></div><br class="example-break"/></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e3714"/>4.6.3.6. Declaring Fact Metadata</h4></div></div></div><p>To declare and associate fact metadata, just use the @ symbol for
      each metadata ID you want to declare. Example:</p><div class="example"><a id="d0e3719"/><p class="title"><b>Example 4.34. Declaring metadata</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
declare StockTick
  @role( event )
end</pre></div></div><br class="example-break"/></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e3724"/>4.6.3.7. Triggering Bean Generation</h4></div></div></div><p>To activate the dynamic bean generation, just add fields and types
      to your type declaration:</p><div class="example"><a id="d0e3729"/><p class="title"><b>Example 4.35. Declaring <code class="code">Person</code></b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
declare Person
  name : String
  age : int
end</pre></div></div><br class="example-break"/></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e3736"/>4.6.3.8. DSL improvements</h4></div></div></div><p>A series of DSL improvements were implemented, including a
      completely new parser and the ability to declare matching masks for
      matching variables. For instance, one can constrain a phone number field
      to a 2-digit country code + 3-digit area code + 8-digit phone number,
      all connected by a "-" (dash), by declaring the DSL map like: The phone
      number is {number:\d{2}-\d{3}-\d{8}} Any valid java regexp may be used
      in the variable mask.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e3741"/>4.6.3.9. <code class="code">fireUntilHalt()</code></h4></div></div></div><p>Drools now supports "fireUntilHalt()" feature, that starts the
      engine in a reactive mode, where rules will be continually fired, until
      a halt() call is made. This is specially useful for CEP scenarios that
      require what is commonly known as "active queries".</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e3747"/>4.6.3.10. Rule Base partitioning and multi-thread propagation</h4></div></div></div><p>Drools ReteOO algorithm now supports an option to start the rule
      base in a multi-thread mode, where Drools ReteOO network is split into
      multiple partitions and rules are then evaluated concurrently by
      multiple threads. This is also a requirement for CEP where there usually
      are several independent rules running concurrently, with near realtime
      performance/throughput requirements and the evaluation of one can not
      interfere with the evaluation of others.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e3752"/>4.6.3.11. XSD Model Support</h4></div></div></div><p>Drools now supports XSD models. Remember though the XSD model is
      generated as pojos local to the Drools classloader. A helper class is
      there to assist in the creation of the model in the packagebuilder. Once
      the data model is generated you'll typically use the JAXB dataloader to
      insert data.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e3757"/>4.6.3.12. Data Loaders</h4></div></div></div><p>Drools now supports two data loaders, Smooks and JAXB. Smooks is
      an open source data transformation tool for ETL and JAXB a standard sun
      data mapping tool. Unit tests showing Smooks can be found here and JAXB
      here.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e3762"/>4.6.3.13. Type safe configuration</h4></div></div></div><p>In addition to the ability of configuring options in drools
      through configuration files, system properties and by setting properties
      through the API <code class="code">setProperty()</code> method, Drools-API now
      supports type safe configuration. We didn't want to add specific methods
      for each possible configuration methods for two reasons: it polutes the
      API and every time a new option is added to Drools, the API would have
      to change. This way, we followed a modular, class based configuration,
      where a new Option class is added to the API for each possible
      configuration, keeping the API stable, but flexible at the same time.
      So, in order to set configuration options now, you just need to use the
      enumerations or factories provided for each option. For instance, if you
      want to configure the knowledge base for assert behavior "equality" and
      to automatically remove identities from pattern matchings, you would
      just use the enums:</p><div class="example"><a id="d0e3770"/><p class="title"><b>Example 4.36. Configuring</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"></span>
<!--  --><br/><span class="java_type">KnowledgeBaseConfiguration</span><span class="java_plain">&nbsp;config&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">KnowledgeBaseFactory</span><span class="java_separator">.</span><span class="java_plain">newKnowledgeBaseConfiguration</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">config</span><span class="java_separator">.</span><span class="java_plain">setOption</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_type">AssertBehaviorOption</span><span class="java_separator">.</span><span class="java_plain">EQUALITY&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">config</span><span class="java_separator">.</span><span class="java_plain">setOption</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_type">RemoveIdentitiesOption</span><span class="java_separator">.</span><span class="java_plain">YES&nbsp;</span><span class="java_separator">);</span></pre></div></div><br class="example-break"/><p> For options that don't have a predefined constant or can
      assume multiple values, a factory method is provided. For instance, to
      configure the alpha threshold to 5, just use the "get" factory method:</p><div class="example"><a id="d0e3777"/><p class="title"><b>Example 4.37. Configuring alpha threshold</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"></span>
<!--  --><br/><span class="java_plain">config</span><span class="java_separator">.</span><span class="java_plain">setOption</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_type">AlphaThresholdOption</span><span class="java_separator">.</span><span class="java_plain">get</span><span class="java_separator">(</span><span class="java_literal">5</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span></pre></div></div><br class="example-break"/><p>As you can see, the same <code class="code">setOption()</code> method is
      used for the different possible configurations, but they are still type
      safe.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e3787"/>4.6.3.14. New accumulate functions: collectSet and collectList</h4></div></div></div><p>There are times when it is necessary to collect sets or lists of
      values that are derived from the facts attributes, but are not facts
      themselves. In such cases, it was not possible to use the collect CE.
      So, Drools now has two accumulate functions for such cases: collectSet
      for collecting sets of values (i.e., with no duplicate values) and
      collectList for collecting lists of values (i.e., allowing duplicate
      values):</p><div class="example"><a id="d0e3792"/><p class="title"><b>Example 4.38. New accumulate functions</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
// collect the set of unique names in the working memory
$names : Set() from accumulate( Person( $n : name, $s : surname ),
                        collectSet( $n + " " + $s ) )

// collect the list of alarm codes from the alarms in the working memory
$codes : List() from accumulate( Alarm( $c : code, $s : severity ),
                         collectList( $c + $s ) )</pre></div></div><br class="example-break"/></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e3797"/>4.6.3.15. New metadata for type declarations:
      @propertyChangeSupport</h4></div></div></div><p>Facts that implement support for property changes as defined in
      the Javabean(tm) spec, now can be annotated so that the engine register
      itself to listen for changes on fact properties. The boolean parameter
      that was used in the insert() method in the Drools 4 API is deprecated
      and does not exist in the drools-api module.</p><div class="example"><a id="d0e3802"/><p class="title"><b>Example 4.39. @propertyChangeSupport</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
declare Person
  @propertyChangeSupport
end</pre></div></div><br class="example-break"/></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e3807"/>4.6.3.16. Batch Executor</h4></div></div></div><p>Batch Executor allows for the scripting of a Knowledge session
      using Commands. Both the <code class="code">StatelessKnowledgeSession</code> and
      <code class="code">StatefulKnowledgeSession</code> implement this interface. Commands
      are created using the <code class="code">CommandFactory</code> and executed using the
      "execute" method, such as the following insert Command:</p><div class="example"><a id="d0e3821"/><p class="title"><b>Example 4.40. Using <code class="code">CommandFactory</code></b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"></span>
<!--  --><br/><span class="java_plain">ksession</span><span class="java_separator">.</span><span class="java_plain">execute</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_type">CommandFactory</span><span class="java_separator">.</span><span class="java_plain">newInsert</span><span class="java_separator">(</span><span class="java_plain">&nbsp;person&nbsp;</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span><span class="java_plain">&nbsp;</span></pre></div></div><br class="example-break"/><p>Typically though you will want to execute a batch of
      commands, this can be achieved via the composite Command
      <code class="code">BatchExecution</code>. <code class="code">BatchExecutionResults</code> is now
      used to handle the results, some commands can specify "out" identifiers
      which it used to add the result to the
      <code class="code">BatchExecutionResult</code>. Handily querries can now be executed
      and results added to the <code class="code">BatchExecutionResult</code>. Further to
      this results are scoped to this execute call and return via the
      <code class="code">BatchExecutionResults</code>:</p><div class="example"><a id="d0e3845"/><p class="title"><b>Example 4.41. Using <code class="code">BatchExecutionResult</code></b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"></span>
<!--  --><br/><span class="java_type">List</span><span class="java_operator">&lt;</span><span class="java_type">Command</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;cmds&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">ArrayList</span><span class="java_operator">&lt;</span><span class="java_type">Command</span><span class="java_operator">&gt;</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">cmds</span><span class="java_separator">.</span><span class="java_plain">add</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_type">CommandFactory</span><span class="java_separator">.</span><span class="java_plain">newSetGlobal</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;list1&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">ArrayList</span><span class="java_separator">(),</span><span class="java_plain">&nbsp;</span><span class="java_literal">true</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">cmds</span><span class="java_separator">.</span><span class="java_plain">add</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_type">CommandFactory</span><span class="java_separator">.</span><span class="java_plain">newInsert</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">Person</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;jon&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_literal">102</span><span class="java_plain">&nbsp;</span><span class="java_separator">),</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;person&quot;</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">cmds</span><span class="java_separator">.</span><span class="java_plain">add</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_type">CommandFactory</span><span class="java_separator">.</span><span class="java_plain">newQuery</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;Get&nbsp;People&quot;</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;getPeople&quot;</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_type">BatchExecutionResults</span><span class="java_plain">&nbsp;results&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;ksession</span><span class="java_separator">.</span><span class="java_plain">execute</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_type">CommandFactory</span><span class="java_separator">.</span><span class="java_plain">newBatchExecution</span><span class="java_separator">(</span><span class="java_plain">&nbsp;cmds&nbsp;</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">results</span><span class="java_separator">.</span><span class="java_plain">getValue</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;list1&quot;</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span><span class="java_plain">&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;returns&nbsp;the&nbsp;</span><span class="java_type">ArrayList</span>
<!--  --><br/><span class="java_plain">results</span><span class="java_separator">.</span><span class="java_plain">getValue</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;person&quot;</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span><span class="java_plain">&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;returns&nbsp;the&nbsp;inserted&nbsp;fact&nbsp;</span><span class="java_type">Person</span>
<!--  --><br/><span class="java_plain">results</span><span class="java_separator">.</span><span class="java_plain">getValue</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;Get&nbsp;People&quot;</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span><span class="java_operator">//</span><span class="java_plain">&nbsp;returns&nbsp;the&nbsp;query&nbsp;as&nbsp;a&nbsp;</span><span class="java_type">QueryResults</span><span class="java_plain">&nbsp;instance</span><span class="java_separator">.</span>
<!--  --><br/><span class="java_plain">end</span></pre></div></div><br class="example-break"/><p>The <code class="code">CommandFactory</code> details the supported
      commands, all of which can marshalled using XStream and the
      <code class="code">BatchExecutionHelper</code>. This can be combined with the
      pipeline to automate the scripting of a session.</p><div class="example"><a id="d0e3860"/><p class="title"><b>Example 4.42. Using <code class="code">PipelineFactory</code></b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"></span>
<!--  --><br/><span class="java_type">Action</span><span class="java_plain">&nbsp;executeResultHandler&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">PipelineFactory</span><span class="java_separator">.</span><span class="java_plain">newExecuteResultHandler</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_type">Action</span><span class="java_plain">&nbsp;assignResult&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">PipelineFactory</span><span class="java_separator">.</span><span class="java_plain">newAssignObjectAsResult</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">assignResult</span><span class="java_separator">.</span><span class="java_plain">setReceiver</span><span class="java_separator">(</span><span class="java_plain">&nbsp;executeResultHandler&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_type">Transformer</span><span class="java_plain">&nbsp;outTransformer&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">PipelineFactory</span><span class="java_separator">.</span><span class="java_plain">newXStreamToXmlTransformer</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_type">BatchExecutionHelper</span><span class="java_separator">.</span><span class="java_plain">newXStreamMarshaller</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">outTransformer</span><span class="java_separator">.</span><span class="java_plain">setReceiver</span><span class="java_separator">(</span><span class="java_plain">&nbsp;assignResult&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_type">KnowledgeRuntimeCommand</span><span class="java_plain">&nbsp;batchExecution&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">PipelineFactory</span><span class="java_separator">.</span><span class="java_plain">newBatchExecutor</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">batchExecution</span><span class="java_separator">.</span><span class="java_plain">setReceiver</span><span class="java_separator">(</span><span class="java_plain">&nbsp;outTransformer&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_type">Transformer</span><span class="java_plain">&nbsp;inTransformer&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">PipelineFactory</span><span class="java_separator">.</span><span class="java_plain">newXStreamFromXmlTransformer</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_type">BatchExecutionHelper</span><span class="java_separator">.</span><span class="java_plain">newXStreamMarshaller</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">inTransformer</span><span class="java_separator">.</span><span class="java_plain">setReceiver</span><span class="java_separator">(</span><span class="java_plain">&nbsp;batchExecution&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_type">Pipeline</span><span class="java_plain">&nbsp;pipeline&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">PipelineFactory</span><span class="java_separator">.</span><span class="java_plain">newStatelessKnowledgeSessionPipeline</span><span class="java_separator">(</span><span class="java_plain">&nbsp;ksession&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">pipeline</span><span class="java_separator">.</span><span class="java_plain">setReceiver</span><span class="java_separator">(</span><span class="java_plain">&nbsp;inTransformer&nbsp;</span><span class="java_separator">);</span><span class="java_plain">&nbsp;</span></pre></div></div><br class="example-break"/><p>Using the above for a rulset that updates the price of a
      Cheese fact, given the following xml to insert a Cheese instance using
      an out-identifier:</p><div class="example"><a id="d0e3869"/><p class="title"><b>Example 4.43. Updating Cheese fact</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">batch-execution</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">insert</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">out-identifier</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">'outStilton'</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">org.drools.Cheese</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">type</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">stilton</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">type</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">price</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">25</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">price</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">oldPrice</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">0</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">oldPrice</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">org.drools.Cheese</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">insert</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">batch-execution</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre></div></div><br class="example-break"/><p>We then get the following
      <code class="code">BatchExecutionResults</code>:</p><div class="example"><a id="d0e3879"/><p class="title"><b>Example 4.44. Updating Cheese fact</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">batch-execution-results</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">result</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">identifier</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">'outStilton'</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">org.drools.Cheese</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">type</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">stilton</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">type</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">oldPrice</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">0</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">oldPrice</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">price</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">30</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">price</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">org.drools.Cheese</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">result</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">batch-execution-results</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre></div></div><br class="example-break"/></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e3884"/>4.6.3.17. Marshalling</h4></div></div></div><p>The <code class="code">MarshallerFactory</code> is used to marshal and
      unmarshal <code class="code">StatefulKnowledgeSessions</code>. At the simplest it can
      be used as follows:</p><div class="example"><a id="d0e3895"/><p class="title"><b>Example 4.45. Using <code class="code">MarshallerFactory</code></b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"></span>
<!--  --><br/><span class="java_operator">//</span><span class="java_plain">&nbsp;ksession&nbsp;is&nbsp;the&nbsp;</span><span class="java_type">StatefulKnowledgeSession</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_plain">&nbsp;kbase&nbsp;is&nbsp;the&nbsp;</span><span class="java_type">KnowledgeBase</span>
<!--  --><br/><span class="java_type">ByteArrayOutputStream</span><span class="java_plain">&nbsp;baos&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">ByteArrayOutputStream</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_type">Marshaller</span><span class="java_plain">&nbsp;marshaller&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">MarshallerFactory</span><span class="java_separator">.</span><span class="java_plain">newMarshaller</span><span class="java_separator">(</span><span class="java_plain">&nbsp;kbase&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">marshaller</span><span class="java_separator">.</span><span class="java_plain">marshall</span><span class="java_separator">(</span><span class="java_plain">&nbsp;baos</span><span class="java_separator">,</span><span class="java_plain">&nbsp;ksession&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">baos</span><span class="java_separator">.</span><span class="java_plain">close</span><span class="java_separator">();</span>
</pre></div></div><br class="example-break"/><p>However with marshalling you need more flexibility when
      dealing with referenced user data. To achieve this we have the
      <code class="code">ObjectMarshallingStrategy</code> interface. Two implementations
      are provided, but the user can implement their own. The two supplied are
      <code class="code">IdentityMarshallingStrategy</code> and
      <code class="code">SerializeMarshallingStrategy</code>.
      <code class="code">SerializeMarshallingStrategy</code> is the default, as used in the
      example above and it just calls the <code class="code">Serializable</code> or
      <code class="code">Externalizable</code> methods on a user instance.
      <code class="code">IdentityMarshallingStrategy</code> instead creates an int id for
      each user object and stores them in a <code class="code">Map</code> the id is written
      to the stream. When unmarshalling it simply looks to the
      <code class="code">IdentityMarshallingStrategy</code> map to retrieve the instance.
      This means that if you use the <code class="code">IdentityMarshallingStrategy</code>
      it's stateful for the life of the Marshaller instance and will create
      ids and keep references to all objects that it attempts to marshal.</p><div class="example"><a id="d0e3934"/><p class="title"><b>Example 4.46. Code to use a
          <code class="code">IdentityMarshallingStrategy</code></b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"></span>
<!--  --><br/><span class="java_type">ByteArrayOutputStream</span><span class="java_plain">&nbsp;baos&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">ByteArrayOutputStream</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_type">Marshaller</span><span class="java_plain">&nbsp;marshaller&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">MarshallerFactory</span><span class="java_separator">.</span><span class="java_plain">newMarshaller</span><span class="java_separator">(</span><span class="java_plain">&nbsp;kbase</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">ObjectMarshallingStrategy</span><span class="java_separator">[]</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_type">MarshallerFactory</span><span class="java_separator">.</span><span class="java_plain">newIdentityMarshallingStrategy</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">marshaller</span><span class="java_separator">.</span><span class="java_plain">marshall</span><span class="java_separator">(</span><span class="java_plain">&nbsp;baos</span><span class="java_separator">,</span><span class="java_plain">&nbsp;ksession&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">baos</span><span class="java_separator">.</span><span class="java_plain">close</span><span class="java_separator">();</span><span class="java_plain">&nbsp;</span>
</pre></div></div><br class="example-break"/><p>For added flexability we can't assume that a single
      strategy is suitable for this we have added the
      <code class="code">ObjectMarshallingStrategyAcceptor</code> interface that each
      <code class="code">ObjectMarshallingStrategy</code> has. The Marshaller has a chain
      of strategies and when it attempts to read or write a user object it
      iterates the strategies asking if they accept responsability for
      marshalling the user object. One one implementation is provided the
      <code class="code">ClassFilterAcceptor</code>. This allows strings and wild cards to
      be used to match class names. The default is "*.*", so in the above the
      <code class="code">IdentityMarshallingStrategy</code> is used which has a default
      "*.*" acceptor. But lets say we want to serialise all classes except for
      one given package, where we will use identity lookup, we could do the
      following:</p><div class="example"><a id="d0e3955"/><p class="title"><b>Example 4.47. Using identity lookup</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"></span>
<!--  --><br/><span class="java_type">ByteArrayOutputStream</span><span class="java_plain">&nbsp;baos&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">ByteArrayOutputStream</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_type">ObjectMarshallingStrategyAcceptor</span><span class="java_plain">&nbsp;identityAceceptor&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">MarshallerFactory</span><span class="java_separator">.</span><span class="java_plain">newClassFilterAcceptor</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_separator">[]</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;org.domain.pkg1.*&quot;</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_type">ObjectMarshallingStrategy</span><span class="java_plain">&nbsp;identityStratetgy&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">MarshallerFactory</span><span class="java_separator">.</span><span class="java_plain">newIdentityMarshallingStrategy</span><span class="java_separator">(</span><span class="java_plain">&nbsp;identityAceceptor&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_type">Marshaller</span><span class="java_plain">&nbsp;marshaller&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">MarshallerFactory</span><span class="java_separator">.</span><span class="java_plain">newMarshaller</span><span class="java_separator">(</span><span class="java_plain">&nbsp;kbase</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">ObjectMarshallingStrategy</span><span class="java_separator">[]</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;identityStratetgy</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">MarshallerFactory</span><span class="java_separator">.</span><span class="java_plain">newSerializeMarshallingStrategy</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">marshaller</span><span class="java_separator">.</span><span class="java_plain">marshall</span><span class="java_separator">(</span><span class="java_plain">&nbsp;baos</span><span class="java_separator">,</span><span class="java_plain">&nbsp;ksession&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">baos</span><span class="java_separator">.</span><span class="java_plain">close</span><span class="java_separator">();</span>
</pre></div></div><br class="example-break"/></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e3960"/>4.6.3.18. Knowledge Agent</h4></div></div></div><p>The <code class="code">KnowlegeAgent</code> is created by the
      <code class="code">KnowlegeAgentFactory</code>. The <code class="code">KnowlegeAgent</code>
      provides automatic loading, caching and re-loading, of resources and is
      configured from a properties files. The <code class="code">KnowledgeAgent</code> can
      update or rebuild this <code class="code">KnowlegeBase</code> as the resources it
      uses are changed. The strategy for this is determined by the
      configuration given to the factory, but it is typically pull based using
      regular polling. We hope to add push based updates and rebuilds in
      future versions. The Following example constructs an agent that will
      build a new <code class="code">KnowledgeBase</code> from the files specified in the
      path String. It will poll those files every 30 seconds to see if they
      are updated. If new files are found it will construct a new
      KnowledgeBase, instead of updating the existing one, due to the
      "newInstance" set to "true" (however currently only the value of "true"
      is supported and is hard coded into the engine):</p><div class="example"><a id="d0e3983"/><p class="title"><b>Example 4.48. Constructing an agent</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"></span>
<!--  --><br/><span class="java_operator">//</span><span class="java_plain">&nbsp;</span><span class="java_type">Set</span><span class="java_plain">&nbsp;the&nbsp;interval&nbsp;on&nbsp;the&nbsp;</span><span class="java_type">ResourceChangeScannerService</span><span class="java_plain">&nbsp;</span><span class="java_keyword">if</span><span class="java_plain">&nbsp;you&nbsp;are&nbsp;to&nbsp;use&nbsp;it&nbsp;and&nbsp;</span><span class="java_keyword">default</span><span class="java_plain">&nbsp;of&nbsp;</span><span class="java_literal">60</span><span class="java_plain">s&nbsp;is&nbsp;not&nbsp;desirable</span><span class="java_separator">.</span>
<!--  --><br/><span class="java_type">ResourceChangeScannerConfiguration</span><span class="java_plain">&nbsp;sconf&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">ResourceFactory</span><span class="java_separator">.</span><span class="java_plain">getResourceChangeScannerService</span><span class="java_separator">().</span><span class="java_plain">newResourceChangeScannerConfiguration</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">sconf</span><span class="java_separator">.</span><span class="java_plain">setProperty</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;drools.resource.scanner.interval&quot;</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_literal">&quot;30&quot;</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span><span class="java_plain">&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;set&nbsp;the&nbsp;disk&nbsp;scanning&nbsp;interval&nbsp;to&nbsp;</span><span class="java_literal">30</span><span class="java_plain">s</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_keyword">default</span><span class="java_plain">&nbsp;is&nbsp;</span><span class="java_literal">60</span><span class="java_plain">s</span>
<!--  --><br/><span class="java_type">ResourceFactory</span><span class="java_separator">.</span><span class="java_plain">getResourceChangeScannerService</span><span class="java_separator">().</span><span class="java_plain">configure</span><span class="java_separator">(</span><span class="java_plain">&nbsp;sconf&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_type">KnowledgeBase</span><span class="java_plain">&nbsp;kbase&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">KnowledgeBaseFactory</span><span class="java_separator">.</span><span class="java_plain">newKnowledgeBase</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_type">KnowledgeAgentConfiguration</span><span class="java_plain">&nbsp;aconf&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">KnowledgeAgentFactory</span><span class="java_separator">.</span><span class="java_plain">newKnowledgeAgentConfiguration</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">aconf</span><span class="java_separator">.</span><span class="java_plain">setProperty</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;drools.agent.scanDirectories&quot;</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_literal">&quot;true&quot;</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span><span class="java_plain">&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;we&nbsp;want&nbsp;to&nbsp;scan&nbsp;directories</span><span class="java_separator">,</span><span class="java_plain">&nbsp;not&nbsp;just&nbsp;files</span><span class="java_separator">,</span><span class="java_plain">&nbsp;turning&nbsp;</span><span class="java_keyword">this</span><span class="java_plain">&nbsp;on&nbsp;turns&nbsp;on&nbsp;file&nbsp;scanning</span>
<!--  --><br/><span class="java_plain">aconf</span><span class="java_separator">.</span><span class="java_plain">setProperty</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;drools.agent.newInstance&quot;</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_literal">&quot;true&quot;</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span><span class="java_plain">&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;resource&nbsp;changes&nbsp;results&nbsp;in&nbsp;a&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;instance&nbsp;of&nbsp;the&nbsp;</span><span class="java_type">KnowledgeBase</span><span class="java_plain">&nbsp;being&nbsp;built</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;</span><span class="java_keyword">this</span><span class="java_plain">&nbsp;cannot&nbsp;currently&nbsp;be&nbsp;set&nbsp;to&nbsp;</span><span class="java_literal">false</span><span class="java_plain">&nbsp;</span><span class="java_keyword">for</span><span class="java_plain">&nbsp;incremental&nbsp;building</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span>
<!--  --><br/><span class="java_type">KnowledgeAgent</span><span class="java_plain">&nbsp;kagent&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">KnowledgeAgentFactory</span><span class="java_separator">.</span><span class="java_plain">newKnowledgeAgent</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;test&nbsp;agent&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;the&nbsp;name&nbsp;of&nbsp;the&nbsp;agent</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;kbase</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;the&nbsp;</span><span class="java_type">KnowledgeBase</span><span class="java_plain">&nbsp;to&nbsp;use</span><span class="java_separator">,</span><span class="java_plain">&nbsp;the&nbsp;</span><span class="java_type">Agent</span><span class="java_plain">&nbsp;will&nbsp;also&nbsp;monitor&nbsp;any&nbsp;exist&nbsp;knowledge&nbsp;definitions</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;aconf&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">kagent</span><span class="java_separator">.</span><span class="java_plain">applyChangeSet</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_type">ResourceFactory</span><span class="java_separator">.</span><span class="java_plain">newUrlResource</span><span class="java_separator">(</span><span class="java_plain">&nbsp;url&nbsp;</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span><span class="java_plain">&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;resource&nbsp;to&nbsp;the&nbsp;change</span><span class="java_operator">-</span><span class="java_plain">set&nbsp;xml&nbsp;</span><span class="java_keyword">for</span><span class="java_plain">&nbsp;the&nbsp;resources&nbsp;to&nbsp;add</span>
</pre></div></div><br class="example-break"/><p><code class="code">KnowledgeAgents</code> can take a empty
      <code class="code">KnowledgeBase</code> or a populated one. If a populated
      <code class="code">KnowledgeBase</code> is provided, the <code class="code">KnowledgeAgent</code>
      will iterate <code class="code">KnowledgeBase</code> and subscribe to the
      <code class="code">Resource</code> that it finds. While it is possible for the
      <code class="code">KnowledgeBuilder</code> to build all resources found in a
      directory, that information is lost by the KnowledgeBuilder so those
      directories will not be continuously scanned. Only directories specified
      as part of the <code class="code">applyChangeSet(Resource)</code> method are
      monitored.</p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e4013"/>4.6.4. Drools Flow</h3></div></div></div><p>Drools 4.0 had simple "RuleFlow" which was for orchestrating rules.
    Drools 5.0 introduces a powerful (extensible) workflow engine. It allows
    users to specify their business logic using both rules and processes
    (where powerful interaction between processes and rules is possible) and
    offers a unified enviroment.</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e4018"/>4.6.4.1. Process Instance view at a specific breakpoint</h4></div></div></div><div class="figure"><a id="d0e4022"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Release_Notes/process-instances.png" align="middle" alt="Rule Flow properties"/></div></div><p class="title"><b>Figure 4.105. Rule Flow properties</b></p></div><p><br class="figure-break"/> </p><div class="figure"><a id="d0e4029"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Release_Notes/example-debug-1.png" align="middle" alt="Current active nodes in a workflow in a specific breakpoint"/></div></div><p class="title"><b>Figure 4.106. Current active nodes in a workflow in a specific
          breakpoint</b></p></div><p><br class="figure-break"/></p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e4035"/>4.6.4.2. New Nodes</h4></div></div></div><p>Timers:</p><p>A timer node can be added which causes the execution of the node
      to wait for a specific period. Currently just uses JDK defaults of
      initial delay and repeat delay, more complex timers will be available in
      further milestones.</p><p>Human Task:</p><p>Processes can include tasks that need to be executed by human
      actors. Human tasks include parameters like taskname, priority,
      description, actorId, etc. The process engine can easily be integrated
      with existing human task component (like for example a WS-HumanTask
      implementation) using our pluggable work items (see below). Swimlanes
      and assignment rules are also supported.</p><p>The palette in the screenshot shows the two new components, and
      the workflow itself shows the human task in use. It also shows two "work
      items" which is explained in the next section: </p><div class="figure"><a id="d0e4048"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Release_Notes/humantask.png" align="middle" alt="Human task"/></div></div><p class="title"><b>Figure 4.107. Human task</b></p></div><p><br class="figure-break"/></p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e4054"/>4.6.4.3. Domain Specific Work Items</h4></div></div></div><p>Domain Specific Work Items are pluggable nodes that users create
      to facilitate custom task execution. They provide an api to specify a
      new icon in the palette and gui editor for the tasks properties, if no
      editor gui is supplied then it defaults to a text based key value pair
      form. The api then allows execution behaviour for these work items to be
      specified. By default the Email and Log work items are provided. The
      Drools flow Manual has been updated on how to implement these.</p><p>The below image shows three different work items in use in a
      workflow, "Blood Pressure", "BP Medication", "Notify GP": </p><div class="figure"><a id="d0e4061"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Release_Notes/CDSSExample.png" align="middle" alt="Work items"/></div></div><p class="title"><b>Figure 4.108. Work items</b></p></div><p><br class="figure-break"/> This one ows a new "Notification" work item: </p><div class="figure"><a id="d0e4068"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Release_Notes/NotificationPalette.png" align="middle" alt="Notification"/></div></div><p class="title"><b>Figure 4.109. Notification</b></p></div><p><br class="figure-break"/></p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e4074"/>4.6.4.4. Extensible Process Definition Language (ePDL)</h4></div></div></div><p>Drools 4.0 used Xstream to store it's content, which was not
      easily human writeable. Drools 5.0 introduced the ePDL which is a XML
      specific to our process language, it also allows for domain specific
      extensions which has been talked about in detail in this blog posting
      "Drools Extensible Process Definition Language (ePDL) and the Semantic
      Module Framework (SMF)". An example of the XML language, with a DSL
      extension in red, is shown below.</p><div class="example"><a id="d0e4079"/><p class="title"><b>Example 4.49. Example of the XML language</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">process</span><span class="xml_plain">&nbsp;&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;process&nbsp;name&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">id</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;process&nbsp;name&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">package-name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;org.domain&quot;</span><span class="xml_plain"></span><br />
<span class="xml_attribute_name">xmlns</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;http://drools.org/drools-4.0/process&quot;</span><span class="xml_plain"></span><br />
<span class="xml_attribute_name">xmlns:mydsl</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;http://domain/org/mydsl&quot;</span><span class="xml_plain"></span><br />
<span class="xml_attribute_name">xmlns:xs</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><span class="xml_plain"></span><br />
<span class="xml_attribute_name">xs:schemaLocation</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;http://drools.org/drools-4.0/process&nbsp;drools-processes-4.0.xsd&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">nodes</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">start</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">id</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;0&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">action</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">id</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;1&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">dialect</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;java&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;list.add(&nbsp;&quot;action&nbsp;node&nbsp;was&nbsp;here&quot;&nbsp;);&nbsp;</span><br />
<span class="xml_plain">&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">action</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">mydsl:logger</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">id</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;2&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">type</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;warn&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;This&nbsp;is&nbsp;my&nbsp;message&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">mydsl:logger</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">end</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">id</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;3&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">nodes</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">connections</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">connection</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">from</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;0&nbsp;to=&quot;</span><span class="xml_plain">1</span><span class="xml_attribute_value">&quot;&nbsp;/</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&lt;</span><span class="xml_attribute_name">connection</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">from</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;1&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">to</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;2&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">connection</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">from</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;2&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">to</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;3&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">connections</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">process</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre></div></div><br class="example-break"/></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e4084"/>4.6.4.5. Pluggable Nodes</h4></div></div></div><p>The underlying nodes for the framework are completely pluggable
      making it simple to extend and to implement other execution models. We
      already have a partial implementation for OSWorkflow and are working
      with Deigo to complete this to provide a migration path for OSWorkflow
      users. Other enhancements include exception scopes, the ability to
      include on-entry and on-exit actions on various node types, integration
      with our binary persistence mechanism to persist the state of long
      running processes, etc. Check out the Drools Flow documentation to learn
      more.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e4089"/>4.6.4.6. Human tasks</h4></div></div></div><p>Human task management is very important in the context of
      processes. While we allow users to plug in any task component they
      prefer, we have developed a human task management component that
      supports the entire life cycle of human tasks based on the WS-HumanTask
      specification.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e4094"/>4.6.4.7. New functions to the Drools Flow language</h4></div></div></div><div class="itemizedlist"><ul><li><p>Event nodes that allow a process to respond to external
            events</p></li><li><p>Exception handlers and exception handler scopes to handle
            exceptions that could be thrown</p></li><li><p>A ForEach node allows instantiating a section of your flow
            multiple times, for each element in a collection</p></li><li><p>Data type support has been extended</p></li><li><p>Timers are integrated with common node types</p></li></ul></div><p> As a result, new node types and properties have been
      added to the Drools Flow editor in Eclipse. You can also find examples
      of these new features in the integration tests (e.g.
      ProcessExceptionHandlerTest, ProcessTimerTest, etc.).</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e4115"/>4.6.4.8. Work items</h4></div></div></div><p>Our pluggable work item approach allows you to plug in
      domain-specific work in your process in a declarative manner. We plan to
      build a library of common work items and already provide an
      implementation for sending emails, finding files, archiving, executing
      system commands, logging and human tasks.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e4120"/>4.6.4.9. JPA</h4></div></div></div><p>Improved support for persistence (JPA) and transactions (JTA).</p><div class="example"><a id="d0e4125"/><p class="title"><b>Example 4.50. An example on how to use persistence and transactions in
          combination with processes</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"></span>
<!--  --><br/><span class="java_operator">//</span><span class="java_plain">&nbsp;create&nbsp;a&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;JPA</span><span class="java_operator">-</span><span class="java_plain">based&nbsp;session&nbsp;and&nbsp;specify&nbsp;the&nbsp;JPA&nbsp;entity&nbsp;manager&nbsp;factory</span>
<!--  --><br/><span class="java_type">Environment</span><span class="java_plain">&nbsp;env&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">KnowledgeBaseFactory</span><span class="java_separator">.</span><span class="java_plain">newEnvironment</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">env</span><span class="java_separator">.</span><span class="java_plain">set</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_type">EnvironmentName</span><span class="java_separator">.</span><span class="java_plain">ENTITY_MANAGER_FACTORY</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">Persistence</span><span class="java_separator">.</span><span class="java_plain">createEntityManagerFactory</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;emf-name&quot;</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">env</span><span class="java_separator">.</span><span class="java_plain">set</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_type">EnvironmentName</span><span class="java_separator">.</span><span class="java_plain">TRANSACTION_MANAGER</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">TransactionManagerServices</span><span class="java_separator">.</span><span class="java_plain">getTransactionManager</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
<!--  --><br/><span class="java_type">StatefulKnowledgeSession</span><span class="java_plain">&nbsp;ksession&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">JPAKnowledgeService</span><span class="java_separator">.</span><span class="java_plain">newStatefulKnowledgeSession</span><span class="java_separator">(</span><span class="java_plain">&nbsp;kbase</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_literal">null</span><span class="java_separator">,</span><span class="java_plain">&nbsp;env&nbsp;</span><span class="java_separator">);</span><span class="java_plain">&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;</span><span class="java_type">KnowledgeSessionConfiguration</span><span class="java_plain">&nbsp;may&nbsp;be&nbsp;</span><span class="java_literal">null</span><span class="java_separator">,</span><span class="java_plain">&nbsp;and&nbsp;a&nbsp;</span><span class="java_keyword">default</span><span class="java_plain">&nbsp;will&nbsp;be&nbsp;used</span>
<!--  --><br/><span class="java_type">int</span><span class="java_plain">&nbsp;sessionId&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;ksession</span><span class="java_separator">.</span><span class="java_plain">getId</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_plain">&nbsp;</span><span class="java_keyword">if</span><span class="java_plain">&nbsp;no&nbsp;transaction&nbsp;boundary&nbsp;is&nbsp;specified</span><span class="java_separator">,</span><span class="java_plain">&nbsp;the&nbsp;method&nbsp;invocation&nbsp;is&nbsp;executed&nbsp;in&nbsp;a&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;transaction&nbsp;automatically</span>
<!--  --><br/><span class="java_type">ProcessInstance</span><span class="java_plain">&nbsp;processInstance&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;ksession</span><span class="java_separator">.</span><span class="java_plain">startProcess</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;org.drools.test.TestProcess&quot;</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_plain">&nbsp;the&nbsp;users&nbsp;can&nbsp;also&nbsp;specify&nbsp;the&nbsp;transaction&nbsp;boundary&nbsp;themselves</span>
<!--  --><br/><span class="java_type">UserTransaction</span><span class="java_plain">&nbsp;ut&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_type">UserTransaction</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">InitialContext</span><span class="java_separator">().</span><span class="java_plain">lookup</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;java:comp/UserTransaction&quot;</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">ut</span><span class="java_separator">.</span><span class="java_plain">begin</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">ksession</span><span class="java_separator">.</span><span class="java_plain">insert</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">Person</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;John&nbsp;Doe&quot;</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">ksession</span><span class="java_separator">.</span><span class="java_plain">startProcess</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;org.drools.test.TestProcess&quot;</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">ksession</span><span class="java_separator">.</span><span class="java_plain">fireAllRules</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">ut</span><span class="java_separator">.</span><span class="java_plain">commit</span><span class="java_separator">();</span></pre></div></div><br class="example-break"/></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e4130"/>4.6.4.10. Variable Injection</h4></div></div></div><p>Support direct access to process variables in both MVEL and Java
      in code constraints and actions, so if you have a variable called
      "person" in your process, you can now describe constraints like:</p><div class="example"><a id="d0e4135"/><p class="title"><b>Example 4.51. Variable injection example</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
    * [Java code constraint] return person.getAge() &gt; 20;
    * [MVEL action] System.out.println(person.name);</pre></div></div><br class="example-break"/></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e4140"/>4.6.4.11. Miscellaneous Enhancements</h4></div></div></div><div class="itemizedlist"><ul><li><p>Process instances can now listen for external events by
            marking the event node property "external" as true. External
            events are signaled to the engine using
            <code class="code">session.signalEvent(type, eventData)</code> More information
            on how to use events inside your processes can be found in the
            Drools Flow documentation here:
            https://hudson.jboss.org/hudson/job/drools/lastSuccessfulBuild/artifact/trunk/target/docs/drools-flow/html/ch03.html#d0e917</p></li><li><p>Process instances are now safe for multi-threading (as
            multiple thread are blocked from working on the same process
            instance)</p></li><li><p>Process persistence / transaction support has been further
            improved. Check out the drools-process/drools-process-enterprise
            project for more information.</p></li><li><p>The human task component has been extended to support all
            kinds of data for input / output / exceptions during task
            execution.</p><div class="example"><a id="d0e4159"/><p class="title"><b>Example 4.52. As a result, the life cycle methods of the task client
                have been extended to allow content data</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"></span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;taskClient</span><span class="java_separator">.</span><span class="java_plain">addTask</span><span class="java_separator">(</span><span class="java_plain">task</span><span class="java_separator">,</span><span class="java_plain">&nbsp;contentData</span><span class="java_separator">,</span><span class="java_plain">&nbsp;responseHandler</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;taskClient</span><span class="java_separator">.</span><span class="java_plain">complete</span><span class="java_separator">(</span><span class="java_plain">taskId</span><span class="java_separator">,</span><span class="java_plain">&nbsp;userId</span><span class="java_separator">,</span><span class="java_plain">&nbsp;outputData</span><span class="java_separator">,</span><span class="java_plain">responseHandler</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;taskFail</span><span class="java_separator">.</span><span class="java_plain">complete</span><span class="java_separator">(</span><span class="java_plain">taskId</span><span class="java_separator">,</span><span class="java_plain">&nbsp;userId</span><span class="java_separator">,</span><span class="java_plain">&nbsp;outputData</span><span class="java_separator">,</span><span class="java_plain">responseHandler</span><span class="java_separator">)</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_type">long</span><span class="java_plain">&nbsp;contentId&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;task</span><span class="java_separator">.</span><span class="java_plain">getTaskData</span><span class="java_separator">().</span><span class="java_plain">getDocumentContentId</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;taskClient</span><span class="java_separator">.</span><span class="java_plain">getContent</span><span class="java_separator">(</span><span class="java_plain">contentId</span><span class="java_separator">,</span><span class="java_plain">&nbsp;responseHandler</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_type">ContentData</span><span class="java_plain">&nbsp;content&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;responseHandler</span><span class="java_separator">.</span><span class="java_plain">getContent</span><span class="java_separator">();</span></pre></div></div><br class="example-break"/></li><li><p>It is now possible to migrate old Drools4 RuleFlows (using
            the xstream format) to Drools5 processes (using readable xml)
            during compilation. Migration will automatically be performed when
            adding the RuleFlow to the KnowledgeBase when the following system
            property is set: <code class="code">drools.ruleflow.port = true</code></p></li><li><p>The "Transform" work item allows you to easily transform
            data from one format to another inside processes. The code and an
            example can be found in the drools-process/drools-workitems
            directory.</p></li><li><p>Function imports are now also supported inside
            processes.</p></li><li><p>The history log - that keeps the history of all executed
            process instances in a database - has been extended so it is now
            capable of storing more detailed information for one specific
            process instance. It is now possible to find out exactly which
            nodes were triggered during the execution of the process
            instance.</p></li><li><p>A new type of join has been added, one that will wait until
            n of its m incoming connections have been completed. This n could
            either be hardcoded in the process or based on the value of a
            variable in the process.</p></li><li><p>Improvements have been made to make persistence easier to
            configure. The persistence approach is based on a command service
            that makes sure that all the client invocations are executed
            inside a transaction and that the state is stored in the database
            after successful execution of the command. While this was already
            possible in M4 using the commands directly, we have extended this
            so that people can simply use the normal StatefulKnowledgeSession
            interface but simply can configure the persistence using
            configuration files. For more details, check out the chapter on
            persistence in the Drools Flow documentation.</p></li></ul></div></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e4184"/>4.6.5. Drools Fusion</h3></div></div></div><p>Drools 5.0 brings to the rules world the full power of events
    processing by supporting a number of CEP features as well as supporting
    events as first class citizens in the rules engine.</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e4189"/>4.6.5.1. Event Semantics</h4></div></div></div><p>Events are (from a rules engine perspective) a special type of
      fact that has a few special characteristics:</p><div class="itemizedlist"><ul><li><p>they are immutable</p></li><li><p>they have strong time-related relationships</p></li><li><p>they may have clear lifecycle windows</p></li><li><p>they may be transparently garbage collected after it's
            lifecycle window expires</p></li><li><p>they may be time-constrained</p></li><li><p>they may be included in sliding windows for reasoning</p></li></ul></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e4213"/>4.6.5.2. Event Declaration</h4></div></div></div><p>Any fact type can assume an event role, and its corresponding
      event semantics, by simply declaring the metadata for it.</p><div class="example"><a id="d0e4218"/><p class="title"><b>Example 4.53. Both existing and generated beans support event
          semantics:</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
// existing bean assuming an event role
import org.drools.test.StockTick
declare StockTick
  @role( event )
end

// generated bean assuming an event role
declare Alarm
  @role( event )
  type : String
  timestamp : long
end</pre></div></div><br class="example-break"/></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e4223"/>4.6.5.3. Entry-Point Stream Listeners</h4></div></div></div><p>A new key "from entry-point" has been added to allow a pattern in
      a rule to listen on a stream, which avoids the overhead of having to
      insert the object into the working memory where it is potentially
      reasoned over by all rules.</p><p><code class="code"> $st : StockTick( company == "ACME", price &gt; 10 ) from
      entry-point "stock stream" </code></p><p/><div class="example"><a id="d0e4232"/><p class="title"><b>Example 4.54. To insert facts into an entry point</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"></span>
<!--  --><br/><span class="java_type">WorkingMemoryEntryPoint</span><span class="java_plain">&nbsp;entry&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;wm</span><span class="java_separator">.</span><span class="java_plain">getWorkingMemoryEntryPoint</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;stock&nbsp;stream&quot;</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">entry</span><span class="java_separator">.</span><span class="java_plain">insert</span><span class="java_separator">(</span><span class="java_plain">&nbsp;ticker&nbsp;</span><span class="java_separator">);</span>
</pre></div></div><br class="example-break"/><p>StreamTest shows a unit for this.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e4239"/>4.6.5.4. Event Correlation and New Operators</h4></div></div></div><p>Event correlation and time based constraint support are
      requirements of event processing, and are completely supported by Drools
      5.0. The new, out of the box, time constraint operators can be seen in
      these test case rules: test_CEP_TimeRelationalOperators.drl</p><p>As seen in the test above, Drools supports both: primitive events,
      that are point in time occurrences with no duration, and compound
      events, that are events with distinct start and end timestamps.</p><p>The complete list of operators are:</p><div class="itemizedlist"><ul><li><p>coincides</p></li><li><p>before</p></li><li><p>after</p></li><li><p>meets</p></li><li><p>metby</p></li><li><p>overlaps</p></li><li><p>overlappedby</p></li><li><p>during</p></li><li><p>includes</p></li><li><p>starts</p></li><li><p>startedby</p></li><li><p>finishes</p></li><li><p>finishedby</p></li></ul></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e4288"/>4.6.5.5. Sliding Time Windows</h4></div></div></div><p>Drools 5.0 adds support for reasoning over sliding windows of
      events. For instance:</p><p><code class="code"> StockTick( symbol == "RHAT" ) over window:time( 60 )
      </code></p><p>The above example will only pattern match the RHAT stock ticks
      that happened in the last 60 clock ticks, discarding any event older
      than that.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e4298"/>4.6.5.6. Session Clock</h4></div></div></div><p>Enabling full event processing capabilities requires the ability
      to configure and interact with a session clock. Drools adds support for
      time reasoning and session clock configuration, allowing it to not only
      run real time event processing but also simulations, what-if scenarios
      and post-processing audit by replaying a scenario.</p><div class="example"><a id="d0e4303"/><p class="title"><b>Example 4.55. The Clock is specified as part of the SessionConfiguration, a
          new class that is optionally specified at session creation
          time</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"></span>
<!--  --><br/><span class="java_type">SessionConfiguration</span><span class="java_plain">&nbsp;conf&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">SessionConfiguration</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">conf</span><span class="java_separator">.</span><span class="java_plain">setClockType</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_type">ClockType</span><span class="java_separator">.</span><span class="java_plain">PSEUDO_CLOCK&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_type">StatefulSession</span><span class="java_plain">&nbsp;session&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;ruleBase</span><span class="java_separator">.</span><span class="java_plain">newStatefulSession</span><span class="java_separator">(</span><span class="java_plain">&nbsp;conf&nbsp;</span><span class="java_separator">);</span>
</pre></div></div><br class="example-break"/></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e4308"/>4.6.5.7. Event Garbage Collection</h4></div></div></div><p>Since events usually have strong temporal relationships, it is
      possible to infer a logical time window when events can possibly match.
      The engine uses that capability to calculate when an event is no longer
      capable of matching any rule anymore and automatically retracts that
      event.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e4313"/>4.6.5.8. Time Units Support</h4></div></div></div><p>Drools adopted a simplified syntax for time units, based on the
      ISO 8601 syntax for durations. This allows users to easily add temporal
      constraints to the rules writing time in well known units.
      Example:</p><p><code class="code">SomeEvent( this after[1m,1h30m] $anotherEvent
      )</code></p><p>The above pattern will match if SomeEvent happens between 1 minute
      (1m) and 1 hour and 30 minutes after <code class="code">$anotherEvent</code>.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e4326"/>4.6.5.9. Support to event expiration policy</h4></div></div></div><p>added the ability to define a per-type event expiration policy. In
      the example below, the StockTick events will expire 10 minutes after
      they enter the system:</p><p><code class="code"> declare StockTick @role( event ) @expires( 10m ) end
      </code></p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e4334"/>4.6.5.10. Support to temporal operations over arbitrary dates.</h4></div></div></div><div class="example"><a id="d0e4337"/><p class="title"><b>Example 4.56. added the ability for point-in-time operators (before, after
          and coincides) to be used with any arbitrary date field</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">rule "Allow access"
when
WorkHours( $s : start, $e : end )
LogIn( time after $s, time before $e )
then
// allow access
end
</pre></div></div><br class="example-break"/></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e4342"/>4.6.6. Eclipse IDE</h3></div></div></div><div class="itemizedlist"><ul><li><p>Support multiple runtimes: The IDE now supports multiple
        runtimes. A Drools runtime is a collection of jars on your file system
        that represent one specific release of the Drools project jars. To
        create a runtime, you must either point the IDE to the release of your
        choice, or you can simply create a new runtime on your file system
        from the jars included in the Drools Eclipse plugin. Drools runtimes
        can be configured by opening up the Eclipse preferences and selecting
        the Drools -&gt; Installed Drools Runtimes category, as shown below.
        </p><div class="figure"><a id="d0e4349"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Release_Notes/runtimes.png" align="middle" alt="Run times"/></div></div><p class="title"><b>Figure 4.110. Run times</b></p></div><p><br class="figure-break"/></p></li><li><p>Debugging of rules using the MVEL dialect has been fixed</p></li><li><p>Drools Flow Editor</p><div class="itemizedlist"><ul><li><p>Process Skins allow you to define how the different
              RuleFlow nodes are visualized. We now support two skins: the
              default one which existed before and a BPMN skin that visualizes
              the nodes using a BPMN-like representation:
              http://blog.athico.com/2008/10/drools-flow-and-bpmn.html</p></li><li><p>An (X)OR split now shows the name of the constraint as the
              connection label</p></li><li><p>Custom work item editors now signal the process correctly
              that it has been changed</p></li></ul></div></li></ul></div></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e4371"/>4.7. What is new in Drools 4.0</h2></div></div></div><p>Drools 4.0 is a major update over the previous Drools 3.0.x series. A
  whole new set of features were developed which special focus on language
  expressiveness, engine performance and tools availability. The following is
  a list of the most interesting changes.</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e4376"/>4.7.1. Language Expressiveness Enhancements</h3></div></div></div><div class="itemizedlist"><ul><li><p>New Conditional Elements: from, collect, accumulate and
        forall</p></li><li><p>New Field Constraint operators: not matches, not contains, in,
        not in, memberOf, not memberOf</p></li><li><p>New Implicit Self Reference field: this</p></li><li><p>Full support for Conditional Elements nesting, for First Order
        Logic completeness.</p></li><li><p>Support for multi-restrictions and constraint connectives
        &amp;&amp; and ||</p></li><li><p>Parser improvements to remove previous language limitations,
        like character escaping and keyword conflicts</p></li><li><p>Support for pluggable dialects and full support for MVEL
        scripting language</p></li><li><p>Complete rewrite of DSL engine, allowing for full l10n</p></li><li><p>Fact attributes auto-vivification for return value restrictions
        and inline-eval constraints</p></li><li><p>Support for nested accessors, property navigation and simplified
        collection, arrays and maps syntax</p></li><li><p>Improved support for XML rules</p></li></ul></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e4413"/>4.7.2. Core Engine Enhancements</h3></div></div></div><div class="itemizedlist"><ul><li><p>Native support for primitive types, avoiding constant
        autoboxing</p></li><li><p>Support for transparent optional Shadow Facts</p></li><li><p>Rete Network performance improvements for complex rules</p></li><li><p>Support for Rule-Flows</p></li><li><p>Support for Stateful and Stateless working memories (rule engine
        sessions)</p></li><li><p>Support for Asynchronous Working Memory actions</p></li><li><p>Rules Engine Agent for hot deployment and BRMS
        integration</p></li><li><p>Dynamic salience for rules conflict resolution</p></li><li><p>Support for Parameterized Queries</p></li><li><p>Support for halt command</p></li><li><p>Support for sequential execution mode</p></li><li><p>Support for pluggable global variable resolver</p></li></ul></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e4453"/>4.7.3. IDE Enhancements</h3></div></div></div><div class="itemizedlist"><ul><li><p>Support for rule break-points on debugging</p></li><li><p>WYSIWYG support for rule-flows</p></li><li><p>New guided editor for rules authoring</p></li><li><p>Upgrade to support all new engine features</p></li></ul></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e4469"/>4.7.4. Business Rules Management System - BRMS</h3></div></div></div><div class="itemizedlist"><ul><li><p>New BRMS tool</p></li><li><p>User friendly web interface with nice WEB 2.0 ajax
        features</p></li><li><p>Package configuration</p></li><li><p>Rule Authoring easy to edit rules both with guided editor (
        drop-down menus ) and text editor</p></li><li><p>Package compilation and deployment</p></li><li><p>Easy deployment with Rule Agent</p></li><li><p>Easy to organize with categories and search assets</p></li><li><p>Versioning enabled, you can easily replace yours assets with
        previously saved</p></li><li><p>JCR compliant rule assets repository</p></li></ul></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e4500"/>4.7.5. Miscellaneous Enhancements</h3></div></div></div><div class="itemizedlist"><ul><li><p>Slimmed down dependencies and smaller memory footprint</p></li></ul></div></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e4507"/>4.8. Upgrade tips from Drools 3.0.x to Drools 4.0.x</h2></div></div></div><p>As mentioned before Drools 4.0 is a major update over the previous
  Drools 3.0.x series. Unfortunately, in order to achieve the goals set for
  this release, some backward compatibility issues were introduced, as
  discussed in the mail list and blogs.</p><p>This section of the manual is a work in progress and will document a
  simple how-to on upgrading from Drools 3.0.x to Drools 4.0.x.</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e4514"/>4.8.1. API changes</h3></div></div></div><p>There are a few API changes that are visible to regular users and
    need to be fixed.</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e4519"/>4.8.1.1. Working Memory creation</h4></div></div></div><p>Drools 3.0.x had only one working memory type that worked like a
      stateful working memory. Drools 4.0.x introduces separate APIs for
      Stateful and Stateless working memories that are called now Rule
      Sessions. In Drools 3.0.x, the code to create a working memory
      was:</p><div class="example"><a id="d0e4524"/><p class="title"><b>Example 4.57. Drools 3.0.x: Working Memory Creation</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">WorkingMemory</span><!-- <br/> --><span class="java_plain">&nbsp;wm&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;rulebase</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">newWorkingMemory</span><!-- <br/> --><span class="java_separator">();</span></pre></div></div><br class="example-break"/><p>In Drools 4.0.x it must be changed to:</p><div class="example"><a id="d0e4531"/><p class="title"><b>Example 4.58. Drools 4.0.x: Stateful Rule Session Creation</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">StatefulSession</span><!-- <br/> --><span class="java_plain">&nbsp;wm&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;rulebase</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">newStatefulSession</span><!-- <br/> --><span class="java_separator">();</span></pre></div></div><br class="example-break"/><p>The StatefulSession object has the same behavior as the
      Drools 3.0.x WorkingMemory (it even extends the WorkingMemory
      interface), so there should be no other problems with this fix.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e4538"/>4.8.1.2. Working Memory Actions</h4></div></div></div><p>Drools 4.0.x now supports pluggable dialects and has built-in
      support for Java and MVEL scripting language. In order to avoid keyword
      conflicts, the working memory actions were renamed as showed
      below:</p><p/><div class="table"><a id="d0e4544"/><p class="title"><b>Table 4.3. Working Memory Actions equivalent API methods</b></p><div class="table-contents"><table summary="Working Memory Actions equivalent API methods" border="1"><colgroup><col/><col/></colgroup><tbody><tr><td><span class="bold"><strong>Drools 3.0.x</strong></span></td><td><span class="bold"><strong>Drools 4.0.x</strong></span></td></tr><tr><td>WorkingMemory.assertObject()</td><td>WorkingMemory.insert()</td></tr><tr><td>WorkingMemory.assertLogicalObject()</td><td>WorkingMemory.insertLogical()</td></tr><tr><td>WorkingMemory.modifyObject()</td><td>WorkingMemory.update()</td></tr></tbody></table></div></div><br class="table-break"/></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e4571"/>4.8.2. Rule Language Changes</h3></div></div></div><p>The DRL Rule Language also has some backward incompatible changes as
    detailed below.</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e4576"/>4.8.2.1. Working Memory Actions</h4></div></div></div><p>The Working Memory actions in rule consequences were also changed
      in a similar way to the change made in the API. The following table
      summarizes the change:</p><div class="table"><a id="d0e4581"/><p class="title"><b>Table 4.4. Working Memory Actions equivalent DRL commands</b></p><div class="table-contents"><table summary="Working Memory Actions equivalent DRL commands" border="1"><colgroup><col/><col/></colgroup><tbody><tr><td><span class="bold"><strong>Drools 3.0.x</strong></span></td><td><span class="bold"><strong>Drools 4.0.x</strong></span></td></tr><tr><td>assert()</td><td>insert()</td></tr><tr><td>assertLogical()</td><td>insertLogical()</td></tr><tr><td>modify()</td><td>update()</td></tr></tbody></table></div></div><br class="table-break"/></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e4608"/>4.8.2.2. Primitive support and unboxing</h4></div></div></div><p>Drools 3.0.x did not had native support for primitive types and
      consequently, it auto-boxed all primitives in it's respective wrapper
      classes. That way, any use of a boxed variable binding required a manual
      unbox.</p><p>Drools 4.0.x has full support for primitive types and does not
      wrap values anymore. So, all previous unwrap method calls must be
      removed from the DRL.</p><div class="example"><a id="d0e4615"/><p class="title"><b>Example 4.59. Drools 3.0.x manual unwrap</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">rule "Primitive int manual unbox"
when
    $c : Cheese( $price : price )
then
    $c.setPrice( $price<span xmlns="http://www.w3.org/1999/xhtml" class="bold"><strong>.intValue()</strong></span> * 2 )
end
</pre></div></div><br class="example-break"/><p>The above rule in 4.0.x would be:</p><div class="example"><a id="d0e4625"/><p class="title"><b>Example 4.60. Drools 4.0.x primitive support</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">rule "Primitive support"
when
    $c : Cheese( $price : price )
then
    $c.setPrice( $price * 2 )
end
</pre></div></div><br class="example-break"/></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e4630"/>4.8.3. Drools Update Tool</h3></div></div></div><p>The Drools Update tools is a simple program to help with the upgrade
    of DRL files from Drools 3.0.x to Drools 4.0.x.</p><p>At this point, its main objective is to upgrade the memory action
    calls from 3.0.x to 4.0.x, but expect it to grow over the next few weeks
    covering additional scenarios. It is important to note that it does not
    make a dumb text search and replace in rules file, but it actually parses
    the rules file and try to make sure it is not doing anything unexpected,
    and as so, it is a safe tool to use for upgrade large sets of rule
    files.</p><p>The Drools update tool can be found as a maven project in the
    following source repository
    http://anonsvn.labs.jboss.com/labs/jbossrules/trunk/experimental/drools-update/
    you just need to check it out, and execute the maven clean install action
    with the project's pom.xml file. After resolve all the class path
    dependencies you are able to run the toll with the following
    command:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">java -cp $CLASSPATH org.drools.tools.update.UpdateTool -f &lt;filemask&gt; [-d &lt;basedir&gt;] [-s &lt;sufix&gt;]</pre><p>The program parameters are very easy to understand as following.</p><div class="itemizedlist"><ul><li><p>-h,--help, Shows a very simple list the usage help</p></li><li><p>-d your source base directory</p></li><li><p>-f pattern for the files to be updated. The format is the same
          as used by ANT: * = single file, directory ** = any level of
          subdirectories EXAMPLE: src/main/resources/**/*.drl = matches all
          DRL files inside any subdirectory of /src/main/resources</p></li><li><p>-s,--sufix the sufix to be added to all updated files</p></li></ul></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e4656"/>4.8.4. DSL Grammars in Drools 4.0</h3></div></div></div><p>It is important to note that the DSL template engine was rewritten
    from scratch to improve flexibility. One of the new features of DSL
    grammars is the support to Regular Expressions. This way, now you can
    write your mappings using regexp to have additional flexibility, as
    explained in the DSL chapter. Although, now you have to escape characters
    with regexp meaning. Example: if previously you had a matching
    like:</p><div class="example"><a id="d0e4661"/><p class="title"><b>Example 4.61. Drools 3.0.x mapping</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">[when][]- the {attr} is in [ {values} ]={attr} in ( {values} )</pre></div></div><br class="example-break"/><p>Now, you need to escape '[' and ']' characters, as they have special
    meaning in regexps. So, the same mapping in Drools 4.0 would be:</p><div class="example"><a id="d0e4668"/><p class="title"><b>Example 4.62. Drools 4.0.x mapping with escaped characters</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">[when][]- the {attr} is in \[ {values} \]={attr} in ( {values} )</pre></div></div><br class="example-break"/></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e4673"/>4.8.5. Rule flow Update for 4.0.2</h3></div></div></div><p>
      The Rule flow feature was updated for 4.0.2, and now all your ruleflows must declare a package name.
    </p><div class="figure"><a id="d0e4678"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Release_Notes/ruleflowproperties.png" align="middle" alt="Rule Flow properties"/></div></div><p class="title"><b>Figure 4.111. Rule Flow properties</b></p></div><br class="figure-break"/></div></div></div><div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="compatibility"/>Chapter 5. Drools compatibility matrix</h2></div></div></div><p>The following table shows the compatibility between different versions of Drools, jBPM and Guvnor.</p><div class="table"><a id="d0e4689"/><p class="title"><b>Table 5.1. Compatibility matrix</b></p><div class="table-contents"><table summary="Compatibility matrix" border="1"><colgroup><col/><col/><col/><col/></colgroup><thead><tr><th>Drools</th><th>jBPM</th><th>Guvnor</th><th>jBPM Designer</th></tr></thead><tbody><tr><td>5.5.0.Final</td><td>5.4.0.Final</td><td>5.5.0.Final</td><td>2.0.Final, 2.1.Final, 2.2.Final, 2.3.Final</td></tr><tr><td>5.5.0.CR1</td><td>5.4.0.CR1</td><td>5.5.0.CR1</td><td>2.0.Final, 2.1.Final, 2.2.Final, 2.3.Final</td></tr><tr><td>5.5.0.Beta1</td><td>5.4.0.Beta1</td><td>5.5.0.Beta1</td><td>2.0.Final, 2.1.Final, 2.2.Final, 2.3.Final</td></tr><tr><td>5.4.0.Final</td><td>5.3.0.Final</td><td>5.4.0.Final</td><td>2.0.Final, 2.1.Final, 2.2.Final, 2.3.Final</td></tr><tr><td>5.4.0.CR1</td><td>5.3.0.CR1</td><td>5.4.0.CR1</td><td>2.0.Final, 2.1.Final, 2.2.Final, 2.3.Final</td></tr><tr><td>5.4.0.Beta2</td><td>5.2.0.Final</td><td>5.4.0.Beta2</td><td>2.0.Final, 2.1.Final, 2.2.Final, 2.3.Final</td></tr><tr><td>5.4.0.Beta1</td><td>5.2.0.Final</td><td>5.4.0.Beta1</td><td>2.0.Final, 2.1.Final, 2.2.Final, 2.3.Final</td></tr><tr><td>5.3.2.Final</td><td>5.2.1.Final</td><td>5.3.2.Final</td><td>2.0.Final, 2.1.Final, 2.2.Final, 2.3.Final</td></tr><tr><td>5.3.1.Final</td><td>5.2.0.Final</td><td>5.3.1.Final</td><td>2.0.Final, 2.1.Final, 2.2.Final, 2.3.Final</td></tr><tr><td>5.3.0.Final</td><td>5.1.2.Final</td><td>5.3.0.Final</td><td>2.0.Final, 2.1.Final, 2.2.Final, 2.3.Final</td></tr><tr><td>5.3.0.CR1</td><td>5.1.1.Final</td><td>5.3.0.CR1</td><td>2.0.Final, 2.1.Final, 2.2.Final, 2.3.Final</td></tr><tr><td>5.2.1.Final</td><td>5.1.1.Final</td><td>5.2.1.Final</td><td>2.0.Final, 2.1.Final, 2.2.Final, 2.3.Final</td></tr><tr><td>5.2.0.Final</td><td>5.1.0.Final</td><td>5.2.0.Final</td><td>2.0.Final, 2.1.Final, 2.2.Final, 2.3.Final</td></tr><tr><td>5.2.0.CR1</td><td>5.1.0.CR1</td><td>5.2.0.CR1</td><td>2.0.Final, 2.1.Final, 2.2.Final, 2.3.Final</td></tr><tr><td>5.2.0.M2</td><td>5.1.0.M1</td><td>5.2.0.M2</td><td>2.0.Final, 2.1.Final, 2.2.Final, 2.3.Final</td></tr></tbody></table></div></div><br class="table-break"/><p>If you combine the versions specified in any <span class="emphasis"><em>single</em></span> row of this table, they are
  compatible.</p></div></div></body></html>
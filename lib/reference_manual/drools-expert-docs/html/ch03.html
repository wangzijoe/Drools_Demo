<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><title xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory">Chapter 3. API Reference</title><link rel="stylesheet" href="css/jbossorg.css" type="text/css"/><meta xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" name="generator" content="DocBook XSL-NS Stylesheets V1.74.0"/><meta xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" http-equiv="Content-Type" content="text/html; charset=UTF-8"/><link rel="home" href="index.html" title="Drools Expert User Guide"/><link rel="up" href="index.html" title="Drools Expert User Guide"/><link rel="prev" href="ch02.html" title="Chapter 2. User Guide"/><link rel="next" href="ch04.html" title="Chapter 4. Rule Language Reference"/></head><body><p xmlns:d="http://docbook.org/ns/docbook" id="title"><a href="http://www.jboss.org" class="site_href"><strong>JBoss.org</strong></a><a href="http://docs.jboss.org/" class="doc_href"><strong>Community Documentation</strong></a></p><ul xmlns:d="http://docbook.org/ns/docbook" class="docnav"><li class="previous"><a accesskey="p" href="ch02.html"><strong>Prev</strong></a></li><li class="next"><a accesskey="n" href="ch04.html"><strong>Next</strong></a></li></ul><div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e2351"/>Chapter 3. API Reference</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="ch03.html#d0e2354">3.1. Building</a></span></dt><dd><dl><dt><span class="section"><a href="ch03.html#d0e2364">3.1.1. Building Using Code</a></span></dt><dt><span class="section"><a href="ch03.html#d0e2477">3.1.2. Building Using Configuration and the ChangeSet XML</a></span></dt><dt><span class="section"><a href="ch03.html#changingTheDefaultBuildResultSeverity">3.1.3. Changing the Default Build Result Severity</a></span></dt></dl></dd><dt><span class="section"><a href="ch03.html#d0e2554">3.2. Deploying</a></span></dt><dd><dl><dt><span class="section"><a href="ch03.html#d0e2557">3.2.1. KnowledgePackage and Knowledge Definitions</a></span></dt><dt><span class="section"><a href="ch03.html#d0e2570">3.2.2. KnowledgeBase</a></span></dt><dt><span class="section"><a href="ch03.html#d0e2620">3.2.3. In-Process Building and Deployment</a></span></dt><dt><span class="section"><a href="ch03.html#d0e2635">3.2.4. Building and Deployment in Separate Processes</a></span></dt><dt><span class="section"><a href="ch03.html#d0e2674">3.2.5. StatefulknowledgeSessions and KnowledgeBase Modifications</a></span></dt><dt><span class="section"><a href="ch03.html#d0e2688">3.2.6. KnowledgeAgent</a></span></dt></dl></dd><dt><span class="section"><a href="ch03.html#d0e2813">3.3. Running</a></span></dt><dd><dl><dt><span class="section"><a href="ch03.html#d0e2817">3.3.1. KnowledgeBase</a></span></dt><dt><span class="section"><a href="ch03.html#d0e2836">3.3.2. StatefulKnowledgeSession</a></span></dt><dt><span class="section"><a href="ch03.html#d0e2858">3.3.3. KnowledgeRuntime</a></span></dt><dt><span class="section"><a href="ch03.html#d0e3150">3.3.4. Agenda</a></span></dt><dt><span class="section"><a href="ch03.html#d0e3255">3.3.5. Event Model</a></span></dt><dt><span class="section"><a href="ch03.html#d0e3370">3.3.6. KnowledgeRuntimeLogger</a></span></dt><dt><span class="section"><a href="ch03.html#d0e3386">3.3.7. StatelessKnowledgeSession</a></span></dt><dt><span class="section"><a href="ch03.html#d0e3581">3.3.8. Commands and the CommandExecutor</a></span></dt><dt><span class="section"><a href="ch03.html#d0e3879">3.3.9. Marshalling</a></span></dt><dt><span class="section"><a href="ch03.html#d0e3961">3.3.10. Persistence and Transactions</a></span></dt><dt><span class="section"><a href="ch03.html#d0e4005">3.3.11. Drools Clips</a></span></dt></dl></dd></dl></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e2354"/>3.1. Building</h2></div></div></div><div class="figure"><a id="d0e2357"/><div class="figure-contents"><div class="mediaobject"><img src="images/Chapter-User_Guide/builder.png" alt="org.drools.builder"/></div></div><p class="title"><b>Figure 3.1. org.drools.builder</b></p></div><br class="figure-break"/><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e2364"/>3.1.1. Building Using Code</h3></div></div></div><p>The KnowledgeBuilder is responsible for taking source files, such as
    a DRL file or an Excel file, and turning them into a Knowledge Package of
    rule and process definitions which a Knowledge Base can consume. An object
    of the class <code class="code">ResourceType</code> indicates the type of resource the builder
    is being asked to process.</p><p>The <code class="code">ResourceFactory</code> provides capabilities to load
    resources from a number of sources, such as a java.io.Reader, the classpath,
    a URL, a java.io.File, or a byte array. Binary files, such as decision tables
    (Excel's' .xls files), should not be passed in with Reader, which is only 
    suitable for text based resources.</p><div class="figure"><a id="d0e2377"/><div class="figure-contents"><div class="mediaobject"><img src="images/Chapter-User_Guide/KnowledgeBuilder.png" alt="KnowledgeBuilder"/></div></div><p class="title"><b>Figure 3.2. KnowledgeBuilder</b></p></div><br class="figure-break"/><p>The KnowledgeBuilder is created using the
    KnowledgeBuilderFactory.</p><div class="figure"><a id="d0e2385"/><div class="figure-contents"><div class="mediaobject"><img src="images/Chapter-User_Guide/KnowledgeBuilderFactory.png" alt="KnowledgeBuilderFactory"/></div></div><p class="title"><b>Figure 3.3. KnowledgeBuilderFactory</b></p></div><br class="figure-break"/><p>A KnowledgeBuilder can be created using the default
    configuration.</p><div class="example"><a id="d0e2393"/><p class="title"><b>Example 3.1. Creating a new KnowledgeBuilder</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">KnowledgeBuilder</span><!-- <br/> --><span class="java_plain">&nbsp;kbuilder&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">KnowledgeBuilderFactory</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">newKnowledgeBuilder</span><!-- <br/> --><span class="java_separator">();</span></pre></div></div><br class="example-break"/><p>A configuration can be created using the
    <code class="code">KnowledgeBuilderFactory</code>. This allows the behavior of the
    Knowledge Builder to be modified. The most common usage is to provide a
    custom class loader so that the <code class="code">KnowledgeBuilder</code> object can
    resolve classes that are not in the default classpath. The first parameter
    is for properties and is optional, i.e., it may be left null, in which
    case the default options will be used. The options parameter can be used
    for things like changing the dialect or registering new accumulator
    functions.</p><div class="example"><a id="d0e2406"/><p class="title"><b>Example 3.2. Creating a new KnowledgeBuilder with a custom ClassLoader</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">KnowledgeBuilderConfiguration</span><!-- <br/> --><span class="java_plain">&nbsp;kbuilderConf&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">KnowledgeBuilderFactory</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">newKnowledgeBuilderConfiguration</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_literal">null</span><!-- <br/> --><span class="java_separator">,</span><!-- <br/> --><span class="java_plain">&nbsp;classLoader&nbsp;</span><!-- <br/> --><span class="java_separator">);</span>
<!--  --><br/><span class="java_type">KnowledgeBuilder</span><span class="java_plain">&nbsp;kbuilder&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">KnowledgeBuilderFactory</span><span class="java_separator">.</span><span class="java_plain">newKnowledgeBuilder</span><span class="java_separator">(</span><span class="java_plain">kbuilderConf</span><span class="java_separator">);</span>
</pre></div></div><br class="example-break"/><p>Resources of any type can be added iteratively. Below, a DRL file is
    added. The Knowledge Builder can handle multiple namespaces, so you can 
    combine resources regardless of their namespace.</p><div class="example"><a id="d0e2413"/><p class="title"><b>Example 3.3. Adding DRL Resources</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">kbuilder</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">add</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">ResourceFactory</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">newFileResource</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_literal">&quot;/project/myrules.drl&quot;</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">),</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">ResourceType</span><span class="java_separator">.</span><span class="java_plain">DRL</span><span class="java_separator">);</span>
</pre></div></div><br class="example-break"/><p>It is a best practice to check the compilation results after
    each resource addition. The KnowledgeBuilder can report compilation results
    of 3 different severities: ERROR, WARNING and INFO.</p><p>An ERROR indicates that the compilation of the resource failed.
    You should not add more resources or retrieve the Knowledge Packages if
    there are errors. <code class="code">getKnowledgePackages()</code> returns an empty
    list if there are errors.</p><p>WARNING and INFO results can be ignored, but are available for
    inspection nonetheless.</p><p>To check and retrieve the build results for a list of severities,
    the KnowledgeBuilder API offers a couple of methods:</p><div class="example"><a id="d0e2429"/><p class="title"><b>Example 3.4. KnowledgeBuilder result inspection methods</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">    /**
     * Return the knowledge builder results for the listed severities.
     * @param severities
     * @return
     */
    KnowledgeBuilderResults getResults(ResultSeverity... severities);
    
    /**
     * Checks if the builder generated any results of the listed severities
     * @param severities
     * @return
     */
    boolean hasResults(ResultSeverity... severities ;</pre></div></div><br class="example-break"/><p>The KnowledgeBuilder API also has two helper methods to
    inspect for errors only: <code class="code">hasErrors()</code> and
    <code class="code">getErrors()</code>:</p><div class="example"><a id="d0e2442"/><p class="title"><b>Example 3.5. Validating</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">if</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_plain">&nbsp;kbuilder</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">hasErrors</span><!-- <br/> --><span class="java_separator">()</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">)</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">System</span><span class="java_separator">.</span><span class="java_plain">out</span><span class="java_separator">.</span><span class="java_plain">println</span><span class="java_separator">(</span><span class="java_plain">&nbsp;kbuilder</span><span class="java_separator">.</span><span class="java_plain">getErrors</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_separator">}</span>
</pre></div></div><br class="example-break"/><p>When all the resources have been added and there are no errors the
    collection of Knowledge Packages can be retrieved. It is a java.util.Collection
    because there is one KnowledgePackage per package namespace. These
    Knowledge Packages are serializable and often used as a unit of
    deployment.</p><div class="example"><a id="d0e2449"/><p class="title"><b>Example 3.6. Getting the KnowledgePackages</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">Collection</span><!-- <br/> --><span class="java_operator">&lt;</span><!-- <br/> --><span class="java_type">KnowledgePackage</span><!-- <br/> --><span class="java_operator">&gt;</span><!-- <br/> --><span class="java_plain">&nbsp;kpkgs&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;kbuilder</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">getKnowledgePackages</span><!-- <br/> --><span class="java_separator">();</span>
</pre></div></div><br class="example-break"/><p>The final example puts it all together.</p><div class="example"><a id="d0e2456"/><p class="title"><b>Example 3.7. Putting it all together</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">KnowledgeBuilder</span><!-- <br/> --><span class="java_plain">&nbsp;kbuilder&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">KnowledgeBuilderFactory</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">newKnowledgeBuilder</span><!-- <br/> --><span class="java_separator">();</span>
<!--  --><br/><span class="java_keyword">if</span><span class="java_separator">(</span><span class="java_plain">&nbsp;kbuilder</span><span class="java_separator">.</span><span class="java_plain">hasErrors</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">System</span><span class="java_separator">.</span><span class="java_plain">out</span><span class="java_separator">.</span><span class="java_plain">println</span><span class="java_separator">(</span><span class="java_plain">&nbsp;kbuilder</span><span class="java_separator">.</span><span class="java_plain">getErrors</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_type">KnowledgeBuilder</span><span class="java_plain">&nbsp;kbuilder&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">KnowledgeBuilderFactory</span><span class="java_separator">.</span><span class="java_plain">newKnowledgeBuilder</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">kbuilder</span><span class="java_separator">.</span><span class="java_plain">add</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_type">ResourceFactory</span><span class="java_separator">.</span><span class="java_plain">newFileResource</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;/project/myrules1.drl&quot;</span><span class="java_plain">&nbsp;</span><span class="java_separator">),</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">ResourceType</span><span class="java_separator">.</span><span class="java_plain">DRL</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">kbuilder</span><span class="java_separator">.</span><span class="java_plain">add</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_type">ResourceFactory</span><span class="java_separator">.</span><span class="java_plain">newFileResource</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;/project/myrules2.drl&quot;</span><span class="java_plain">&nbsp;</span><span class="java_separator">),</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">ResourceType</span><span class="java_separator">.</span><span class="java_plain">DRL</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_keyword">if</span><span class="java_separator">(</span><span class="java_plain">&nbsp;kbuilder</span><span class="java_separator">.</span><span class="java_plain">hasErrors</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">System</span><span class="java_separator">.</span><span class="java_plain">out</span><span class="java_separator">.</span><span class="java_plain">println</span><span class="java_separator">(</span><span class="java_plain">&nbsp;kbuilder</span><span class="java_separator">.</span><span class="java_plain">getErrors</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_type">Collection</span><span class="java_operator">&lt;</span><span class="java_type">KnowledgePackage</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;kpkgs&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;kbuilder</span><span class="java_separator">.</span><span class="java_plain">getKnowledgePackages</span><span class="java_separator">();</span>
</pre></div></div><br class="example-break"/><p>The KnowledgeBuilder also has a batch mode, with a fluent interface, that
    allows to build multiple DRLs at once as in the following example:</p><div class="example"><a id="d0e2463"/><p class="title"><b>Example 3.8. Using KnowledgeBuilder in batch mode</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">KnowledgeBuilder</span><!-- <br/> --><span class="java_plain">&nbsp;kbuilder&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">KnowledgeBuilderFactory</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">newKnowledgeBuilder</span><!-- <br/> --><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">kbuilder</span><span class="java_separator">.</span><span class="java_plain">batch</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">add</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_type">ResourceFactory</span><span class="java_separator">.</span><span class="java_plain">newFileResource</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;/project/myrules1.drl&quot;</span><span class="java_plain">&nbsp;</span><span class="java_separator">),</span><span class="java_plain">&nbsp;</span><span class="java_type">ResourceType</span><span class="java_separator">.</span><span class="java_plain">DRL&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">add</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_type">ResourceFactory</span><span class="java_separator">.</span><span class="java_plain">newFileResource</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;/project/myrules2.drl&quot;</span><span class="java_plain">&nbsp;</span><span class="java_separator">),</span><span class="java_plain">&nbsp;</span><span class="java_type">ResourceType</span><span class="java_separator">.</span><span class="java_plain">DRL&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">add</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_type">ResourceFactory</span><span class="java_separator">.</span><span class="java_plain">newFileResource</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;/project/mytypes1.drl&quot;</span><span class="java_plain">&nbsp;</span><span class="java_separator">),</span><span class="java_plain">&nbsp;</span><span class="java_type">ResourceType</span><span class="java_separator">.</span><span class="java_plain">DRL&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">build</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></pre></div></div><br class="example-break"/><p>In this way it is no longer necessary to build the DRL files in the right order (e.g., first the DRLs
    containing the type declarations and then the ones with the rules using them) and it will also be possible to have
    circular references among them.</p><p>Moreover, the KnowledgeBuilder (regardless if you are using the batch mode or not) also allows to discard
    what has been added with the last DRL(s) build. This can be useful to recover from having added an
    erroneous DRL to the KnowledgeBuilder, as shown below.</p><div class="example"><a id="d0e2472"/><p class="title"><b>Example 3.9. Discard the build of the last added DRL</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">kbuilder</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">add</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">ResourceFactory</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">newFileResource</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_literal">&quot;/project/wrong.drl&quot;</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">),</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">ResourceType</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">DRL&nbsp;</span><!-- <br/> --><span class="java_separator">);</span>
<!--  --><br/><span class="java_keyword">if</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_plain">&nbsp;kbuilder</span><span class="java_separator">.</span><span class="java_plain">hasErrors</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;kbuilder</span><span class="java_separator">.</span><span class="java_plain">undo</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></pre></div></div><br class="example-break"/></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e2477"/>3.1.2. Building Using Configuration and the ChangeSet XML</h3></div></div></div><p>Instead of adding the resources to create definitions
    programmatically it is also possible to do it by configuration, via the
    ChangeSet XML. The simple XML file supports three elements: add, remove,
    and modify, each of which has a sequence of &lt;resource&gt; subelements
    defining a configuration entity. The following XML schema is
    <span class="emphasis"><em>not</em></span> normative and intended for illustration
    only.</p><div class="example"><a id="d0e2485"/><p class="title"><b>Example 3.10. XML Schema for ChangeSet XML (not normative)</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">xs:schema</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">xmlns:xs</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;http://www.w3.org/2001/XMLSchema&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">xmlns</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;http://drools.org/drools-5.0/change-set&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">targetNamespace</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;http://drools.org/drools-5.0/change-set&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">xs:element</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;change-set&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">type</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;ChangeSet&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">xs:complexType</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;ChangeSet&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">xs:choice</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">maxOccurs</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;unbounded&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">xs:element</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;add&quot;</span><span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">type</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;Operation&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">xs:element</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;remove&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">type</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;Operation&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">xs:element</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;modify&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">type</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;Operation&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">xs:choice</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">xs:complexType</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">xs:complexType</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;Operation&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">xs:sequence</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">xs:element</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;resource&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">type</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;Resource&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">maxOccurs</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;unbounded&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">xs:sequence</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">xs:complexType</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">xs:complexType</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;Resource&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">xs:sequence</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><br />
<!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">xs:element</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;decisiontable-conf&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">type</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;DecTabConf&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">minOccurs</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;0&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">xs:sequence</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><br />
<!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">xs:attribute</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;source&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">type</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;xs:string&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">xs:attribute</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;type&quot;</span><span class="xml_plain">&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">type</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;ResourceType&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">xs:complexType</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">xs:complexType</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;DecTabConf&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">xs:attribute</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;input-type&quot;</span><span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">type</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;DecTabInpType&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">xs:attribute</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;worksheet-name&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">type</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;xs:string&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">use</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;optional&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">xs:complexType</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;</span><br />
<!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">xs:simpleType</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;ResourceType&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">xs:restriction</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">base</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;xs:string&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">xs:enumeration</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">value</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;DRL&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">xs:enumeration</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">value</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;XDRL&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">xs:enumeration</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">value</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;DSL&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">xs:enumeration</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">value</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;DSLR&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">xs:enumeration</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">value</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;DRF&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">xs:enumeration</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">value</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;DTABLE&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">xs:enumeration</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">value</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;PKG&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">xs:enumeration</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">value</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;BRL&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">xs:enumeration</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">value</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;CHANGE_SET&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">xs:restriction</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">xs:simpleType</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;</span><br />
<!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">xs:simpleType</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;DecTabInpType&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">xs:restriction</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">base</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;xs:string&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">xs:enumeration</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">value</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;XLS&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">xs:enumeration</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">value</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;CSV&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">xs:restriction</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">xs:simpleType</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">xs:schema</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre></div></div><br class="example-break"/><p>Currently only the add element is supported, but the others will be
    implemented to support iterative changes. The following example loads a
    single DRL file.</p><div class="example"><a id="d0e2500"/><p class="title"><b>Example 3.11. Simple ChangeSet XML</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">change-set</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">xmlns</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">'http://drools.org/drools-5.0/change-set'</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">xmlns:xs</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">'http://www.w3.org/2001/XMLSchema-instance'</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">xs:schemaLocation</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">'http://drools.org/drools-5.0/change-set.xsd&nbsp;http://anonsvn.jboss.org/repos/labs/labs/jbossrules/trunk/drools-api/src/main/resources/change-set-1.0.0.xsd'</span><span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">add</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">resource</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">source</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">'file:/project/myrules.drl'</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">type</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">'DRL'</span><span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">add</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">change-set</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre></div></div><br class="example-break"/><p>Notice the <code class="code">file:</code> prefix, which signifies the protocol
    for the resource. The Change Set supports all the protocols provided by
    java.net.URL, such as "file" and "http", as well as an additional
    "classpath". Currently the type attribute must always be specified for a
    resource, as it is not inferred from the file name extension. Using the
    ClassPath resource loader in Java allows you to specify the Class Loader
    to be used to locate the resource but this is not possible from XML.
    Instead, the Class Loader will default to the one used by the Knowledge
    Builder unless the ChangeSet XML is itself loaded by the ClassPath
    resource, in which case it will use the Class Loader specified for that
    resource.</p><p>Currently you still need to use the API to load that ChangeSet, but
    we will add support for containers such as Spring in the future, so that
    the process of creating a Knowledge Base can be done completely by XML
    configuration. Loading resources using an XML file couldn't be simpler, as
    it's just another resource type.</p><div class="example"><a id="d0e2512"/><p class="title"><b>Example 3.12. Loading the ChangeSet XML</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">kbuilder</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">add</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">ResourceFactory</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">newUrlResource</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_plain">&nbsp;url&nbsp;</span><!-- <br/> --><span class="java_separator">),</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">ResourceType</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">CHANGE_SET&nbsp;</span><!-- <br/> --><span class="java_separator">);</span>
</pre></div></div><br class="example-break"/><p>Change Sets can include any number of resources, and they even
    support additional configuration information, which currently is only
    needed for decision tables. Below, the example is expanded to load rules
    via HTTP from a URL location, and an Excel decision table from the
    classpath.</p><div class="example"><a id="d0e2519"/><p class="title"><b>Example 3.13. ChangeSet XML with resource configuration</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">change-set</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">xmlns</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">'http://drools.org/drools-5.0/change-set'</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">xmlns:xs</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">'http://www.w3.org/2001/XMLSchema-instance'</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">xs:schemaLocation</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">'http://drools.org/drools-5.0/change-set.xsd&nbsp;http://anonsvn.jboss.org/repos/labs/labs/jbossrules/trunk/drools-api/src/main/resources/change-set-1.0.0.xsd'</span><span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">add</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">resource</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">source</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">'http:org/domain/myrules.drl'</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">type</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">'DRL'</span><span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">resource</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">source</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">'classpath:data/IntegrationExampleTest.xls'</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">type</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;DTABLE&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">decisiontable-conf</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">input-type</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;XLS&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">worksheet-name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;Tables_2&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">resource</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">add</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">change-set</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre></div></div><br class="example-break"/><p>The Change Set is especially useful when working with a Knowledge
    Agent, as it allows for change notification and automatic rebuilding of
    the Knowledge Base, which is covered in more detail in the section on the
    Knowledge Agent, under Deploying.</p><p>Directories can also be specified, to add all resources in that
    folder. Currently it is expected that all resources in that folder are of
    the same type. If you use the Knowledge Agent it will provide a continous
    scanning for added, modified or removed resources and rebuild the cached
    Knowledge Base. The KnowledgeAgent provides more information on
    this.</p><div class="example"><a id="d0e2528"/><p class="title"><b>Example 3.14. ChangeSet XML which adds a directory's contents</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">change-set</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">xmlns</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">'http://drools.org/drools-5.0/change-set'</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">xmlns:xs</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">'http://www.w3.org/2001/XMLSchema-instance'</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">xs:schemaLocation</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">'http://drools.org/drools-5.0/change-set.xsd&nbsp;http://anonsvn.jboss.org/repos/labs/labs/jbossrules/trunk/drools-api/src/main/resources/change-set-1.0.0.xsd'</span><span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">add</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">resource</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">source</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">'file:/projects/myproject/myrules'</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">type</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">'DRL'</span><span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">add</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">change-set</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre></div></div><br class="example-break"/></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="changingTheDefaultBuildResultSeverity"/>3.1.3. Changing the Default Build Result Severity</h3></div></div></div><p>In some cases, it is possible to change the default severity of a
    type of build result. For instance, when a new rule with the same name
    of an existing rule is added to a package, the default behavior is to
    replace the old rule by the new rule and report it as an INFO. This is
    probably ideal for most use cases, but in some deployments the user
    might want to prevent the rule update and report it as an error.</p><p>Changing the default severity for a result type is configured
    like any other option in Drools and can be done by API
    calls, system properties or configuration files. As of this version,
    Drools supports configurable result severity for rule updates and function
    updates. To configure it using system properties or configuration files,
    the user has to use the following properties:</p><div class="example"><a id="d0e2540"/><p class="title"><b>Example 3.15. Setting the severity using properties</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">// sets the severity of rule updates
drools.kbuilder.severity.duplicateRule = &lt;INFO|WARNING|ERROR&gt;
// sets the severity of function updates
drools.kbuilder.severity.duplicateFunction = &lt;INFO|WARNING|ERROR&gt;
</pre></div></div><br class="example-break"/><p>To configure it through the API:</p><div class="example"><a id="d0e2547"/><p class="title"><b>Example 3.16. Setting the severity using the API</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">KnowledgeBuilderConfiguration kbconf = ...

// sets the severity of rule updates to error
kbconf.setOption( KBuilderSeverityOption.get( "drools.kbuilder.severity.duplicateRule", ResultSeverity.ERROR ) ); 
// sets the severity of function updates to error
kbconf.setOption( KBuilderSeverityOption.get( "drools.kbuilder.severity.duplicateFunction", ResultSeverity.ERROR ) ); 
</pre></div></div><br class="example-break"/><p/><p/></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e2554"/>3.2. Deploying</h2></div></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e2557"/>3.2.1. KnowledgePackage and Knowledge Definitions</h3></div></div></div><p>A Knowledge Package is a collection of Knowledge Definitions, such
    as rules and processes. It is created by the Knowledge Builder, as
    described in the chapter "Building". Knowledge Packages are self-contained
    and serializable, and they currently form the basic deployment
    unit.</p><div class="figure"><a id="d0e2562"/><div class="figure-contents"><div class="mediaobject"><img src="images/Chapter-User_Guide/KnowledgePackage.png" alt="KnowledgePackage"/></div></div><p class="title"><b>Figure 3.4. KnowledgePackage</b></p></div><br class="figure-break"/><p>Knowledge Packages are added to the Knowledge Base. However, a
    Knowledge Package instance cannot be reused once it's added to the
    Knowledge Base. If you need to add it to another Knowledge Base, try
    serializing it first and using the "cloned" result. We hope to fix this
    limitation in future versions of Drools.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e2570"/>3.2.2. KnowledgeBase</h3></div></div></div><p>The Knowledge Base is a repository of all the application's
    knowledge definitions. It may contain rules, processes, functions, and
    type models. The Knowledge Base itself does not contain instance data,
    known as facts; instead, sessions are created from the Knowledge Base into
    which data can be inserted and where process instances may be started.
    Creating the Knowledge Base can be heavy, whereas session creation is very
    light, so it is recommended that Knowledge Bases be cached where possible
    to allow for repeated session creation.</p><div class="figure"><a id="d0e2575"/><div class="figure-contents"><div class="mediaobject"><img src="images/Chapter-User_Guide/KnowledgeBase.png" alt="KnowledgeBase"/></div></div><p class="title"><b>Figure 3.5. KnowledgeBase</b></p></div><br class="figure-break"/><p>A <code class="code">KnowledgeBase</code> object is also serializable, and some
    people may prefer to build and then store a <code class="code">KnowledgeBase</code>,
    treating it also as a unit of deployment, instead of the Knowledge
    Packages.</p><p>The KnowledgeBase is created using the KnowledgeBaseFactory.</p><div class="figure"><a id="d0e2591"/><div class="figure-contents"><div class="mediaobject"><img src="images/Chapter-User_Guide/KnowledgeBaseFactory.png" alt="KnowledgeBaseFactory"/></div></div><p class="title"><b>Figure 3.6. KnowledgeBaseFactory</b></p></div><br class="figure-break"/><p>A KnowledgeBase can be created using the default
    configuration.</p><div class="example"><a id="d0e2599"/><p class="title"><b>Example 3.17. Creating a new KnowledgeBase</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">KnowledgeBase</span><!-- <br/> --><span class="java_plain">&nbsp;kbase&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">KnowledgeBaseFactory</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">newKnowledgeBase</span><!-- <br/> --><span class="java_separator">();</span></pre></div></div><br class="example-break"/><p>If a custom class loader was used with the
    <code class="code">KnowledgeBuilder</code> to resolve types not in the default class
    loader, then that must also be set on the <code class="code">KnowledgeBase</code>. The
    technique for this is the same as with the
    <code class="code">KnowledgeBuilder</code>.</p><div class="example"><a id="d0e2615"/><p class="title"><b>Example 3.18. Creating a new KnowledgeBase with a custom ClassLoader</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">KnowledgeBaseConfiguration</span><!-- <br/> --><span class="java_plain">&nbsp;kbaseConf&nbsp;</span><!-- <br/> --><span class="java_operator">=</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">KnowledgeBaseFactory</span><span class="java_separator">.</span><span class="java_plain">createKnowledgeBaseConfiguration</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">null</span><span class="java_separator">,</span><span class="java_plain">&nbsp;cl&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_type">KnowledgeBase</span><span class="java_plain">&nbsp;kbase&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">KnowledgeBaseFactory</span><span class="java_separator">.</span><span class="java_plain">newKnowledgeBase</span><span class="java_separator">(</span><span class="java_plain">&nbsp;kbaseConf&nbsp;</span><span class="java_separator">);</span></pre></div></div><br class="example-break"/></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e2620"/>3.2.3. In-Process Building and Deployment</h3></div></div></div><p>This is the simplest form of deployment. It compiles the knowledge
    definitions and adds them to the Knowledge Base in the same JVM. This
    approach requires drools-core.jar and drools-compiler.jar to be on the
    classpath.</p><div class="example"><a id="d0e2625"/><p class="title"><b>Example 3.19. Add KnowledgePackages to a KnowledgeBase</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">Collection</span><!-- <br/> --><span class="java_operator">&lt;</span><!-- <br/> --><span class="java_type">KnowledgePackage</span><!-- <br/> --><span class="java_operator">&gt;</span><!-- <br/> --><span class="java_plain">&nbsp;kpkgs&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;kbuilder</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">getKnowledgePackages</span><!-- <br/> --><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_type">KnowledgeBase</span><span class="java_plain">&nbsp;kbase&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">KnowledgeBaseFactory</span><span class="java_separator">.</span><span class="java_plain">newKnowledgeBase</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">kbase</span><span class="java_separator">.</span><span class="java_plain">addKnowledgePackages</span><span class="java_separator">(</span><span class="java_plain">&nbsp;kpkgs&nbsp;</span><span class="java_separator">);</span></pre></div></div><br class="example-break"/><p>Note that the <code class="code">addKnowledgePackages(kpkgs)</code> method can be
    called iteratively to add additional knowledge.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e2635"/>3.2.4. Building and Deployment in Separate Processes</h3></div></div></div><p>Both the <code class="code">KnowledgeBase</code> and the
    <code class="code">KnowledgePackage</code> are units of deployment and serializable.
    This means you can have one machine do any necessary building, requiring
    <code class="filename">drools-compiler.jar</code>, and have another machine deploy
    and execute everything, needing only
    <code class="filename">drools-core.jar</code>.</p><p>Although serialization is standard Java, we present an example of
    how one machine might write out the deployment unit and how another
    machine might read in and use that deployment unit.</p><div class="example"><a id="d0e2654"/><p class="title"><b>Example 3.20. Writing the KnowledgePackage to an OutputStream</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">ObjectOutputStream</span><!-- <br/> --><span class="java_plain">&nbsp;out&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">new</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">ObjectOutputStream</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">new</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">FileOutputStream</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_plain">&nbsp;fileName&nbsp;</span><!-- <br/> --><span class="java_separator">)</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">out</span><span class="java_separator">.</span><span class="java_plain">writeObject</span><span class="java_separator">(</span><span class="java_plain">&nbsp;kpkgs&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">out</span><span class="java_separator">.</span><span class="java_plain">close</span><span class="java_separator">();</span>
</pre></div></div><br class="example-break"/><div class="example"><a id="d0e2659"/><p class="title"><b>Example 3.21. Reading the KnowledgePackage from an InputStream</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">ObjectInputStream</span><!-- <br/> --><span class="java_plain">&nbsp;in&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">new</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">ObjectInputStream</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">new</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">FileInputStream</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_plain">&nbsp;fileName&nbsp;</span><!-- <br/> --><span class="java_separator">)</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">);</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_plain">&nbsp;</span><span class="java_type">The</span><span class="java_plain">&nbsp;input&nbsp;stream&nbsp;might&nbsp;contain&nbsp;an&nbsp;individual</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_plain">&nbsp;</span><span class="java_keyword">package</span><span class="java_plain">&nbsp;or&nbsp;a&nbsp;collection</span><span class="java_separator">.</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">SuppressWarnings</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;unchecked&quot;</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_type">Collection</span><span class="java_operator">&lt;</span><span class="java_type">KnowledgePackage</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;kpkgs&nbsp;</span><span class="java_operator">=</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">()</span><span class="java_plain">in</span><span class="java_separator">.</span><span class="java_plain">readObject</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_type">Collection</span><span class="java_operator">&lt;</span><span class="java_type">KnowledgePackage</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">in</span><span class="java_separator">.</span><span class="java_plain">close</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_type">KnowledgeBase</span><span class="java_plain">&nbsp;kbase&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">KnowledgeBaseFactory</span><span class="java_separator">.</span><span class="java_plain">newKnowledgeBase</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">kbase</span><span class="java_separator">.</span><span class="java_plain">addKnowledgePackages</span><span class="java_separator">(</span><span class="java_plain">&nbsp;kpkgs&nbsp;</span><span class="java_separator">);</span>
</pre></div></div><br class="example-break"/><p>The <code class="code">KnowledgeBase</code> is also serializable and some people
    may prefer to build and then store the <code class="code">KnowledgeBase</code> itself,
    instead of the Knowledge Packages.</p><p>Drools Guvnor, our server side management system, uses this
    deployment approach. After Guvnor has compiled and published serialized
    Knowledge Packages on a URL, Drools can use the URL resource type to load
    them.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e2674"/>3.2.5. StatefulknowledgeSessions and KnowledgeBase Modifications</h3></div></div></div><p>Stateful Knowledge Sessions will be discussed in more detail in
    section "Running". The <code class="code">KnowledgeBase</code> creates and returns
    <code class="code">StatefulKnowledgeSession</code> objects, and it may optionally keep
    references to those. When <code class="code">KnowledgeBase</code> modifications occur
    those modifications are applied against the data in the sessions. This
    reference is a weak reference and it is also optional, which is controlled
    by a boolean flag.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e2688"/>3.2.6. KnowledgeAgent</h3></div></div></div><p>The <code class="code">KnowlegeAgent</code> provides automatic loading, caching
    and re-loading of resources and is configured from a properties files. The
    Knowledge Agent can update or rebuild this Knowlege Base as the resources
    it uses are changed. The strategy for this is determined by the
    configuration given to the factory, but it is typically pull-based using
    regular polling. We hope to add push-based updates and rebuilds in future
    versions. The Knowledge Agent will continuously scan all the added
    resources, using a default polling interval of 60 seconds. If their date
    of the last modification is updated it will rebuild the cached Knowledge
    Base using the new resources.</p><div class="figure"><a id="d0e2696"/><div class="figure-contents"><div class="mediaobject"><img src="images/Chapter-User_Guide/KnowledgeAgent.png" alt="KnowledgeAgent"/></div></div><p class="title"><b>Figure 3.7. KnowledgeAgent</b></p></div><br class="figure-break"/><p>The <code class="code">KnowlegeBuilder</code> is created using a
    <code class="code">KnowledgeBuilderFactory</code> object. The agent must specify a
    name, which is used in the log files to associate a log entry with the
    corresponding agent.</p><div class="example"><a id="d0e2710"/><p class="title"><b>Example 3.22. Creating the KnowledgeAgent</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">KnowledgeAgent</span><!-- <br/> --><span class="java_plain">&nbsp;kagent&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">KnowledgeAgentFactory</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">newKnowledgeAgent</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_literal">&quot;MyAgent&quot;</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">);</span>
</pre></div></div><br class="example-break"/><div class="figure"><a id="d0e2715"/><div class="figure-contents"><div class="mediaobject"><img src="images/Chapter-User_Guide/KnowledgeAgentFactory.png" alt="KnowledgeAgentFactory"/></div></div><p class="title"><b>Figure 3.8. KnowledgeAgentFactory</b></p></div><br class="figure-break"/><p>The following example constructs an agent that will build a new
    KnowledgeBase from the specified ChangeSet. (See section "Building" for
    more details on the ChangeSet format.) Note that the method can be called
    iteratively to add new resources over time. The Knowledge Agent polls the
    resources added from the ChangeSet every 60 seconds, the default interval,
    to see if they are updated. Whenever changes are found it will construct a
    new Knowledge Base or apply the modifications to the existing Knowledge
    Base according to its configuration. If the change set specifies a
    resource that is a directory its contents will be scanned for changes,
    too.</p><div class="example"><a id="d0e2723"/><p class="title"><b>Example 3.23. Writing the KnowledgePackage to an OutputStream</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">KnowledgeAgent</span><!-- <br/> --><span class="java_plain">&nbsp;kagent&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">KnowledgeAgentFactory</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">newKnowledgeAgent</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_literal">&quot;MyAgent&quot;</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">kagent</span><span class="java_separator">.</span><span class="java_plain">applyChangeSet</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_type">ResourceFactory</span><span class="java_separator">.</span><span class="java_plain">newUrlResource</span><span class="java_separator">(</span><span class="java_plain">&nbsp;url&nbsp;</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_type">KnowledgeBase</span><span class="java_plain">&nbsp;kbase&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;kagent</span><span class="java_separator">.</span><span class="java_plain">getKnowledgeBase</span><span class="java_separator">();</span>
</pre></div></div><br class="example-break"/><p>Resource scanning is not on by default, it's a service and must be
    started, and the same is true for notification. Both can be done via the
    ResourceFactory.</p><div class="example"><a id="d0e2730"/><p class="title"><b>Example 3.24. Starting the Scanning and Notification Services</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">ResourceFactory</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">getResourceChangeNotifierService</span><!-- <br/> --><span class="java_separator">().</span><!-- <br/> --><span class="java_plain">start</span><!-- <br/> --><span class="java_separator">();</span>
<!--  --><br/><span class="java_type">ResourceFactory</span><span class="java_separator">.</span><span class="java_plain">getResourceChangeScannerService</span><span class="java_separator">().</span><span class="java_plain">start</span><span class="java_separator">();</span>
</pre></div></div><br class="example-break"/><p>The default resource scanning period may be changed via the
    <code class="code">ResourceChangeScannerService</code>. A suitably updated
    <code class="code">ResourceChangeScannerConfiguration</code> object is passed to the
    service's <code class="code">configure()</code> method, which allows for the service to
    be reconfigured on demand.</p><div class="example"><a id="d0e2746"/><p class="title"><b>Example 3.25. Changing the Scanning Intervals</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">ResourceChangeScannerConfiguration</span><!-- <br/> --><span class="java_plain">&nbsp;sconf&nbsp;</span><!-- <br/> --><span class="java_operator">=</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">ResourceFactory</span><span class="java_separator">.</span><span class="java_plain">getResourceChangeScannerService</span><span class="java_separator">().</span><span class="java_plain">newResourceChangeScannerConfiguration</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_plain">&nbsp;</span><span class="java_type">Set</span><span class="java_plain">&nbsp;the&nbsp;disk&nbsp;scanning&nbsp;interval&nbsp;to&nbsp;</span><span class="java_literal">30</span><span class="java_plain">s</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_keyword">default</span><span class="java_plain">&nbsp;is&nbsp;</span><span class="java_literal">60</span><span class="java_plain">s</span><span class="java_separator">.</span>
<!--  --><br/><span class="java_plain">sconf</span><span class="java_separator">.</span><span class="java_plain">setProperty</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;drools.resource.scanner.interval&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;30&quot;</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_type">ResourceFactory</span><span class="java_separator">.</span><span class="java_plain">getResourceChangeScannerService</span><span class="java_separator">().</span><span class="java_plain">configure</span><span class="java_separator">(</span><span class="java_plain">&nbsp;sconf&nbsp;</span><span class="java_separator">);</span>
</pre></div></div><br class="example-break"/><p>Knowledge Agents can take an empty Knowledge Base or a populated
    one. If a populated Knowledge Base is provided, the Knowledge Agent will
    run an iterator from Knowledge Base and subscribe to the resources that it
    finds. While it is possible for the Knowledge Builder to build all
    resources found in a directory, that information is lost by the Knowledge
    Builder so that those directories will not be continuously scanned. Only
    directories specified as part of the <code class="code">applyChangeSet(Resource)</code>
    method are monitored.</p><p>One of the advantages of providing <code class="code">KnowledgeBase</code> as the
    starting point is that you can provide it with a
    <code class="code">KnowledgeBaseConfiguration</code>. When resource changes are
    detected and a new <code class="code">KnowledgeBase</code> object is instantiated, it
    will use the <code class="code">KnowledgeBaseConfiguration</code> of the previous
    <code class="code">KnowledgeBase</code> object.</p><div class="example"><a id="d0e2773"/><p class="title"><b>Example 3.26. Using an existing KnowledgeBase</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">KnowledgeBaseConfiguration</span><!-- <br/> --><span class="java_plain">&nbsp;kbaseConf&nbsp;</span><!-- <br/> --><span class="java_operator">=</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">KnowledgeBaseFactory</span><span class="java_separator">.</span><span class="java_plain">createKnowledgeBaseConfiguration</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">null</span><span class="java_separator">,</span><span class="java_plain">&nbsp;cl&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_type">KnowledgeBase</span><span class="java_plain">&nbsp;kbase&nbsp;</span><span class="java_type">KnowledgeBaseFactory</span><span class="java_separator">.</span><span class="java_plain">newKnowledgeBase</span><span class="java_separator">(</span><span class="java_plain">&nbsp;kbaseConf&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_plain">&nbsp;</span><span class="java_type">Populate</span><span class="java_plain">&nbsp;kbase&nbsp;with&nbsp;resources&nbsp;here</span><span class="java_separator">.</span>
</span>
<!--  --><br/><span class="java_type">KnowledgeAgent</span><span class="java_plain">&nbsp;kagent&nbsp;</span><span class="java_operator">=</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">KnowledgeAgentFactory</span><span class="java_separator">.</span><span class="java_plain">newKnowledgeAgent</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;MyAgent&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;kbase&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_type">KnowledgeBase</span><span class="java_plain">&nbsp;kbase&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;kagent</span><span class="java_separator">.</span><span class="java_plain">getKnowledgeBase</span><span class="java_separator">();</span>
</pre></div></div><br class="example-break"/><p>In the above example <code class="code">getKnowledgeBase()</code> will return the
    same provided kbase instance until resource changes are detected and a new
    Knowledge Base is built. When the new Knowledge Base is built, it will be
    done with the <code class="code">KnowledgeBaseConfiguration</code> that was provided to
    the previous <code class="code">KnowledgeBase</code>.</p><p>As mentioned previously, a ChangeSet XML can specify a directory and
    all of its contents will be added. If this ChangeSet XML is used with the
    <code class="code">applyChangeSet()</code> method it will also add any directories to
    the scanning process. When the directory scan detects an additional file,
    it will be added to the Knowledge Base; any removed file is removed from
    the Knowledge Base, and modified files will be removed from the Knowledge
    Base.</p><div class="example"><a id="d0e2794"/><p class="title"><b>Example 3.27. ChangeSet XML which adds a directories contents</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">change-set</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">xmlns</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">'http://drools.org/drools-5.0/change-set'</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">xmlns:xs</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">'http://www.w3.org/2001/XMLSchema-instance'</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">xs:schemaLocation</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">'http://drools.org/drools-5.0/change-set.xsd'</span><span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">add</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">resource</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">source</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">'file:/projects/myproject/myrules'</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">type</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">'PKG'</span><span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">add</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">change-set</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre></div></div><br class="example-break"/><p>Note that for the resource type PKG the drools-compiler dependency
    is not needed as the Knowledge Agent is able to handle those with just
    drools-core.</p><p>The <code class="code">KnowledgeAgentConfiguration</code> can be used to modify a
    Knowledge Agent's default behavior. You could use this to load the
    resources from a directory, while inhibiting the continuous scan for
    changes of that directory.</p><div class="example"><a id="d0e2806"/><p class="title"><b>Example 3.28. Change the Scanning Behavior</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">KnowledgeBase</span><!-- <br/> --><span class="java_plain">&nbsp;kbase&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">KnowledgeBaseFactory</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">newKnowledgeBase</span><!-- <br/> --><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_type">KnowledgeAgentConfiguration</span><span class="java_plain">&nbsp;kaconf&nbsp;</span><span class="java_operator">=</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">KnowledgeAgentFactory</span><span class="java_separator">.</span><span class="java_plain">newKnowledgeAgentConfiguation</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_plain">&nbsp;</span><span class="java_type">Do</span><span class="java_plain">&nbsp;not&nbsp;scan&nbsp;directories</span><span class="java_separator">,</span><span class="java_plain">&nbsp;just&nbsp;files</span><span class="java_separator">.</span>
<!--  --><br/><span class="java_plain">kaconf</span><span class="java_separator">.</span><span class="java_plain">setProperty</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;drools.agent.scanDirectories&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;false&quot;</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_type">KnowledgeAgent</span><span class="java_plain">&nbsp;kagent&nbsp;</span><span class="java_operator">=</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">KnowledgeAgentFactory</span><span class="java_separator">.</span><span class="java_plain">newKnowledgeAgent</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;test&nbsp;agent&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;kaconf&nbsp;</span><span class="java_separator">);</span>
</pre></div></div><br class="example-break"/><p>Previously we mentioned Drools Guvnor and how it can build and
    publish serialized Knowledge Packages on a URL, and that the ChangeSet XML
    can handle URLs and Packages. Taken together, this forms an importanty
    deployment scenario for the Knowledge Agent.</p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e2813"/>3.3. Running</h2></div></div></div><p/><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e2817"/>3.3.1. KnowledgeBase</h3></div></div></div><p>The <code class="code">KnowledgeBase</code> is a repository of all the
    application's knowledge definitions. It will contain rules, processes,
    functions, and type models. The Knowledge Base itself does not contain
    data; instead, sessions are created from the <code class="code">KnowledgeBase</code>
    into which data can be inserted and from which process instances may be
    started. Creating the <code class="code">KnowledgeBase</code> can be heavy, whereas
    session creation is very light, so it is recommended that KnowledgeBases
    be cached where possible to allow for repeated session creation.</p><div class="example"><a id="d0e2831"/><p class="title"><b>Example 3.29. Creating a new KnowledgeBase</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">KnowledgeBase</span><!-- <br/> --><span class="java_plain">&nbsp;kbase&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">KnowledgeBaseFactory</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">newKnowledgeBase</span><!-- <br/> --><span class="java_separator">();</span></pre></div></div><br class="example-break"/></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e2836"/>3.3.2. StatefulKnowledgeSession</h3></div></div></div><p>The <code class="code">StatefulKnowledgeSession</code> stores and executes on the
    runtime data. It is created from the <code class="code">KnowledgeBase</code>.</p><div class="figure"><a id="d0e2847"/><div class="figure-contents"><div class="mediaobject"><img src="images/Chapter-User_Guide/StatefulKnowledgeSession.png" alt="StatefulKnowledgeSession"/></div></div><p class="title"><b>Figure 3.9. StatefulKnowledgeSession</b></p></div><br class="figure-break"/><div class="example"><a id="d0e2853"/><p class="title"><b>Example 3.30. Create a StatefulKnowledgeSession from a KnowledgeBase</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">StatefulKnowledgeSession</span><!-- <br/> --><span class="java_plain">&nbsp;ksession&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;kbase</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">newStatefulKnowledgeSession</span><!-- <br/> --><span class="java_separator">();</span>
</pre></div></div><br class="example-break"/></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e2858"/>3.3.3. KnowledgeRuntime</h3></div></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e2861"/>3.3.3.1. WorkingMemoryEntryPoint</h4></div></div></div><p>The <code class="code">WorkingMemoryEntryPoint</code> provides the methods
      around inserting, updating and retrieving facts. The term "entry point"
      is related to the fact that we have multiple partitions in a Working
      Memory and you can choose which one you are inserting into, although
      this use case is aimed at event processing and covered in more detail in
      the Fusion manual. Most rule based applications will work with the
      default entry point alone.</p><p>The <code class="code">KnowledgeRuntime</code> interface provides the main
      interaction with the engine. It is available in rule consequences and
      process actions. In this manual the focus is on the methods and
      interfaces related to rules, and the methods pertaining to processes
      will be ignored for now. But you'll notice that the
      <code class="code">KnowledgeRuntime</code> inherits methods from both the
      <code class="code">WorkingMemory</code> and the <code class="code">ProcessRuntime</code>, thereby
      providing a unified API to work with processes and rules. When working
      with rules, three interfaces form the <code class="code">KnowledgeRuntime</code>:
      <code class="code">WorkingMemoryEntryPoint</code>, <code class="code">WorkingMemory</code> and the
      <code class="code">KnowledgeRuntime</code> itself.</p><div class="figure"><a id="d0e2895"/><div class="figure-contents"><div class="mediaobject"><img src="images/Chapter-User_Guide/WorkingMemoryEntryPoint.png" alt="WorkingMemoryEntryPoint"/></div></div><p class="title"><b>Figure 3.10. WorkingMemoryEntryPoint</b></p></div><br class="figure-break"/><div class="section" lang="en-US"><div class="titlepage"><div><div><h5 class="title"><a id="d0e2901"/>3.3.3.1.1. Insertion</h5></div></div></div><p>Insertion is the act of telling the <code class="code">WorkingMemory</code>
        about a fact, which you do by
        <code class="code">ksession.insert(yourObject)</code>, for example. When you insert
        a fact, it is examined for matches against the rules. This means
        <span class="emphasis"><em>all</em></span> of the work for deciding about firing or not
        firing a rule is done during insertion; no rule, however, is executed
        until you call <code class="code">fireAllRules()</code>, which you call after you
        have finished inserting your facts. It is a common misunderstanding
        for people to think the condition evaluation happens when you call
        <code class="code">fireAllRules()</code>. Expert systems typically use the term
        <span class="emphasis"><em>assert</em></span> or <span class="emphasis"><em>assertion</em></span> to refer
        to facts made available to the system. However, due to "assert" being
        a keyword in most languages, we have decided to use the
        <code class="literal">insert</code> keyword; however, expect to hear the two terms
        used interchangeably.</p><p>When an Object is inserted it returns a <code class="code">FactHandle</code>.
        This <code class="code">FactHandle</code> is the token used to represent your
        inserted object within the <code class="code">WorkingMemory</code>. It is also used
        for interactions with the <code class="code">WorkingMemory</code> when you wish to
        retract or modify an object.</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">Cheese</span><!-- <br/> --><span class="java_plain">&nbsp;stilton&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">new</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">Cheese</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_literal">&quot;stilton&quot;</span><!-- <br/> --><span class="java_separator">);</span>
<!--  --><br/><span class="java_type">FactHandle</span><span class="java_plain">&nbsp;stiltonHandle&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;ksession</span><span class="java_separator">.</span><span class="java_plain">insert</span><span class="java_separator">(</span><span class="java_plain">&nbsp;stilton&nbsp;</span><span class="java_separator">);</span><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></pre><p>As mentioned in the Knowledge Base section, a Working Memory may
        operate in two assertion modes, i.e., equality or identity, with
        identity being the default.</p><p><span class="emphasis"><em>Identity</em></span> means that the Working Memory uses
        an <code class="code">IdentityHashMap</code> to store all asserted objects. New
        instance assertions always result in the return of new
        <code class="code">FactHandle</code>, but if an instance is asserted again then it
        returns the original fact handle, i.e., it ignores repeated insertions
        for the same object.</p><p><span class="emphasis"><em>Equality</em></span> means that the Working Memory uses
        a <code class="code">HashMap</code> to store all asserted objects. An object instance
        assertion will only return a new <code class="code">FactHandle</code> if the inserted
        object is not equal (according to its <code class="code">equal</code> method) to an
        already existing fact.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h5 class="title"><a id="d0e2972"/>3.3.3.1.2. Retraction</h5></div></div></div><p>Retraction is the removal of a fact from Working Memory, which
        means that it will no longer track and match that fact, and any rules
        that are activated and dependent on that fact will be cancelled. Note
        that it is possible to have rules that depend on the nonexistence of a
        fact, in which case retracting a fact may cause a rule to activate.
        (See the <code class="code">not</code> and <code class="code">exists</code> keywords.) Retraction
        may be done using the <code class="code">FactHandle</code> that was returned by the
        insert call. On the right hand side of a rule the
        <code class="literal">retract</code> statement is used, which works with a simple
        object reference.</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">Cheese</span><!-- <br/> --><span class="java_plain">&nbsp;stilton&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">new</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">Cheese</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_literal">&quot;stilton&quot;</span><!-- <br/> --><span class="java_separator">);</span>
<!--  --><br/><span class="java_type">FactHandle</span><span class="java_plain">&nbsp;stiltonHandle&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;ksession</span><span class="java_separator">.</span><span class="java_plain">insert</span><span class="java_separator">(</span><span class="java_plain">&nbsp;stilton&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_separator">....</span>
<!--  --><br/><span class="java_plain">ksession</span><span class="java_separator">.</span><span class="java_plain">retract</span><span class="java_separator">(</span><span class="java_plain">&nbsp;stiltonHandle&nbsp;</span><span class="java_separator">);</span><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></pre></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h5 class="title"><a id="d0e2991"/>3.3.3.1.3. Update</h5></div></div></div><p>The Rule Engine must be notified of modified facts, so that they
        can be reprocessed. You must use the <code class="code">update()</code> method to
        notify the <code class="code">WorkingMemory</code> of changed objects for those
        objects that are not able to notify the <code class="code">WorkingMemory</code>
        themselves. Notice that <code class="code">update()</code> always takes the
        modified object as a second parameter, which allows you to specify new
        instances for immutable objects. On the right hand side of a rule the
        <code class="code">modify</code> statement is recommended, as it makes the
        changes and notifies the engine in a single statement. Alternatively,
        after changing a fact object's field values through calls of setter
        methods you must invoke <code class="code">update</code> immediately, event
        before changing another fact, or you will cause problems with the 
        indexing within the rule engine. The modify statement avoids this
        problem.</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">Cheese</span><!-- <br/> --><span class="java_plain">&nbsp;stilton&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">new</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">Cheese</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_literal">&quot;stilton&quot;</span><!-- <br/> --><span class="java_separator">);</span>
<!--  --><br/><span class="java_type">FactHandle</span><span class="java_plain">&nbsp;stiltonHandle&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;workingMemory</span><span class="java_separator">.</span><span class="java_plain">insert</span><span class="java_separator">(</span><span class="java_plain">&nbsp;stilton&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_separator">...</span>
<!--  --><br/><span class="java_plain">stilton</span><span class="java_separator">.</span><span class="java_plain">setPrice</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">100</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">workingMemory</span><span class="java_separator">.</span><span class="java_plain">update</span><span class="java_separator">(</span><span class="java_plain">&nbsp;stiltonHandle</span><span class="java_separator">,</span><span class="java_plain">&nbsp;stilton&nbsp;</span><span class="java_separator">);</span><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></pre></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e3016"/>3.3.3.2. WorkingMemory</h4></div></div></div><p>The WorkingMemory provides access to the Agenda, permits query
      executions, and lets you access named Entry Points.</p><div class="figure"><a id="d0e3021"/><div class="figure-contents"><div class="mediaobject"><img src="images/Chapter-User_Guide/WorkingMemory.png" alt="WorkingMemory"/></div></div><p class="title"><b>Figure 3.11. WorkingMemory</b></p></div><br class="figure-break"/><div class="section" lang="en-US"><div class="titlepage"><div><div><h5 class="title"><a id="d0e3027"/>3.3.3.2.1. Query</h5></div></div></div><p>Queries are used to retrieve fact sets based on patterns, as
        they are used in rules. Patterns may make use of optional parameters.
        Queries can be defined in the Knowledge Base, from where they are
        called up to return the matching results. While iterating over the
        result collection, any identifier bound in the query can be used to
        access the corresponding fact or fact field by calling the
        <code class="code">get</code> method with the binding variable's name as its
        argument. If the binding refers to a fact object, its FactHandle can
        be retrieved by calling <code class="code">getFactHandle</code>, again with the
        variable's name as the parameter.</p><div class="figure"><a id="d0e3038"/><div class="figure-contents"><div class="mediaobject"><img src="images/Chapter-User_Guide/QueryResults.png" alt="QueryResults"/></div></div><p class="title"><b>Figure 3.12. QueryResults</b></p></div><br class="figure-break"/><div class="figure"><a id="d0e3044"/><div class="figure-contents"><div class="mediaobject"><img src="images/Chapter-User_Guide/QueryResultsRow.png" alt="QueryResultsRow"/></div></div><p class="title"><b>Figure 3.13. QueryResultsRow</b></p></div><br class="figure-break"/><div class="example"><a id="d0e3050"/><p class="title"><b>Example 3.31. Simple Query Example</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">QueryResults</span><!-- <br/> --><span class="java_plain">&nbsp;results&nbsp;</span><!-- <br/> --><span class="java_operator">=</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;ksession</span><span class="java_separator">.</span><span class="java_plain">getQueryResults</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;my&nbsp;query&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">Object</span><span class="java_separator">[]</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;string&quot;</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_keyword">for</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_type">QueryResultsRow</span><span class="java_plain">&nbsp;row&nbsp;</span><span class="java_operator">:</span><span class="java_plain">&nbsp;results&nbsp;</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">System</span><span class="java_separator">.</span><span class="java_plain">out</span><span class="java_separator">.</span><span class="java_plain">println</span><span class="java_separator">(</span><span class="java_plain">&nbsp;row</span><span class="java_separator">.</span><span class="java_plain">get</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;varName&quot;</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_separator">}</span></pre></div></div><br class="example-break"/></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h5 class="title"><a id="d0e3055"/>3.3.3.2.2. Live Queries</h5></div></div></div><p>Invoking queries and processing the results by iterating over
        the returned set is not a good way to monitor changes over
        time.</p><p>To alleviate this, Drools provides Live Queries, which have a
        listener attached instead of returning an iterable result set. These
        live queries stay open by creating a view and publishing change events for
        the contents of this view. To activate, you start your query with
        parameters and listen to changes in the resulting view. The
        <code class="code">dispose</code> method terminates the query and discontinues this
        reactive scenario.</p><div class="example"><a id="d0e3065"/><p class="title"><b>Example 3.32. Implementing ViewChangedEventListener</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">final</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">List</span><!-- <br/> --><span class="java_plain">&nbsp;updated&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">new</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">ArrayList</span><!-- <br/> --><span class="java_separator">();</span>
<!--  --><br/><span class="java_keyword">final</span><span class="java_plain">&nbsp;</span><span class="java_type">List</span><span class="java_plain">&nbsp;removed&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">ArrayList</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_keyword">final</span><span class="java_plain">&nbsp;</span><span class="java_type">List</span><span class="java_plain">&nbsp;added&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">ArrayList</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_type">ViewChangedEventListener</span><span class="java_plain">&nbsp;listener&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">ViewChangedEventListener</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;rowUpdated</span><span class="java_separator">(</span><span class="java_type">Row</span><span class="java_plain">&nbsp;row</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;updated</span><span class="java_separator">.</span><span class="java_plain">add</span><span class="java_separator">(</span><span class="java_plain">&nbsp;row</span><span class="java_separator">.</span><span class="java_plain">get</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;$price&quot;</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;rowRemoved</span><span class="java_separator">(</span><span class="java_type">Row</span><span class="java_plain">&nbsp;row</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;removed</span><span class="java_separator">.</span><span class="java_plain">add</span><span class="java_separator">(</span><span class="java_plain">&nbsp;row</span><span class="java_separator">.</span><span class="java_plain">get</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;$price&quot;</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;rowAdded</span><span class="java_separator">(</span><span class="java_type">Row</span><span class="java_plain">&nbsp;row</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;added</span><span class="java_separator">.</span><span class="java_plain">add</span><span class="java_separator">(</span><span class="java_plain">&nbsp;row</span><span class="java_separator">.</span><span class="java_plain">get</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;$price&quot;</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_separator">};</span><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_plain">&nbsp;</span><span class="java_type">Open</span><span class="java_plain">&nbsp;the&nbsp;</span><span class="java_type">LiveQuery</span>
<!--  --><br/><span class="java_type">LiveQuery</span><span class="java_plain">&nbsp;query&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;ksession</span><span class="java_separator">.</span><span class="java_plain">openLiveQuery</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;cheeses&quot;</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">Object</span><span class="java_separator">[]</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;cheddar&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;stilton&quot;</span><span class="java_plain">&nbsp;</span><span class="java_separator">},</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;listener&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">...</span>
<!--  --><br/><span class="java_plain">query</span><span class="java_separator">.</span><span class="java_plain">dispose</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;calling&nbsp;dispose&nbsp;to&nbsp;terminate&nbsp;the&nbsp;live&nbsp;query</span></pre></div></div><br class="example-break"/><p>A Drools blog article contains an example of Glazed Lists
        integration for live queries:</p><p><a class="link" href="http://blog.athico.com/2010/07/glazed-lists-examples-for-drools-live.html" target="">http://blog.athico.com/2010/07/glazed-lists-examples-for-drools-live.html</a></p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e3075"/>3.3.3.3. KnowledgeRuntime</h4></div></div></div><p>The <code class="code">KnowledgeRuntime</code> provides further methods that
      are applicable to both rules and processes, such as setting globals and
      registering channels. ("Exit point" is an obsolete synonym for "channel".)</p><div class="figure"><a id="d0e3083"/><div class="figure-contents"><div class="mediaobject"><img src="images/Chapter-User_Guide/KnowledgeRuntime.png" alt="KnowledgeRuntime"/></div></div><p class="title"><b>Figure 3.14. KnowledgeRuntime</b></p></div><br class="figure-break"/><div class="section" lang="en-US"><div class="titlepage"><div><div><h5 class="title"><a id="d0e3089"/>3.3.3.3.1. Globals</h5></div></div></div><p>Globals are named objects that are made visible to the rule engine,
        but in a way that is fundamentally different from the one for facts:
        changes in the object backing a global do not trigger reevaluation of
        rules. Still, globals are useful for providing static information, 
        as an object offering services that are used in the RHS of a rule, or
        as a means to return objects from the rule engine. When you use
        a global on the LHS of a rule, make sure it is immutable, or, at least,
        don't expect changes to have any effect on the behavior of your rules.</p><p>A global must be declared in a rules file, and then it needs to be 
        backed up with a Java object.</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">global java.util.List list</pre><p>With the Knowledge Base now aware of the global identifier and
        its type, it is now possible to call <code class="code">ksession.setGlobal()</code>
        with the global's name and an object, for any session, to associate
        the object with the global. Failure to declare the global type and 
        identifier in DRL code will result in an exception being thrown from
        this call.</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">List</span><!-- <br/> --><span class="java_plain">&nbsp;list&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">new</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">ArrayList</span><!-- <br/> --><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">ksession</span><span class="java_separator">.</span><span class="java_plain">setGlobal</span><span class="java_separator">(</span><span class="java_literal">&quot;list&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;list</span><span class="java_separator">);</span><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></pre><p>Make sure to set any global before it is used in the evaluation
        of a rule. Failure to do so results in a <code class="code">NullPointerException</code>.</p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e3110"/>3.3.3.4. StatefulRuleSession</h4></div></div></div><p>The <code class="code">StatefulRuleSession</code> is inherited by the
      <code class="code">StatefulKnowledgeSession</code> and provides the rule related
      methods that are relevant from outside of the engine.</p><div class="figure"><a id="d0e3121"/><div class="figure-contents"><div class="mediaobject"><img src="images/Chapter-User_Guide/StatefulRuleSession.png" alt="StatefulRuleSession"/></div></div><p class="title"><b>Figure 3.15. StatefulRuleSession</b></p></div><br class="figure-break"/><div class="section" lang="en-US"><div class="titlepage"><div><div><h5 class="title"><a id="d0e3127"/>3.3.3.4.1. Agenda Filters</h5></div></div></div><div class="figure"><a id="d0e3130"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-User_Guide/AgendaFilter.png" align="middle" alt="AgendaFilters"/></div></div><p class="title"><b>Figure 3.16. AgendaFilters</b></p></div><br class="figure-break"/><p><code class="code">AgendaFilter</code> objects are optional implementations
        of the filter interface which are used to allow or deny the firing of
        an activation. What you filter on is entirely up to the
        implementation. Drools 4.0 used to supply some out of the box filters,
        which have not be exposed in drools 5.0 knowledge-api, but they are
        simple to implement and the Drools 4.0 code base can be referred
        to.</p><p>To use a filter specify it while calling
        <code class="code">fireAllRules()</code>. The following example permits only rules
        ending in the string <code class="code">"Test"</code>. All others will be filtered
        out.</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">ksession</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">fireAllRules</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">new</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">RuleNameEndsWithAgendaFilter</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_literal">&quot;Test&quot;</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">)</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">);</span></pre></div></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e3150"/>3.3.4. Agenda</h3></div></div></div><p>The Agenda is a <span class="emphasis"><em>Rete</em></span> feature. During actions on
    the <code class="code">WorkingMemory</code>, rules may become fully matched and
    eligible for execution; a single Working Memory Action can result in
    multiple eligible rules. When a rule is fully matched an Activation is
    created, referencing the rule and the matched facts, and placed onto the
    Agenda. The Agenda controls the execution order of these Activations using
    a Conflict Resolution strategy.</p><p>The engine cycles repeatedly through two phases:</p><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="orderedlist"><ol><li><p>Working Memory Actions. This is where most of the work takes
        place, either in the Consequence (the RHS itself) or the main Java
        application process. Once the Consequence has finished or the main
        Java application process calls <code class="code">fireAllRules()</code> the engine
        switches to the Agenda Evaluation phase.</p></li><li><p>Agenda Evaluation. This attempts to select a rule to fire. If no
        rule is found it exits, otherwise it fires the found rule, switching
        the phase back to Working Memory Actions.</p></li></ol></div><div class="figure"><a id="d0e3173"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Rule_Engine/Two_Phase.png" align="middle" alt="Two Phase Execution"/></div></div><p class="title"><b>Figure 3.17. Two Phase Execution</b></p></div><br class="figure-break"/><p>The process repeats until the agenda is clear, in which case control
    returns to the calling application. When Working Memory Actions are taking
    place, no rules are being fired.</p><div class="figure"><a id="d0e3181"/><div class="figure-contents"><div class="mediaobject"><img src="images/Chapter-User_Guide/Agenda.png" alt="Agenda"/></div></div><p class="title"><b>Figure 3.18. Agenda</b></p></div><br class="figure-break"/><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e3187"/>3.3.4.1. Conflict Resolution</h4></div></div></div><p>Conflict resolution is required when there are multiple rules on
      the agenda. (The basics to this are covered in chapter "Quick Start".)
      As firing a rule may have side effects on the working memory, the rule
      engine needs to know in what order the rules should fire (for instance,
      firing ruleA may cause ruleB to be removed from the agenda).</p><p>The default conflict resolution strategies employed by Drools are:
      Salience and LIFO (last in, first out).</p><p>The most visible one is <span class="emphasis"><em>salience</em></span> (or
      priority), in which case a user can specify that a certain rule has a
      higher priority (by giving it a higher number) than other rules. In that
      case, the rule with higher salience will be preferred. LIFO priorities
      are based on the assigned Working Memory Action counter value, with all
      rules created during the same action receiving the same value. The
      execution order of a set of firings with the same priority value is
      arbitrary.</p><p>As a general rule, it is a good idea not to count on rules firing
      in any particular order, and to author the rules without worrying about
      a "flow". However when a flow is needed a number of possibilities exist,
      including but not limited to: agenda groups, rule flow groups,
      activation groups, control/semaphore facts. These are discussed in later
      sections.</p><p>Drools 4.0 supported custom conflict resolution strategies; while
      this capability still exists in Drools it has not yet been exposed to
      the end user via knowledge-api in Drools 5.0.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e3203"/>3.3.4.2. AgendaGroup</h4></div></div></div><div class="figure"><a id="d0e3206"/><div class="figure-contents"><div class="mediaobject"><img src="images/Chapter-User_Guide/AgendaGroup.png" alt="AgendaGroup"/></div></div><p class="title"><b>Figure 3.19. AgendaGroup</b></p></div><br class="figure-break"/><p>Agenda groups are a way to partition rules (activations, actually)
      on the agenda. At any one time, only one group has "focus" which means
      that activations for rules in that group only will take effect. You can
      also have rules with "auto focus" which means that the focus is taken
      for its agenda group when that rule's conditions are true.</p><p>Agenda groups are known as "modules" in CLIPS terminology. While
      it best to design rules that do not need control flow, this is not
      always possible. Agenda groups provide a handy way to create a "flow"
      between grouped rules. You can switch the group which has focus either
      from within the rule engine, or via the API. If your rules have a clear
      need for multiple "phases" or "sequences" of processing, consider using
      agenda-groups for this purpose.</p><p>Each time <code class="code">setFocus()</code> is called it pushes that Agenda
      Group onto a stack. When the focus group is empty it is popped from the
      stack and the focus group that is now on top evaluates. An Agenda Group
      can appear in multiple locations on the stack. The default Agenda Group
      is "MAIN", with all rules which do not specify an Agenda Group being in
      this group. It is also always the first group on the stack, given focus
      initially, by default.</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">ksession</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">getAgenda</span><!-- <br/> --><span class="java_separator">().</span><!-- <br/> --><span class="java_plain">getAgendaGroup</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_literal">&quot;Group&nbsp;A&quot;</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">).</span><!-- <br/> --><span class="java_plain">setFocus</span><!-- <br/> --><span class="java_separator">();</span></pre></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e3223"/>3.3.4.3. ActivationGroup</h4></div></div></div><div class="figure"><a id="d0e3226"/><div class="figure-contents"><div class="mediaobject"><img src="images/Chapter-User_Guide/ActivationGroup.png" alt="ActivationGroup"/></div></div><p class="title"><b>Figure 3.20. ActivationGroup</b></p></div><br class="figure-break"/><p>An activation group is a set of rules bound together by the same
      "activation-group" rule attribute. In this group only one rule can fire,
      and after that rule has fired all the other rules are cancelled from the
      agenda. The <code class="code">clear()</code> method can be called at any time, which
      cancels all of the activations before one has had a chance to
      fire.</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">ksession</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">getAgenda</span><!-- <br/> --><span class="java_separator">().</span><!-- <br/> --><span class="java_plain">getActivationGroup</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_literal">&quot;Group&nbsp;B&quot;</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">).</span><!-- <br/> --><span class="java_plain">clear</span><!-- <br/> --><span class="java_separator">();</span></pre></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e3239"/>3.3.4.4. RuleFlowGroup</h4></div></div></div><div class="figure"><a id="d0e3242"/><div class="figure-contents"><div class="mediaobject"><img src="images/Chapter-User_Guide/RuleFlowGroup.png" alt="RuleFlowGroup"/></div></div><p class="title"><b>Figure 3.21. RuleFlowGroup</b></p></div><br class="figure-break"/><p>A rule flow group is a group of rules associated by the
      "ruleflow-group" rule attribute. These rules can only fire when the
      group is activate. The group itself can only become active when the
      elaboration of the ruleflow diagram reaches the node representing the
      group. Here too, the <code class="code">clear()</code> method can be called at any
      time to cancels all activations still remaining on the Agenda.</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">ksession</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">getAgenda</span><!-- <br/> --><span class="java_separator">().</span><!-- <br/> --><span class="java_plain">getRuleFlowGroup</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_literal">&quot;Group&nbsp;C&quot;</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">).</span><!-- <br/> --><span class="java_plain">clear</span><!-- <br/> --><span class="java_separator">();</span></pre></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e3255"/>3.3.5. Event Model</h3></div></div></div><p>The event package provides means to be notified of rule engine
    events, including rules firing, objects being asserted, etc. This allows
    you, for instance, to separate logging and auditing activities from the
    main part of your application (and the rules).</p><p>The <code class="code">KnowlegeRuntimeEventManager</code> interface is
    implemented by the <code class="code">KnowledgeRuntime</code> which provides two
    interfaces, <code class="code">WorkingMemoryEventManager</code> and
    <code class="code">ProcessEventManager</code>. We will only cover the
    <code class="code">WorkingMemoryEventManager</code> here.</p><div class="figure"><a id="d0e3277"/><div class="figure-contents"><div class="mediaobject"><img src="images/Chapter-User_Guide/KnowledgeRuntimeEventManager.png" alt="KnowledgeRuntimeEventManager"/></div></div><p class="title"><b>Figure 3.22. KnowledgeRuntimeEventManager</b></p></div><br class="figure-break"/><p>The <code class="code">WorkingMemoryEventManager</code> allows for listeners to
    be added and removed, so that events for the working memory and the agenda
    can be listened to.</p><div class="figure"><a id="d0e3288"/><div class="figure-contents"><div class="mediaobject"><img src="images/Chapter-User_Guide/WorkingMemoryEventManager.png" alt="WorkingMemoryEventManager"/></div></div><p class="title"><b>Figure 3.23. WorkingMemoryEventManager</b></p></div><br class="figure-break"/><p>The following code snippet shows how a simple agenda listener is
    declared and attached to a session. It will print activations after they
    have fired.</p><div class="example"><a id="d0e3296"/><p class="title"><b>Example 3.33. Adding an AgendaEventListener</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">ksession</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">addEventListener</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">new</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">DefaultAgendaEventListener</span><!-- <br/> --><span class="java_separator">()</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;afterActivationFired</span><span class="java_separator">(</span><span class="java_type">AfterActivationFiredEvent</span><span class="java_plain">&nbsp;event</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">super</span><span class="java_separator">.</span><span class="java_plain">afterActivationFired</span><span class="java_separator">(</span><span class="java_plain">&nbsp;event&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">System</span><span class="java_separator">.</span><span class="java_plain">out</span><span class="java_separator">.</span><span class="java_plain">println</span><span class="java_separator">(</span><span class="java_plain">&nbsp;event&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_separator">});</span><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></pre></div></div><br class="example-break"/><p>Drools also provides <code class="code">DebugWorkingMemoryEventListener</code>
    and <code class="code">DebugAgendaEventListener</code> which implement each method with
    a debug print statement. To print all Working Memory events, you add a
    listener like this:</p><div class="example"><a id="d0e3309"/><p class="title"><b>Example 3.34. Creating a new KnowledgeBuilder</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">ksession</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">addEventListener</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">new</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">DebugWorkingMemoryEventListener</span><!-- <br/> --><span class="java_separator">()</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">);</span><!-- <br/> --><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></pre></div></div><br class="example-break"/><p>All emitted events implement the <code class="code">KnowlegeRuntimeEvent</code>
    interface which can be used to retrieve the actual
    <code class="code">KnowlegeRuntime</code> the event originated from.</p><div class="figure"><a id="d0e3322"/><div class="figure-contents"><div class="mediaobject"><img src="images/Chapter-User_Guide/KnowledgeRuntimeEvent.png" alt="KnowlegeRuntimeEvent"/></div></div><p class="title"><b>Figure 3.24. KnowlegeRuntimeEvent</b></p></div><br class="figure-break"/><p>The events currently supported are:</p><div class="itemizedlist"><ul><li><p>ActivationCreatedEvent</p></li><li><p>ActivationCancelledEvent</p></li><li><p>BeforeActivationFiredEvent</p></li><li><p>AfterActivationFiredEvent</p></li><li><p>AgendaGroupPushedEvent</p></li><li><p>AgendaGroupPoppedEvent</p></li><li><p>ObjectInsertEvent</p></li><li><p>ObjectRetractedEvent</p></li><li><p>ObjectUpdatedEvent</p></li><li><p>ProcessCompletedEvent</p></li><li><p>ProcessNodeLeftEvent</p></li><li><p>ProcessNodeTriggeredEvent</p></li><li><p>ProcessStartEvent</p></li></ul></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e3370"/>3.3.6. KnowledgeRuntimeLogger</h3></div></div></div><p>The KnowledgeRuntimeLogger uses the comprehensive event system in
    Drools to create an audit log that can be used to log the execution of an
    application for later inspection, using tools such as the Eclipse audit
    viewer.</p><div class="figure"><a id="d0e3375"/><div class="figure-contents"><div class="mediaobject"><img src="images/Chapter-User_Guide/KnowledgeRuntimeLoggerFactory.png" alt="KnowledgeRuntimeLoggerFactory"/></div></div><p class="title"><b>Figure 3.25. KnowledgeRuntimeLoggerFactory</b></p></div><br class="figure-break"/><div class="example"><a id="d0e3381"/><p class="title"><b>Example 3.35. FileLogger</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">KnowledgeRuntimeLogger</span><!-- <br/> --><span class="java_plain">&nbsp;logger&nbsp;</span><!-- <br/> --><span class="java_operator">=</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_type">KnowledgeRuntimeLoggerFactory</span><span class="java_separator">.</span><span class="java_plain">newFileLogger</span><span class="java_separator">(</span><span class="java_plain">ksession</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;logdir/mylogfile&quot;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_separator">...</span>
<!--  --><br/><span class="java_plain">logger</span><span class="java_separator">.</span><span class="java_plain">close</span><span class="java_separator">();</span></pre></div></div><br class="example-break"/></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e3386"/>3.3.7. StatelessKnowledgeSession</h3></div></div></div><p>The <code class="code">StatelessKnowledgeSession</code> wraps the
    <code class="code">StatefulKnowledgeSession</code>, instead of extending it. Its main
    focus is on decision service type scenarios. It avoids the need to call
    <code class="code">dispose()</code>. Stateless sessions do not support iterative
    insertions and the method call <code class="code">fireAllRules()</code> from Java code;
    the act of calling <code class="code">execute()</code> is a single-shot method that
    will internally instantiate a <code class="code">StatefulKnowledgeSession</code>, add
    all the user data and execute user commands, call
    <code class="code">fireAllRules()</code>, and then call <code class="code">dispose()</code>. While
    the main way to work with this class is via the
    <code class="code">BatchExecution</code> (a subinterface of <code class="code">Command</code>) as
    supported by the <code class="code">CommandExecutor</code> interface, two convenience
    methods are provided for when simple object insertion is all that's
    required. The <code class="code">CommandExecutor</code> and <code class="code">BatchExecution</code>
    are talked about in detail in their own section.</p><div class="figure"><a id="d0e3430"/><div class="figure-contents"><div class="mediaobject"><img src="images/Chapter-User_Guide/StatelessKnowledgeSession.png" alt="StatelessKnowledgeSession"/></div></div><p class="title"><b>Figure 3.26. StatelessKnowledgeSession</b></p></div><br class="figure-break"/><p>Our simple example shows a stateless session executing a given
    collection of Java objects using the convenience API. It will iterate the
    collection, inserting each element in turn.</p><div class="example"><a id="d0e3438"/><p class="title"><b>Example 3.36. Simple StatelessKnowledgeSession execution with a
      Collection</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">KnowledgeBuilder</span><!-- <br/> --><span class="java_plain">&nbsp;kbuilder&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">KnowledgeBuilderFactory</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">newKnowledgeBuilder</span><!-- <br/> --><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">kbuilder</span><span class="java_separator">.</span><span class="java_plain">add</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_type">ResourceFactory</span><span class="java_separator">.</span><span class="java_plain">newFileSystemResource</span><span class="java_separator">(</span><span class="java_plain">&nbsp;fileName&nbsp;</span><span class="java_separator">),</span><span class="java_plain">&nbsp;</span><span class="java_type">ResourceType</span><span class="java_separator">.</span><span class="java_plain">DRL&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_keyword">if</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_plain">kbuilder</span><span class="java_separator">.</span><span class="java_plain">hasErrors</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">System</span><span class="java_separator">.</span><span class="java_plain">out</span><span class="java_separator">.</span><span class="java_plain">println</span><span class="java_separator">(</span><span class="java_plain">&nbsp;kbuilder</span><span class="java_separator">.</span><span class="java_plain">getErrors</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_separator">}</span><span class="java_plain">&nbsp;</span><span class="java_keyword">else</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">KnowledgeBase</span><span class="java_plain">&nbsp;kbase&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">KnowledgeBaseFactory</span><span class="java_separator">.</span><span class="java_plain">newKnowledgeBase</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;kbase</span><span class="java_separator">.</span><span class="java_plain">addKnowledgePackages</span><span class="java_separator">(</span><span class="java_plain">&nbsp;kbuilder</span><span class="java_separator">.</span><span class="java_plain">getKnowledgePackages</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">StatelessKnowledgeSession</span><span class="java_plain">&nbsp;ksession&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;kbase</span><span class="java_separator">.</span><span class="java_plain">newStatelessKnowledgeSession</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;ksession</span><span class="java_separator">.</span><span class="java_plain">execute</span><span class="java_separator">(</span><span class="java_plain">&nbsp;collection&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_separator">}</span></pre></div></div><br class="example-break"/><p>If this was done as a single Command it would be as follows:</p><div class="example"><a id="d0e3445"/><p class="title"><b>Example 3.37. Simple StatelessKnowledgeSession execution with InsertElements
      Command</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">ksession</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">execute</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">CommandFactory</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">newInsertElements</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_plain">&nbsp;collection&nbsp;</span><!-- <br/> --><span class="java_separator">)</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">);</span><!-- <br/> --><span class="java_plain">&nbsp;&nbsp;</span></pre></div></div><br class="example-break"/><p>If you wanted to insert the collection itself, and the collection's
    individual elements, then
    <code class="code">CommandFactory.newInsert(collection)</code> would do the job.</p><p>Methods of the <code class="code">CommandFactory</code> create the supported
    commands, all of which can be marshalled using XStream and the
    <code class="code">BatchExecutionHelper</code>. <code class="code">BatchExecutionHelper</code>
    provides details on the XML format as well as how to use Drools Pipeline
    to automate the marshalling of <code class="code">BatchExecution</code> and
    <code class="code">ExecutionResults</code>.</p><p><code class="code">StatelessKnowledgeSession</code> supports globals, scoped in a
    number of ways. I'll cover the non-command way first, as commands are
    scoped to a specific execution call. Globals can be resolved in three
    ways.</p><div class="itemizedlist"><ul><li><p>The Stateless Knowledge Session method <code class="code">getGlobals()</code>
        returns a Globals instance which provides access to the session's
        globals. These are shared for <span class="emphasis"><em>all</em></span> execution
        calls. Exercise caution regarding mutable globals because execution
        calls can be executing simultaneously in different threads.</p><div class="example"><a id="d0e3486"/><p class="title"><b>Example 3.38. Session scoped global</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">StatelessKnowledgeSession</span><!-- <br/> --><span class="java_plain">&nbsp;ksession&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;kbase</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">newStatelessKnowledgeSession</span><!-- <br/> --><span class="java_separator">();</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_plain">&nbsp;</span><span class="java_type">Set</span><span class="java_plain">&nbsp;a&nbsp;global&nbsp;hbnSession</span><span class="java_separator">,</span><span class="java_plain">&nbsp;that&nbsp;can&nbsp;be&nbsp;used&nbsp;</span><span class="java_keyword">for</span><span class="java_plain">&nbsp;DB&nbsp;interactions&nbsp;in&nbsp;the&nbsp;rules</span><span class="java_separator">.</span>
<!--  --><br/><span class="java_plain">ksession</span><span class="java_separator">.</span><span class="java_plain">setGlobal</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;hbnSession&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;hibernateSession&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_plain">&nbsp;</span><span class="java_type">Execute</span><span class="java_plain">&nbsp;</span><span class="java_keyword">while</span><span class="java_plain">&nbsp;being&nbsp;able&nbsp;to&nbsp;resolve&nbsp;the&nbsp;</span><span class="java_literal">&quot;hbnSession&quot;</span><span class="java_plain">&nbsp;identifier</span><span class="java_separator">.</span><span class="java_plain">&nbsp;&nbsp;</span>
<!--  --><br/><span class="java_plain">ksession</span><span class="java_separator">.</span><span class="java_plain">execute</span><span class="java_separator">(</span><span class="java_plain">&nbsp;collection&nbsp;</span><span class="java_separator">);</span><span class="java_plain">&nbsp;</span></pre></div></div><br class="example-break"/></li><li><p>Using a delegate is another way of global resolution. Assigning
        a value to a global (with <code class="code">setGlobal(String, Object)</code>)
        results in the value being stored in an internal collection mapping
        identifiers to values. Identifiers in this internal collection will
        have priority over any supplied delegate. Only if an identifier cannot
        be found in this internal collection, the delegate global (if any)
        will be used.</p></li><li><p>The third way of resolving globals is to have execution scoped
        globals. Here, a <code class="code">Command</code> to set a global is passed to the
        <code class="code">CommandExecutor</code>.</p></li></ul></div><p>The <code class="code">CommandExecutor</code> interface also offers the ability
    to export data via "out" parameters. Inserted facts, globals and query
    results can all be returned.</p><div class="example"><a id="d0e3511"/><p class="title"><b>Example 3.39. Out identifiers</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_operator">//</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">Set</span><!-- <br/> --><span class="java_plain">&nbsp;up&nbsp;a&nbsp;list&nbsp;of&nbsp;commands</span>
<!--  --><br/><span class="java_type">List</span><span class="java_plain">&nbsp;cmds&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">ArrayList</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">cmds</span><span class="java_separator">.</span><span class="java_plain">add</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_type">CommandFactory</span><span class="java_separator">.</span><span class="java_plain">newSetGlobal</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;list1&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">ArrayList</span><span class="java_separator">(),</span><span class="java_plain">&nbsp;</span><span class="java_literal">true</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">cmds</span><span class="java_separator">.</span><span class="java_plain">add</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_type">CommandFactory</span><span class="java_separator">.</span><span class="java_plain">newInsert</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">Person</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;jon&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_literal">102</span><span class="java_plain">&nbsp;</span><span class="java_separator">),</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;person&quot;</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">cmds</span><span class="java_separator">.</span><span class="java_plain">add</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_type">CommandFactory</span><span class="java_separator">.</span><span class="java_plain">newQuery</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;Get&nbsp;People&quot;</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;getPeople&quot;</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_plain">&nbsp;</span><span class="java_type">Execute</span><span class="java_plain">&nbsp;the&nbsp;list</span>
<!--  --><br/><span class="java_type">ExecutionResults</span><span class="java_plain">&nbsp;results&nbsp;</span><span class="java_operator">=</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;ksession</span><span class="java_separator">.</span><span class="java_plain">execute</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_type">CommandFactory</span><span class="java_separator">.</span><span class="java_plain">newBatchExecution</span><span class="java_separator">(</span><span class="java_plain">&nbsp;cmds&nbsp;</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_plain">&nbsp;</span><span class="java_type">Retrieve</span><span class="java_plain">&nbsp;the&nbsp;</span><span class="java_type">ArrayList</span>
<!--  --><br/><span class="java_plain">results</span><span class="java_separator">.</span><span class="java_plain">getValue</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;list1&quot;</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_plain">&nbsp;</span><span class="java_type">Retrieve</span><span class="java_plain">&nbsp;the&nbsp;inserted&nbsp;</span><span class="java_type">Person</span><span class="java_plain">&nbsp;fact</span>
<!--  --><br/><span class="java_plain">results</span><span class="java_separator">.</span><span class="java_plain">getValue</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;person&quot;</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_plain">&nbsp;</span><span class="java_type">Retrieve</span><span class="java_plain">&nbsp;the&nbsp;query&nbsp;as&nbsp;a&nbsp;</span><span class="java_type">QueryResults</span><span class="java_plain">&nbsp;instance</span><span class="java_separator">.</span>
<!--  --><br/><span class="java_plain">results</span><span class="java_separator">.</span><span class="java_plain">getValue</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;Get&nbsp;People&quot;</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span></pre></div></div><br class="example-break"/><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e3516"/>3.3.7.1. Sequential Mode</h4></div></div></div><p>With Rete you have a stateful session where objects can be
      asserted and modified over time, and where rules can also be added and
      removed. Now what happens if we assume a stateless session, where after
      the initial data set no more data can be asserted or modified and rules
      cannot be added or removed? Certainly it won't be necessary to
      re-evaluate rules, and the engine will be able to operate in a
      simplified way.</p><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="orderedlist"><ol><li><p>Order the Rules by salience and position in the ruleset (by
          setting a sequence attribute on the rule terminal node).</p></li><li><p>Create an array, one element for each possible rule
          activation; element position indicates firing order.</p></li><li><p>Turn off all node memories, except the right-input Object
          memory.</p></li><li><p>Disconnect the Left Input Adapter Node propagation, and let
          the Object plus the Node be referenced in a Command object, which is
          added to a list on the Working Memory for later execution.</p></li><li><p>Assert all objects, and, when all assertions are finished and
          thus right-input node memories are populated, check the Command list
          and execute each in turn.</p></li><li><p>All resulting Activations should be placed in the array, based
          upon the determined sequence number of the Rule. Record the first
          and last populated elements, to reduce the iteration range.</p></li><li><p>Iterate the array of Activations, executing populated element
          in turn.</p></li><li><p>If we have a maximum number of allowed rule executions, we can
          exit our network evaluations early to fire all the rules in the
          array.</p></li></ol></div><p>The <code class="code">LeftInputAdapterNode</code> no longer creates a Tuple,
      adding the Object, and then propagate the Tuple – instead a Command
      object is created and added to a list in the Working Memory. This
      Command object holds a reference to the
      <code class="code">LeftInputAdapterNode</code> and the propagated object. This stops
      any left-input propagations at insertion time, so that we know that a
      right-input propagation will never need to attempt a join with the
      left-inputs (removing the need for left-input memory). All nodes have
      their memory turned off, including the left-input Tuple memory but
      excluding the right-input object memory, which means that the only node
      remembering an insertion propagation is the right-input object memory.
      Once all the assertions are finished and all right-input memories
      populated, we can then iterate the list of
      <code class="code">LeftInputAdatperNode</code> Command objects calling each in turn.
      They will propagate down the network attempting to join with the
      right-input objects, but they won't be remembered in the left input as
      we know there will be no further object assertions and thus propagations
      into the right-input memory.</p><p>There is no longer an Agenda, with a priority queue to schedule
      the Tuples; instead, there is simply an array for the number of rules.
      The sequence number of the <code class="code">RuleTerminalNode</code> indicates the
      element within the array where to place the Activation. Once all Command
      objects have finished we can iterate our array, checking each element in
      turn, and firing the Activations if they exist. To improve performance,
      we remember the first and the last populated cell in the array. The
      network is constructed, with each <code class="code">RuleTerminalNode</code> being
      given a sequence number based on a salience number and its order of
      being added to the network.</p><p>Typically the right-input node memories are Hash Maps, for fast
      object retraction; here, as we know there will be no object retractions,
      we can use a list when the values of the object are not indexed. For
      larger numbers of objects indexed Hash Maps provide a performance
      increase; if we know an object type has only a few instances, indexing
      is probably not advantageous, and a list can be used.</p><p>Sequential mode can only be used with a Stateless Session and is
      off by default. To turn it on, either call
      <code class="code">RuleBaseConfiguration.setSequential(true)</code>, or set the
      rulebase configuration property <code class="code">drools.sequential</code> to true.
      Sequential mode can fall back to a dynamic agenda by calling
      <code class="code">setSequentialAgenda</code> with
      <code class="code">SequentialAgenda.DYNAMIC</code>. You may also set the
      "drools.sequential.agenda" property to "sequential" or "dynamic".</p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e3581"/>3.3.8. Commands and the CommandExecutor</h3></div></div></div><p>Drools has the concept of stateful or stateless sessions. We've
    already covered stateful sessions, which use the standard working memory
    that can be worked with iteratively over time. Stateless is a one-off
    execution of a working memory with a provided data set. It may return some
    results, with the session being disposed at the end, prohibiting further
    iterative interactions. You can think of stateless as treating a rule
    engine like a function call with optional return results.</p><p>In Drools 4 we supported these two paradigms but the way the user
    interacted with them was different. StatelessSession used an execute(...)
    method which would insert a collection of objects as facts.
    StatefulSession didn't have this method, and insert used the more
    traditional <code class="code">insert(...)</code> method. The other issue was that the
    StatelessSession did not return any results, so that users themselves had
    to map globals to get results, and it wasn't possible to do anything
    besides inserting objects; users could not start processes or execute
    queries.</p><p>Drools 5.0 addresses all of these issues and more. The foundation
    for this is the <code class="code">CommandExecutor</code> interface, which both the
    stateful and stateless interfaces extend, creating consistency and
    <code class="code">ExecutionResults</code>:</p><div class="figure"><a id="d0e3599"/><div class="figure-contents"><div class="mediaobject"><img src="images/Chapter-User_Guide/CommandExecutor.png" alt="CommandExecutor"/></div></div><p class="title"><b>Figure 3.27. CommandExecutor</b></p></div><br class="figure-break"/><div class="figure"><a id="d0e3605"/><div class="figure-contents"><div class="mediaobject"><img src="images/Chapter-User_Guide/ExecutionResults.png" alt="ExecutionResults"/></div></div><p class="title"><b>Figure 3.28. ExecutionResults</b></p></div><br class="figure-break"/><p>The <code class="code">CommandFactory</code> allows for commands to be executed
    on those sessions, the only difference being that the Stateless Knowledge
    Session executes <code class="code">fireAllRules()</code> at the end before disposing
    the session. The currently supported commands are:</p><div class="itemizedlist"><ul><li><p>FireAllRules</p></li><li><p>GetGlobal</p></li><li><p>SetGlobal</p></li><li><p>InsertObject</p></li><li><p>InsertElements</p></li><li><p>Query</p></li><li><p>StartProcess</p></li><li><p>BatchExecution</p></li></ul></div><p><code class="code">InsertObject</code> will insert a single object, with an
    optional "out" identifier. <code class="code">InsertElements</code> will iterate an
    Iterable, inserting each of the elements. What this means is that a
    Stateless Knowledge Session is no longer limited to just inserting
    objects, it can now start processes or execute queries, and do this in any
    order.</p><div class="example"><a id="d0e3651"/><p class="title"><b>Example 3.40. Insert Command</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">StatelessKnowledgeSession</span><!-- <br/> --><span class="java_plain">&nbsp;ksession&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;kbase</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">newStatelessKnowledgeSession</span><!-- <br/> --><span class="java_separator">();</span>
<!--  --><br/><span class="java_type">ExecutionResults</span><span class="java_plain">&nbsp;bresults&nbsp;</span><span class="java_operator">=</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;ksession</span><span class="java_separator">.</span><span class="java_plain">execute</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_type">CommandFactory</span><span class="java_separator">.</span><span class="java_plain">newInsert</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">Cheese</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;stilton&quot;</span><span class="java_plain">&nbsp;</span><span class="java_separator">),</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;stilton_id&quot;</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_type">Stilton</span><span class="java_plain">&nbsp;stilton&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;bresults</span><span class="java_separator">.</span><span class="java_plain">getValue</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;stilton_id&quot;</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
</pre></div></div><br class="example-break"/><p>The execute method always returns an <code class="code">ExecutionResults</code>
    instance, which allows access to any command results if they specify an
    out identifier such as the "stilton_id" above.</p><div class="example"><a id="d0e3661"/><p class="title"><b>Example 3.41. InsertElements Command</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">StatelessKnowledgeSession</span><!-- <br/> --><span class="java_plain">&nbsp;ksession&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;kbase</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">newStatelessKnowledgeSession</span><!-- <br/> --><span class="java_separator">();</span>
<!--  --><br/><span class="java_type">Command</span><span class="java_plain">&nbsp;cmd&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">CommandFactory</span><span class="java_separator">.</span><span class="java_plain">newInsertElements</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_type">Arrays</span><span class="java_separator">.</span><span class="java_plain">asList</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_type">Object</span><span class="java_separator">[]</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">Cheese</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;stilton&quot;</span><span class="java_plain">&nbsp;</span><span class="java_separator">),</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">Cheese</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;brie&quot;</span><span class="java_plain">&nbsp;</span><span class="java_separator">),</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">Cheese</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;cheddar&quot;</span><span class="java_plain">&nbsp;</span><span class="java_separator">),</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">});</span>
<!--  --><br/><span class="java_type">ExecutionResults</span><span class="java_plain">&nbsp;bresults&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;ksession</span><span class="java_separator">.</span><span class="java_plain">execute</span><span class="java_separator">(</span><span class="java_plain">&nbsp;cmd&nbsp;</span><span class="java_separator">);</span>
</pre></div></div><br class="example-break"/><p>The execute method only allows for a single command. That's where
    <code class="code">BatchExecution</code> comes in, which represents a composite
    command, created from a list of commands. Now, execute will iterate over
    the list and execute each command in turn. This means you can insert some
    objects, start a process, call fireAllRules and execute a query, all in a
    single <code class="code">execute(...)</code> call, which is quite powerful.</p><p>As mentioned previosly, the Stateless Knowledge Session will execute
    <code class="code">fireAllRules()</code> automatically at the end. However the
    keen-eyed reader probably has already noticed the
    <code class="code">FireAllRules</code> command and wondered how that works with a
    StatelessKnowledgeSession. The <code class="code">FireAllRules</code> command is
    allowed, and using it will disable the automatic execution at the end;
    think of using it as a sort of manual override function.</p><p>Commands support out identifiers. Any command that has an out
    identifier set on it will add its results to the returned ExecutionResults
    instance. Let's look at a simple example to see how this works.</p><div class="example"><a id="d0e3687"/><p class="title"><b>Example 3.42. BatchExecution Command</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">StatelessKnowledgeSession</span><!-- <br/> --><span class="java_plain">&nbsp;ksession&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;kbase</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">newStatelessKnowledgeSession</span><!-- <br/> --><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_type">List</span><span class="java_plain">&nbsp;cmds&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">ArrayList</span><span class="java_separator">();</span><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
<!--  --><br/><span class="java_plain">cmds</span><span class="java_separator">.</span><span class="java_plain">add</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_type">CommandFactory</span><span class="java_separator">.</span><span class="java_plain">newInsertObject</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">Cheese</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;stilton&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_literal">1</span><span class="java_separator">),</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;stilton&quot;</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">cmds</span><span class="java_separator">.</span><span class="java_plain">add</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_type">CommandFactory</span><span class="java_separator">.</span><span class="java_plain">newStartProcess</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;process&nbsp;cheeses&quot;</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">cmds</span><span class="java_separator">.</span><span class="java_plain">add</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_type">CommandFactory</span><span class="java_separator">.</span><span class="java_plain">newQuery</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;cheeses&quot;</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_type">ExecutionResults</span><span class="java_plain">&nbsp;bresults&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;ksession</span><span class="java_separator">.</span><span class="java_plain">execute</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_type">CommandFactory</span><span class="java_separator">.</span><span class="java_plain">newBatchExecution</span><span class="java_separator">(</span><span class="java_plain">&nbsp;cmds&nbsp;</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_type">Cheese</span><span class="java_plain">&nbsp;stilton&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_type">Cheese</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span><span class="java_plain">&nbsp;bresults</span><span class="java_separator">.</span><span class="java_plain">getValue</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;stilton&quot;</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_type">QueryResults</span><span class="java_plain">&nbsp;qresults&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_type">QueryResults</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span><span class="java_plain">&nbsp;bresults</span><span class="java_separator">.</span><span class="java_plain">getValue</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;cheeses&quot;</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
</pre></div></div><br class="example-break"/><p>In the above example multiple commands are executed, two of which
    populate the <code class="code">ExecutionResults</code>. The query command defaults to
    use the same identifier as the query name, but it can also be mapped to a
    different identifier.</p><p>A custom XStream marshaller can be used with the Drools Pipeline to
    achieve XML scripting, which is perfect for services. Here are two simple
    XML samples, one for the BatchExecution and one for the
    <code class="code">ExecutionResults</code>.</p><div class="example"><a id="d0e3702"/><p class="title"><b>Example 3.43. Simple BatchExecution XML</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">batch-execution</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">insert</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">out-identifier</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">'outStilton'</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">org.drools.Cheese</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">type</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">stilton</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">type</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">price</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">25</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">price</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">oldPrice</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">0</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">oldPrice</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">org.drools.Cheese</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">insert</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">batch-execution</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre></div></div><br class="example-break"/><div class="example"><a id="d0e3707"/><p class="title"><b>Example 3.44. Simple ExecutionResults XML</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">execution-results</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">result</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">identifier</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">'outStilton'</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">org.drools.Cheese</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">type</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">stilton</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">type</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">oldPrice</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">25</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">oldPrice</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">price</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">30</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">price</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">org.drools.Cheese</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">result</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">execution-results</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre></div></div><br class="example-break"/><p>Spring and Camel, covered in the integrations book, facilitate
    declarative services.</p><div class="example"><a id="d0e3714"/><p class="title"><b>Example 3.45. BatchExecution Marshalled to XML</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">batch-execution</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">insert</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">out-identifier</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;stilton&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">org.drools.Cheese</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">type</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">stilton</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">type</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">price</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">1</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">price</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">oldPrice</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">0</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">oldPrice</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">org.drools.Cheese</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">insert</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">query</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">out-identifier</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">'cheeses2'</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">'cheesesWithParams'</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">string</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">stilton</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">string</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">string</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">cheddar</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">string</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">query</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">batch-execution</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre></div></div><br class="example-break"/><p>The <code class="code">CommandExecutor</code> returns an
    <code class="code">ExecutionResults</code>, and this is handled by the pipeline code
    snippet as well. A similar output for the &lt;batch-execution&gt; XML
    sample above would be:</p><div class="example"><a id="d0e3727"/><p class="title"><b>Example 3.46. ExecutionResults Marshalled to XML</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">execution-results</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">result</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">identifier</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;stilton&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">org.drools.Cheese</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">type</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">stilton</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">type</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">price</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">2</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">price</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">org.drools.Cheese</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">result</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><br />
<span class="xml_plain">&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">result</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">identifier</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">'cheeses2'</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">query-results</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">identifiers</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">identifier</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">cheese</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">identifier</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">identifiers</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">row</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">org.drools.Cheese</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">type</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">cheddar</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">type</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">price</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">2</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">price</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">oldPrice</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">0</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">oldPrice</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">org.drools.Cheese</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">row</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">row</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">org.drools.Cheese</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">type</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">cheddar</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">type</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">price</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">1</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">price</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">oldPrice</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">0</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">oldPrice</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">org.drools.Cheese</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">row</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">query-results</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">result</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">execution-results</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre></div></div><br class="example-break"/><p>The <code class="code">BatchExecutionHelper</code> provides a configured XStream
    instance to support the marshalling of Batch Executions, where the
    resulting XML can be used as a message format, as shown above. Configured
    converters only exist for the commands supported via the Command Factory.
    The user may add other converters for their user objects. This is very
    useful for scripting stateless or stateful knowledge sessions, especially
    when services are involved.</p><p>There is currently no XML schema to support schema validation. The
    basic format is outlined here, and the drools-pipeline module has an
    illustrative unit test in the <code class="code">XStreamBatchExecutionTest</code> unit
    test. The root element is &lt;batch-execution&gt; and it can contain zero
    or more commands elements.</p><div class="example"><a id="d0e3742"/><p class="title"><b>Example 3.47. Root XML element</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">batch-execution</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">...</span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">batch-execution</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre></div></div><br class="example-break"/><p>This contains a list of elements that represent commands, the
    supported commands is limited to those Commands provided by the Command
    Factory. The most basic of these is the &lt;insert&gt; element, which
    inserts objects. The contents of the insert element is the user object, as
    dictated by XStream.</p><div class="example"><a id="d0e3749"/><p class="title"><b>Example 3.48. Insert</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">batch-execution</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">insert</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...</span><span class="xml_comment">&lt;!--&nbsp;any&nbsp;user&nbsp;object&nbsp;--&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">insert</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">batch-execution</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre></div></div><br class="example-break"/><p>The insert element features an "out-identifier" attribute, demanding
    that the inserted object will also be returned as part of the result
    payload.</p><div class="example"><a id="d0e3756"/><p class="title"><b>Example 3.49. Insert with Out Identifier Command</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">batch-execution</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">insert</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">out-identifier</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">'userVar'</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...</span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">insert</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">batch-execution</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre></div></div><br class="example-break"/><p>It's also possible to insert a collection of objects using the
    &lt;insert-elements&gt; element. This command does not support an
    out-identifier. The <code class="code">org.domain.UserClass</code> is just an
    illustrative user object that XStream would serialize.</p><div class="example"><a id="d0e3766"/><p class="title"><b>Example 3.50. Insert Elements command</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">batch-execution</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">insert-elements</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">org.domain.UserClass</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...</span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">org.domain.UserClass</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">org.domain.UserClass</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...</span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">org.domain.UserClass</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">org.domain.UserClass</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...</span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">org.domain.UserClass</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">insert-elements</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">batch-execution</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre></div></div><br class="example-break"/><p>Next, there is the <code class="code">&lt;set-global&gt;</code> element, which
    sets a global for the session.</p><div class="example"><a id="d0e3776"/><p class="title"><b>Example 3.51. Insert Elements command</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">batch-execution</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">set-global</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">identifier</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">'userVar'</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">org.domain.UserClass</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...</span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">org.domain.UserClass</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">set-global</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">batch-execution</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre></div></div><br class="example-break"/><p><code class="code">&lt;set-global&gt;</code> also supports two other optional
    attributes, <code class="literal">out</code> and <code class="literal">out-identifier</code>.
    A true value for the boolean <code class="literal">out</code> will add the global to
    the <code class="code">&lt;batch-execution-results&gt;</code> payload, using the name
    from the <code class="literal">identifier</code> attribute.
    <code class="literal">out-identifier</code> works like <code class="literal">out</code> but
    additionally allows you to override the identifier used in the
    <code class="code">&lt;batch-execution-results&gt;</code> payload.</p><div class="example"><a id="d0e3809"/><p class="title"><b>Example 3.52. Set Global Command</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">batch-execution</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">set-global</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">identifier</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">'userVar1'</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">out</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">'true'</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">org.domain.UserClass</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...</span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">org.domain.UserClass</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">set-global</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">set-global</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">identifier</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">'userVar2'</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">out-identifier</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">'alternativeUserVar2'</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">org.domain.UserClass</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...</span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">org.domain.UserClass</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">set-global</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">batch-execution</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre></div></div><br class="example-break"/><p>There is also a <code class="code">&lt;get-global&gt;</code> element, without
    contents, with just an <code class="literal">out-identifier</code> attribute. (There
    is no need for an <code class="literal">out</code> attribute because retrieving the
    value is the sole purpose of a <code class="code">&lt;get-global&gt;</code>
    element.</p><div class="example"><a id="d0e3828"/><p class="title"><b>Example 3.53. Get Global Command</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">batch-execution</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">get-global</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">identifier</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">'userVar1'</span><span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">get-global</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">identifier</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">'userVar2'</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">out-identifier</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">'alternativeUserVar2'</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">batch-execution</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre></div></div><br class="example-break"/><p>While the <code class="literal">out</code> attribute is useful in returning
    specific instances as a result payload, we often wish to run actual
    queries. Both parameter and parameterless queries are supported. The
    <code class="literal">name</code> attribute is the name of the query to be called,
    and the <code class="literal">out-identifier</code> is the identifier to be used for
    the query results in the <code class="code">&lt;execution-results&gt;</code>
    payload.</p><div class="example"><a id="d0e3847"/><p class="title"><b>Example 3.54. Query Command</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">batch-execution</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">query</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">out-identifier</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">'cheeses'</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">'cheeses'</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">query</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">out-identifier</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">'cheeses2'</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">'cheesesWithParams'</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">string</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">stilton</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">string</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">string</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">cheddar</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">string</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">query</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">batch-execution</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre></div></div><br class="example-break"/><p>The <code class="code">&lt;start-process&gt;</code> command accepts optional
    parameters. Other process related methods will be added later, like
    interacting with work items.</p><div class="example"><a id="d0e3857"/><p class="title"><b>Example 3.55. Start Process Command</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">batch-execution</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">startProcess</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">processId</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">'org.drools.actions'</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">parameter</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">identifier</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">'person'</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">org.drools.TestVariable</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">name</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">John&nbsp;Doe</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">name</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">org.drools.TestVariable</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">parameter</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">startProcess</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">batch-execution</span><span class="xml_plain"></span><br />
</pre></div></div><br class="example-break"/><div class="example"><a id="d0e3862"/><p class="title"><b>Example 3.56. Signal Event Command</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">signal-event</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">process-instance-id</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">'1'</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">event-type</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">'MyEvent'</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">string</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">MyValue</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">string</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">signal-event</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre></div></div><br class="example-break"/><div class="example"><a id="d0e3867"/><p class="title"><b>Example 3.57. Complete Work Item Command</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">complete-work-item</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">id</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">'&quot;&nbsp;+&nbsp;workItem.getId()&nbsp;+&nbsp;&quot;'</span><span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">result</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">identifier</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">'Result'</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">string</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">SomeOtherString</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">string</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">result</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">complete-work-item</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre></div></div><br class="example-break"/><div class="example"><a id="d0e3872"/><p class="title"><b>Example 3.58. Abort Work Item Command</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">abort-work-item</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">id</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">'21'</span><span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
</pre></div></div><br class="example-break"/><p>Support for more commands will be added over time.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e3879"/>3.3.9. Marshalling</h3></div></div></div><p>The <code class="code">MarshallerFactory</code> is used to marshal and unmarshal
    Stateful Knowledge Sessions.</p><div class="figure"><a id="d0e3887"/><div class="figure-contents"><div class="mediaobject"><img src="images/Chapter-User_Guide/MarshallerFactory.png" alt="MarshallerFactory"/></div></div><p class="title"><b>Figure 3.29. MarshallerFactory</b></p></div><br class="figure-break"/><p>At the simplest the <code class="code">MarshallerFactory</code> can be used as
    follows:</p><div class="example"><a id="d0e3898"/><p class="title"><b>Example 3.59. Simple Marshaller Example</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_operator">//</span><!-- <br/> --><span class="java_plain">&nbsp;ksession&nbsp;is&nbsp;the&nbsp;</span><!-- <br/> --><span class="java_type">StatefulKnowledgeSession</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_plain">&nbsp;kbase&nbsp;is&nbsp;the&nbsp;</span><span class="java_type">KnowledgeBase</span>
<!--  --><br/><span class="java_type">ByteArrayOutputStream</span><span class="java_plain">&nbsp;baos&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">ByteArrayOutputStream</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_type">Marshaller</span><span class="java_plain">&nbsp;marshaller&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">MarshallerFactory</span><span class="java_separator">.</span><span class="java_plain">newMarshaller</span><span class="java_separator">(</span><span class="java_plain">&nbsp;kbase&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">marshaller</span><span class="java_separator">.</span><span class="java_plain">marshall</span><span class="java_separator">(</span><span class="java_plain">&nbsp;baos</span><span class="java_separator">,</span><span class="java_plain">&nbsp;ksession&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">baos</span><span class="java_separator">.</span><span class="java_plain">close</span><span class="java_separator">();</span>
</pre></div></div><br class="example-break"/><p>However, with marshalling you need more flexibility when dealing
    with referenced user data. To achieve this we have the
    <code class="code">ObjectMarshallingStrategy</code> interface. Two implementations are
    provided, but users can implement their own. The two supplied strategies
    are <code class="code">IdentityMarshallingStrategy</code> and
    <code class="code">SerializeMarshallingStrategy</code>.
    <code class="code">SerializeMarshallingStrategy</code> is the default, as used in the
    example above, and it just calls the <code class="code">Serializable</code> or
    <code class="code">Externalizable</code> methods on a user instance.
    <code class="code">IdentityMarshallingStrategy</code> instead creates an integer id for
    each user object and stores them in a Map, while the id is written to the
    stream. When unmarshalling it accesses the
    <code class="code">IdentityMarshallingStrategy</code> map to retrieve the instance.
    This means that if you use the <code class="code">IdentityMarshallingStrategy</code>,
    it is stateful for the life of the Marshaller instance and will create ids
    and keep references to all objects that it attempts to marshal. Below is
    he code to use an Identity Marshalling Strategy.</p><div class="example"><a id="d0e3932"/><p class="title"><b>Example 3.60. IdentityMarshallingStrategy</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">ByteArrayOutputStream</span><!-- <br/> --><span class="java_plain">&nbsp;baos&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">new</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">ByteArrayOutputStream</span><!-- <br/> --><span class="java_separator">();</span>
<!--  --><br/><span class="java_type">ObjectMarshallingStrategy</span><span class="java_plain">&nbsp;oms&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">MarshallerFactory</span><span class="java_separator">.</span><span class="java_plain">newIdentityMarshallingStrategy</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_type">Marshaller</span><span class="java_plain">&nbsp;marshaller&nbsp;</span><span class="java_operator">=</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_type">MarshallerFactory</span><span class="java_separator">.</span><span class="java_plain">newMarshaller</span><span class="java_separator">(</span><span class="java_plain">&nbsp;kbase</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">ObjectMarshallingStrategy</span><span class="java_separator">[]{</span><span class="java_plain">&nbsp;oms&nbsp;</span><span class="java_separator">}</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">marshaller</span><span class="java_separator">.</span><span class="java_plain">marshall</span><span class="java_separator">(</span><span class="java_plain">&nbsp;baos</span><span class="java_separator">,</span><span class="java_plain">&nbsp;ksession&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">baos</span><span class="java_separator">.</span><span class="java_plain">close</span><span class="java_separator">();</span>
</pre></div></div><br class="example-break"/><p>For added flexability we can't assume that a single strategy is
    suitable. Therefore we have added the
    <code class="code">ObjectMarshallingStrategyAcceptor</code> interface that each Object
    Marshalling Strategy contains. The Marshaller has a chain of strategies,
    and when it attempts to read or write a user object it iterates the
    strategies asking if they accept responsability for marshalling the user
    object. One of the provided implementations is
    <code class="code">ClassFilterAcceptor</code>. This allows strings and wild cards to be
    used to match class names. The default is "*.*", so in the above example
    the Identity Marshalling Strategy is used which has a default "*.*"
    acceptor.</p><p>Assuming that we want to serialize all classes except for one given
    package, where we will use identity lookup, we could do the
    following:</p><div class="example"><a id="d0e3947"/><p class="title"><b>Example 3.61. IdentityMarshallingStrategy with Acceptor</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">ByteArrayOutputStream</span><!-- <br/> --><span class="java_plain">&nbsp;baos&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">new</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">ByteArrayOutputStream</span><!-- <br/> --><span class="java_separator">();</span>
<!--  --><br/><span class="java_type">ObjectMarshallingStrategyAcceptor</span><span class="java_plain">&nbsp;identityAcceptor&nbsp;</span><span class="java_operator">=</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_type">MarshallerFactory</span><span class="java_separator">.</span><span class="java_plain">newClassFilterAcceptor</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_separator">[]</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;org.domain.pkg1.*&quot;</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_type">ObjectMarshallingStrategy</span><span class="java_plain">&nbsp;identityStrategy&nbsp;</span><span class="java_operator">=</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_type">MarshallerFactory</span><span class="java_separator">.</span><span class="java_plain">newIdentityMarshallingStrategy</span><span class="java_separator">(</span><span class="java_plain">&nbsp;identityAcceptor&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_type">ObjectMarshallingStrategy</span><span class="java_plain">&nbsp;sms&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">MarshallerFactory</span><span class="java_separator">.</span><span class="java_plain">newSerializeMarshallingStrategy</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_type">Marshaller</span><span class="java_plain">&nbsp;marshaller&nbsp;</span><span class="java_operator">=</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_type">MarshallerFactory</span><span class="java_separator">.</span><span class="java_plain">newMarshaller</span><span class="java_separator">(</span><span class="java_plain">&nbsp;kbase</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">ObjectMarshallingStrategy</span><span class="java_separator">[]{</span><span class="java_plain">&nbsp;identityStrategy</span><span class="java_separator">,</span><span class="java_plain">&nbsp;sms&nbsp;</span><span class="java_separator">}</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">marshaller</span><span class="java_separator">.</span><span class="java_plain">marshall</span><span class="java_separator">(</span><span class="java_plain">&nbsp;baos</span><span class="java_separator">,</span><span class="java_plain">&nbsp;ksession&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">baos</span><span class="java_separator">.</span><span class="java_plain">close</span><span class="java_separator">();</span>
</pre></div></div><br class="example-break"/><p>Note that the acceptance checking order is in the natural order of
    the supplied array.</p><p>Also note that if you are using scheduled activations (i.e. some
    of your rules use timers or calendars) they are marshallable only if,
    before you use it, you configure your StatefulKnowledgeSession to use a
    trackable timer job factory manager as it follows:</p><div class="example"><a id="d0e3956"/><p class="title"><b>Example 3.62. Configuring a trackable timer job factory manager</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">KnowledgeSessionConfiguration</span><!-- <br/> --><span class="java_plain">&nbsp;ksconf&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">KnowledgeBaseFactory</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">newKnowledgeSessionConfiguration</span><!-- <br/> --><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">ksconf</span><span class="java_separator">.</span><span class="java_plain">setOption</span><span class="java_separator">(</span><span class="java_type">TimerJobFactoryOption</span><span class="java_separator">.</span><span class="java_plain">get</span><span class="java_separator">(</span><span class="java_literal">&quot;trackable&quot;</span><span class="java_separator">));</span>
<!--  --><br/><span class="java_type">StatefulKnowledgeSession</span><span class="java_plain">&nbsp;ksession&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;kbase</span><span class="java_separator">.</span><span class="java_plain">newStatefulKnowledgeSession</span><span class="java_separator">(</span><span class="java_plain">ksconf</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_literal">null</span><span class="java_separator">);</span></pre></div></div><br class="example-break"/></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e3961"/>3.3.10. Persistence and Transactions</h3></div></div></div><p>Longterm out of the box persistence with Java Persistence API (JPA)
    is possible with Drools. You will need to have some implementation of the
    Java Transaction API (JTA) installed. For development purposes we
    recommend the Bitronix Transaction Manager, as it's simple to set up and
    works embedded, but for production use JBoss Transactions is
    recommended.</p><div class="example"><a id="d0e3966"/><p class="title"><b>Example 3.63. Simple example using transactions</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">Environment</span><!-- <br/> --><span class="java_plain">&nbsp;env&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">KnowledgeBaseFactory</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">newEnvironment</span><!-- <br/> --><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">env</span><span class="java_separator">.</span><span class="java_plain">set</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_type">EnvironmentName</span><span class="java_separator">.</span><span class="java_plain">ENTITY_MANAGER_FACTORY</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">Persistence</span><span class="java_separator">.</span><span class="java_plain">createEntityManagerFactory</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;emf-name&quot;</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">env</span><span class="java_separator">.</span><span class="java_plain">set</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_type">EnvironmentName</span><span class="java_separator">.</span><span class="java_plain">TRANSACTION_MANAGER</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">TransactionManagerServices</span><span class="java_separator">.</span><span class="java_plain">getTransactionManager</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_plain">&nbsp;</span><span class="java_type">KnowledgeSessionConfiguration</span><span class="java_plain">&nbsp;may&nbsp;be&nbsp;</span><span class="java_literal">null</span><span class="java_separator">,</span><span class="java_plain">&nbsp;and&nbsp;a&nbsp;</span><span class="java_keyword">default</span><span class="java_plain">&nbsp;will&nbsp;be&nbsp;used</span>
<!--  --><br/><span class="java_type">StatefulKnowledgeSession</span><span class="java_plain">&nbsp;ksession&nbsp;</span><span class="java_operator">=</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_type">JPAKnowledgeService</span><span class="java_separator">.</span><span class="java_plain">newStatefulKnowledgeSession</span><span class="java_separator">(</span><span class="java_plain">&nbsp;kbase</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_literal">null</span><span class="java_separator">,</span><span class="java_plain">&nbsp;env&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_type">int</span><span class="java_plain">&nbsp;sessionId&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;ksession</span><span class="java_separator">.</span><span class="java_plain">getId</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_type">UserTransaction</span><span class="java_plain">&nbsp;ut&nbsp;</span><span class="java_operator">=</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_separator">(</span><span class="java_type">UserTransaction</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">InitialContext</span><span class="java_separator">().</span><span class="java_plain">lookup</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;java:comp/UserTransaction&quot;</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">ut</span><span class="java_separator">.</span><span class="java_plain">begin</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">ksession</span><span class="java_separator">.</span><span class="java_plain">insert</span><span class="java_separator">(</span><span class="java_plain">&nbsp;data1&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">ksession</span><span class="java_separator">.</span><span class="java_plain">insert</span><span class="java_separator">(</span><span class="java_plain">&nbsp;data2&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">ksession</span><span class="java_separator">.</span><span class="java_plain">startProcess</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;process1&quot;</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">ut</span><span class="java_separator">.</span><span class="java_plain">commit</span><span class="java_separator">();</span>
</pre></div></div><br class="example-break"/><p>To use a JPA, the Environment must be set with both the
    <code class="code">EntityManagerFactory</code> and the <code class="code">TransactionManager</code>.
    If rollback occurs the ksession state is also rolled back, so you can
    continue to use it after a rollback. To load a previously persisted
    Stateful Knowledge Session you'll need the id, as shown below:</p><div class="example"><a id="d0e3979"/><p class="title"><b>Example 3.64. Loading a StatefulKnowledgeSession</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">StatefulKnowledgeSession</span><!-- <br/> --><span class="java_plain">&nbsp;ksession&nbsp;</span><!-- <br/> --><span class="java_operator">=</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_type">JPAKnowledgeService</span><span class="java_separator">.</span><span class="java_plain">loadStatefulKnowledgeSession</span><span class="java_separator">(</span><span class="java_plain">&nbsp;sessionId</span><span class="java_separator">,</span><span class="java_plain">&nbsp;kbase</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_literal">null</span><span class="java_separator">,</span><span class="java_plain">&nbsp;env&nbsp;</span><span class="java_separator">);</span>
</pre></div></div><br class="example-break"/><p>To enable persistence several classes must be added to your
    persistence.xml, as in the example below:</p><div class="example"><a id="d0e3986"/><p class="title"><b>Example 3.65. Configuring JPA</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">persistence-unit</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;org.drools.persistence.jpa&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">transaction-type</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;JTA&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">provider</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">org.hibernate.ejb.HibernatePersistence</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">provider</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">jta-data-source</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">jdbc/BitronixJTADataSource</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">jta-data-source</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">class</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">org.drools.persistence.session.SessionInfo</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">class</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">class</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">org.drools.persistence.processinstance.ProcessInstanceInfo</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">class</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">class</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">org.drools.persistence.processinstance.ProcessInstanceEventInfo</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">class</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">class</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">org.drools.persistence.processinstance.WorkItemInfo</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">class</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">properties</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">property</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;hibernate.dialect&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">value</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;org.hibernate.dialect.H2Dialect&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">property</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;hibernate.max_fetch_depth&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">value</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;3&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">property</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;hibernate.hbm2ddl.auto&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">value</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;update&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">property</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;hibernate.show_sql&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">value</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;true&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">property</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;hibernate.transaction.manager_lookup_class&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">value</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;org.hibernate.transaction.BTMTransactionManagerLookup&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">properties</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">persistence-unit</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre></div></div><br class="example-break"/><p>The jdbc JTA data source would have to be configured first. Bitronix
    provides a number of ways of doing this, and its documentation should be
    contsulted for details. For a quick start, here is the programmatic
    approach:</p><div class="example"><a id="d0e3993"/><p class="title"><b>Example 3.66. Configuring JTA DataSource</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">PoolingDataSource</span><!-- <br/> --><span class="java_plain">&nbsp;ds&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">new</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">PoolingDataSource</span><!-- <br/> --><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">ds</span><span class="java_separator">.</span><span class="java_plain">setUniqueName</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;jdbc/BitronixJTADataSource&quot;</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">ds</span><span class="java_separator">.</span><span class="java_plain">setClassName</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;org.h2.jdbcx.JdbcDataSource&quot;</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">ds</span><span class="java_separator">.</span><span class="java_plain">setMaxPoolSize</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">3</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">ds</span><span class="java_separator">.</span><span class="java_plain">setAllowLocalTransactions</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">true</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">ds</span><span class="java_separator">.</span><span class="java_plain">getDriverProperties</span><span class="java_separator">().</span><span class="java_plain">put</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;user&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;sa&quot;</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">ds</span><span class="java_separator">.</span><span class="java_plain">getDriverProperties</span><span class="java_separator">().</span><span class="java_plain">put</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;password&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;sasa&quot;</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">ds</span><span class="java_separator">.</span><span class="java_plain">getDriverProperties</span><span class="java_separator">().</span><span class="java_plain">put</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;URL&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;jdbc:h2:mem:mydb&quot;</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">ds</span><span class="java_separator">.</span><span class="java_plain">init</span><span class="java_separator">();</span>
</pre></div></div><br class="example-break"/><p>Bitronix also provides a simple embedded JNDI service, ideal for
    testing. To use it add a jndi.properties file to your META-INF and add the
    following line to it:</p><div class="example"><a id="d0e4000"/><p class="title"><b>Example 3.67. JNDI properties</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">java.naming.factory.initial=bitronix.tm.jndi.BitronixInitialContextFactory
</pre></div></div><br class="example-break"/></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e4005"/>3.3.11. Drools Clips</h3></div></div></div><p>Drools Clips is an alpha level research project to provide a Clips
    like front end ot Drools. As of Drools 5.2 this module as stopped working,
    we will try and fix for 5.3.</p><p>Deftemplates are working, the knowledge base handles multiple name
    spaces and you can attach the knoweldge base to the session for interative
    building, to provide a more "shell" like environment suitable for
    Clips.</p><div class="itemizedlist"><ul><li><p>deftemplate</p></li><li><p>defrule</p></li><li><p>deffunction</p></li><li><p>and/or/not/exists/test conditional elements</p></li><li><p>Literal, Variable, Return Value and Predicate field
        constarints</p></li></ul></div><div class="mediaobject"><img src="images/Chapter-User_Guide/clips-shell.png"/></div><p>This project is very early stages and in need of love. If you want
    to help, open up eclipse import api, core, compiler and clips and you
    should be good to go. The unit tests should be self explanatory.</p></div></div></div><ul xmlns:d="http://docbook.org/ns/docbook" class="docnav"><li class="previous"><a accesskey="p" href="ch02.html"><strong>Prev</strong>Chapter 2. User Guide</a></li><li class="up"><a accesskey="u" href="#"><strong>Top of page</strong></a></li><li class="home"><a accesskey="h" href="index.html"><strong>Front page</strong></a></li><li class="next"><a accesskey="n" href="ch04.html"><strong>Next</strong>Chapter 4. Rule Language Reference</a></li></ul></body></html>
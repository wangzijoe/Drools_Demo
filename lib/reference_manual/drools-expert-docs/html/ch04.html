<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><title xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory">Chapter 4. Rule Language Reference</title><link rel="stylesheet" href="css/jbossorg.css" type="text/css"/><meta xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" name="generator" content="DocBook XSL-NS Stylesheets V1.74.0"/><meta xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" http-equiv="Content-Type" content="text/html; charset=UTF-8"/><link rel="home" href="index.html" title="Drools Expert User Guide"/><link rel="up" href="index.html" title="Drools Expert User Guide"/><link rel="prev" href="ch03.html" title="Chapter 3. API Reference"/><link rel="next" href="ch05.html" title="Chapter 5. The Java Rule Engine API (JSR94)"/></head><body><p xmlns:d="http://docbook.org/ns/docbook" id="title"><a href="http://www.jboss.org" class="site_href"><strong>JBoss.org</strong></a><a href="http://docs.jboss.org/" class="doc_href"><strong>Community Documentation</strong></a></p><ul xmlns:d="http://docbook.org/ns/docbook" class="docnav"><li class="previous"><a accesskey="p" href="ch03.html"><strong>Prev</strong></a></li><li class="next"><a accesskey="n" href="ch05.html"><strong>Next</strong></a></li></ul><div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e4033"/>Chapter 4. Rule Language Reference</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="ch04.html#d0e4036">4.1. Overview</a></span></dt><dd><dl><dt><span class="section"><a href="ch04.html#d0e4044">4.1.1. A rule file</a></span></dt><dt><span class="section"><a href="ch04.html#d0e4077">4.1.2. What makes a rule</a></span></dt></dl></dd><dt><span class="section"><a href="ch04.html#d0e4113">4.2. Keywords</a></span></dt><dt><span class="section"><a href="ch04.html#d0e4308">4.3. Comments</a></span></dt><dd><dl><dt><span class="section"><a href="ch04.html#d0e4313">4.3.1. Single line comment</a></span></dt><dt><span class="section"><a href="ch04.html#d0e4323">4.3.2. Multi-line comment</a></span></dt></dl></dd><dt><span class="section"><a href="ch04.html#d0e4336">4.4. Error Messages</a></span></dt><dd><dl><dt><span class="section"><a href="ch04.html#d0e4341">4.4.1. Message format</a></span></dt><dt><span class="section"><a href="ch04.html#d0e4372">4.4.2. Error Messages Description</a></span></dt><dt><span class="section"><a href="ch04.html#d0e4527">4.4.3. Other Messages</a></span></dt></dl></dd><dt><span class="section"><a href="ch04.html#d0e4532">4.5. Package</a></span></dt><dd><dl><dt><span class="section"><a href="ch04.html#d0e4555">4.5.1. import</a></span></dt><dt><span class="section"><a href="ch04.html#d0e4569">4.5.2. global</a></span></dt></dl></dd><dt><span class="section"><a href="ch04.html#d0e4612">4.6. Function</a></span></dt><dt><span class="section"><a href="ch04.html#d0e4646">4.7. Type Declaration</a></span></dt><dd><dl><dt><span class="section"><a href="ch04.html#d0e4674">4.7.1. Declaring New Types</a></span></dt><dt><span class="section"><a href="ch04.html#d0e4780">4.7.2. Declaring Metadata</a></span></dt><dt><span class="section"><a href="ch04.html#d0e4950">4.7.3. Declaring Metadata for Existing Types</a></span></dt><dt><span class="section"><a href="ch04.html#d0e4993">4.7.4. Parametrized constructors for declared types</a></span></dt><dt><span class="section"><a href="ch04.html#d0e5006">4.7.5. Non Typesafe Classes</a></span></dt><dt><span class="section"><a href="ch04.html#d0e5011">4.7.6. Accessing Declared Types from the Application Code</a></span></dt><dt><span class="section"><a href="ch04.html#d0e5060">4.7.7. Type Declaration 'extends'</a></span></dt><dt><span class="section"><a href="ch04.html#d0e5069">4.7.8. Traits</a></span></dt></dl></dd><dt><span class="section"><a href="ch04.html#d0e5108">4.8. Rule</a></span></dt><dd><dl><dt><span class="section"><a href="ch04.html#d0e5150">4.8.1. Rule Attributes</a></span></dt><dt><span class="section"><a href="ch04.html#d0e5310">4.8.2. Timers and Calendars</a></span></dt><dt><span class="section"><a href="ch04.html#d0e5351">4.8.3. Left Hand Side (when) syntax</a></span></dt><dt><span class="section"><a href="ch04.html#d0e7386">4.8.4. The Right Hand Side (then)</a></span></dt><dt><span class="section"><a href="ch04.html#d0e7627">4.8.5. A Note on Auto-boxing and Primitive Types</a></span></dt></dl></dd><dt><span class="section"><a href="ch04.html#d0e7632">4.9. Query</a></span></dt><dt><span class="section"><a href="ch04.html#d0e7704">4.10. Domain Specific Languages</a></span></dt><dd><dl><dt><span class="section"><a href="ch04.html#d0e7714">4.10.1. When to Use a DSL</a></span></dt><dt><span class="section"><a href="ch04.html#d0e7721">4.10.2. DSL Basics</a></span></dt><dt><span class="section"><a href="ch04.html#d0e7791">4.10.3. Adding Constraints to Facts</a></span></dt><dt><span class="section"><a href="ch04.html#d0e7836">4.10.4. Developing a DSL</a></span></dt><dt><span class="section"><a href="ch04.html#d0e7849">4.10.5. DSL and DSLR Reference</a></span></dt></dl></dd><dt><span class="section"><a href="ch04.html#d0e8052">4.11. XML Rule Language</a></span></dt><dd><dl><dt><span class="section"><a href="ch04.html#d0e8064">4.11.1. Legacy Drools 2.x XML rule format</a></span></dt><dt><span class="section"><a href="ch04.html#d0e8069">4.11.2. When to use XML</a></span></dt><dt><span class="section"><a href="ch04.html#d0e8080">4.11.3. The XML format</a></span></dt><dt><span class="section"><a href="ch04.html#d0e8126">4.11.4. Legacy Drools 2.x XML rule format</a></span></dt><dt><span class="section"><a href="ch04.html#d0e8131">4.11.5. Automatic transforming between formats (XML and DRL)</a></span></dt></dl></dd></dl></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e4036"/>4.1. Overview</h2></div></div></div><p>Drools has a "native" rule language. 
  This format is very light in terms of punctuation, and supports
  natural and domain specific languages via "expanders" that allow the
  language to morph to your problem domain. This chapter is mostly concerted
  with this native rule format. The diagrams used to present the syntax are
  known as "railroad" diagrams, and they are basically flow charts for the
  language terms. The
  technically very keen may also refer to <code class="filename">DRL.g</code> which is 
  the Antlr3
  grammar for the rule language. If you use the Rule Workbench, a lot of the
  rule structure is done for you with content assistance, for example, type
  "ru" and press ctrl+space, and it will build the rule structure for
  you.</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e4044"/>4.1.1. A rule file</h3></div></div></div><p>A rule file is typically a file with a .drl extension. In a DRL file
    you can have multiple rules, queries and functions, as well as some
    resource declarations like imports, globals and attributes that are
    assigned and used by your rules and queries. However, you are also able to
    spread your rules across multiple rule files (in that case, the extension
    .rule is suggested, but not required) - spreading rules across files can
    help with managing large numbers of rules. A DRL file is simply a text
    file.</p><p>The overall structure of a rule file is:</p><div class="example"><a id="d0e4051"/><p class="title"><b>Example 4.1. Rules file</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class=""><span xmlns="http://www.w3.org/1999/xhtml" class="bold"><strong>package </strong></span><em xmlns="http://www.w3.org/1999/xhtml" class="replaceable"><code>package-name</code></em>

<em xmlns="http://www.w3.org/1999/xhtml" class="replaceable"><code>imports</code></em>

<em xmlns="http://www.w3.org/1999/xhtml" class="replaceable"><code>globals</code></em>

<em xmlns="http://www.w3.org/1999/xhtml" class="replaceable"><code>functions</code></em>

<em xmlns="http://www.w3.org/1999/xhtml" class="replaceable"><code>queries</code></em>

<em xmlns="http://www.w3.org/1999/xhtml" class="replaceable"><code>rules</code></em>
</pre></div></div><br class="example-break"/><p>The order in which the elements are declared is not important,
    except for the package name that, if declared, must be the first element
    in the rules file. All elements are optional, so you will use only those
    you need. We will discuss each of them in the following sections.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e4077"/>4.1.2. What makes a rule</h3></div></div></div><p>For the inpatients, just as an early view, a rule has the following
    rough structure:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class=""><span xmlns="http://www.w3.org/1999/xhtml" class="bold"><strong>rule</strong></span> <em xmlns="http://www.w3.org/1999/xhtml" class="replaceable"><code>"name"</code></em>
    <em xmlns="http://www.w3.org/1999/xhtml" class="replaceable"><code>attributes</code></em>
    <span xmlns="http://www.w3.org/1999/xhtml" class="bold"><strong>when</strong></span>
        <em xmlns="http://www.w3.org/1999/xhtml" class="replaceable"><code>LHS</code></em>
    <span xmlns="http://www.w3.org/1999/xhtml" class="bold"><strong>then</strong></span>
        <em xmlns="http://www.w3.org/1999/xhtml" class="replaceable"><code>RHS</code></em>
<span xmlns="http://www.w3.org/1999/xhtml" class="bold"><strong>end</strong></span>
</pre><p>It's really that simple. Mostly punctuation is not needed,
    even the double quotes for "name" are optional, as are newlines.
    Attributes are simple (always optional) hints to how the rule should
    behave. LHS is the conditional parts of the rule, which follows a certain
    syntax which is covered below. RHS is basically a block that allows
    dialect specific semantic code to be executed.</p><p>It is important to note that white space is not important,
      <span class="emphasis"><em>except</em></span> in
    the case of domain specific languages, where lines are processed
    one by one and spaces may be significant to the domain language.</p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e4113"/>4.2. Keywords</h2></div></div></div><p>Drools 5 introduces the concept of <span class="emphasis"><em>hard</em></span> and
  <span class="emphasis"><em>soft</em></span> keywords.</p><p>Hard keywords are reserved, you cannot use any hard keyword when
  naming your domain objects, properties, methods, functions and other
  elements that are used in the rule text.</p><p>Here is the list of hard keywords that must be avoided as identifiers
  when writing rules:</p><div class="itemizedlist"><ul><li><p><code class="literal">true</code></p></li><li><p><code class="literal">false</code></p></li><li><p><code class="literal">null</code></p></li></ul></div><p>Soft keywords are just recognized in their context, enabling you to
  use these words in any other place if you wish, although, it is still
  recommended to avoid them, to avoid confusions, if possible. Here is a list
  of the soft keywords:</p><div class="itemizedlist"><ul><li><p><code class="literal">lock-on-active</code></p></li><li><p><code class="literal">date-effective</code></p></li><li><p><code class="literal">date-expires</code></p></li><li><p><code class="literal">no-loop</code></p></li><li><p><code class="literal">auto-focus</code></p></li><li><p><code class="literal">activation-group</code></p></li><li><p><code class="literal">agenda-group</code></p></li><li><p><code class="literal">ruleflow-group</code></p></li><li><p><code class="literal">entry-point</code></p></li><li><p><code class="literal">duration</code></p></li><li><p><code class="literal">package</code></p></li><li><p><code class="literal">import</code></p></li><li><p><code class="literal">dialect</code></p></li><li><p><code class="literal">salience</code></p></li><li><p><code class="literal">enabled</code></p></li><li><p><code class="literal">attributes</code></p></li><li><p><code class="literal">rule</code></p></li><li><p><code class="literal">extend</code></p></li><li><p>when</p></li><li><p>then</p></li><li><p><code class="literal">template</code></p></li><li><p><code class="literal">query</code></p></li><li><p><code class="literal">declare</code></p></li><li><p><code class="literal">function</code></p></li><li><p><code class="literal">global</code></p></li><li><p><code class="literal">eval</code></p></li><li><p><code class="literal">not</code></p></li><li><p><code class="literal">in</code></p></li><li><p><code class="literal">or</code></p></li><li><p><code class="literal">and</code></p></li><li><p><code class="literal">exists</code></p></li><li><p><code class="literal">forall</code></p></li><li><p>accumulate</p></li><li><p>collect</p></li><li><p>from</p></li><li><p><code class="literal">action</code></p></li><li><p><code class="literal">reverse</code></p></li><li><p><code class="literal">result</code></p></li><li><p><code class="literal">end</code></p></li><li><p>over</p></li><li><p><code class="literal">init</code></p></li></ul></div><p>Of course, you can have these (hard and soft) words as part of a
  method name in camel case, like notSomething() or accumulateSomething() -
  there are no issues with that scenario.</p><p>Although the 3 hard keywords above are unlikely to be used in your
  existing domain models, if you absolutely need to use them as identifiers
  instead of keywords, the DRL language provides the ability to escape hard
  keywords on rule text. To escape a word, simply enclose it in grave accents,
  like this:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">Holiday( `true` == "yes" ) // please note that Drools will resolve that reference to the method Holiday.isTrue()</pre></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e4308"/>4.3. Comments</h2></div></div></div><p>Comments are sections of text that are ignored by the rule engine.
  They are stripped out when they are encountered, except inside semantic code
  blocks, like the RHS of a rule.</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e4313"/>4.3.1. Single line comment</h3></div></div></div><p>To create single line comments, you can use '//'. The parser will
    ignore anything in the line after the comment symbol. Example:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">rule "Testing Comments"
when
    // this is a single line comment
    eval( true ) // this is a comment in the same line of a pattern
then
    // this is a comment inside a semantic code block
end
</pre><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="warning"><h2>Warning</h2><p>Drools also supports for backward compatibility the use of '#' for
      single line comments, but this is deprecated and will be removed in
      future releases.</p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e4323"/>4.3.2. Multi-line comment</h3></div></div></div><div class="figure"><a id="d0e4326"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Rule_Language/multi_line_comment.png" align="middle" alt="Multi-line comment"/></div></div><p class="title"><b>Figure 4.1. Multi-line comment</b></p></div><br class="figure-break"/><p>Multi-line comments are used to comment blocks of text, both in and
    outside semantic code blocks. Example:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">rule "Test Multi-line Comments"
when
    /* this is a multi-line comment
       in the left hand side of a rule */
    eval( true )
then
    /* and this is a multi-line comment
       in the right hand side of a rule */
end </pre></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e4336"/>4.4. Error Messages</h2></div></div></div><p>Drools 5 introduces standardized error messages. This standardization
  aims to help users to find and resolve problems in a easier and faster way.
  In this section you will learn how to identify and interpret those error
  messages, and you will also receive some tips on how to solve the problems
  associated with them.</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e4341"/>4.4.1. Message format</h3></div></div></div><p>The standardization includes the error message format and to better
    explain this format, let's use the following example:</p><div class="figure"><a id="d0e4346"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Rule_Language/error_message.png" align="middle" alt="Error Message Format"/></div></div><p class="title"><b>Figure 4.2. Error Message Format</b></p></div><br class="figure-break"/><p><span class="bold"><strong>1st Block:</strong></span> This area identifies the
    error code.</p><p><span class="bold"><strong>2nd Block:</strong></span> Line and column
    information.</p><p><span class="bold"><strong>3rd Block:</strong></span> Some text describing the
    problem.</p><p><span class="bold"><strong>4th Block:</strong></span> This is the first
    context. Usually indicates the rule, function, template or query where the
    error occurred. This block is not mandatory.</p><p><span class="bold"><strong>5th Block:</strong></span> Identifies the pattern
    where the error occurred. This block is not mandatory.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e4372"/>4.4.2. Error Messages Description</h3></div></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e4375"/>4.4.2.1. 101: No viable alternative</h4></div></div></div><p>Indicates the most common errors, where the parser came to a
      decision point but couldn't identify an alternative. Here are some
      examples:</p><div class="example"><a id="d0e4380"/><p class="title"><b>Example 4.2. </b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">1: rule one
2:   when
3:     exists Foo()
4:     <span xmlns="http://www.w3.org/1999/xhtml" class="bold"><strong>exits</strong></span> Bar()
5:   then
6: end
</pre></div></div><br class="example-break"/><p>The above example generates this message:</p><div class="itemizedlist"><ul><li><p>[ERR 101] Line 4:4 no viable alternative at input 'exits' in
          rule one</p></li></ul></div><p>At first glance this seems to be valid syntax, but it is not
      (exits != exists). Let's take a look at next example:</p><div class="example"><a id="d0e4394"/><p class="title"><b>Example 4.3. </b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">1: package org.drools;
2: rule
3:   when
4:     Object()
5:   then
6:     System.out.println("A RHS");
7: end
</pre></div></div><br class="example-break"/><p>Now the above code generates this message:</p><div class="itemizedlist"><ul><li><p>[ERR 101] Line 3:2 no viable alternative at input
          'WHEN'</p></li></ul></div><p>This message means that the parser encountered the token <span class="bold"><strong>WHEN</strong></span>, actually a hard keyword, but it's in the
      wrong place since the the rule name is missing.</p><p>The error "no viable alternative" also occurs when you make a
      simple lexical mistake. Here is a sample of a lexical problem:</p><div class="example"><a id="d0e4410"/><p class="title"><b>Example 4.4. </b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">1: rule simple_rule
2:   when
3:     Student( name == "Andy )
4:   then
5: end
</pre></div></div><br class="example-break"/><p>The above code misses to close the quotes and because of this the
      parser generates this error message:</p><div class="itemizedlist"><ul><li><p>[ERR 101] Line 0:-1 no viable alternative at input
          '&lt;eof&gt;' in rule simple_rule in pattern Student</p></li></ul></div><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>Usually the Line and Column information are accurate, but in
        some cases (like unclosed quotes), the parser generates a 0:-1
        position. In this case you should check whether you didn't forget to
        close quotes, apostrophes or parentheses.</p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e4423"/>4.4.2.2. 102: Mismatched input</h4></div></div></div><p>This error indicates that the parser was looking for a particular
      symbol that it didn't ﬁnd at the current input position. Here are some
      samples:</p><div class="example"><a id="d0e4428"/><p class="title"><b>Example 4.5. </b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">1: rule simple_rule
2:   when
3:     foo3 : Bar(
</pre></div></div><br class="example-break"/><p>The above example generates this message:</p><div class="itemizedlist"><ul><li><p>[ERR 102] Line 0:-1 mismatched input '&lt;eof&gt;' expecting
          ')' in rule simple_rule in pattern Bar</p></li></ul></div><p>To fix this problem, it is necessary to complete the rule
      statement.</p><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>Usually when you get a 0:-1 position, it means that parser
        reached the end of source.</p></div><p>The following code generates more than one error message:</p><div class="example"><a id="d0e4444"/><p class="title"><b>Example 4.6. </b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">1: package org.drools;
2:
3: rule "Avoid NPE on wrong syntax"
4:   when
5:     not( Cheese( ( type == "stilton", price == 10 ) || ( type == "brie", price == 15 ) ) from $cheeseList )
6:   then
7:     System.out.println("OK");
8: end
</pre></div></div><br class="example-break"/><p>These are the errors associated with this source:</p><div class="itemizedlist"><ul><li><p>[ERR 102] Line 5:36 mismatched input ',' expecting ')' in rule
          "Avoid NPE on wrong syntax" in pattern Cheese</p></li><li><p>[ERR 101] Line 5:57 no viable alternative at input 'type' in
          rule "Avoid NPE on wrong syntax"</p></li><li><p>[ERR 102] Line 5:106 mismatched input ')' expecting 'then' in
          rule "Avoid NPE on wrong syntax"</p></li></ul></div><p>Note that the second problem is related to the first. To fix it,
      just replace the commas (',') by AND operator ('&amp;&amp;').</p><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>In some situations you can get more than one error message. Try
        to fix one by one, starting at the first one. Some error messages are
        generated merely as consequences of other errors.</p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e4464"/>4.4.2.3. 103: Failed predicate</h4></div></div></div><p>A validating semantic predicate evaluated to false. Usually these
      semantic predicates are used to identify soft keywords. This sample
      shows exactly this situation:</p><div class="example"><a id="d0e4469"/><p class="title"><b>Example 4.7. </b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class=""> 1: package nesting;
 2: dialect "mvel"
 3:
 4: import org.drools.Person
 5: import org.drools.Address
 6: 
 7: <span xmlns="http://www.w3.org/1999/xhtml" class="bold"><strong>fdsfdsfds</strong></span>
 8: 
 9: rule "test something"
10:   when
11:     p: Person( name=="Michael" )
12:   then
13:     p.name = "other";
14:     System.out.println(p.name);
15: end
</pre></div></div><br class="example-break"/><p>With this sample, we get this error message:</p><div class="itemizedlist"><ul><li><p>[ERR 103] Line 7:0 rule 'rule_key' failed predicate:
          {(validateIdentifierKey(DroolsSoftKeywords.RULE))}? in rule</p></li></ul></div><p>The <span class="bold"><strong>fdsfdsfds</strong></span> text is invalid and
      the parser couldn't identify it as the soft keyword
      <code class="literal">rule</code>.</p><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>This error is very similar to 102: Mismatched input, but usually
        involves soft keywords.</p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e4492"/>4.4.2.4. 104: Trailing semi-colon not allowed</h4></div></div></div><p>This error is associated with the <code class="literal">eval</code> clause,
      where its expression may not be terminated with a semicolon. Check this
      example:</p><div class="example"><a id="d0e4500"/><p class="title"><b>Example 4.8. </b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">1: rule simple_rule
2:   when
3:     eval(abc();)
4:   then
5: end
</pre></div></div><br class="example-break"/><p>Due to the trailing semicolon within eval, we get this error
      message:</p><div class="itemizedlist"><ul><li><p>[ERR 104] Line 3:4 trailing semi-colon not allowed in rule
          simple_rule</p></li></ul></div><p>This problem is simple to fix: just remove the semi-colon.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e4511"/>4.4.2.5. 105: Early Exit</h4></div></div></div><p>The recognizer came to a subrule in the grammar that must match an
      alternative at least once, but the subrule did not match anything.
      Simply put: the parser has entered a branch from where there is no way
      out. This example illustrates it:</p><div class="example"><a id="d0e4516"/><p class="title"><b>Example 4.9. </b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">1: template test_error
2:   aa s  11;
3: end
</pre></div></div><br class="example-break"/><p>This is the message associated to the above sample:</p><div class="itemizedlist"><ul><li><p>[ERR 105] Line 2:2 required (...)+ loop did not match anything
          at input 'aa' in template test_error</p></li></ul></div><p>To fix this problem it is necessary to remove the numeric value as
      it is neither a valid data type which might begin a new template slot
      nor a possible start for any other rule file construct.</p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e4527"/>4.4.3. Other Messages</h3></div></div></div><p>Any other message means that something bad has happened, so please
    contact the development team.</p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e4532"/>4.5. Package</h2></div></div></div><p>A package is a collection of rules and other related constructs, such
  as imports and globals. The package members are typically related to each
  other - perhaps HR rules, for instance. A package represents a namespace,
  which ideally is kept unique for a given grouping of rules. The package name
  itself is the namespace, and is not related to files or folders in any
  way.</p><p>It is possible to assemble rules from multiple rule sources, and have
  one top level package configuration that all the rules are kept under (when
  the rules are assembled). Although, it is not possible to merge into the
  same package resources declared under different names. A single Rulebase
  may, however, contain multiple packages built on it. A common structure is to
  have all the rules for a package in the same file as the package declaration
  (so that is it entirely self-contained).</p><p>The following railroad diagram shows all the components that may make
  up a package. Note that a package <span class="emphasis"><em>must</em></span> have a namespace and be declared
  using standard Java conventions for package names; i.e., no spaces, unlike
  rule names which allow spaces. In terms of the order of elements, they can
  appear in any order in the rule file, with the exception of the <code class="literal">package</code>
  statement, which must be at the top of the file. In all cases, the semicolons are
  optional.</p><div class="figure"><a id="d0e4547"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Rule_Language/package.png" align="middle" alt="package"/></div></div><p class="title"><b>Figure 4.3. package</b></p></div><br class="figure-break"/><p>Notice that any rule attribute (as described the section Rule Attributes)
  may also be written at package level, superseding the attribute's default value.
  The modified default may still be replaced by an attribute setting within
  a rule.</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e4555"/>4.5.1. import</h3></div></div></div><div class="figure"><a id="d0e4558"/><div class="figure-contents"><div class="mediaobject"><img src="images/Chapter-Rule_Language/import.png" alt="import"/></div></div><p class="title"><b>Figure 4.4. import</b></p></div><br class="figure-break"/><p>Import statements work like import statements in Java. You need to
    specify the fully qualified paths and type names for any objects you want
    to use in the rules. Drools automatically imports classes from the
    Java package of the same name, and also from the package
    <code class="code">java.lang</code>.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e4569"/>4.5.2. global</h3></div></div></div><div class="figure"><a id="d0e4572"/><div class="figure-contents"><div class="mediaobject"><img src="images/Chapter-Rule_Language/global.png" alt="global"/></div></div><p class="title"><b>Figure 4.5. global</b></p></div><br class="figure-break"/><p>With <code class="literal">global</code> you define global variables. They are used to make
    application objects available to the rules. Typically, they are used
    to provide data or services that the rules use, especially application
    services used in rule consequences, and to return data from the rules,
    like logs or values added in rule consequences, or for the rules to
    interact with the application, doing callbacks. Globals are not 
    inserted into the Working Memory, and therefore a global should never be
    used to establish conditions in rules except when it has a
    constant immutable value. The engine cannot be notified about value
    changes of globals and does not track their changes. Incorrect use
    of globals in constraints may yield surprising results - surprising
    in a bad way.</p><p>If multiple packages declare globals with the same identifier they
    must be of the same type and all of them will reference the same global
    value.</p><p>In order to use globals you must:</p><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="orderedlist"><ol><li><p>Declare your global variable in your rules file and use it in
        rules. Example:</p><pre xmlns="" class="">global java.util.List myGlobalList;

rule "Using a global"
when
    eval( true )
then
    myGlobalList.add( "Hello World" );
end
</pre></li><li><p>Set the global value on your working memory. It is a best
        practice to set all global values before asserting any fact to the
        working memory. Example:</p><pre xmlns="" class="JAVA"><!-- <br/> --><span class="java_type">List</span><!-- <br/> --><span class="java_plain">&nbsp;list&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">new</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">ArrayList</span><!-- <br/> --><span class="java_separator">();</span>
<!--  --><br/><span class="java_type">WorkingMemory</span><span class="java_plain">&nbsp;wm&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;rulebase</span><span class="java_separator">.</span><span class="java_plain">newStatefulSession</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">wm</span><span class="java_separator">.</span><span class="java_plain">setGlobal</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;myGlobalList&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;list&nbsp;</span><span class="java_separator">);</span>
</pre></li></ol></div><p>Note that these are just named instances of objects that you pass in
    from your application to the working memory. This means you can pass in
    any object you want: you could pass in a service locator, or perhaps a
    service itself. With the new <code class="literal">from</code> element it is now common to pass a
    Hibernate session as a global, to allow <code class="literal">from</code> to pull data from a named
    Hibernate query.</p><p>One example may be an instance of a Email service. In your
    integration code that is calling the rule engine, you obtain your
    emailService object, and then set it in the working memory. In the DRL,
    you declare that you have a global of type EmailService, and give it the
    name "email". Then in your rule consequences, you can use things like
    email.sendSMS(number, message).</p><p>Globals are not designed to share data between rules and they should
    never be used for that purpose. Rules always reason and react to the
    working memory state, so if you want to pass data from rule to rule, assert
    the data as facts into the working memory.</p><p>It is strongly discouraged to set or change a global value from
    inside your rules. We recommend to you always set the value from your
    application using the working memory interface.</p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e4612"/>4.6. Function</h2></div></div></div><div class="figure"><a id="d0e4615"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Rule_Language/function.png" align="middle" alt="function"/></div></div><p class="title"><b>Figure 4.6. function</b></p></div><br class="figure-break"/><p>Functions are a way to put semantic code in your rule source file, as
  opposed to in normal Java classes. They can't do anything more than what you
  can do with helper classes. (In fact, the compiler generates the helper class
  for you behind the scenes.) The main advantage of using functions in a rule
  is that you can keep the logic all in one place, and you can change the
  functions as needed (which can be a good or a bad thing). Functions are most
  useful for invoking actions on the consequence (<code class="literal">then</code>) part of a rule,
  especially if that particular action is used over and over again, perhaps
  with only differing parameters for each rule.</p><p>A typical function declaration looks like:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">function String hello(String name) {
    return "Hello "+name+"!";
}
</pre><p>Note that the <code class="literal">function</code> keyword is used, even though its not really
  part of Java. Parameters to the function are defined as for a method, and
  you don't have to have parameters if they are not needed. The return type
  is defined just like in a regular method.</p><p>Alternatively, you could use a static method in a helper class,
  e.g., <code class="code">Foo.hello()</code>. Drools supports the use of
  function imports, so all you would need to do is:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">import function my.package.Foo.hello</pre><p>Irrespective of the way the function is defined or imported, you
  use a function by calling it by its name, in the consequence or inside
  a semantic code block. Example:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">rule "using a static function"
when 
    eval( true )
then
    System.out.println( hello( "Bob" ) );
end
</pre></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e4646"/>4.7. Type Declaration</h2></div></div></div><div class="figure"><a id="d0e4649"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Rule_Language/meta_data.png" align="middle" alt="meta_data"/></div></div><p class="title"><b>Figure 4.7. meta_data</b></p></div><br class="figure-break"/><div class="figure"><a id="d0e4655"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Rule_Language/type_declaration.png" align="middle" alt="type_declaration"/></div></div><p class="title"><b>Figure 4.8. type_declaration</b></p></div><br class="figure-break"/><p>Type declarations have two main goals in the rules engine: to allow
  the declaration of new types, and to allow the declaration of metadata for
  types.</p><div class="itemizedlist"><ul><li><p><span class="bold"><strong>Declaring new types:</strong></span> Drools works
      out of the box with plain Java objects as facts. Sometimes, however,
      users may want to define the model directly to the rules engine, without
      worrying about creating models in a lower level language like Java. At
      other times, there is a domain model already built, but eventually the
      user wants or needs to complement this model with additional entities
      that are used mainly during the reasoning process.</p></li><li><p><span class="bold"><strong>Declaring metadata:</strong></span> facts may
      have meta information associated to them. Examples of meta information
      include any kind of data that is not represented by the fact attributes
      and is consistent among all instances of that fact type. This meta
      information may be queried at runtime by the engine and used in the
      reasoning process.</p></li></ul></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e4674"/>4.7.1. Declaring New Types</h3></div></div></div><p>To declare a new type, all you need to do is use the keyword
    <code class="literal">declare</code>, followed by the list of fields, and the
    keyword <code class="literal">end</code>. A new fact must have a list of fields,
    otherwise the engine will look for an existing fact class in the classpath
    and raise an error if not found.</p><div class="example"><a id="d0e4685"/><p class="title"><b>Example 4.10. Declaring a new fact type: Address</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class=""><span xmlns="http://www.w3.org/1999/xhtml" class="bold"><strong>declare</strong></span> Address
   number : int
   streetName : String
   city : String
<span xmlns="http://www.w3.org/1999/xhtml" class="bold"><strong>end</strong></span>
</pre></div></div><br class="example-break"/><p>The previous example declares a new fact type called
    <code class="code">Address</code>. This fact type will have three attributes:
    <code class="code">number</code>, <code class="code">streetName</code> and <code class="code">city</code>. Each
    attribute has a type that can be any valid Java type, including any other
    class created by the user or even other fact types previously
    declared.</p><p>For instance, we may want to declare another fact type
    <code class="code">Person</code>:</p><div class="example"><a id="d0e4714"/><p class="title"><b>Example 4.11. declaring a new fact type: Person</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class=""><span xmlns="http://www.w3.org/1999/xhtml" class="bold"><strong>declare</strong></span> Person
    name : String
    dateOfBirth : java.util.Date
    address : Address
<span xmlns="http://www.w3.org/1999/xhtml" class="bold"><strong>end</strong></span>
</pre></div></div><br class="example-break"/><p>As we can see on the previous example, <code class="code">dateOfBirth</code> is
    of type <code class="code">java.util.Date</code>, from the Java API, while
    <code class="code">address</code> is of the previously defined fact type
    Address.</p><p>You may avoid having to write the fully qualified name of a class
    every time you write it by using the <code class="literal">import</code> clause, as
    previously discussed.</p><div class="example"><a id="d0e4740"/><p class="title"><b>Example 4.12. Avoiding the need to use fully qualified class names by using
      import</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class=""><span xmlns="http://www.w3.org/1999/xhtml" class="bold"><strong>import</strong></span> java.util.Date

<span xmlns="http://www.w3.org/1999/xhtml" class="bold"><strong>declare</strong></span> Person
    name : String
    dateOfBirth : Date
    address : Address
<span xmlns="http://www.w3.org/1999/xhtml" class="bold"><strong>end</strong></span></pre></div></div><br class="example-break"/><p>When you declare a new fact type, Drools will, at compile time,
    generate bytecode that implements a Java class representing the fact type.
    The generated Java class will be a one-to-one Java Bean mapping of the
    type definition. So, for the previous example, the generated Java class
    would be:</p><div class="example"><a id="d0e4754"/><p class="title"><b>Example 4.13. generated Java class for the previous Person fact type
      declaration</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">public</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">class</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">Person</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">implements</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">Serializable</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;name</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;java</span><span class="java_separator">.</span><span class="java_plain">util</span><span class="java_separator">.</span><span class="java_type">Date</span><span class="java_plain">&nbsp;dateOfBirth</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Address</span><span class="java_plain">&nbsp;address</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;empty&nbsp;constructor</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Person</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{...}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;constructor&nbsp;with&nbsp;all&nbsp;fields&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Person</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;name</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">Date</span><span class="java_plain">&nbsp;dateOfBirth</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">Address</span><span class="java_plain">&nbsp;address&nbsp;</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{...}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;</span><span class="java_keyword">if</span><span class="java_plain">&nbsp;keys&nbsp;are&nbsp;defined</span><span class="java_separator">,</span><span class="java_plain">&nbsp;constructor&nbsp;with&nbsp;keys</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Person</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_separator">...</span><span class="java_plain">keys</span><span class="java_separator">...</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{...}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters&nbsp;and&nbsp;setters</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;equals</span><span class="java_operator">/</span><span class="java_plain">hashCode</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;toString</span>
<!--  --><br/><span class="java_separator">}</span>
</pre></div></div><br class="example-break"/><p>Since the generated class is a simple Java class, it can be used
    transparently in the rules, like any other fact.</p><div class="example"><a id="d0e4761"/><p class="title"><b>Example 4.14. Using the declared types in rules</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class=""><span xmlns="http://www.w3.org/1999/xhtml" class="bold"><strong>rule</strong></span> "Using a declared Type"
<span xmlns="http://www.w3.org/1999/xhtml" class="bold"><strong>when</strong></span> 
    $p : Person( name == "Bob" )
<span xmlns="http://www.w3.org/1999/xhtml" class="bold"><strong>then</strong></span>
    <span xmlns="http://www.w3.org/1999/xhtml" class="emphasis"><em>// Insert Mark, who is Bob's mate.</em></span>
    Person mark = new Person();
    mark.setName("Mark");
    insert( mark );
<span xmlns="http://www.w3.org/1999/xhtml" class="bold"><strong>end</strong></span>
</pre></div></div><br class="example-break"/></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e4780"/>4.7.2. Declaring Metadata</h3></div></div></div><p>Metadata may be assigned to several different constructions in
    Drools: fact types, fact attributes and rules. Drools uses the at sign
    ('@') to introduce metadata, and it always uses the form:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">@<span xmlns="http://www.w3.org/1999/xhtml" class="emphasis"><em>metadata_key</em></span>( <span xmlns="http://www.w3.org/1999/xhtml" class="emphasis"><em>metadata_value</em></span> )</pre><p>The parenthesized <span class="emphasis"><em>metadata_value</em></span> is
    optional.</p><p>For instance, if you want to declare a metadata attribute like
    <code class="code">author</code>, whose value is <span class="emphasis"><em>Bob</em></span>, you could
    simply write:</p><div class="example"><a id="d0e4806"/><p class="title"><b>Example 4.15. Declaring a metadata attribute</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">@author( Bob )</pre></div></div><br class="example-break"/><p>Drools allows the declaration of any arbitrary metadata attribute,
    but some will have special meaning to the engine, while others are simply
    available for querying at runtime. Drools allows the declaration of
    metadata both for fact types and for fact attributes. Any metadata that is
    declared before the attributes of a fact type are assigned to the fact
    type, while metadata declared after an attribute are assigned to that
    particular attribute.</p><div class="example"><a id="d0e4813"/><p class="title"><b>Example 4.16. Declaring metadata attributes for fact types and
      attributes</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class=""><span xmlns="http://www.w3.org/1999/xhtml" class="bold"><strong>import</strong></span> java.util.Date

<span xmlns="http://www.w3.org/1999/xhtml" class="bold"><strong>declare</strong></span> Person
    <span xmlns="http://www.w3.org/1999/xhtml" class="emphasis"><em>@author</em></span>( Bob )
    <span xmlns="http://www.w3.org/1999/xhtml" class="emphasis"><em>@dateOfCreation</em></span>( 01-Feb-2009 )

    name : String <span xmlns="http://www.w3.org/1999/xhtml" class="emphasis"><em>@key @maxLength</em></span>( 30 )
    dateOfBirth : Date 
    address : Address
<span xmlns="http://www.w3.org/1999/xhtml" class="bold"><strong>end</strong></span></pre></div></div><br class="example-break"/><p>In the previous example, there are two metadata items declared for
    the fact type (<code class="code">@author</code> and <code class="code">@dateOfCreation</code>) and
    two more defined for the name attribute (<code class="code">@key</code> and
    <code class="code">@maxLength</code>). Please note that the <code class="code">@key</code> metadata
    has no required value, and so the parentheses and the value were
    omitted.:</p><p>@position can be used to declare the position of a field, overriding
    the default declared order. This is used for positional constraints in
    patterns.</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">declare Cheese
    name : String @position(1)
    shop : String @position(2)
    price : int @position(0)
end
</pre><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e4855"/>4.7.2.1. Predefined class level annotations</h4></div></div></div><p>Some annotations have predefined semantics that are interpreted by
      the engine. The following is a list of some of these predefined
      annotations and their meaning.</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h5 class="title"><a id="d0e4860"/>4.7.2.1.1. @role( &lt;fact | event&gt; )</h5></div></div></div><p>See Drools Fusion documentation for details.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h5 class="title"><a id="d0e4865"/>4.7.2.1.2. @typesafe( &lt;boolean&gt; )</h5></div></div></div><p>By default all type declarations are compiled with type safety
        enabled; @typesafe( false ) provides a means to override this
        behaviour by permitting a fall-back, to type unsafe evaluation where
        all constraints are generated as MVEL constraints and executed
        dynamically. This can be important when dealing with collections that
        do not have any generics or mixed type collections.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h5 class="title"><a id="d0e4870"/>4.7.2.1.3. @timestamp( &lt;attribute name&gt; )</h5></div></div></div><p>See Drools Fusion documentation for details.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h5 class="title"><a id="d0e4875"/>4.7.2.1.4. @duration( &lt;attribute name&gt; )</h5></div></div></div><p>See Drools Fusion documentation for details.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h5 class="title"><a id="d0e4880"/>4.7.2.1.5. @expires( &lt;time interval&gt; )</h5></div></div></div><p>See Drools Fusion documentation for details.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h5 class="title"><a id="d0e4885"/>4.7.2.1.6. @propertyChangeSupport</h5></div></div></div><p>Facts that implement support for property changes as defined in
        the Javabean(tm) spec, now can be annotated so that the engine
        register itself to listen for changes on fact properties. The boolean
        parameter that was used in the insert() method in the Drools 4 API is
        deprecated and does not exist in the drools-api module.</p><div class="example"><a id="d0e4890"/><p class="title"><b>Example 4.17. @propertyChangeSupport</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">declare Person
  @propertyChangeSupport
end</pre></div></div><br class="example-break"/></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h5 class="title"><a id="d0e4895"/>4.7.2.1.7. @propertyReactive</h5></div></div></div><p>Make this type property reactive. See Fine grained property
        change listeners section for details.</p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e4900"/>4.7.2.2. Predefined attribute level annotations</h4></div></div></div><p>As noted before, Drools also supports annotations in type
      attributes. Here is a list of predefined attribute annotations.</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h5 class="title"><a id="d0e4905"/>4.7.2.2.1. @key</h5></div></div></div><p>Declaring an attribute as a key attribute has 2 major effects on
        generated types:</p><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="orderedlist"><ol><li><p>The attribute will be used as a key identifier for the
              type, and as so, the generated class will implement the equals()
              and hashCode() methods taking the attribute into account when
              comparing instances of this type.</p></li><li><p>Drools will generate a constructor using all the key
              attributes as parameters.</p></li></ol></div><p>For instance:</p><div class="example"><a id="d0e4919"/><p class="title"><b>Example 4.18. example of @key declarations for a type</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">declare Person
    firstName : String @key
    lastName : String @key
    age : int
end
</pre></div></div><br class="example-break"/><p>For the previous example, Drools will generate equals() and
        hashCode() methods that will check the firstName and lastName
        attributes to determine if two instances of Person are equal to each
        other, but will not check the age attribute. It will also generate a
        constructor taking firstName and lastName as parameters, allowing one
        to create instances with a code like this:</p><div class="example"><a id="d0e4926"/><p class="title"><b>Example 4.19. creating an instance using the key constructor</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">Person person = new Person( "John", "Doe" );</pre></div></div><br class="example-break"/></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h5 class="title"><a id="d0e4931"/>4.7.2.2.2. @position</h5></div></div></div><p>Patterns support positional arguments on type
        declarations.</p><p>Positional arguments are ones where you don't need to specify
        the field name, as the position maps to a known named field. i.e.
        Person( name == "mark" ) can be rewritten as Person( "mark"; ). The
        semicolon ';' is important so that the engine knows that everything
        before it is a positional argument. Otherwise we might assume it was a
        boolean expression, which is how it could be interpreted after the
        semicolon. You can mix positional and named arguments on a pattern by
        using the semicolon ';' to separate them. Any variables used in a
        positional that have not yet been bound will be bound to the field
        that maps to that position.</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">declare Cheese
    name : String
    shop : String
    price : int
end
</pre><p>The default order is the declared order, but this can be
        overridden using @position</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">declare Cheese
    name : String @position(1)
    shop : String @position(2)
    price : int @position(0)
end
</pre><p>The @Position annotation, in the org.drools.definition.type
        package, can be used to annotate original pojos on the classpath.
        Currently only fields on classes can be annotated. Inheritance of
        classes is supported, but not interfaces of methods yet.</p><p>Example patterns, with two constraints and a binding. Remember
        semicolon ';' is used to differentiate the positional section from the
        named argument section. Variables and literals and expressions using
        just literals are supported in positional arguments, but not
        variables.</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
Cheese( "stilton", "Cheese Shop", p; )
Cheese( "stilton", "Cheese Shop"; p : price )
Cheese( "stilton"; shop == "Cheese Shop", p : price )
Cheese( name == "stilton"; shop == "Cheese Shop", p : price )
</pre></div></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e4950"/>4.7.3. Declaring Metadata for Existing Types</h3></div></div></div><p>Drools allows the declaration of metadata attributes for existing
    types in the same way as when declaring metadata attributes for new fact
    types. The only difference is that there are no fields in that
    declaration.</p><p>For instance, if there is a class org.drools.examples.Person, and
    one wants to declare metadata for it, it's possible to write the following
    code:</p><div class="example"><a id="d0e4957"/><p class="title"><b>Example 4.20. Declaring metadata for an existing type</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class=""><span xmlns="http://www.w3.org/1999/xhtml" class="bold"><strong>import</strong></span> org.drools.examples.Person

<span xmlns="http://www.w3.org/1999/xhtml" class="bold"><strong>declare</strong></span> Person
    <span xmlns="http://www.w3.org/1999/xhtml" class="emphasis"><em>@author</em></span>( Bob )
    <span xmlns="http://www.w3.org/1999/xhtml" class="emphasis"><em>@dateOfCreation</em></span>( 01-Feb-2009 )
<span xmlns="http://www.w3.org/1999/xhtml" class="bold"><strong>end</strong></span>
</pre></div></div><br class="example-break"/><p>Instead of using the import, it is also possible to reference the
    class by its fully qualified name, but since the class will also be
    referenced in the rules, it is usually shorter to add the import and use
    the short class name everywhere.</p><div class="example"><a id="d0e4978"/><p class="title"><b>Example 4.21. Declaring metadata using the fully qualified class name</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class=""><span xmlns="http://www.w3.org/1999/xhtml" class="bold"><strong>declare</strong></span> org.drools.examples.Person
    <span xmlns="http://www.w3.org/1999/xhtml" class="emphasis"><em>@author</em></span>( Bob )
    <span xmlns="http://www.w3.org/1999/xhtml" class="emphasis"><em>@dateOfCreation</em></span>( 01-Feb-2009 )
<span xmlns="http://www.w3.org/1999/xhtml" class="bold"><strong>end</strong></span></pre></div></div><br class="example-break"/></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e4993"/>4.7.4. Parametrized constructors for declared types</h3></div></div></div><p>Generate constructors with parameters for declared types.</p><p>Example: for a declared type like the following:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">declare Person
    firstName : String @key
    lastName : String @key
    age : int
end
</pre><p>The compiler will implicitly generate 3 constructors: one without
    parameters, one with the @key fields, and one with all fields.</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">Person() // parameterless constructor
Person( String firstName, String lastName )
Person( String firstName, String lastName, int age )</pre></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e5006"/>4.7.5. Non Typesafe Classes</h3></div></div></div><p>@typesafe( &lt;boolean&gt;) has been added to type declarations. By
    default all type declarations are compiled with type safety enabled;
    @typesafe( false ) provides a means to override this behaviour by
    permitting a fall-back, to type unsafe evaluation where all constraints
    are generated as MVEL constraints and executed dynamically. This can be
    important when dealing with collections that do not have any generics or
    mixed type collections.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e5011"/>4.7.6. Accessing Declared Types from the Application Code</h3></div></div></div><p>Declared types are usually used inside rules files, while Java
    models are used when sharing the model between rules and applications.
    Although, sometimes, the application may need to access and handle facts
    from the declared types, especially when the application is wrapping the
    rules engine and providing higher level, domain specific user interfaces
    for rules management.</p><p>In such cases, the generated classes can be handled as usual with
    the Java Reflection API, but, as we know, that usually requires a lot of
    work for small results. Therefore, Drools provides a simplified API for
    the most common fact handling the application may want to do.</p><p>The first important thing to realize is that a declared fact will
    belong to the package where it was declared. So, for instance, in the
    example below, <code class="code">Person</code> will belong to the
    <code class="code">org.drools.examples</code> package, and so the fully qualified name
    of the generated class will be
    <code class="code">org.drools.examples.Person</code>.</p><div class="example"><a id="d0e5029"/><p class="title"><b>Example 4.22. Declaring a type in the org.drools.examples package</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class=""><span xmlns="http://www.w3.org/1999/xhtml" class="bold"><strong>package</strong></span> org.drools.examples

<span xmlns="http://www.w3.org/1999/xhtml" class="bold"><strong>import</strong></span> java.util.Date

<span xmlns="http://www.w3.org/1999/xhtml" class="bold"><strong>declare</strong></span> Person
    name : String
    dateOfBirth : Date
    address : Address
<span xmlns="http://www.w3.org/1999/xhtml" class="bold"><strong>end</strong></span></pre></div></div><br class="example-break"/><p>Declared types, as discussed previously, are generated at knowledge
    base compilation time, i.e., the application will only have access to them
    at application run time. Therefore, these classes are not available for
    direct reference from the application.</p><p>Drools then provides an interface through which users can handle
    declared types from the application code:
    <code class="code">org.drools.definition.type.FactType</code>. Through this interface,
    the user can instantiate, read and write fields in the declared fact
    types.</p><div class="example"><a id="d0e5051"/><p class="title"><b>Example 4.23. Handling declared fact types through the API</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">// get a reference to a knowledge base with a declared type:
KnowledgeBase kbase = ...

// get the declared FactType
FactType personType = kbase.getFactType( "org.drools.examples",
                                         "Person" );

// handle the type as necessary:
// create instances:
Object bob = personType.newInstance();

// set attributes values
personType.set( bob,
                "name",
                "Bob" );
personType.set( bob,
                "age",
                42 );

// insert fact into a session
StatefulKnowledgeSession ksession = ...
ksession.insert( bob );
ksession.fireAllRules();

// read attributes
String name = personType.get( bob, "name" );
int age = personType.get( bob, "age" );

</pre></div></div><br class="example-break"/><p>The API also includes other helpful methods, like setting all the
    attributes at once, reading values from a Map, or reading all attributes
    at once, into a Map.</p><p>Although the API is similar to Java reflection (yet much simpler to
    use), it does not use reflection underneath, relying on much more
    performant accessors implemented with generated bytecode.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e5060"/>4.7.7. Type Declaration 'extends'</h3></div></div></div><p>Type declarations now support 'extends' keyword for
    inheritance</p><p>In order to extend a type declared in Java by a DRL declared
    subtype, repeat the supertype in a declare statement without any
    fields.</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">import org.people.Person

declare Person
end

declare Student extends Person
    school : String
end

declare LongTermStudent extends Student
    years : int
    course : String
end</pre></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e5069"/>4.7.8. Traits</h3></div></div></div><p>The same fact may have multiple dynamic types which do not fit naturally in a class hierarchy.
    Traits allow to model this very common scenario. A trait is an interface that can be applied (and eventually
    removed) to an individual object at runtime. To create a trait out of an interface, one has to add a @format(trait)
    annotation to its declaration in DRL as in the following example:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">declare GoldenCustomer
    @format(trait)
    // fields will map to getters/setters
    code     : String
    balance  : long
    discount : int
    maxExpense : long
end</pre><p>In order to apply a trait to an object, we provide the new don keyword, which can be used as simply as this:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">when
    $c : Customer()
then
    GoldenCustomer gc = don( $c, Customer.class );
end</pre><p>when a core object dons a trait, a proxy class is created on the fly (one such class will be generated lazily for each
    core/trait class combination). The proxy instance, which wraps the core object and implements the trait interface, is inserted
    automatically and will possibly activate other rules. An immediate advantage of declaring and using interfaces, getting the
    implementation proxy for free from the engine, is that multiple inheritance hierarchies can be exploited when writing rules.
    The core classes, however, need not implement any of those interfaces statically, also facilitating the use of legacy classes as
    cores. In fact, any object can don a trait. For efficiency reasons, however, one can add the @Traitable annotation to a declared
    bean class to reduce the amount of glue code that the compiler will have to generate. This is optional and will not change the
    behavior of the engine:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">declare Customer
    @Traitable
    code    : String
    balance : long
end</pre><p>The only connection between core classes and trait interfaces is at the proxy level, a trait is not specifically tied to a
    core class. This means that the same trait can be applied to totally different objects. For this reason, the trait does not
    transparently expose the fields of its core object. So, when writing a rule using a trait interface, only the fields of the interface
    will be available, as usual. However, any field in the interface that corresponds to a core object field, will be mapped by the proxy class:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">when
    $o: OrderItem( $p : price, $code : custCode )
    $c: GoldenCustomer( code == $code, $a : balance, $d: discount )
then
    $c.setBalance( $a - $p*$d );
end</pre><p>In this case, the code and balance would be read from the underlying Customer object. Likewise, the setAccount will modify the
    underlying object, preserving a strongly typed access to the data structures. Now, one might wonder what happens when a core class
    does NOT provide the implementation for a field defined in an interface. We call hard fields those trait fields which are also core fields
    and thus readily available, while we define soft those fields which are NOT provided by the core class. Hidden fields, instead, are fields
    in the core class not exposed by the interface.</p><p>So, while hard field management is intuitive, there remains the problem of soft and hidden fields. The solution we have adopted
    is to use a two-part proxy. Internally, proxies are formed by a proper proxy and a wrapper. The former implements the interface, while
    the latter manages the core object fields, implementing a name/value map to supports soft fields. The proxy, then, uses both the core
    object and the map wrapper to implement the interface, as needed. So, you can write:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">when
    $sc : GoldenCustomer( $c : code, // hard getter
                          $maxExpense : maxExpense &gt; 1000 // soft getter
    )
then
    $sc.setDiscount( ... ); // soft setter
end</pre><p>The wrapper, then, provides a looser form of typing when writing rules. However, it has also other uses. The wrapper is specific
        to the object it wraps, regardless of how many traits have been attached to an object: all the proxies on the same object will share the
        same wrapper. Secondly, the wrapper also contains a back-reference to all proxies attached to the wrapped object, effectively allowing
        traits to see each other. To this end, we have provided the new isA operator:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">$sc : GoldenCustomer( $maxExpense : maxExpense &gt; 1000,
                      this isA "SeniorCustomer"
)</pre><p>Eventually, the business logic may require that a trait is removed from a wrapped object. To this end, we provide two options.
        The first is a "logical don", which will result in a logical insertion of the proxy resulting from the traiting operation:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">then
    don( $x, // core object
         Customer.class, // trait class
         true // optional flag for logical insertion
    )
    </pre><p>The second is the use of the shed keyword, which causes the retraction of the proxy corresponding to the given argument type:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">then
    Thing t = shed( $x, GoldenCustomer.class )</pre><p>This operation returns another proxy implementing the org.drools.factmodel.traits.Thing interface, where the getFields() and getCore()
    methods are defined. Internally, in fact, all declared traits are generated to extend this interface (in addition to any others specified).
    This allows to preserve the wrapper with the soft fields which would otherwise be lost.</p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e5108"/>4.8. Rule</h2></div></div></div><div class="figure"><a id="d0e5111"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Rule_Language/rule.png" align="middle" alt="rule"/></div></div><p class="title"><b>Figure 4.9. rule</b></p></div><br class="figure-break"/><p>A rule specifies that <span class="emphasis"><em>when</em></span> a particular set of
  conditions occur, specified in the Left Hand Side (LHS),
  <span class="emphasis"><em>then</em></span> do what queryis specified as a list of actions in
  the Right Hand Side (RHS). A common question from users is "Why use when
  instead of if?" "When" was chosen over "if" because "if" is normally part of
  a procedural execution flow, where, at a specific point in time, a condition
  is to be checked. In contrast, "when" indicates that the condition
  evaluation is not tied to a specific evaluation sequence or point in time,
  but that it happens continually, at any time during the life time of the
  engine; whenever the condition is met, the actions are executed.</p><p>A rule must have a name, unique within its rule package. If you define
  a rule twice in the same DRL it produces an error while loading. If you add
  a DRL that includes a rule name already in the package, it replaces the
  previous rule. If a rule name is to have spaces, then it will need to be
  enclosed in double quotes (it is best to always use double quotes).</p><p>Attributes - described below - are optional. They are best written one
  per line.</p><p>The LHS of the rule follows the <code class="literal">when</code> keyword
  (ideally on a new line), similarly the RHS follows the
  <code class="literal">then</code> keyword (again, ideally on a newline). The rule is
  terminated by the keyword <code class="literal">end</code>. Rules cannot be
  nested.</p><div class="example"><a id="d0e5140"/><p class="title"><b>Example 4.24. Rule Syntax Overview</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">rule "&lt;name&gt;"
    &lt;attribute&gt;*
when
    &lt;conditional element&gt;*
then
    &lt;action&gt;*
end</pre></div></div><br class="example-break"/><div class="example"><a id="d0e5145"/><p class="title"><b>Example 4.25. A simple rule</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">rule "Approve if not rejected"
  salience -100 
  agenda-group "approval"
    when
        not Rejection() 
        p : Policy(approved == false, policyState:status)
        exists Driver(age &gt; 25)
        Process(status == policyState)
    then
        log("APPROVED: due to no objections."); 
        p.setApproved(true);
end</pre></div></div><br class="example-break"/><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e5150"/>4.8.1. Rule Attributes</h3></div></div></div><p>Rule attributes provide a declarative way to influence the behavior
    of the rule. Some are quite simple, while others are part of complex
    subsystems such as ruleflow. To get the most from Drools you should make
    sure you have a proper understanding of each attribute.</p><div class="figure"><a id="d0e5155"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Rule_Language/rule_attributes.png" align="middle" alt="rule attributes"/></div></div><p class="title"><b>Figure 4.10. rule attributes</b></p></div><br class="figure-break"/><div class="variablelist"><dl><dt><span class="term"><code class="literal">no-loop</code></span></dt><dd><p>default value: <code class="literal">false</code></p><p>type: Boolean</p><p>When a rule's consequence modifies a fact it may cause the
          rule to activate again, causing an infinite loop. Setting no-loop to
          true will skip the creation of another Activation for the rule with
          the current set of facts.</p></dd><dt><span class="term"><code class="literal">ruleflow-group</code></span></dt><dd><p>default value: N/A</p><p>type: String</p><p>Ruleflow is a Drools feature that lets you exercise control
          over the firing of rules. Rules that are assembled by the same
          ruleflow-group identifier fire only when their group is
          active.</p></dd><dt><span class="term"><code class="literal">lock-on-active</code></span></dt><dd><p>default value: <code class="literal">false</code></p><p>type: Boolean</p><p>Whenever a ruleflow-group becomes active or an agenda-group
          receives the focus, any rule within that group that has
          lock-on-active set to true will not be activated any more;
          irrespective of the origin of the update, the activation of a
          matching rule is discarded. This is a stronger version of no-loop,
          because the change could now be caused not only by the rule itself.
          It's ideal for calculation rules where you have a number of rules
          that modify a fact and you don't want any rule re-matching and
          firing again. Only when the ruleflow-group is no longer active or
          the agenda-group loses the focus those rules with lock-on-active set
          to true become eligible again for their activations to be placed
          onto the agenda.</p></dd><dt><span class="term"><code class="literal">salience</code></span></dt><dd><p>default value: <code class="literal">0</code></p><p>type: integer</p><p>Each rule has an integer salience attribute which defaults to
          zero and can be negative or positive. Salience is a form of priority
          where rules with higher salience values are given higher priority
          when ordered in the Activation queue.</p><p>Drools also supports dynamic salience where you can use an
          expression involving bound variables.</p><div class="example"><a id="d0e5214"/><p class="title"><b>Example 4.26. Dynamic Salience</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">rule "Fire in rank order 1,2,.."
        salience( -$rank )
    when
        Element( $rank : rank,... )
    then
        ...
end</pre></div></div><br class="example-break"/></dd><dt><span class="term"><code class="literal">agenda-group</code></span></dt><dd><p>default value: MAIN</p><p>type: String</p><p>Agenda groups allow the user to partition the Agenda providing
          more execution control. Only rules in the agenda group that has
          acquired the focus are allowed to fire.</p></dd><dt><span class="term"><code class="literal">auto-focus</code></span></dt><dd><p>default value: <code class="literal">false</code></p><p>type: Boolean</p><p>When a rule is activated where the <code class="code">auto-focus</code>
          value is true and the rule's agenda group does not have focus yet,
          then it is given focus, allowing the rule to potentially
          fire.</p></dd><dt><span class="term"><code class="literal">activation-group</code></span></dt><dd><p>default value: N/A</p><p>type: String</p><p>Rules that belong to the same activation-group, identified by
          this attribute's string value, will only fire exclusively. In other
          words, the first rule in an activation-group to fire will cancel the
          other rules' activations, i.e., stop them from firing.</p><p>Note: This used to be called Xor group, but technically it's
          not quite an Xor. You may still hear people mention Xor group; just
          swap that term in your mind with activation-group.</p></dd><dt><span class="term"><code class="literal">dialect</code></span></dt><dd><p>default value: as specified by the package</p><p>type: String</p><p>possible values: "java" or "mvel"</p><p>The dialect species the language to be used for any code
          expressions in the LHS or the RHS code block. Currently two dialects
          are available, Java and MVEL. While the dialect can be specified at
          the package level, this attribute allows the package definition to
          be overridden for a rule.</p></dd><dt><span class="term"><code class="literal">date-effective</code></span></dt><dd><p>default value: N/A</p><p>type: String, containing a date and time definition</p><p>A rule can only activate if the current date and time is after
          date-effective attribute.</p></dd><dt><span class="term"><code class="literal">date-expires</code></span></dt><dd><p>default value: N/A</p><p>type: String, containing a date and time definition</p><p>A rule cannot activate if the current date and time is after
          the date-expires attribute.</p></dd><dt><span class="term"><code class="literal">duration</code></span></dt><dd><p>default value: no default value</p><p>type: long</p><p>The duration dictates that the rule will fire after a
          specified duration, if it is still true.</p></dd></dl></div><div class="example"><a id="d0e5305"/><p class="title"><b>Example 4.27. Some attribute examples</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">rule "my rule"
  salience 42
  agenda-group "number 1"
    when ...</pre></div></div><br class="example-break"/></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e5310"/>4.8.2. Timers and Calendars</h3></div></div></div><p>Rules now support both interval and cron based timers, which replace
    the now deprecated duration attribute.</p><div class="example"><a id="d0e5315"/><p class="title"><b>Example 4.28. Sample timer attribute uses</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">timer&nbsp;</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">int</span><!-- <br/> --><span class="java_operator">:</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_operator">&lt;</span><!-- <br/> --><span class="java_plain">initial&nbsp;delay</span><!-- <br/> --><span class="java_operator">&gt;</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_operator">&lt;</span><!-- <br/> --><span class="java_plain">repeat&nbsp;interval</span><!-- <br/> --><span class="java_operator">&gt;?</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">timer&nbsp;</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_type">int</span><span class="java_operator">:</span><span class="java_plain">&nbsp;</span><span class="java_literal">30</span><span class="java_plain">s&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">timer&nbsp;</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_type">int</span><span class="java_operator">:</span><span class="java_plain">&nbsp;</span><span class="java_literal">30</span><span class="java_plain">s&nbsp;</span><span class="java_literal">5</span><span class="java_plain">m&nbsp;</span><span class="java_separator">)</span>
</span>
<!--  --><br/><span class="java_plain">timer&nbsp;</span><span class="java_separator">(</span><span class="java_plain">&nbsp;cron</span><span class="java_operator">:</span><span class="java_plain">&nbsp;</span><span class="java_operator">&lt;</span><span class="java_plain">cron&nbsp;expression</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">timer&nbsp;</span><span class="java_separator">(</span><span class="java_plain">&nbsp;cron</span><span class="java_operator">:*</span><span class="java_plain">&nbsp;</span><span class="java_literal">0</span><span class="java_operator">/</span><span class="java_literal">15</span><span class="java_plain">&nbsp;</span><span class="java_operator">*</span><span class="java_plain">&nbsp;</span><span class="java_operator">*</span><span class="java_plain">&nbsp;</span><span class="java_operator">*</span><span class="java_plain">&nbsp;</span><span class="java_operator">?</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span></pre></div></div><br class="example-break"/><p>Interval (indicated by "int:") timers follow the semantics of
    java.util.Timer objects, with an initial delay and an optional repeat
    interval. Cron (indicated by "cron:") timers follow standard Unix cron
    expressions:</p><div class="example"><a id="d0e5322"/><p class="title"><b>Example 4.29. A Cron Example</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">rule&nbsp;</span><!-- <br/> --><span class="java_literal">&quot;Send&nbsp;SMS&nbsp;every&nbsp;15&nbsp;minutes&quot;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;timer&nbsp;</span><span class="java_separator">(</span><span class="java_plain">cron</span><span class="java_operator">:*</span><span class="java_plain">&nbsp;</span><span class="java_literal">0</span><span class="java_operator">/</span><span class="java_literal">15</span><span class="java_plain">&nbsp;</span><span class="java_operator">*</span><span class="java_plain">&nbsp;</span><span class="java_operator">*</span><span class="java_plain">&nbsp;</span><span class="java_operator">*</span><span class="java_plain">&nbsp;</span><span class="java_operator">?</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">when</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;$a&nbsp;</span><span class="java_operator">:</span><span class="java_plain">&nbsp;</span><span class="java_type">Alarm</span><span class="java_separator">(</span><span class="java_plain">&nbsp;on&nbsp;</span><span class="java_operator">==</span><span class="java_plain">&nbsp;</span><span class="java_literal">true</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">then</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;channels</span><span class="java_separator">[</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;sms&quot;</span><span class="java_plain">&nbsp;</span><span class="java_separator">].</span><span class="java_plain">insert</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">Sms</span><span class="java_separator">(</span><span class="java_plain">&nbsp;$a</span><span class="java_separator">.</span><span class="java_plain">mobileNumber</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;The&nbsp;alarm&nbsp;is&nbsp;still&nbsp;on&quot;</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">end</span></pre></div></div><br class="example-break"/><p>Calendars are used to control when rules can fire. The Calendar API
    is modelled on <a class="link" href="http://www.quartz-scheduler.org/" target="">Quartz</a>:</p><div class="example"><a id="d0e5332"/><p class="title"><b>Example 4.30. Adapting a Quartz Calendar</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">Calendar</span><!-- <br/> --><span class="java_plain">&nbsp;weekDayCal&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">QuartzHelper</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">quartzCalendarAdapter</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_plain">org</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">quartz</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_type">Calendar</span><!-- <br/> --><span class="java_plain">&nbsp;quartzCal</span><!-- <br/> --><span class="java_separator">)</span></pre></div></div><br class="example-break"/><p>Calendars are registered with the StatefulKnowledgeSession:</p><div class="example"><a id="d0e5339"/><p class="title"><b>Example 4.31. Registering a Calendar</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">ksession</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">getCalendars</span><!-- <br/> --><span class="java_separator">().</span><!-- <br/> --><span class="java_plain">set</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_literal">&quot;weekday&quot;</span><!-- <br/> --><span class="java_separator">,</span><!-- <br/> --><span class="java_plain">&nbsp;weekDayCal&nbsp;</span><!-- <br/> --><span class="java_separator">);</span></pre></div></div><br class="example-break"/><p>They can be used in conjunction with normal rules and rules
    including timers. The rule attribute "calendars" may contain one or more
    comma-separated calendar names written as string literals.</p><div class="example"><a id="d0e5346"/><p class="title"><b>Example 4.32. Using Calendars and Timers together</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">rule&nbsp;</span><!-- <br/> --><span class="java_literal">&quot;weekdays&nbsp;are&nbsp;high&nbsp;priority&quot;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;calendars&nbsp;</span><span class="java_literal">&quot;weekday&quot;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;timer&nbsp;</span><span class="java_separator">(</span><span class="java_type">int</span><span class="java_operator">:</span><span class="java_literal">0</span><span class="java_plain">&nbsp;</span><span class="java_literal">1</span><span class="java_plain">h</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">when&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">Alarm</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">then</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;send</span><span class="java_separator">(</span><span class="java_plain">&nbsp;&quot;priority&nbsp;high&nbsp;</span><span class="java_operator">-</span><span class="java_plain">&nbsp;we&nbsp;have&nbsp;an&nbsp;alarm&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">end&nbsp;</span>
</span>
<!--  --><br/><span class="java_plain">rule&nbsp;</span><span class="java_literal">&quot;weekend&nbsp;are&nbsp;low&nbsp;priority&quot;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;calendars&nbsp;</span><span class="java_literal">&quot;weekend&quot;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;timer&nbsp;</span><span class="java_separator">(</span><span class="java_type">int</span><span class="java_operator">:</span><span class="java_literal">0</span><span class="java_plain">&nbsp;</span><span class="java_literal">4</span><span class="java_plain">h</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">when&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">Alarm</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">then</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;send</span><span class="java_separator">(</span><span class="java_plain">&nbsp;&quot;priority&nbsp;low&nbsp;</span><span class="java_operator">-</span><span class="java_plain">&nbsp;we&nbsp;have&nbsp;an&nbsp;alarm&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">end</span></pre></div></div><br class="example-break"/></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e5351"/>4.8.3. Left Hand Side (when) syntax</h3></div></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e5354"/>4.8.3.1. What is the Left Hand Side?</h4></div></div></div><p>The Left Hand Side (LHS) is a common name for the conditional part
      of the rule. It consists of zero or more Conditional Elements. If the
      LHS is empty, it will be considered as a condition element that is
      always true and it will be activated once, when a new WorkingMemory
      session is created.</p><div class="figure"><a id="d0e5359"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Rule_Language/lhs.png" align="middle" alt="Left Hand Side"/></div></div><p class="title"><b>Figure 4.11. Left Hand Side</b></p></div><br class="figure-break"/><div class="example"><a id="d0e5365"/><p class="title"><b>Example 4.33. Rule without a Conditional Element</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">rule "no CEs"
when
    // empty
then
    ... // actions (executed once)
end

// The above rule is internally rewritten as:

rule "eval(true)"
when
    eval( true )
then
    ... // actions (executed once)
end</pre></div></div><br class="example-break"/><p>Conditional elements work on one or more
      <span class="emphasis"><em>patterns</em></span> (which are described below). The most
      common conditional element is "<code class="literal">and"</code>. Therefore it is
      implicit when you have multiple patterns in the LHS of a rule that are
      not connected in any way:</p><div class="example"><a id="d0e5378"/><p class="title"><b>Example 4.34. Implicit and</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">rule "2 unconnected patterns"
when
    Pattern1()
    Pattern2()
then
    ... // actions
end

// The above rule is internally rewritten as:

rule "2 and connected patterns"
when
    Pattern1()
    and Pattern2()
then
    ... // actions
end</pre></div></div><br class="example-break"/><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>An "<code class="literal">and"</code> cannot have a leading declaration
        binding (unlike for example <code class="literal">or</code>). This is obvious,
        since a declaration can only reference a single fact at a time, and
        when the "<code class="literal">and"</code> is satisfied it matches both facts -
        so which fact would the declaration bind to?</p><pre xmlns="" class="">// Compile error
$person : (Person( name == "Romeo" ) and Person( name == "Juliet"))</pre></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e5397"/>4.8.3.2. Pattern (conditional element)</h4></div></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h5 class="title"><a id="d0e5400"/>4.8.3.2.1. What is a pattern?</h5></div></div></div><p>A pattern element is the most important Conditional Element. It
        can potentially match on each fact that is inserted in the working
        memory.</p><p>A pattern contains of zero or more constraints and has an
        optional pattern binding. The railroad diagram below shows the syntax
        for this.</p><div class="figure"><a id="d0e5407"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Rule_Language/pattern.png" align="middle" alt="Pattern"/></div></div><p class="title"><b>Figure 4.12. Pattern</b></p></div><br class="figure-break"/><p>In its simplest form, with no constraints, a pattern matches
        against a fact of the given type. In the following case the type is
        <code class="code">Cheese</code>, which means that the pattern will match against
        all <code class="code">Person</code> objects in the Working Memory:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">Person()</pre><p>The type need not be the actual class of some fact object.
        Patterns may refer to superclasses or even interfaces, thereby
        potentially matching facts from many different classes.</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">Object() // matches all objects in the working memory</pre><p>Inside of the pattern parenthesis is where all the action
        happens: it defines the constraints for that pattern. For example,
        with a age related constraint:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">Person( age == 100 )</pre><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>For backwards compatibility reasons it's allowed to suffix
          patterns with the <code class="literal">;</code> character. But it is not
          recommended to do that.</p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h5 class="title"><a id="d0e5437"/>4.8.3.2.2. Pattern binding</h5></div></div></div><p>For referring to the matched object, use a pattern binding
        variable such as <code class="code">$p</code>.</p><div class="example"><a id="d0e5445"/><p class="title"><b>Example 4.35. Pattern with a binding variable</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">rule ...
when
    $p : Person()
then
    System.out.println( "Person " + $p );
end</pre></div></div><br class="example-break"/><p>The prefixed dollar symbol (<code class="literal">$</code>) is just a
        convention; it can be useful in complex rules where it helps to easily
        differentiate between variables and fields, but it is not
        mandatory.</p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e5455"/>4.8.3.3. Constraint (part of a pattern)</h4></div></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h5 class="title"><a id="d0e5458"/>4.8.3.3.1. What is a constraint?</h5></div></div></div><p>A constraint is an expression that returns
        <code class="literal">true</code> or <code class="literal">false</code>. This example has
        a constraint that states <span class="emphasis"><em>5 is smaller than
        6</em></span>:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">Person( 5 &lt; 6 )  // just an example, as constraints like this would be useless in a real pattern</pre><p>In essence, it's a Java expression with some enhancements (such
        as property access) and a few differences (such as
        <code class="literal">equals()</code> semantics for <code class="literal">==</code>).
        Let's take a deeper look.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h5 class="title"><a id="d0e5482"/>4.8.3.3.2. Property access on Java Beans (POJO's)</h5></div></div></div><p>Any bean property can be used directly. A bean property is
        exposed using a standard Java bean getter: a method
        <code class="literal">getMyProperty()</code> (or
        <code class="literal">isMyProperty()</code> for a primitive boolean) which takes
        no arguments and return something. For example: the age property is
        written as <code class="literal">age</code> in DRL instead of the getter
        <code class="literal">getAge()</code>:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">Person( age == 50 )

// this is the same as:
Person( getAge() == 50 )</pre><p>Drools uses the standard JDK <code class="literal">Introspector</code>
        class to do this mapping, so it follows the standard Java bean
        specification.</p><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>We recommend using property access (<code class="literal">age</code>)
          over using getters explicitly (<code class="literal">getAge()</code>) because
          of performance enhancements through field indexing.</p></div><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="warning"><h2>Warning</h2><p>Property accessors must not change the state of the object in
          a way that may effect the rules. Remember that the rule engine
          effectively caches the results of its matching in between
          invocations to make it faster.</p><pre xmlns="" class="">public int getAge() {
    age++; // Do NOT do this
    return age;
}</pre><pre xmlns="" class="">public int getAge() {
    Date now = DateUtil.now(); // Do NOT do this
    return DateUtil.differenceInYears(now, birthday);
}</pre><p>To solve this latter case, insert a fact that wraps the
          current date into working memory and update that fact between
          <code class="literal">fireAllRules</code> as needed.</p></div><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>The following fallback applies: if the getter of a property
          cannot be found, the compiler will resort to using the property name
          as a method name and without arguments:</p><pre xmlns="" class="">Person( age == 50 )

// If Person.getAge() does not exists, this falls back to:
Person( age() == 50 )</pre></div><p>Nested property access is also supported:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">Person( address.houseNumber == 50 )

// this is the same as:
Person( getAddress().getHouseNumber() == 50 )</pre><p>Nested properties are also indexed.</p><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="warning"><h2>Warning</h2><p>In a stateful session, care should be taken when using nested
          accessors as the Working Memory is not aware of any of the nested
          values, and does not know when they change. Either consider them
          immutable while any of their parent references are inserted into the
          Working Memory. Or, instead, if you wish to modify a nested value
          you should mark all of the outer facts as updated. In the above
          example, when the <code class="literal">houseNumber</code> changes, any
          <code class="literal">Person</code> with that <code class="literal">Address</code> must
          be marked as updated.</p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h5 class="title"><a id="d0e5550"/>4.8.3.3.3. Java expression</h5></div></div></div><p>You can use any Java expression that returns a
        <code class="literal">boolean</code> as a constraint inside the parentheses of a
        pattern. Java expressions can be mixed with other expression
        enhancements, such as property access:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">Person( age == 50 )</pre><p>It is possible to change the evaluation priority by using
        parentheses, as in any logic or mathematical expression:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">Person( age &gt; 100 &amp;&amp; ( age % 10 == 0 ) )</pre><p>It is possible to reuse Java methods:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">Person( Math.round( weight / ( height * height ) ) &lt; 25.0 )</pre><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="warning"><h2>Warning</h2><p>As for property accessors, methods must not change the state
          of the object in a way that may affect the rules. Any method
          executed on a fact in the LHS should be a <span class="emphasis"><em>read
          only</em></span> method.</p><pre xmlns="" class="">Person( incrementAndGetAge() == 10 ) // Do NOT do this</pre></div><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="warning"><h2>Warning</h2><p>The state of a fact should not change between rule invocations
          (unless those facts are marked as updated to the working memory on
          every change):</p><pre xmlns="" class="">Person( System.currentTimeMillis() % 1000 == 0 ) // Do NOT do this</pre></div><p>Normal Java operator precedence applies, see the operator
        precedence list below.</p><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="important"><h2>Important</h2><p>All operators have normal Java semantics except for
          <code class="literal">==</code> and <code class="literal">!=</code>.</p><p>The <code class="literal">==</code> operator has null-safe
          <code class="literal">equals()</code> semantics:</p><pre xmlns="" class="">// Similar to: java.util.Objects.equals(person.getFirstName(), "John")
// so (because "John" is not null) similar to:
// "John".equals(person.getFirstName())
Person( firstName == "John" )</pre><p>The <code class="literal">!=</code> operator has null-safe
          <code class="literal">!equals()</code> semantics:</p><pre xmlns="" class="">// Similar to: !java.util.Objects.equals(person.getFirstName(), "John")
Person( firstName != "John" )</pre></div><p>Type coercion is always attempted if the field and the value are
        of different types; exceptions will be thrown if a bad coercion is
        attempted. For instance, if "ten" is provided as a string in a numeric
        evaluator, an exception is thrown, whereas "10" would coerce to a
        numeric 10. Coercion is always in favor of the field type and not the
        value type:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">Person( age == "10" ) // "10" is coerced to 10</pre></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h5 class="title"><a id="d0e5616"/>4.8.3.3.4. Comma separated AND</h5></div></div></div><p>The comma character ('<code class="literal">,</code>') is used to separate
        constraint groups. It has implicit <span class="emphasis"><em>AND</em></span> connective
        semantics.</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">// Person is at least 50 and weighs at least 80 kg
Person( age &gt; 50, weight &gt; 80 )</pre><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">// Person is at least 50, weighs at least 80 kg and is taller than 2 meter.
Person( age &gt; 50, weight &gt; 80, height &gt; 2 )</pre><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>Although the <code class="literal">&amp;&amp;</code> and
          <code class="literal">,</code> operators have the same semantics, they are
          resolved with different priorities: The
          <code class="literal">&amp;&amp;</code> operator precedes the
          <code class="literal">||</code> operator. Both the
          <code class="literal">&amp;&amp;</code> and <code class="literal">||</code> operator
          precede the <code class="literal">,</code> operator. See the operator
          precedence list below.</p><p>The comma operator should be preferred at the top level
          constraint, as it makes constraints easier to read and the engine
          will often be able to optimize them better.</p></div><p>The comma (<code class="literal">,</code>) operator cannot be embedded in
        a composite constraint expression, such as parentheses:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">Person( ( age &gt; 50, weight &gt; 80 ) || height &gt; 2 ) // Do NOT do this: compile error

// Use this instead
Person( ( age &gt; 50 &amp;&amp; weight &gt; 80 ) || height &gt; 2 )</pre></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h5 class="title"><a id="d0e5664"/>4.8.3.3.5. Binding variables</h5></div></div></div><p>A property can be bound to a variable:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">// 2 persons of the same age
Person( $firstAge : age ) // binding
Person( age == $firstAge ) // constraint expression</pre><p>The prefixed dollar symbol (<code class="literal">$</code>) is just a
        convention; it can be useful in complex rules where it helps to easily
        differentiate between variables and fields.</p><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>For backwards compatibility reasons, It's allowed (but not
          recommended) to mix a constraint binding and constraint expressions
          as such:</p><pre xmlns="" class="">// Not recommended
Person( $age : age * 2 &lt; 100 )</pre><pre xmlns="" class="">// Recommended (separates bindings and constraint expressions)
Person( age * 2 &lt; 100, $age : age )</pre></div><p>Bound variable restrictions using the operator
        <code class="literal">==</code> provide for very fast execution as it use hash
        indexing to improve performance.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h5 class="title"><a id="d0e5688"/>4.8.3.3.6. Unification</h5></div></div></div><p>Drools does not allow bindings to the same declaration. However
        this is an important aspect to derivation query unification. While
        positional arguments are always processed with unification a special
        unification symbol, ':=', was introduced for named arguments named
        arguments. The following "unifies" the age argument across two
        people.</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">Person( $age := age ) 
Person( $age := age) </pre><p>In essence unification will declare a binding for the first
        occurrence and constrain to the same value of the bound field for
        sequence occurrences.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h5 class="title"><a id="d0e5697"/>4.8.3.3.7. Special literal support</h5></div></div></div><p>Besides normal Java literals (including Java 5 enums), this
        literal is also supported:</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h6 class="title"><a id="d0e5702"/>4.8.3.3.7.1. Date literal</h6></div></div></div><p>The date format <code class="literal">dd-mmm-yyyy</code> is supported by
          default. You can customize this by providing an alternative date
          format mask as the System property named
          <code class="code">drools.dateformat</code>. If more control is required, use a
          restriction.</p><div class="example"><a id="d0e5713"/><p class="title"><b>Example 4.36. Date Literal Restriction</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">Cheese( bestBefore &lt; "27-Oct-2009" )</pre></div></div><br class="example-break"/></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h5 class="title"><a id="d0e5718"/>4.8.3.3.8. List and Map access</h5></div></div></div><p>It's possible to directly access a <code class="literal">List</code> value
        by index:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">// Same as childList(0).getAge() == 18
Person( childList[0].age == 18 )</pre><p>It's also possible to directly access a <code class="literal">Map</code>
        value by key:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">// Same as credentialMap.get("jsmith").isValid()
Person( credentialMap["jsmith"].valid )</pre></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h5 class="title"><a id="d0e5735"/>4.8.3.3.9. Abbreviated combined relation condition</h5></div></div></div><p>This allows you to place more than one restriction on a field
        using the restriction connectives <code class="literal">&amp;&amp;</code> or
        <code class="literal">||</code>. Grouping via parentheses is permitted,
        resulting in a recursive syntax pattern.</p><div class="figure"><a id="d0e5746"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Rule_Language/abbreviatedCombinedRelationCondition.png" align="middle" alt="Abbreviated combined relation condition"/></div></div><p class="title"><b>Figure 4.13. Abbreviated combined relation condition</b></p></div><br class="figure-break"/><div class="figure"><a id="d0e5752"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Rule_Language/abbreviatedCombinedRelationConditionGroup.png" align="middle" alt="Abbreviated combined relation condition with parentheses"/></div></div><p class="title"><b>Figure 4.14. Abbreviated combined relation condition with
          parentheses</b></p></div><br class="figure-break"/><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">// Simple abbreviated combined relation condition using a single &amp;&amp;
Person( age &gt; 30 &amp;&amp; &lt; 40 )</pre><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">// Complex abbreviated combined relation using groupings
Person( age ( (&gt; 30 &amp;&amp; &lt; 40) ||
              (&gt; 20 &amp;&amp; &lt; 25) ) )</pre><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">// Mixing abbreviated combined relation with constraint connectives
Person( age &gt; 30 &amp;&amp; &lt; 40 || location == "london" )</pre></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h5 class="title"><a id="d0e5764"/>4.8.3.3.10. Special DRL operators</h5></div></div></div><div class="figure"><a id="d0e5767"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Rule_Language/operator.png" align="middle" alt="Operators"/></div></div><p class="title"><b>Figure 4.15. Operators</b></p></div><br class="figure-break"/><p>Coercion to the correct value for the evaluator and the field
        will be attempted.</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h6 class="title"><a id="d0e5775"/>4.8.3.3.10.1. The operators <code class="literal">&lt;</code>
          <code class="literal">&lt;=</code> <code class="literal">&gt;</code>
          <code class="literal">&gt;=</code></h6></div></div></div><p>These operators can be used on properties with natural
          ordering. For example, for Date fields, <code class="literal">&lt;</code>
          means <span class="emphasis"><em>before</em></span>, for <code class="literal">String</code>
          fields, it means alphabetically lower.</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">Person( firstName &lt; $otherFirstName )</pre><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">Person( birthDate &lt; $otherBirthDate )</pre><p>Only applies on <code class="literal">Comparable</code>
          properties.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h6 class="title"><a id="d0e5809"/>4.8.3.3.10.2. The operator <code class="literal">matches</code></h6></div></div></div><p>Matches a field against any valid Java <a id="d0e5816" class="indexterm"/>Regular Expression. Typically that regexp is a string
          literal, but variables that resolve to a valid regexp are also
          allowed.</p><div class="example"><a id="d0e5820"/><p class="title"><b>Example 4.37. Regular Expression Constraint</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">Cheese( type matches "(Buffalo)?\\S*Mozarella" )</pre></div></div><br class="example-break"/><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>Like in Java, regular expressions written as string literals
            <span class="emphasis"><em>need to escape '<code class="literal">\</code></em></span>'.</p></div><p>Only applies on <code class="literal">String</code> properties.
          Using <code class="literal">matches</code> against a <code class="literal">null</code> value
          always evaluates to false.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h6 class="title"><a id="d0e5844"/>4.8.3.3.10.3. The operator <code class="literal">not matches</code></h6></div></div></div><p>The operator returns true if the String does not match the
          regular expression. The same rules apply as for the
          <code class="literal">matches</code> operator. Example:</p><div class="example"><a id="d0e5854"/><p class="title"><b>Example 4.38. Regular Expression Constraint</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">Cheese( type not matches "(Buffulo)?\\S*Mozarella" )</pre></div></div><br class="example-break"/><p>Only applies on <code class="literal">String</code> properties.
          Using <code class="literal">not matches</code> against a <code class="literal">null</code> value
          always evaluates to true.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h6 class="title"><a id="d0e5870"/>4.8.3.3.10.4. The operator <code class="literal">contains</code></h6></div></div></div><p>The operator <code class="literal">contains</code> is used to check
          whether a field that is a <a id="d0e5880" class="indexterm"/>Collection or array contains the specified
          value.</p><div class="example"><a id="d0e5884"/><p class="title"><b>Example 4.39. Contains with Collections</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">CheeseCounter( cheeses contains "stilton" ) // contains with a String literal
CheeseCounter( cheeses contains $var ) // contains with a variable</pre></div></div><br class="example-break"/><p>Only applies on <code class="literal">Collection</code>
          properties.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h6 class="title"><a id="d0e5894"/>4.8.3.3.10.5. The operator <code class="literal">not contains</code></h6></div></div></div><p>The operator <code class="literal">not contains</code> is used to check
          whether a field that is a <a id="d0e5904" class="indexterm"/>Collection or array does <span class="emphasis"><em>not</em></span>
          contain the specified value.</p><div class="example"><a id="d0e5911"/><p class="title"><b>Example 4.40. Literal Constraint with Collections</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">CheeseCounter( cheeses not contains "cheddar" ) // not contains with a String literal
CheeseCounter( cheeses not contains $var ) // not contains with a variable</pre></div></div><br class="example-break"/><p>Only applies on <code class="literal">Collection</code>
          properties.</p><div class="blockquote"><blockquote class="blockquote"><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>For backward compatibility, the
              <code class="literal">excludes</code> operator is supported as a synonym
              for <code class="literal">not contains</code>.</p></div></blockquote></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h6 class="title"><a id="d0e5931"/>4.8.3.3.10.6. The operator <code class="literal">memberOf</code></h6></div></div></div><p>The operator <code class="literal">memberOf</code> is used to check
          whether a field is a member of a collection or array; that
          collection must be a variable.</p><div class="example"><a id="d0e5941"/><p class="title"><b>Example 4.41. Literal Constraint with Collections</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">CheeseCounter( cheese memberOf $matureCheeses )</pre></div></div><br class="example-break"/></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h6 class="title"><a id="d0e5946"/>4.8.3.3.10.7. The operator <code class="literal">not memberOf</code></h6></div></div></div><p>The operator <code class="literal">not memberOf</code> is used to check
          whether a field is not a member of a collection or array; that
          collection must be a variable.</p><div class="example"><a id="d0e5956"/><p class="title"><b>Example 4.42. Literal Constraint with Collections</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">CheeseCounter( cheese not memberOf $matureCheeses )</pre></div></div><br class="example-break"/></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h6 class="title"><a id="d0e5961"/>4.8.3.3.10.8. The operator <code class="literal">soundslike</code></h6></div></div></div><p>This operator is similar to <code class="literal">matches</code>, but it
          checks whether a word has almost the same sound (using English
          pronunciation) as the given value. This is based on the Soundex
          algorithm (see
          <code class="code">http://en.wikipedia.org/wiki/Soundex</code>).</p><div class="example"><a id="d0e5974"/><p class="title"><b>Example 4.43. Test with soundslike</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">// match cheese "fubar" or "foobar"
Cheese( name soundslike 'foobar' )</pre></div></div><br class="example-break"/></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h6 class="title"><a id="d0e5979"/>4.8.3.3.10.9. The operator <code class="literal">str</code></h6></div></div></div><p>This operator <code class="literal">str</code> is used to check whether
          a field that is a <code class="literal">String</code> starts with or ends with
          a certain value. It can also be used to check the length of the
          String.</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">Message( routingValue str[startsWith] "R1" )</pre><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">Message( routingValue str[endsWith] "R2" )</pre><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">Message( routingValue str[length] 17 )</pre></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h6 class="title"><a id="d0e5998"/>4.8.3.3.10.10. The operators <code class="literal">in</code> and <code class="literal">not
          in</code> (compound value restriction)</h6></div></div></div><p>The compound value restriction is used where there is more
          than one possible value to match. Currently only the
          <code class="literal">in</code> and <code class="literal">not in</code> evaluators
          support this. The second operand of this operator must be a
          comma-separated list of values, enclosed in parentheses. Values may
          be given as variables, literals, return values or qualified
          identifiers. Both evaluators are actually <span class="emphasis"><em>syntactic
          sugar</em></span>, internally rewritten as a list of multiple
          restrictions using the operators <code class="literal">!=</code> and
          <code class="literal">==</code>.</p><div class="figure"><a id="d0e6024"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Rule_Language/compoundValueRestriction.png" align="middle" alt="compoundValueRestriction"/></div></div><p class="title"><b>Figure 4.16. compoundValueRestriction</b></p></div><br class="figure-break"/><div class="example"><a id="d0e6030"/><p class="title"><b>Example 4.44. Compound Restriction using "in"</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">Person( $cheese : favouriteCheese )
Cheese( type in ( "stilton", "cheddar", $cheese ) )</pre></div></div><br class="example-break"/></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h5 class="title"><a id="d0e6035"/>4.8.3.3.11. Inline eval operator (deprecated)</h5></div></div></div><div class="figure"><a id="d0e6038"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Rule_Language/inlineEvalConstraint.png" align="middle" alt="Inline Eval Expression"/></div></div><p class="title"><b>Figure 4.17. Inline Eval Expression</b></p></div><br class="figure-break"/><p>An <a id="d0e6046" class="indexterm"/>inline eval constraint can use any valid dialect
        expression as long as it results to a primitive boolean. The
        expression must be constant over time. Any previously bound variable,
        from the current or previous pattern, can be used; autovivification is
        also used to auto-create field binding variables. When an identifier
        is found that is not a current variable, the builder looks to see if
        the identifier is a field on the current object type, if it is, the
        field binding is auto-created as a variable of the same name. This is
        called autovivification of field variables inside of inline
        eval's.</p><p>This example will find all male-female pairs where the male is 2
        years older than the female; the variable <code class="code">age</code> is
        auto-created in the second pattern by the autovivification
        process.</p><div class="example"><a id="d0e6055"/><p class="title"><b>Example 4.45. Return Value operator</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">Person( girlAge : age, sex = "F" )
Person( eval( age == girlAge + 2 ), sex = 'M' ) // eval() is actually obsolete in this example</pre></div></div><br class="example-break"/><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>Inline eval's are effectively obsolete as their inner syntax
          is now directly supported. It's recommended not to use them. Simply
          write the expression without wrapping eval() around it.</p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h5 class="title"><a id="d0e6063"/>4.8.3.3.12. Operator precedence</h5></div></div></div><p>The operators are evaluated in this precedence:</p><div class="table"><a id="d0e6068"/><p class="title"><b>Table 4.1. Operator precedence</b></p><div class="table-contents"><table summary="Operator precedence" border="1"><colgroup><col/><col/><col/></colgroup><thead><tr><th align="center">Operator type</th><th align="center">Operators</th><th align="center">Notes</th></tr></thead><tbody><tr><td>(nested) property access</td><td><code class="literal">.</code></td><td>Not normal Java semantics</td></tr><tr><td>List/Map access</td><td><code class="literal">[ ]</code></td><td>Not normal Java semantics</td></tr><tr><td>constraint binding</td><td><code class="literal">:</code></td><td>Not normal Java semantics</td></tr><tr><td>multiplicative</td><td><code class="literal">*</code> <code class="literal">/</code>
                <code class="literal">%</code></td><td> </td></tr><tr><td>additive</td><td><code class="literal">+</code> <code class="literal">-</code></td><td> </td></tr><tr><td>shift</td><td><code class="literal">&lt;&lt;</code> <code class="literal">&gt;&gt;</code>
                <code class="literal">&gt;&gt;&gt;</code></td><td> </td></tr><tr><td>relational</td><td><code class="literal">&lt;</code> <code class="literal">&gt;</code>
                <code class="literal">&lt;=</code> <code class="literal">&gt;=</code>
                <code class="literal">instanceof</code></td><td> </td></tr><tr><td>equality</td><td><code class="literal">==</code> <code class="literal">!=</code></td><td>Does not use normal Java (<span class="emphasis"><em>not</em></span>)
                <span class="emphasis"><em>same</em></span> semantics: uses
                (<span class="emphasis"><em>not</em></span>) <span class="emphasis"><em>equals</em></span>
                semantics instead.</td></tr><tr><td>non-short circuiting AND</td><td><code class="literal">&amp;</code></td><td> </td></tr><tr><td>non-short circuiting exclusive OR</td><td><code class="literal">^</code></td><td> </td></tr><tr><td>non-short circuiting inclusive OR</td><td><code class="literal">|</code></td><td> </td></tr><tr><td>logical AND</td><td><code class="literal">&amp;&amp;</code></td><td> </td></tr><tr><td>logical OR</td><td><code class="literal">||</code></td><td> </td></tr><tr><td>ternary</td><td><code class="literal">? :</code></td><td> </td></tr><tr><td>Comma separated AND</td><td><code class="literal">,</code></td><td>Not normal Java semantics</td></tr></tbody></table></div></div><br class="table-break"/></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e6233"/>4.8.3.4. Positional Arguments</h4></div></div></div><p>Patterns now support positional arguments on type
      declarations.</p><p>Positional arguments are ones where you don't need to specify the
      field name, as the position maps to a known named field. i.e. Person(
      name == "mark" ) can be rewritten as Person( "mark"; ). The semicolon
      ';' is important so that the engine knows that everything before it is a
      positional argument. Otherwise we might assume it was a boolean
      expression, which is how it could be interpreted after the semicolon.
      You can mix positional and named arguments on a pattern by using the
      semicolon ';' to separate them. Any variables used in a positional that
      have not yet been bound will be bound to the field that maps to that
      position.</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">declare Cheese
    name : String
    shop : String
    price : int
end
</pre><p>Example patterns, with two constraints and a binding. Remember
      semicolon ';' is used to differentiate the positional section from the
      named argument section. Variables and literals and expressions using
      just literals are supported in positional arguments, but not variables.
      Positional arguments are always resolved using unification.</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">Cheese( "stilton", "Cheese Shop", p; )
Cheese( "stilton", "Cheese Shop"; p : price )
Cheese( "stilton"; shop == "Cheese Shop", p : price )
Cheese( name == "stilton"; shop == "Cheese Shop", p : price )
</pre><p>Positional arguments that are given a previously declared binding
      will constrain against that using unification; these are referred to as
      input arguments. If the binding does not yet exist, it will create the
      declaration binding it to the field represented by the position
      argument; these are referred to as output arguments.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e6248"/>4.8.3.5. Fine grained property change listeners</h4></div></div></div><p>When you call modify() (see the modify statement section) on a given object it will trigger a revaluation of all
          patterns of the matching object type in the knowledge base. This can can lead to unwanted and useless evaluations
          and in the worst cases to infinite recursions. The only workaround to avoid it was to split up your objects into
          smaller ones having a 1 to 1 relationship with the original object.</p><p>This feature allows the pattern matching to only react to modification of properties actually
          constrained or bound inside of a given pattern. That will help with performance and recursion and avoid artificial
          object splitting.</p><p>By default this feature is off in order to make the behavior of the rule engine backward compatible with the
          former releases. When you want to activate it on a specific bean you have to annotate it with @propertyReactive.
          This annotation works both on drl type declarations:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">declare Person
          @propertyReactive
          firstName : String
          lastName : String
          end</pre><p>and on Java classes:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">@PropertyReactive
          public static class Person {
          private String firstName;
          private String lastName;
          }</pre><p>In this way, for instance, if you have a rule like the following:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">rule "Every person named Mario is a male" when
          $person : Person( firstName == "Mario" )
          then
          modify ( $person )  { setMale( true ) }
          end</pre><p>you won't have to add the no-loop attribute to it in order to avoid an infinite recursion because the engine
          recognizes that the pattern matching is done on the 'firstName' property while the RHS of the rule modifies the
          'male' one. Note that this feature does not work for update(), and this is one of the reasons why we promote
          modify() since it encapsulates the field changes within the statement. Moreover, on Java classes, you can also
          annotate any method to say that its invocation actually modifies other properties. For instance in the former
          Person class you could have a method like:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">@Modifies( { "firstName", "lastName" } )
          public void setName(String name) {
          String[] names = name.split("\\s");
          this.firstName = names[0];
          this.lastName = names[1];
          }</pre><p>That means that if a rule has a RHS like the following:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">modify($person) { setName("Mario Fusco") }</pre><p>it will correctly recognize that the values of both properties 'firstName' and 'lastName' could have
          potentially been modified and act accordingly, not missing of reevaluating the patterns constrained on them. At
          the moment the usage of @Modifies is not allowed on fields but only on methods. This is coherent with the most
          common scenario where the @Modifies will be used for methods that are not related with a class field as in the
          Person.setName() in the former example. Also note that @Modifies is not transitive, meaning that if another method
          internally invokes the Person.setName() one it won't be enough to annotate it with @Modifies( { "name" } ), but it
          is necessary to use @Modifies( { "firstName", "lastName" } ) even on it. Very likely @Modifies transitivity will
          be implemented in the next release.</p><p>For what regards nested accessors, the engine will be notified only for top level fields. In other words a
          pattern matching like:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">Person ( address.city.name == "London ) </pre><p>will be revaluated only for modification of the 'address' property of a Person object. In the same way the
          constraints analysis is currently strictly limited to what there is inside a pattern. Another example could help
          to clarify this. An LHS like the following:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">$p : Person( )
          Car( owner = $p.name )</pre><p>will not listen on modifications of the person's name, while this one will do:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">Person( $name : name )
          Car( owner = $name )</pre><p>To overcome this problem it is possible to annotate a pattern with @watch as it follows:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">$p : Person( ) @watch ( name )
          Car( owner = $p.name )</pre><p>Indeed, annotating a pattern with @watch allows you to modify the inferred set of properties for which that
          pattern will react. Note that the properties named in the @watch annotation are actually added to the ones
          automatically inferred, but it is also possible to explicitly exclude one or more of them prepending their name
          with a ! and to make the pattern to listen for all or none of the properties of the type used in the pattern
          respectively with the wildcrds * and !*. So, for example, you can annotate a pattern in the LHS of a rule
          like:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">// listens for changes on both firstName (inferred) and lastName
          Person( firstName == $expectedFirstName ) @watch( lastName )

          // listens for all the properties of the Person bean
          Person( firstName == $expectedFirstName ) @watch( * )

          // listens for changes on lastName and explicitly exclude firstName
          Person( firstName == $expectedFirstName ) @watch( lastName, !firstName )

          // listens for changes on all the properties except the age one
          Person( firstName == $expectedFirstName ) @watch( *, !age )</pre><p>Since doesn't make sense to use this annotation on a pattern using a type not annotated with
          @PropertyReactive the rule compiler will raise a compilation error if you try to do so. Also the duplicated usage
          of the same property in @watch (for example like in: @watch( firstName, ! firstName ) ) will end up in a
          compilation error. In a next release we will make the automatic detection of the properties to be listened smarter
          by doing analysis even outside of the pattern.</p><p>It also possible to enable this feature by default on all the types of your model or to completely disallow
          it by using on option of the KnowledgeBuilderConfiguration. In particular this new PropertySpecificOption can have
          one of the following 3 values:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">- DISABLED =&gt; the feature is turned off and all the other related annotations are just ignored
          - ALLOWED =&gt; this is the default behavior: types are not property reactive unless they are not annotated with @PropertySpecific
          - ALWAYS =&gt; all types are property reactive by default</pre><p>So, for example, to have a KnowledgeBuilder generating property reactive types by default you could
          do:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">KnowledgeBuilderConfiguration config = KnowledgeBuilderFactory.newKnowledgeBuilderConfiguration();
          config.setOption(PropertySpecificOption.ALWAYS);
          KnowledgeBuilder kbuilder = KnowledgeBuilderFactory.newKnowledgeBuilder(config);</pre><p>In this last case it will be possible to disable the property reactivity feature on a specific type by
          annotating it with @ClassReactive.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e6309"/>4.8.3.6. Basic conditional elements</h4></div></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h5 class="title"><a id="d0e6312"/>4.8.3.6.1. Conditional Element <code class="literal">and</code></h5></div></div></div><p>The Conditional Element <code class="literal">"and"</code> is used to
        group other Conditional Elements into a logical conjunction. Drools
        supports both prefix <code class="literal">and</code> and infix
        <code class="literal">and</code>.</p><div class="figure"><a id="d0e6328"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Rule_Language/infixAnd.png" align="middle" alt="infixAnd"/></div></div><p class="title"><b>Figure 4.18. infixAnd</b></p></div><br class="figure-break"/><p>Traditional infix <code class="literal">and</code> is supported:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">//infixAnd
Cheese( cheeseType : type ) and Person( favouriteCheese == cheeseType )</pre><p>Explicit grouping with parentheses is also supported:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">//infixAnd with grouping
( Cheese( cheeseType : type ) and
  ( Person( favouriteCheese == cheeseType ) or 
    Person( favouriteCheese == cheeseType ) )</pre><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>The symbol <code class="literal">&amp;&amp;</code> (as an alternative to
          <code class="literal">and</code>) is deprecated. But it is still supported in
          the syntax for backwards compatibility.</p></div><div class="figure"><a id="d0e6354"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Rule_Language/prefixAnd.png" align="middle" alt="prefixAnd"/></div></div><p class="title"><b>Figure 4.19. prefixAnd</b></p></div><br class="figure-break"/><p>Prefix <code class="literal">and</code> is also supported:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">(and Cheese( cheeseType : type )
     Person( favouriteCheese == cheeseType ) )</pre><p>The root element of the LHS is an implicit prefix
        <code class="literal">and</code> and doesn't need to be specified:</p><div class="example"><a id="d0e6372"/><p class="title"><b>Example 4.46. implicit root prefixAnd</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">when
    Cheese( cheeseType : type )
    Person( favouriteCheese == cheeseType )
then
    ...</pre></div></div><br class="example-break"/></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h5 class="title"><a id="d0e6377"/>4.8.3.6.2. Conditional Element <code class="literal">or</code></h5></div></div></div><p>The Conditional Element <code class="literal">or</code> is used to group
        other Conditional Elements into a logical disjunction. Drools supports
        both prefix <code class="literal">or</code> and infix
        <code class="literal">or</code>.</p><div class="figure"><a id="d0e6393"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Rule_Language/infixOr.png" align="middle" alt="infixOr"/></div></div><p class="title"><b>Figure 4.20. infixOr</b></p></div><br class="figure-break"/><p>Traditional infix <code class="literal">or</code> is supported:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">//infixOr
Cheese( cheeseType : type ) or Person( favouriteCheese == cheeseType )</pre><p>Explicit grouping with parentheses is also supported:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">//infixOr with grouping
( Cheese( cheeseType : type ) or
  ( Person( favouriteCheese == cheeseType ) and
    Person( favouriteCheese == cheeseType ) )</pre><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>The symbol <code class="literal">||</code> (as an alternative to
          <code class="literal">or</code>) is deprecated. But it is still supported in
          the syntax for backwards compatibility.</p></div><div class="figure"><a id="d0e6419"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Rule_Language/prefixOr.png" align="middle" alt="prefixOr"/></div></div><p class="title"><b>Figure 4.21. prefixOr</b></p></div><br class="figure-break"/><p>Prefix <code class="literal">or</code> is also supported:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">(or Person( sex == "f", age &gt; 60 )
    Person( sex == "m", age &gt; 65 )</pre><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>The behavior of the Conditional Element <code class="literal">or</code>
          is different from the connective <code class="literal">||</code> for
          constraints and restrictions in field constraints. The engine
          actually has no understanding of the Conditional Element
          <code class="literal">or</code>. Instead, via a number of different logic
          transformations, a rule with <code class="literal">or</code> is rewritten as a
          number of subrules. This process ultimately results in a rule that
          has a single <code class="literal">or</code> as the root node and one subrule
          for each of its CEs. Each subrule can activate and fire like any
          normal rule; there is no special behavior or interaction between
          these subrules. - This can be most confusing to new rule
          authors.</p></div><p>The Conditional Element <code class="literal">or</code> also allows for
        optional pattern binding. This means that each resulting subrule will
        bind its pattern to the pattern binding. Each pattern must be bound
        separately, using eponymous variables:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">pensioner : ( Person( sex == "f", age &gt; 60 ) or Person( sex == "m", age &gt; 65 ) )</pre><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">(or pensioner : Person( sex == "f", age &gt; 60 ) 
    pensioner : Person( sex == "m", age &gt; 65 ) )</pre><p>Since the conditional element <code class="literal">or</code> results in
        multiple subrule generation, one for each possible logically outcome,
        the example above would result in the internal generation of two
        rules. These two rules work independently within the Working Memory,
        which means both can match, activate and fire - there is no
        shortcutting.</p><p>The best way to think of the conditional element
        <code class="literal">or</code> is as a shortcut for generating two or more
        similar rules. When you think of it that way, it's clear that for a
        single rule there could be multiple activations if two or more terms
        of the disjunction are true.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h5 class="title"><a id="d0e6469"/>4.8.3.6.3. Conditional Element <code class="literal">not</code></h5></div></div></div><div class="figure"><a id="d0e6474"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Rule_Language/not.png" align="middle" alt="not"/></div></div><p class="title"><b>Figure 4.22. not</b></p></div><br class="figure-break"/><p>The CE <code class="literal">not</code> is first order logic's
        non-existential quantifier and checks for the non-existence of
        something in the Working Memory. Think of "not" as meaning "there must
        be none of...".</p><p>The keyword <code class="literal">not</code> may be followed by
        parentheses around the CEs that it applies to. In the simplest case of
        a single pattern (like below) you may optionally omit the
        parentheses.</p><div class="example"><a id="d0e6490"/><p class="title"><b>Example 4.47. No Busses</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">not Bus()</pre></div></div><br class="example-break"/><div class="example"><a id="d0e6495"/><p class="title"><b>Example 4.48. No red Busses</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">// Brackets are optional:
not Bus(color == "red")
// Brackets are optional:
not ( Bus(color == "red", number == 42) )
// "not" with nested infix <code xmlns="http://www.w3.org/1999/xhtml" class="literal">and</code> - two patterns,
// brackets are requires:
not ( Bus(color == "red") and
      Bus(color == "blue") )</pre></div></div><br class="example-break"/></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h5 class="title"><a id="d0e6503"/>4.8.3.6.4. Conditional Element <code class="literal">exists</code></h5></div></div></div><div class="figure"><a id="d0e6508"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Rule_Language/exists.png" align="middle" alt="exists"/></div></div><p class="title"><b>Figure 4.23. exists</b></p></div><br class="figure-break"/><p>The CE <code class="literal">exists</code> is first order logic's
        existential quantifier and checks for the existence of something in
        the Working Memory. Think of "exists" as meaning "there is at least
        one..". It is different from just having the pattern on its own, which
        is more like saying "for each one of...". If you use
        <code class="literal">exists</code> with a pattern, the rule will only activate
        at most once, regardless of how much data there is in working memory
        that matches the condition inside of the <code class="literal">exists</code>
        pattern. Since only the existence matters, no bindings will be
        established.</p><p>The keyword <code class="literal">exists</code> must be followed by
        parentheses around the CEs that it applies to. In the simplest case of
        a single pattern (like below) you may omit the parentheses.</p><div class="example"><a id="d0e6530"/><p class="title"><b>Example 4.49. At least one Bus</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">exists Bus()</pre></div></div><br class="example-break"/><div class="example"><a id="d0e6535"/><p class="title"><b>Example 4.50. At least one red Bus</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">exists Bus(color == "red")
// brackets are optional:
exists ( Bus(color == "red", number == 42) )
// "exists" with nested infix <code xmlns="http://www.w3.org/1999/xhtml" class="literal">and</code>,
// brackets are required:
exists ( Bus(color == "red") and
         Bus(color == "blue") )</pre></div></div><br class="example-break"/></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e6543"/>4.8.3.7. Advanced conditional elements</h4></div></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h5 class="title"><a id="d0e6546"/>4.8.3.7.1. Conditional Element <code class="literal">forall</code></h5></div></div></div><div class="figure"><a id="d0e6551"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Rule_Language/forall.png" align="middle" alt="forall"/></div></div><p class="title"><b>Figure 4.24. forall</b></p></div><br class="figure-break"/><p>The Conditional Element <code class="literal">forall</code> completes the
        First Order Logic support in Drools. The Conditional Element
        <code class="literal">forall</code> evaluates to true when all facts that match
        the first pattern match all the remaining patterns. Example:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">rule "All English buses are red"
when
    forall( $bus : Bus( type == 'english') 
                   Bus( this == $bus, color = 'red' ) )
then
    // all English buses are red
end</pre><p>In the above rule, we "select" all Bus objects whose type is
        "english". Then, for each fact that matches this pattern we evaluate
        the following patterns and if they match, the forall CE will evaluate
        to true.</p><p>To state that all facts of a given type in the working memory
        must match a set of constraints, <code class="literal">forall</code> can be
        written with a single pattern for simplicity. Example:</p><div class="example"><a id="d0e6574"/><p class="title"><b>Example 4.51. Single Pattern Forall</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">rule "All Buses are Red"
when
    forall( Bus( color == 'red' ) )
then
    // all Bus facts are red
end</pre></div></div><br class="example-break"/><p>Another example shows multiple patterns inside the
        <code class="literal">forall</code>:</p><div class="example"><a id="d0e6584"/><p class="title"><b>Example 4.52. Multi-Pattern Forall</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">rule "all employees have health and dental care programs"
when
    forall( $emp : Employee()
            HealthCare( employee == $emp )
            DentalCare( employee == $emp )
          )
then
    // all employees have health and dental care
end</pre></div></div><br class="example-break"/><p>Forall can be nested inside other CEs. For instance,
        <code class="literal">forall</code> can be used inside a <code class="literal">not</code>
        CE. Note that only single patterns have optional parentheses, so that
        with a nested <code class="literal">forall</code> parentheses must be
        used:</p><div class="example"><a id="d0e6600"/><p class="title"><b>Example 4.53. Combining Forall with Not CE</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">rule "not all employees have health and dental care"
when 
    not ( forall( $emp : Employee()
                  HealthCare( employee == $emp )
                  DentalCare( employee == $emp ) ) 
        )
then
    // not all employees have health and dental care
end</pre></div></div><br class="example-break"/><p>As a side note, <code class="code">forall( p1 p2 p3...)</code> is equivalent
        to writing:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">not(p1 and not(and p2 p3...))</pre><p>Also, it is important to note that <code class="literal">forall</code> is
        a <span class="emphasis"><em>scope delimiter</em></span>. Therefore, it can use any
        previously bound variable, but no variable bound inside it will be
        available for use outside of it.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h5 class="title"><a id="d0e6620"/>4.8.3.7.2. Conditional Element <code class="literal">from</code></h5></div></div></div><div class="figure"><a id="d0e6625"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Rule_Language/from.png" align="middle" alt="from"/></div></div><p class="title"><b>Figure 4.25. from</b></p></div><br class="figure-break"/><p>The Conditional Element <code class="literal">from</code> enables users to
        specify an arbitrary source for data to be matched by LHS patterns.
        This allows the engine to reason over data not in the Working Memory.
        The data source could be a sub-field on a bound variable or the
        results of a method call. It is a powerful construction that allows
        out of the box integration with other application components and
        frameworks. One common example is the integration with data retrieved
        on-demand from databases using hibernate named queries.</p><p>The expression used to define the object source is any
        expression that follows regular MVEL syntax. Therefore, it allows you
        to easily use object property navigation, execute method calls and
        access maps and collections elements.</p><p>Here is a simple example of reasoning and binding on another
        pattern sub-field:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">rule "validate zipcode"
when
    Person( $personAddress : address ) 
    Address( zipcode == "23920W") from $personAddress 
then
    // zip code is ok
end</pre><p>With all the flexibility from the new expressiveness in the
        Drools engine you can slice and dice this problem many ways. This is
        the same but shows how you can use a graph notation with the
        'from':</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">rule "validate zipcode"
when
    $p : Person( ) 
    $a : Address( zipcode == "23920W") from $p.address 
then
    // zip code is ok
end</pre><p>Previous examples were evaluations using a single pattern. The
        CE <code class="literal">from</code> also support object sources that return a
        collection of objects. In that case, <code class="literal">from</code> will
        iterate over all objects in the collection and try to match each of
        them individually. For instance, if we want a rule that applies 10%
        discount to each item in an order, we could do:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">rule "apply 10% discount to all items over US$ 100,00 in an order"
when
    $order : Order()
    $item  : OrderItem( value &gt; 100 ) from $order.items
then
    // apply discount to $item
end</pre><p>The above example will cause the rule to fire once for each item
        whose value is greater than 100 for each given order.</p><p>You must take caution, however, when using
        <code class="literal">from</code>, especially in conjunction with the
        <code class="literal">lock-on-active</code> rule attribute as it may produce
        unexpected results. Consider the example provided earlier, but now
        slightly modified as follows:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">rule "Assign people in North Carolina (NC) to sales region 1"
ruleflow-group "test"
lock-on-active true
when
    $p : Person( ) 
    $a : Address( state == "NC") from $p.address 
then
    modify ($p) {} // Assign person to sales region 1 in a modify block
end

rule "Apply a discount to people in the city of Raleigh"
ruleflow-group "test"
lock-on-active true
when
    $p : Person( ) 
    $a : Address( city == "Raleigh") from $p.address 
then
    modify ($p) {} // Apply discount to person in a modify block
end</pre><p>In the above example, persons in Raleigh, NC should be assigned
        to sales region 1 and receive a discount; i.e., you would expect both
        rules to activate and fire. Instead you will find that only the second
        rule fires.</p><p>If you were to turn on the audit log, you would also see that
        when the second rule fires, it deactivates the first rule. Since the
        rule attribute <code class="literal">lock-on-active</code> prevents a rule from
        creating new activations when a set of facts change, the first rule
        fails to reactivate. Though the set of facts have not changed, the use
        of <code class="literal">from</code> returns a new fact for all intents and
        purposes each time it is evaluated.</p><p>First, it's important to review why you would use the above
        pattern. You may have many rules across different rule-flow groups.
        When rules modify working memory and other rules downstream of your
        RuleFlow (in different rule-flow groups) need to be reevaluated, the
        use of <code class="literal">modify</code> is critical. You don't, however, want
        other rules in the same rule-flow group to place activations on one
        another recursively. In this case, the <code class="literal">no-loop</code>
        attribute is ineffective, as it would only prevent a rule from
        activating itself recursively. Hence, you resort to
        <code class="literal">lock-on-active</code>.</p><p>There are several ways to address this issue:</p><div class="itemizedlist"><ul><li><p>Avoid the use of <code class="literal">from</code> when you can assert
            all facts into working memory or use nested object references in
            your constraint expressions (shown below).</p></li><li><p>Place the variable assigned used in the modify block as the
            last sentence in your condition (LHS).</p></li><li><p>Avoid the use of <code class="literal">lock-on-active</code> when you
            can explicitly manage how rules within the same rule-flow group
            place activations on one another (explained below).</p></li></ul></div><p>The preferred solution is to minimize use of
        <code class="literal">from</code> when you can assert all your facts into
        working memory directly. In the example above, both the Person and
        Address instance can be asserted into working memory. In this case,
        because the graph is fairly simple, an even easier solution is to
        modify your rules as follows:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">rule "Assign people in North Carolina (NC) to sales region 1"
ruleflow-group "test"
lock-on-active true
when
    $p : Person(address.state == "NC" )  
then
    modify ($p) {} // Assign person to sales region 1 in a modify block
end

rule "Apply a discount to people in the city of Raleigh"
ruleflow-group "test"
lock-on-active true
when
    $p : Person(address.city == "Raleigh" )  
then
    modify ($p) {} //Apply discount to person in a modify block
end</pre><p>Now, you will find that both rules fire as expected. However, it
        is not always possible to access nested facts as above. Consider an
        example where a Person holds one or more Addresses and you wish to use
        an existential quantifier to match people with at least one address
        that meets certain conditions. In this case, you would have to resort
        to the use of <code class="literal">from</code> to reason over the
        collection.</p><p>There are several ways to use <code class="literal">from</code> to achieve
        this and not all of them exhibit an issue with the use of
        <code class="literal">lock-on-active</code>. For example, the following use of
        <code class="literal">from</code> causes both rules to fire as expected:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">rule "Assign people in North Carolina (NC) to sales region 1"
ruleflow-group "test"
lock-on-active true
when
    $p : Person($addresses : addresses)
    exists (Address(state == "NC") from $addresses)  
then
    modify ($p) {} // Assign person to sales region 1 in a modify block
end

rule "Apply a discount to people in the city of Raleigh"
ruleflow-group "test"
lock-on-active true
when
    $p : Person($addresses : addresses)
    exists (Address(city == "Raleigh") from $addresses)  
then
    modify ($p) {} // Apply discount to person in a modify block
end</pre><p>However, the following slightly different approach does exhibit
        the problem:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">rule "Assign people in North Carolina (NC) to sales region 1"
ruleflow-group "test"
lock-on-active true
when
    $assessment : Assessment()
    $p : Person()
    $addresses : List() from $p.addresses
    exists (Address( state == "NC") from $addresses) 
then
    modify ($assessment) {} // Modify assessment in a modify block
end

rule "Apply a discount to people in the city of Raleigh"
ruleflow-group "test"
lock-on-active true
when
    $assessment : Assessment()
    $p : Person()
    $addresses : List() from $p.addresses 
    exists (Address( city == "Raleigh") from $addresses)
then
    modify ($assessment) {} // Modify assessment in a modify block
end</pre><p>In the above example, the $addresses variable is returned from
        the use of <code class="literal">from</code>. The example also introduces a new
        object, assessment, to highlight one possible solution in this case.
        If the $assessment variable assigned in the condition (LHS) is moved
        to the last condition in each rule, both rules fire as
        expected.</p><p>Though the above examples demonstrate how to combine the use of
        <code class="literal">from</code> with <code class="literal">lock-on-active</code> where
        no loss of rule activations occurs, they carry the drawback of placing
        a dependency on the order of conditions on the LHS. In addition, the
        solutions present greater complexity for the rule author in terms of
        keeping track of which conditions may create issues.</p><p>A better alternative is to assert more facts into working
        memory. In this case, a person's addresses may be asserted into
        working memory and the use of <code class="literal">from</code> would not be
        necessary.</p><p>There are cases, however, where asserting all data into working
        memory is not practical and we need to find other solutions. Another
        option is to reevaluate the need for
        <code class="literal">lock-on-active</code>. An alternative to
        <code class="literal">lock-on-active</code> is to directly manage how rules
        within the same rule-flow group activate one another by including
        conditions in each rule that prevent rules from activating each other
        recursively when working memory is modified. For example, in the case
        above where a discount is applied to citizens of Raleigh, a condition
        may be added to the rule that checks whether the discount has already
        been applied. If so, the rule does not activate.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h5 class="title"><a id="d0e6762"/>4.8.3.7.3. Conditional Element <code class="literal">collect</code></h5></div></div></div><div class="figure"><a id="d0e6767"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Rule_Language/collect.png" align="middle" alt="collect"/></div></div><p class="title"><b>Figure 4.26. collect</b></p></div><br class="figure-break"/><p>The Conditional Element <code class="literal">collect</code> allows rules
        to reason over a collection of objects obtained from the given source
        or from the working memory. In First Oder Logic terms this is the
        cardinality quantifier. A simple example:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">import java.util.ArrayList

rule "Raise priority if system has more than 3 pending alarms"
when
    $system : System()
    $alarms : ArrayList( size &gt;= 3 )
              from collect( Alarm( system == $system, status == 'pending' ) )
then
    // Raise priority, because system $system has
    // 3 or more alarms pending. The pending alarms
    // are $alarms.
end</pre><p>In the above example, the rule will look for all pending alarms
        in the working memory for each given system and group them in
        ArrayLists. If 3 or more alarms are found for a given system, the rule
        will fire.</p><p>The result pattern of <code class="literal">collect</code> can be any
        concrete class that implements the <code class="code">java.util.Collection</code>
        interface and provides a default no-arg public constructor. This means
        that you can use Java collections like ArrayList, LinkedList, HashSet,
        etc., or your own class, as long as it implements the
        <code class="code">java.util.Collection</code> interface and provide a default
        no-arg public constructor.</p><p>Both source and result patterns can be constrained as any other
        pattern.</p><p>Variables bound before the <code class="literal">collect</code> CE are in
        the scope of both source and result patterns and therefore you can use
        them to constrain both your source and result patterns. But note that
        <code class="literal">collect</code> is a scope delimiter for bindings, so that
        any binding made inside of it is not available for use outside of
        it.</p><p>Collect accepts nested <code class="literal">from</code> CEs. The
        following example is a valid use of "collect":</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">import java.util.LinkedList;

rule "Send a message to all mothers"
when
    $town : Town( name == 'Paris' )
    $mothers : LinkedList() 
               from collect( Person( gender == 'F', children &gt; 0 ) 
                             from $town.getPeople() 
                           )
then
    // send a message to all mothers
end</pre></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h5 class="title"><a id="d0e6810"/>4.8.3.7.4. Conditional Element <code class="literal">accumulate</code></h5></div></div></div><div class="figure"><a id="d0e6815"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Rule_Language/accumulate.png" align="middle" alt="accumulate"/></div></div><p class="title"><b>Figure 4.27. accumulate</b></p></div><br class="figure-break"/><p>The Conditional Element <code class="literal">accumulate</code> is a more
        flexible and powerful form of <code class="literal">collect</code>, in the sense
        that it can be used to do what <code class="literal">collect</code> does and
        also achieve results that the CE <code class="literal">collect</code> is not
        capable of doing. Basically, what it does is that it allows a rule to
        iterate over a collection of objects, executing custom actions for
        each of the elements, and at the end it returns a result
        object.</p><p>Accumulate supports both the use of pre-defined accumulate
        functions, or the use of inline custom code. Inline custom code should
        be avoided though, as it is harder for rule authors to maintain, and
        frequently leads to code duplication. Accumulate functions are easier
        to test and reuse.</p><p>The Accumulate CE also supports multiple different syntaxes. The
        preferred syntax is the top level accumulate, as noted bellow, but all
        other syntaxes are supported for backward compatibility.</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h6 class="title"><a id="d0e6839"/>4.8.3.7.4.1. Accumulate CE (preferred syntax)</h6></div></div></div><p>The top level accumulate syntax is the most compact and
          flexible syntax. The simplified syntax is as follows:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class=""><code xmlns="http://www.w3.org/1999/xhtml" class="literal">accumulate( </code><em xmlns="http://www.w3.org/1999/xhtml" class="replaceable"><code>&lt;source pattern&gt;</code></em><code xmlns="http://www.w3.org/1999/xhtml" class="literal">; </code><em xmlns="http://www.w3.org/1999/xhtml" class="replaceable"><code>&lt;functions&gt;</code></em><code xmlns="http://www.w3.org/1999/xhtml" class="literal"> [;</code><em xmlns="http://www.w3.org/1999/xhtml" class="replaceable"><code>&lt;constraints&gt;</code></em><code xmlns="http://www.w3.org/1999/xhtml" class="literal">] )</code>
</pre><p>For instance, a rule to calculate the minimum, maximum and
          average temperature reading for a given sensor and that raises an
          alarm if the minimum temperature is under 20C degrees and the
          average is over 70C degrees could be written in the following way,
          using Accumulate:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">rule "Raise alarm"
when
    $s : Sensor()
    accumulate( Reading( sensor == $s, $temp : temperature );
                $min : min( $temp ),
                $max : max( $temp ),
                $avg : average( $temp );
                $min &lt; 20, $avg &gt; 70 )
then
    // raise the alarm
end</pre><p>In the above example, min, max and average are Accumulate
          Functions and will calculate the minimum, maximum and average
          temperature values over all the readings for each sensor.</p><p>Drools ships with several built-in accumulate functions,
          including:</p><div class="itemizedlist"><ul><li><p>average</p></li><li><p>min</p></li><li><p>max</p></li><li><p>count</p></li><li><p>sum</p></li><li><p>collectList</p></li><li><p>collectSet</p></li></ul></div><p>These common functions accept any expression as input. For
          instance, if someone wants to calculate the average profit on all
          items of an order, a rule could be written using the average
          function:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">rule "Average profit"
when
    $order : Order()
    accumulate( OrderItem( order == $order, $cost : cost, $price : price );
                $avgProfit : average( 1 - $cost / $price ) )
then
    // average profit for $order is $avgProfit
end</pre><p>Accumulate Functions are all pluggable. That means that if
          needed, custom, domain specific functions can easily be added to the
          engine and rules can start to use them without any restrictions. To
          implement a new Accumulate Function all one needs to do is to create
          a Java class that implements the
          <code class="code">org.drools.runtime.rule.TypedAccumulateFunction</code>
          interface and add a line to the configuration file or set a system
          property to let the engine know about the new function. As an
          example of an Accumulate Function implementation, the following is
          the implementation of the <code class="literal">average</code>
          function:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_javadoc_comment">/**</span>
<!--  --><br/><span class="java_javadoc_comment">&nbsp;*&nbsp;An&nbsp;implementation&nbsp;of&nbsp;an&nbsp;accumulator&nbsp;capable&nbsp;of&nbsp;calculating&nbsp;average&nbsp;values</span>
<!--  --><br/><span class="java_javadoc_comment">&nbsp;*/</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">AverageAccumulateFunction</span><span class="java_plain">&nbsp;</span><span class="java_keyword">implements</span><span class="java_plain">&nbsp;org</span><span class="java_separator">.</span><span class="java_plain">drools</span><span class="java_separator">.</span><span class="java_plain">runtime</span><span class="java_separator">.</span><span class="java_plain">rule</span><span class="java_separator">.</span><span class="java_type">TypedAccumulateFunction</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;readExternal</span><span class="java_separator">(</span><span class="java_type">ObjectInput</span><span class="java_plain">&nbsp;in</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_keyword">throws</span><span class="java_plain">&nbsp;</span><span class="java_type">IOException</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">ClassNotFoundException</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;writeExternal</span><span class="java_separator">(</span><span class="java_type">ObjectOutput</span><span class="java_plain">&nbsp;out</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_keyword">throws</span><span class="java_plain">&nbsp;</span><span class="java_type">IOException</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">static</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">AverageData</span><span class="java_plain">&nbsp;</span><span class="java_keyword">implements</span><span class="java_plain">&nbsp;</span><span class="java_type">Externalizable</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">int</span><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;count&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">0</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">double</span><span class="java_plain">&nbsp;total&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">0</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">AverageData</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;readExternal</span><span class="java_separator">(</span><span class="java_type">ObjectInput</span><span class="java_plain">&nbsp;in</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_keyword">throws</span><span class="java_plain">&nbsp;</span><span class="java_type">IOException</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">ClassNotFoundException</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;count&nbsp;&nbsp;&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;in</span><span class="java_separator">.</span><span class="java_plain">readInt</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;total&nbsp;&nbsp;&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;in</span><span class="java_separator">.</span><span class="java_plain">readDouble</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;writeExternal</span><span class="java_separator">(</span><span class="java_type">ObjectOutput</span><span class="java_plain">&nbsp;out</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_keyword">throws</span><span class="java_plain">&nbsp;</span><span class="java_type">IOException</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;out</span><span class="java_separator">.</span><span class="java_plain">writeInt</span><span class="java_separator">(</span><span class="java_plain">count</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;out</span><span class="java_separator">.</span><span class="java_plain">writeDouble</span><span class="java_separator">(</span><span class="java_plain">total</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_comment">/*</span><span class="java_plain">&nbsp;(non-Javadoc)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@see&nbsp;org.drools.base.accumulators.AccumulateFunction#createContext()</span>
<!--  --><br/><span class="java_comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Serializable</span><span class="java_plain">&nbsp;createContext</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">AverageData</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_comment">/*</span><span class="java_plain">&nbsp;(non-Javadoc)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@see&nbsp;org.drools.base.accumulators.AccumulateFunction#init(java.lang.Object)</span>
<!--  --><br/><span class="java_comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;init</span><span class="java_separator">(</span><span class="java_type">Serializable</span><span class="java_plain">&nbsp;context</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_keyword">throws</span><span class="java_plain">&nbsp;</span><span class="java_type">Exception</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">AverageData</span><span class="java_plain">&nbsp;data&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_type">AverageData</span><span class="java_separator">)</span><span class="java_plain">&nbsp;context</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;data</span><span class="java_separator">.</span><span class="java_plain">count&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">0</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;data</span><span class="java_separator">.</span><span class="java_plain">total&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">0</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_comment">/*</span><span class="java_plain">&nbsp;(non-Javadoc)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@see&nbsp;org.drools.base.accumulators.AccumulateFunction#accumulate(java.lang.Object,&nbsp;java.lang.Object)</span>
<!--  --><br/><span class="java_comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;accumulate</span><span class="java_separator">(</span><span class="java_type">Serializable</span><span class="java_plain">&nbsp;context</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">Object</span><span class="java_plain">&nbsp;value</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">AverageData</span><span class="java_plain">&nbsp;data&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_type">AverageData</span><span class="java_separator">)</span><span class="java_plain">&nbsp;context</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;data</span><span class="java_separator">.</span><span class="java_plain">count</span><span class="java_operator">++</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;data</span><span class="java_separator">.</span><span class="java_plain">total&nbsp;</span><span class="java_operator">+=</span><span class="java_plain">&nbsp;</span><span class="java_separator">((</span><span class="java_type">Number</span><span class="java_separator">)</span><span class="java_plain">&nbsp;value</span><span class="java_separator">).</span><span class="java_plain">doubleValue</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_comment">/*</span><span class="java_plain">&nbsp;(non-Javadoc)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@see&nbsp;org.drools.base.accumulators.AccumulateFunction#reverse(java.lang.Object,&nbsp;java.lang.Object)</span>
<!--  --><br/><span class="java_comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;reverse</span><span class="java_separator">(</span><span class="java_type">Serializable</span><span class="java_plain">&nbsp;context</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">Object</span><span class="java_plain">&nbsp;value</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_keyword">throws</span><span class="java_plain">&nbsp;</span><span class="java_type">Exception</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">AverageData</span><span class="java_plain">&nbsp;data&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_type">AverageData</span><span class="java_separator">)</span><span class="java_plain">&nbsp;context</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;data</span><span class="java_separator">.</span><span class="java_plain">count</span><span class="java_operator">--</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;data</span><span class="java_separator">.</span><span class="java_plain">total&nbsp;</span><span class="java_operator">-=</span><span class="java_plain">&nbsp;</span><span class="java_separator">((</span><span class="java_type">Number</span><span class="java_separator">)</span><span class="java_plain">&nbsp;value</span><span class="java_separator">).</span><span class="java_plain">doubleValue</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_comment">/*</span><span class="java_plain">&nbsp;(non-Javadoc)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@see&nbsp;org.drools.base.accumulators.AccumulateFunction#getResult(java.lang.Object)</span>
<!--  --><br/><span class="java_comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Object</span><span class="java_plain">&nbsp;getResult</span><span class="java_separator">(</span><span class="java_type">Serializable</span><span class="java_plain">&nbsp;context</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_keyword">throws</span><span class="java_plain">&nbsp;</span><span class="java_type">Exception</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">AverageData</span><span class="java_plain">&nbsp;data&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_type">AverageData</span><span class="java_separator">)</span><span class="java_plain">&nbsp;context</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">Double</span><span class="java_separator">(</span><span class="java_plain">&nbsp;data</span><span class="java_separator">.</span><span class="java_plain">count&nbsp;</span><span class="java_operator">==</span><span class="java_plain">&nbsp;</span><span class="java_literal">0</span><span class="java_plain">&nbsp;</span><span class="java_operator">?</span><span class="java_plain">&nbsp;</span><span class="java_literal">0</span><span class="java_plain">&nbsp;</span><span class="java_operator">:</span><span class="java_plain">&nbsp;data</span><span class="java_separator">.</span><span class="java_plain">total&nbsp;</span><span class="java_operator">/</span><span class="java_plain">&nbsp;data</span><span class="java_separator">.</span><span class="java_plain">count&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_comment">/*</span><span class="java_plain">&nbsp;(non-Javadoc)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@see&nbsp;org.drools.base.accumulators.AccumulateFunction#supportsReverse()</span>
<!--  --><br/><span class="java_comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">boolean</span><span class="java_plain">&nbsp;supportsReverse</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;</span><span class="java_literal">true</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_javadoc_comment">/**</span>
<!--  --><br/><span class="java_javadoc_comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;{</span><span class="java_javadoc_tag">@inheritDoc</span><span class="java_javadoc_comment">}</span>
<!--  --><br/><span class="java_javadoc_comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Class</span><span class="java_operator">&lt;</span><span class="java_plain">&nbsp;</span><span class="java_operator">?</span><span class="java_plain">&nbsp;</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;getResultType</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;</span><span class="java_type">Number</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_separator">}</span>
</pre><p>The code for the function is very simple, as we could expect,
          as all the "dirty" integration work is done by the engine. Finally,
          to plug the function into the engine, we added it to the
          configuration file:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">drools.accumulate.function.average =
   org.drools.base.accumulators.AverageAccumulateFunction</pre><p>Here, "drools.accumulate.function." is a prefix that must
          always be used, "average" is how the function will be used in the
          rule file, and
          "org.drools.base.accumulators.AverageAccumulateFunction" is the
          fully qualified name of the class that implements the function
          behavior.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h6 class="title"><a id="d0e6910"/>4.8.3.7.4.2. Alternate Syntax: single function with return type</h6></div></div></div><p>The accumulate syntax evolved over time with the goal of
          becoming more compact and expressive. Nevertheless, Drools still
          supports previous syntaxes for backward compatibility
          purposes.</p><p>In case the rule is using a single accumulate function on a
          given accumulate, the author may add a pattern for the result object
          and use the "from" keyword to link it to the accumulate result.
          Example: a rule to apply a 10% discount on orders over $100 could be
          written in the following way:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">rule "Apply 10% discount to orders over US$ 100,00"
when
    $order : Order()
    $total : Number( doubleValue &gt; 100 ) 
             from accumulate( OrderItem( order == $order, $value : value ),
                              sum( $value ) )
then
    # apply discount to $order
end</pre><p>In the above example, the accumulate element is using only one
          function (sum), and so, the rules author opted to explicitly write a
          pattern for the result type of the accumulate function (Number) and
          write the constraints inside it. There are no problems in using this
          syntax over the compact syntax presented before, except that is is a
          bit more verbose. Also note that it is not allowed to use both the
          return type and the functions binding in the same accumulate statement.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h6 class="title"><a id="d0e6921"/>4.8.3.7.4.3. Accumulate with inline custom code</h6></div></div></div><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="warning"><h2>Warning</h2><p>The use of accumulate with inline custom code is not a good
            practice for several reasons, including difficulties on maintaining
            and testing rules that use them, as well as the inability of
            reusing that code. Implementing your own accumulate functions is
            very simple and straightforward, they are easy to unit test and to
            use. This form of accumulate is supported for backward
            compatibility only.</p></div><p>Another possible syntax for the accumulate is to define inline
          custom code, instead of using accumulate functions. As noted on the
          previous warned, this is discouraged though for the stated
          reasons.</p><p>The general syntax of the <code class="literal">accumulate</code> CE
          with inline custom code is:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class=""><em xmlns="http://www.w3.org/1999/xhtml" class="replaceable"><code>&lt;result pattern&gt;</code></em> <code xmlns="http://www.w3.org/1999/xhtml" class="literal">from accumulate(</code> <em xmlns="http://www.w3.org/1999/xhtml" class="replaceable"><code>&lt;source pattern&gt;</code></em><code xmlns="http://www.w3.org/1999/xhtml" class="literal">,</code>
                                  <code xmlns="http://www.w3.org/1999/xhtml" class="literal">init(</code> <em xmlns="http://www.w3.org/1999/xhtml" class="replaceable"><code>&lt;init code&gt;</code></em> <code xmlns="http://www.w3.org/1999/xhtml" class="literal">),</code>
                                  <code xmlns="http://www.w3.org/1999/xhtml" class="literal">action(</code> <em xmlns="http://www.w3.org/1999/xhtml" class="replaceable"><code>&lt;action code&gt;</code></em> <code xmlns="http://www.w3.org/1999/xhtml" class="literal">),</code>
                                  <code xmlns="http://www.w3.org/1999/xhtml" class="literal">reverse(</code> <em xmlns="http://www.w3.org/1999/xhtml" class="replaceable"><code>&lt;reverse code&gt;</code></em> <code xmlns="http://www.w3.org/1999/xhtml" class="literal">),</code>
                                  <code xmlns="http://www.w3.org/1999/xhtml" class="literal">result(</code> <em xmlns="http://www.w3.org/1999/xhtml" class="replaceable"><code>&lt;result expression&gt;</code></em> <code xmlns="http://www.w3.org/1999/xhtml" class="literal">) )</code>
</pre><p>The meaning of each of the elements is the following:</p><div class="itemizedlist"><ul><li><p><span class="emphasis"><em>&lt;source pattern&gt;</em></span>: the source
              pattern is a regular pattern that the engine will try to match
              against each of the source objects.</p></li><li><p><span class="emphasis"><em>&lt;init code&gt;</em></span>: this is a semantic
              block of code in the selected dialect that will be executed once
              for each tuple, before iterating over the source objects.</p></li><li><p><span class="emphasis"><em>&lt;action code&gt;</em></span>: this is a
              semantic block of code in the selected dialect that will be
              executed for each of the source objects.</p></li><li><p><span class="emphasis"><em>&lt;reverse code&gt;</em></span>: this is an
              optional semantic block of code in the selected dialect that if
              present will be executed for each source object that no longer
              matches the source pattern. The objective of this code block is
              to undo any calculation done in the <span class="emphasis"><em>&lt;action
              code&gt;</em></span> block, so that the engine can do decremental
              calculation when a source object is modified or retracted,
              hugely improving performance of these operations.</p></li><li><p><span class="emphasis"><em>&lt;result expression&gt;</em></span>: this is a
              semantic expression in the selected dialect that is executed
              after all source objects are iterated.</p></li><li><p><span class="emphasis"><em>&lt;result pattern&gt;</em></span>: this is a
              regular pattern that the engine tries to match against the
              object returned from the <span class="emphasis"><em>&lt;result
              expression&gt;</em></span>. If it matches, the
              <code class="literal">accumulate</code> conditional element evaluates to
              <span class="emphasis"><em>true</em></span> and the engine proceeds with the
              evaluation of the next CE in the rule. If it does not matches,
              the <code class="literal">accumulate</code> CE evaluates to
              <span class="emphasis"><em>false</em></span> and the engine stops evaluating CEs
              for that rule.</p></li></ul></div><p>It is easier to understand if we look at an example:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">rule "Apply 10% discount to orders over US$ 100,00"
when
    $order : Order()
    $total : Number( doubleValue &gt; 100 ) 
             from accumulate( OrderItem( order == $order, $value : value ),
                              init( double total = 0; ),
                              action( total += $value; ),
                              reverse( total -= $value; ),
                              result( total ) )
then
    # apply discount to $order
end</pre><p>In the above example, for each <code class="code">Order</code> in the
          Working Memory, the engine will execute the <span class="emphasis"><em>init
          code</em></span> initializing the total variable to zero. Then it
          will iterate over all <code class="code">OrderItem</code> objects for that order,
          executing the <span class="emphasis"><em>action</em></span> for each one (in the
          example, it will sum the value of all items into the total
          variable). After iterating over all <code class="code">OrderItem</code> objects,
          it will return the value corresponding to the <span class="emphasis"><em>result
          expression</em></span> (in the above example, the value of variable
          <code class="code">total</code>). Finally, the engine will try to match the
          result with the <code class="code">Number</code> pattern, and if the double value
          is greater than 100, the rule will fire.</p><p>The example used Java as the semantic dialect, and as such,
          note that the usage of the semicolon as statement delimiter is
          mandatory in the init, action and reverse code blocks. The result is
          an expression and, as such, it does not admit ';'. If the user uses
          any other dialect, he must comply to that dialect's specific
          syntax.</p><p>As mentioned before, the <span class="emphasis"><em>reverse code</em></span> is
          optional, but it is strongly recommended that the user writes it in
          order to benefit from the <span class="emphasis"><em>improved performance on update
          and retract</em></span>.</p><p>The <code class="literal">accumulate</code> CE can be used to execute
          any action on source objects. The following example instantiates and
          populates a custom object:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">rule "Accumulate using custom objects"
when
    $person   : Person( $likes : likes )
    $cheesery : Cheesery( totalAmount &gt; 100 )
                from accumulate( $cheese : Cheese( type == $likes ),
                                 init( Cheesery cheesery = new Cheesery(); ),
                                 action( cheesery.addCheese( $cheese ); ),
                                 reverse( cheesery.removeCheese( $cheese ); ),
                                 result( cheesery ) );
then
    // do something
end</pre></div></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e7080"/>4.8.3.8. Conditional Element <code class="literal">eval</code></h4></div></div></div><div class="figure"><a id="d0e7085"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Rule_Language/eval.png" align="middle" alt="eval"/></div></div><p class="title"><b>Figure 4.28. eval</b></p></div><br class="figure-break"/><p>The conditional element <code class="literal">eval</code> is essentially a
      catch-all which allows any semantic code (that returns a primitive
      boolean) to be executed. This code can refer to variables that were
      bound in the LHS of the rule, and functions in the rule package. Overuse
      of eval reduces the declarativeness of your rules and can result in a
      poorly performing engine. While <code class="literal">eval</code> can be used
      anywhere in the patterns, the best practice is to add it as the last
      conditional element in the LHS of a rule.</p><p>Evals cannot be indexed and thus are not as efficient as Field
      Constraints. However this makes them ideal for being used when functions
      return values that change over time, which is not allowed within Field
      Constraints.</p><p>For folks who are familiar with Drools 2.x lineage, the old Drools
      parameter and condition tags are equivalent to binding a variable to an
      appropriate type, and then using it in an eval node.</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">p1 : Parameter()
p2 : Parameter()
eval( p1.getList().containsKey( p2.getItem() ) )</pre><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">p1 : Parameter()
p2 : Parameter()
// call function isValid in the LHS
eval( isValid( p1, p2 ) )</pre></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e7107"/>4.8.3.9. Railroad diagrams</h4></div></div></div><div class="mediaobject"><img src="images/Chapter-Language_Reference/AccumulateAction.png"/></div><div class="mediaobject"><img src="images/Chapter-Language_Reference/AccumulateClause.png"/></div><div class="mediaobject"><img src="images/Chapter-Language_Reference/AccumulateFunction.png"/></div><div class="mediaobject"><img src="images/Chapter-Language_Reference/AccumulateInit.png"/></div><div class="mediaobject"><img src="images/Chapter-Language_Reference/AccumulateResult.png"/></div><div class="mediaobject"><img src="images/Chapter-Language_Reference/AccumulateReverse.png"/></div><div class="mediaobject"><img src="images/Chapter-Language_Reference/AccumulateSteps.png"/></div><div class="mediaobject"><img src="images/Chapter-Language_Reference/Accumulations.png"/></div><div class="mediaobject"><img src="images/Chapter-Language_Reference/AdditiveExpr.png"/></div><div class="mediaobject"><img src="images/Chapter-Language_Reference/Annotation.png"/></div><div class="mediaobject"><object type="image/svg+xml" data="images/Chapter-Language_Reference/Arguments.svg,"/></div><div class="mediaobject"><img src="images/Chapter-Language_Reference/ArrayCreatorRest.png"/></div><div class="mediaobject"><img src="images/Chapter-Language_Reference/ArrayInitializer.png"/></div><div class="mediaobject"><img src="images/Chapter-Language_Reference/AssignmentOperator.png"/></div><div class="mediaobject"><img src="images/Chapter-Language_Reference/BindingPattern.png"/></div><div class="mediaobject"><img src="images/Chapter-Language_Reference/Block.png"/></div><div class="mediaobject"><img src="images/Chapter-Language_Reference/BooleanLiteral.png"/></div><div class="mediaobject"><img src="images/Chapter-Language_Reference/CompilationUnit.png"/></div><div class="mediaobject"><img src="images/Chapter-Language_Reference/ConditionalAnd.png"/></div><div class="mediaobject"><img src="images/Chapter-Language_Reference/ConditionalElementAccumulate.png"/></div><div class="mediaobject"><object type="image/svg+xml" data="images/Chapter-Language_Reference/ConditionalElementEval.svg,"/></div><div class="mediaobject"><img src="images/Chapter-Language_Reference/ConditionalElementExists.png"/></div><div class="mediaobject"><img src="images/Chapter-Language_Reference/ConditionalElementForall.png"/></div><div class="mediaobject"><img src="images/Chapter-Language_Reference/ConditionalElementNot.png"/></div><div class="mediaobject"><img src="images/Chapter-Language_Reference/ConditionalElement.png"/></div><div class="mediaobject"><img src="images/Chapter-Language_Reference/ConditionalExpr.png"/></div><div class="mediaobject"><img src="images/Chapter-Language_Reference/ConditionalOrExpr.png"/></div><div class="mediaobject"><img src="images/Chapter-Language_Reference/ConditionalOr.png"/></div><div class="mediaobject"><img src="images/Chapter-Language_Reference/Constraints.png"/></div><div class="mediaobject"><img src="images/Chapter-Language_Reference/CreatedName.png"/></div><div class="mediaobject"><img src="images/Chapter-Language_Reference/Creator.png"/></div><div class="mediaobject"><object type="image/svg+xml" data="images/Chapter-Language_Reference/Definition.svg,"/></div><div class="mediaobject"><img src="images/Chapter-Language_Reference/Digit.png"/></div><div class="mediaobject"><img src="images/Chapter-Language_Reference/ExplicitGenericInvocationSuffix.png"/></div><div class="mediaobject"><img src="images/Chapter-Language_Reference/ExplicitGenericInvocation.png"/></div><div class="mediaobject"><img src="images/Chapter-Language_Reference/Exponent.png"/></div><div class="mediaobject"><img src="images/Chapter-Language_Reference/ExpressionList.png"/></div><div class="mediaobject"><img src="images/Chapter-Language_Reference/Expression.png"/></div><div class="mediaobject"><img src="images/Chapter-Language_Reference/Field.png"/></div><div class="mediaobject"><img src="images/Chapter-Language_Reference/Fraction.png"/></div><div class="mediaobject"><img src="images/Chapter-Language_Reference/FromAccumulateClause.png"/></div><div class="mediaobject"><img src="images/Chapter-Language_Reference/FromClause.png"/></div><div class="mediaobject"><object type="image/svg+xml" data="images/Chapter-Language_Reference/FromCollectClause.svg,"/></div><div class="mediaobject"><img src="images/Chapter-Language_Reference/FunctionDefinition.png"/></div><div class="mediaobject"><img src="images/Chapter-Language_Reference/GlobalDefinition.png"/></div><div class="mediaobject"><img src="images/Chapter-Language_Reference/IdentifierSuffix.png"/></div><div class="mediaobject"><img src="images/Chapter-Language_Reference/ImportDefinition.png"/></div><div class="mediaobject"><img src="images/Chapter-Language_Reference/InExpr.png"/></div><div class="mediaobject"><img src="images/Chapter-Language_Reference/InlineListExpr.png"/></div><div class="mediaobject"><img src="images/Chapter-Language_Reference/InlineMapExpr.png"/></div><div class="mediaobject"><img src="images/Chapter-Language_Reference/InnerCreator.png"/></div><div class="mediaobject"><img src="images/Chapter-Language_Reference/InstanceOfExpr.png"/></div><div class="mediaobject"><img src="images/Chapter-Language_Reference/IntLiteral.png"/></div><div class="mediaobject"><img src="images/Chapter-Language_Reference/Literal.png"/></div><div class="mediaobject"><object type="image/svg+xml" data="images/Chapter-Language_Reference/ModifyStatement.svg,"/></div><div class="mediaobject"><img src="images/Chapter-Language_Reference/NonWildcardTypeArguments.png"/></div><div class="mediaobject"><img src="images/Chapter-Language_Reference/OrRestriction.png"/></div><div class="mediaobject"><img src="images/Chapter-Language_Reference/OverClause.png"/></div><div class="mediaobject"><img src="images/Chapter-Language_Reference/Parameters.png"/></div><div class="mediaobject"><img src="images/Chapter-Language_Reference/Pattern.png"/></div><div class="mediaobject"><img src="images/Chapter-Language_Reference/Placeholders.png"/></div><div class="mediaobject"><img src="images/Chapter-Language_Reference/Primary.png"/></div><div class="mediaobject"><img src="images/Chapter-Language_Reference/PrimitiveType.png"/></div><div class="mediaobject"><img src="images/Chapter-Language_Reference/QualifiedName.png"/></div><div class="mediaobject"><img src="images/Chapter-Language_Reference/QueryDefinition.png"/></div><div class="mediaobject"><img src="images/Chapter-Language_Reference/QueryOptions.png"/></div><div class="mediaobject"><object type="image/svg+xml" data="images/Chapter-Language_Reference/RealLiteral.svg,"/></div><div class="mediaobject"><img src="images/Chapter-Language_Reference/RealTypeSuffix.png"/></div><div class="mediaobject"><img src="images/Chapter-Language_Reference/RelationalExpr.png"/></div><div class="mediaobject"><img src="images/Chapter-Language_Reference/RelationalOperator.png"/></div><div class="mediaobject"><img src="images/Chapter-Language_Reference/RhsStatement.png"/></div><div class="mediaobject"><img src="images/Chapter-Language_Reference/RuleAttributes.png"/></div><div class="mediaobject"><img src="images/Chapter-Language_Reference/RuleAttribute.png"/></div><div class="mediaobject"><img src="images/Chapter-Language_Reference/RuleDefinition.png"/></div><div class="mediaobject"><img src="images/Chapter-Language_Reference/RuleOptions.png"/></div><div class="mediaobject"><img src="images/Chapter-Language_Reference/Selector.png"/></div><div class="mediaobject"><img src="images/Chapter-Language_Reference/ShiftExpr.png"/></div><div class="mediaobject"><img src="images/Chapter-Language_Reference/SingleRestriction.png"/></div><div class="mediaobject"><object type="image/svg+xml" data="images/Chapter-Language_Reference/SourcePattern.svg,"/></div><div class="mediaobject"><img src="images/Chapter-Language_Reference/StringId.png"/></div><div class="mediaobject"><img src="images/Chapter-Language_Reference/SuperSuffix.png"/></div><div class="mediaobject"><img src="images/Chapter-Language_Reference/ThenPart.png"/></div><div class="mediaobject"><img src="images/Chapter-Language_Reference/TypeArguments.png"/></div><div class="mediaobject"><img src="images/Chapter-Language_Reference/TypeArgument.png"/></div><div class="mediaobject"><img src="images/Chapter-Language_Reference/TypeDefinition.png"/></div><div class="mediaobject"><img src="images/Chapter-Language_Reference/TypeOptions.png"/></div><div class="mediaobject"><img src="images/Chapter-Language_Reference/Type.png"/></div><div class="mediaobject"><img src="images/Chapter-Language_Reference/UnaryExprNotPlusMinus.png"/></div><div class="mediaobject"><img src="images/Chapter-Language_Reference/UnaryExpr.png"/></div><div class="mediaobject"><img src="images/Chapter-Language_Reference/Value.png"/></div><div class="mediaobject"><img src="images/Chapter-Language_Reference/VariableInitializer.png"/></div><div class="mediaobject"><img src="images/Chapter-Language_Reference/WhenPart.png"/></div></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e7386"/>4.8.4. The Right Hand Side (then)</h3></div></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e7389"/>4.8.4.1. Usage</h4></div></div></div><p>The Right Hand Side (RHS) is a common name for the consequence or
      action part of the rule; this part should contain a list of actions to
      be executed. It is bad practice to use imperative or conditional code in
      the RHS of a rule; as a rule should be atomic in nature - "when this,
      then do this", not "when this, maybe do this". The RHS part of a rule
      should also be kept small, thus keeping it declarative and readable. If
      you find you need imperative and/or conditional code in the RHS, then
      maybe you should be breaking that rule down into multiple rules. The
      main purpose of the RHS is to insert, retractor modify working memory
      data. To assist with that there are a few convenience methods you can
      use to modify working memory; without having to first reference a
      working memory instance.</p><p><code class="literal">update(</code><span class="emphasis"><em>object,
      handle</em></span><code class="literal">);</code> will tell the engine that an
      object has changed (one that has been bound to something on the LHS) and
      rules may need to be reconsidered.</p><p><code class="literal">update(</code><span class="emphasis"><em>object</em></span><code class="literal">);</code>
      can also be used; here the Knowledge Helper will look up the facthandle
      for you, via an identity check, for the passed object. (Note that if you
      provide Property Change Listeners to your Java beans that you are
      inserting into the engine, you can avoid the need to call
      <code class="code">update()</code> when the object changes.). After a fact's field
      values have changed you must call update before changing another fact,
      or you will cause problems with the indexing within the rule engine. The
      modify keyword avoids this problem.</p><p><code class="literal">insert(new</code>
      <span class="emphasis"><em>Something</em></span><code class="literal">());</code> will place a new
      object of your creation into the Working Memory.</p><p><code class="literal">insertLogical(new</code>
      <span class="emphasis"><em>Something</em></span><code class="literal">());</code> is similar to
      insert, but the object will be automatically retracted when there are no
      more facts to support the truth of the currently firing rule.</p><p><code class="literal">retract(</code><span class="emphasis"><em>handle</em></span><code class="literal">);</code>
      removes an object from Working Memory.</p><p>These convenience methods are basically macros that provide short
      cuts to the <code class="code">KnowledgeHelper</code> instance that lets you access
      your Working Memory from rules files. The predefined variable
      <code class="code">drools</code> of type <code class="code">KnowledgeHelper</code> lets you call
      several other useful methods. (Refer to the <code class="code">KnowledgeHelper</code>
      interface documentation for more advanced operations).</p><div class="itemizedlist"><ul><li><p>The call <code class="code">drools.halt()</code> terminates rule execution
          immediately. This is required for returning control to the point
          whence the current session was put to work with
          <code class="code">fireUntilHalt()</code>.</p></li><li><p>Methods <code class="code">insert(Object o)</code>, <code class="code">update(Object
          o)</code> and <code class="code">retract(Object o)</code> can be called on
          <code class="code">drools</code> as well, but due to their frequent use they can
          be called without the object reference.</p></li><li><p><code class="code">drools.getWorkingMemory()</code> returns the
          <code class="code">WorkingMemory</code> object.</p></li><li><p><code class="code">drools.setFocus( String s)</code> sets the focus to the
          specified agenda group.</p></li><li><p><code class="code">drools.getRule().getName()</code>, called from a rule's
          RHS, returns the name of the rule.</p></li><li><p><code class="code">drools.getTuple()</code> returns the Tuple that matches
          the currently executing rule, and
          <code class="code">drools.getActivation()</code> delivers the corresponding
          Activation. (These calls are useful for logging and debugging
          purposes.)</p></li></ul></div><p>The full Knowledge Runtime API is exposed through another
      predefined variable, <code class="code">kcontext</code>, of type
      <code class="code">KnowledgeContext</code>. Its method
      <code class="code">getKnowledgeRuntime()</code> delivers an object of type
      <code class="code">KnowledgeRuntime</code>, which, in turn, provides access to a
      wealth of methods, many of which are quite useful for coding RHS
      logic.</p><div class="itemizedlist"><ul><li><p>The call <code class="code">kcontext.getKnowledgeRuntime().halt()</code>
          terminates rule execution immediately.</p></li><li><p>The accessor <code class="code">getAgenda()</code> returns a reference to
          this session's <code class="code">Agenda</code>, which in turn provides access to
          the various rule groups: activation groups, agenda groups, and rule
          flow groups. A fairly common paradigm is the activation of some
          agenda group, which could be done with the lengthy call:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_operator">//</span><!-- <br/> --><span class="java_plain">&nbsp;give&nbsp;focus&nbsp;to&nbsp;the&nbsp;agenda&nbsp;group&nbsp;</span><!-- <br/> --><span class="java_type">CleanUp</span>
<!--  --><br/><span class="java_plain">kcontext</span><span class="java_separator">.</span><span class="java_plain">getKnowledgeRuntime</span><span class="java_separator">().</span><span class="java_plain">getAgenda</span><span class="java_separator">().</span><span class="java_plain">getAgendaGroup</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;CleanUp&quot;</span><span class="java_plain">&nbsp;</span><span class="java_separator">).</span><span class="java_plain">setFocus</span><span class="java_separator">();</span></pre><p>(You can achieve the same using <code class="code">drools.setFocus(
          "CleanUp" )</code>.)</p></li><li><p>To run a query, you call <code class="code">getQueryResults(String
          query)</code>, whereupon you may process the results, as explained
          in section “<span class="quote"><a class="link" href="">Query</a></span>”.</p></li><li><p>A set of methods dealing with event management lets you, among
          other things, add and remove event listeners for the Working Memory
          and the Agenda.</p></li><li><p>Method<code class="code">getKnowledgeBase()</code> returns the
          <code class="code">KnowledgeBase</code> object, the backbone of all the Knowledge
          in your system, and the originator of the current session.</p></li><li><p>You can manage globals with <code class="code">setGlobal(...)</code>,
          <code class="code">getGlobal(...)</code> and <code class="code">getGlobals()</code>.</p></li><li><p>Method <code class="code">getEnvironment()</code> returns the runtime's
          <code class="code">Environment</code> which works much like what you know as your
          operating system's environment.</p></li></ul></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e7583"/>4.8.4.2. The <code class="literal">modify</code> Statement</h4></div></div></div><p>This language extension provides a structured approach to fact
      updates. It combines the update operation with a number of setter calls
      to change the object's fields. This is the syntax schema for the
      <code class="literal">modify</code> statement:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class=""><code xmlns="http://www.w3.org/1999/xhtml" class="literal">modify ( </code><em xmlns="http://www.w3.org/1999/xhtml" class="replaceable"><code>&lt;fact-expression&gt;</code></em><code xmlns="http://www.w3.org/1999/xhtml" class="literal"> ) {</code>
    <em xmlns="http://www.w3.org/1999/xhtml" class="replaceable"><code>&lt;expression&gt;</code></em> [ <code xmlns="http://www.w3.org/1999/xhtml" class="literal">,</code> <em xmlns="http://www.w3.org/1999/xhtml" class="replaceable"><code>&lt;expression&gt;</code></em> ]*
<code xmlns="http://www.w3.org/1999/xhtml" class="literal">}</code></pre><p>The parenthesized <span class="emphasis"><em>&lt;fact-expression&gt;</em></span>
      must yield a fact object reference. The expression list in the block
      should consist of setter calls for the given object, to be written
      without the usual object reference, which is automatically prepended by
      the compiler.</p><p>The example illustrates a simple fact modification.</p><div class="example"><a id="d0e7620"/><p class="title"><b>Example 4.54. A modify statement</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">rule "modify stilton"
when
    $stilton : Cheese(type == "stilton")
then
    modify( $stilton ){
        setPrice( 20 ),
        setAge( "overripe" )
    }
end</pre></div></div><br class="example-break"/><p>The advantages in using the modify statment are particularly clear when
      used in conjuction with fine grained property change listeners.
      See the corresponding section for more details.</p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e7627"/>4.8.5. A Note on Auto-boxing and Primitive Types</h3></div></div></div><p>Drools attempts to preserve numbers in their primitive or object
    wrapper form, so a variable bound to an int primitive when used in a code
    block or expression will no longer need manual unboxing; unlike Drools 3.0
    where all primitives were autoboxed, requiring manual unboxing. A variable
    bound to an object wrapper will remain as an object; the existing JDK 1.5
    and JDK 5 rules to handle auto-boxing and unboxing apply in this case.
    When evaluating field constraints, the system attempts to coerce one of
    the values into a comparable format; so a primitive is comparable to an
    object wrapper.</p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e7632"/>4.9. Query</h2></div></div></div><div class="figure"><a id="d0e7635"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Rule_Language/query.png" align="middle" alt="query"/></div></div><p class="title"><b>Figure 4.29. query</b></p></div><br class="figure-break"/><p>A query is a simple way to search the working memory for facts that
  match the stated conditions. Therefore, it contains only the structure of
  the LHS of a rule, so that you specify neither "when" nor "then". A query
  has an optional set of parameters, each of which can be optionally typed. If
  the type is not given, the type Object is assumed. The engine will attempt
  to coerce the values as needed. Query names are global to the KnowledgeBase;
  so do not add queries of the same name to different packages for the same
  RuleBase.</p><p>To return the results use
  <code class="code">ksession.getQueryResults("name")</code>, where "name" is the query's
  name. This returns a list of query results, which allow you to retrieve the
  objects that matched the query.</p><p>The first example presents a simple query for all the people over the
  age of 30. The second one, using parameters, combines the age limit with a
  location.</p><div class="example"><a id="d0e7650"/><p class="title"><b>Example 4.55. Query People over the age of 30</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">query "people over the age of 30" 
    person : Person( age &gt; 30 )
end</pre></div></div><br class="example-break"/><div class="example"><a id="d0e7655"/><p class="title"><b>Example 4.56. Query People over the age of x, and who live in y</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">query "people over the age of x"  (int x, String y)
    person : Person( age &gt; x, location == y )
end</pre></div></div><br class="example-break"/><p>We iterate over the returned QueryResults using a standard "for" loop.
  Each element is a QueryResultsRow which we can use to access each of the
  columns in the tuple. These columns can be accessed by bound declaration
  name or index position.</p><div class="example"><a id="d0e7662"/><p class="title"><b>Example 4.57. Query People over the age of 30</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">QueryResults results = ksession.getQueryResults( "people over the age of 30" );
System.out.println( "we have " + results.size() + " people over the age  of 30" );

System.out.println( "These people are are over 30:" );

for ( QueryResultsRow row : results ) {
    Person person = ( Person ) row.get( "person" );
    System.out.println( person.getName() + "\n" );
}</pre></div></div><br class="example-break"/><p>Support for positional syntax has been added for more compact code. By
  default the declared type order in the type declaration matches the argument
  position. But it possible to override these using the @position annotation.
  This allows patterns to be used with positional arguments, instead of the
  more verbose named arguments.</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">declare Cheese
    name : String @position(1)
    shop : String @position(2)
    price : int @position(0)
end
</pre><p>The @Position annotation, in the org.drools.definition.type package,
  can be used to annotate original pojos on the classpath. Currently only
  fields on classes can be annotated. Inheritance of classes is supported, but
  not interfaces or methods. The isContainedIn query below demonstrates the
  use of positional arguments in a pattern; <code class="literal">Location(x, y;)</code>
  instead of <code class="literal">Location( thing == x, location == y).</code></p><p>Queries can now call other queries, this combined with optional query
  arguments provides derivation query style backward chaining. Positional and
  named syntax is supported for arguments. It is also possible to mix both
  positional and named, but positional must come first, separated by a semi
  colon. Literal expressions can be passed as query arguments, but at this
  stage you cannot mix expressions with variables. Here is an example of a
  query that calls another query. Note that 'z' here will always be an 'out'
  variable. The '?' symbol means the query is pull only, once the results are
  returned you will not receive further results as the underlying data
  changes.</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">declare Location
    thing : String 
    location : String 
end

query isContainedIn( String x, String y ) 
    Location(x, y;)
    or 
    ( Location(z, y;) and ?isContainedIn(x, z;) )
end</pre><p>As previously mentioned you can use live "open" queries to reactively
  receive changes over time from the query results, as the underlying data it
  queries against changes. Notice the "look" rule calls the query without
  using '?'.</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">query isContainedIn( String x, String y ) 
    Location(x, y;)
    or 
    ( Location(z, y;) and isContainedIn(x, z;) )
end

rule look when 
    Person( $l : likes ) 
    isContainedIn( $l, 'office'; )
then
   insertLogical( $l 'is in the office' );
end 
</pre><p>Drools supports unification for derivation queries, in short this
  means that arguments are optional. It is possible to call queries from java
  leaving arguments unspecified using the static field
  org.drools.runtime.rule.Variable.v - note you must use 'v' and not an
  alternative instance of Variable. These are referred to as 'out' arguments.
  Note that the query itself does not declare at compile time whether an
  argument is in or an out, this can be defined purely at runtime on each use.
  The following example will return all objects contained in the
  office.</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">results = ksession.getQueryResults( "isContainedIn", new Object[] {  Variable.v, "office" } );
l = new ArrayList&lt;List&lt;String&gt;&gt;();
for ( QueryResultsRow r : results ) {
    l.add( Arrays.asList( new String[] { (String) r.get( "x" ), (String) r.get( "y" ) } ) );
}  
</pre><p>The algorithm uses stacks to handle recursion, so the method stack
  will not blow up.</p><p>The following is not yet supported:</p><div class="itemizedlist"><ul><li><p>List and Map unification</p></li><li><p>Variables for the fields of facts</p></li><li><p>Expression unification - pred( X, X + 1, X * Y / 7 )</p></li></ul></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e7704"/>4.10. Domain Specific Languages</h2></div></div></div><p><a id="d0e7708" class="indexterm"/>Domain Specific Languages (or DSLs) are a way of creating a rule
  language that is dedicated to your problem domain. A set of DSL definitions
  consists of transformations from DSL "sentences" to DRL constructs, which lets
  you use of all the underlying rule language and engine features. Given a
  DSL, you write rules in DSL rule (or DSLR) files, which will be translated
  into DRL files.</p><p>DSL and DSLR files are plain text files, and you can use any text
  editor to create and modify them. But there are also DSL and DSLR editors,
  both in the IDE as well as in the web based BRMS, and you can use those
  as well, although they may not provide you with the full DSL functionality.
  </p><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e7714"/>4.10.1. When to Use a DSL</h3></div></div></div><p>DSLs can serve as a layer of separation between rule authoring (and
    rule authors) and the technical intricacies resulting from the modelling
    of domain object and the rule engine's native language and methods. If your
    rules need to be read and validated by domain experts (such as business
    analysts, for instance) who are not programmers, you should consider 
    using a DSL; it hides implementation details and focuses on the rule logic
    proper. DSL sentences can also act as "templates" for conditional elements and
    consequence actions that are used repeatedly in your rules, possibly with
    minor variations. You may define DSL sentences as being mapped to these
    repeated phrases, with parameters providing a means for accommodating those
    variations.</p><p>DSLs have no impact on the rule engine at runtime, they are just a
    compile time feature, requiring a special parser and transformer.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e7721"/>4.10.2. DSL Basics</h3></div></div></div><p>The Drools DSL mechanism allows you to customise conditional
    expressions and consequence actions. A global substitution mechanism
    ("keyword") is also available.</p><div class="example"><a id="d0e7726"/><p class="title"><b>Example 4.58. Example <a id="d0e7729" class="indexterm"/>DSL mapping</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">[when]Something is {colour}=Something(colour=="{colour}")</pre></div></div><br class="example-break"/><p>In the preceding example, <code class="code">[when]</code> indicates the scope of
    the expression, i.e., whether it is valid for the LHS or the RHS of a rule. The
    part after the bracketed keyword is the expression that you use in the rule;
    typically a natural language expression, but it doesn't have to be. The
    part to the right of the equal sign ("=") is the mapping of the expression into
    the rule language. The form of this string depends on its destination, RHS or 
    LHS. If it is for the LHS, then it ought to be a term according to the regular
    LHS syntax; if it is for the RHS then it might be a Java statement.</p><p>Whenever the DSL parser matches a line from the rule file written in the
    DSL with an expression in the DSL definition, it performs three steps of
    string manipulation. First, it extracts the string values appearing where the
    expression contains variable names in braces (here: <code class="code">{colour}</code>). Then,
    the values obtained from these captures are then interpolated wherever that name,
    again enclosed in braces, occurs on the right hand side of the mapping. Finally, the
    interpolated string replaces whatever was matched by the entire expression
    in the line of the DSL rule file.</p><p>Note that the expressions (i.e., the strings on the left hand side of the
    equal sign) are used as regular expressions in a pattern matching operation
    against a line of the DSL rule file, matching all or part of a line. This means
    you can use (for instance) a '?' to indicate that the preceding character is
    optional. One good reason to use this is to overcome variations in natural language
    phrases of your DSL. But, given that these expressions are regular
    expression patterns, this also means that all "magic" characters of Java's
    pattern syntax have to be escaped with a preceding backslash ('\').</p><p>It is important to note that the compiler transforms DSL rule files
    line by line. In the above example, all the text after "Something is " to
    the end of the line is captured as the replacement value for "{colour}",
    and this is used for interpolating the target string. This may not be exactly
    what you want. For instance, when you intend to merge different DSL
    expressions to generate a composite DRL pattern, you need to transform a DSLR
    line in several independent operations. The best way to achieve this is to
    ensure that the captures are surrounded by characteristic text - words or 
    even single characters. As a result,
    the matching operation done by the parser plucks out a substring from 
    somewhere within the line. In the example below, quotes are used as 
    distinctive characters. Note that the characters that surround the capture
    are not included during interpolation, just the contents between them.</p><p>As a rule of thumb, use quotes for textual data that a rule editor
    may want to enter. You can also enclose the capture with words to ensure
    that the text is correctly matched. Both is illustrated by the following
    example. Note that a single line such as <code class="code">Something is "green" and
    another solid thing</code> is now correctly expanded.</p><div class="example"><a id="d0e7755"/><p class="title"><b>Example 4.59. Example with quotes</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">[when]something is "{colour}"=Something(colour=="{colour}")
[when]another {state} thing=OtherThing(state=="{state}"</pre></div></div><br class="example-break"/><p>It is a good idea to avoid punctuation (other than quotes or
    apostrophes) in your DSL expressions as much as possible. The main reason
    is that punctuation is easy to forget for rule authors using your DSL.
    Another reason is that parentheses, the period and the question mark are magic
    characters, requiring escaping in the DSL definition.</p><p>In a DSL mapping, the braces "{" and "}" should only be used to
    enclose a variable definition or reference, resulting in a capture. If they
    should occur literally, either in the expression or within the replacement
    text on the right hand side, they must be escaped with a preceding backslash
    ("\"):</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">[then]do something= if (foo) \{ doSomething(); \}
    </pre><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>If braces "{" and "}" should appear in the replacement string of a
    DSL definition, escape them with a backslash ('\').</p></div><div class="example"><a id="d0e7769"/><p class="title"><b>Example 4.60. Examples of DSL mapping entries</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class=""># This is a comment to be ignored.
[when]There is a person with name of "{name}"=Person(name=="{name}")
[when]Person is at least {age} years old and lives in "{location}"=
      Person(age &gt;= {age}, location=="{location}")
[then]Log "{message}"=System.out.println("{message}");
[when]And = and</pre></div></div><br class="example-break"/><p>Given the above DSL examples, the following examples show the expansion of various
    DSLR snippets:</p><div class="example"><a id="d0e7776"/><p class="title"><b>Example 4.61. Examples of DSL expansions </b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">There is a person with name of "Kitty"
   ==&gt; Person(name="Kitty")
Person is at least 42 years old and lives in "Atlanta"
   ==&gt; Person(age &gt;= 42, location="Atlanta")
Log "boo"
   ==&gt; System.out.println("boo");
There is a person with name of "Bob" and Person is at least 30 years old and lives in "Utah"
   ==&gt; Person(name="Bob") and Person(age &gt;= 30, location="Utah")</pre></div></div><br class="example-break"/><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>Don't forget that if you are capturing plain text from a DSL rule line
    and want to use it as a string literal in the expansion, you must provide
    the quotes on the right hand side of the mapping.</p></div><p>You can chain DSL expressions together on one line, as long as it is
    clear to the parser where one ends and the next one begins and where the
    text representing a parameter ends. (Otherwise you risk getting all the
    text until the end of the line as a parameter value.) The DSL expressions are
    tried, one after the other, according to their order in the DSL definition
    file. After any match, all remaining DSL expressions are investigated,
    too.</p><p>The resulting DRL text may consist of more than one line. Line ends
    are in the replacement text are written as <code class="code">\n</code>.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e7791"/>4.10.3. Adding Constraints to Facts</h3></div></div></div><p>A common requirement when writing rule conditions is to be able to
    add an arbitrary combination of constraints to a pattern. Given that a
    fact type may have many fields, having to provide an individual DSL
    statement for each combination would be plain folly.</p><p>The DSL facility allows you to add constraints to a pattern by a
    simple convention: if your DSL expression starts with a hyphen
    (minus character, "-") it is assumed to be a field constraint and,
    consequently, is is added to the last pattern line preceding it.</p><p>For an example, lets take look at class <code class="code">Cheese</code>,
    with the following fields: type, price, age and country. We can
    express some LHS condition in normal DRL like the following</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">Cheese(age &lt; 5, price == 20, type=="stilton", country=="ch")</pre><p>The DSL definitions given below result in three DSL phrases which
    may be used to create any combination of constraint involving these fields.</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">[when]There is a Cheese with=Cheese()
[when]- age is less than {age}=age&lt;{age}
[when]- type is '{type}'=type=='{type}'
[when]- country equal to '{country}'=country=='{country}'</pre><p>You can then write rules with conditions like the following:
    </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">There is a Cheese with
        - age is less than 42
        - type is 'stilton'</pre><p> The parser will pick up a line
    beginning with "-" and add it as a constraint to  the preceding pattern,
    inserting a comma when it is required. For the preceding example, the
    resulting DRL is: </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">Cheese(age&lt;42, type=='stilton')</pre><p>
    </p><p>Combining all all numeric fields with all relational operators
    (according to the DSL expression "age is less than..." in the preceding
    example) produces an unwieldy amount of DSL entries. But you can define
    DSL phrases for the various operators and even a generic expression
    that handles any field constraint, as shown below. (Notice that
    the expression definition contains a regular expression in addition
    to the variable name.)</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">[when][]is less than or equal to=&lt;=
[when][]is less than=&lt;
[when][]is greater than or equal to=&gt;=
[when][]is greater than=&gt;
[when][]is equal to===
[when][]equals===
[when][]There is a Cheese with=Cheese()</pre>
[when][]- {field:\w*} {operator} {value:\d*}={field} {operator} {value} 

    <p>Given these DSL definitions, you can write rules with conditions
    such as:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">There is a Cheese with
   - age is less than 42
   - rating is greater than 50
   - type equals 'stilton'</pre><p>In this specific case, a phrase such as "is less than" is replaced by
    <code class="code">&lt;</code>, and then the line matches the last DSL entry. This
    removes the hyphen, but the final result is still added as a constraint
    to the preceding pattern. After processing all of the lines, the resulting
    DRL text is:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">Cheese(age&lt;42, rating &gt; 50, type=='stilton')</pre><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>The order of the entries in the DSL is important if separate DSL
    expressions are intended to match the same line, one after the other.</p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e7836"/>4.10.4. Developing a DSL</h3></div></div></div><p>A good way to get started is to write representative samples of the
    rules your application requires, and to test them as you develop. This will
    provide you with a stable framework of conditional elements and their
    constraints. Rules, both in DRL and in DSLR, refer to entities according
    to the data model representing the application data that should be subject
    to the reasoning process defined in rules. Notice that writing rules
    is generally easier if most of the data model's types are facts.</p><p>Given an initial set of rules, it should be possible to identify
    recurring or similar code snippets and to mark variable parts as
    parameters. This provides reliable leads as to what might be a handy
    DSL entry. Also, make sure you have a full grasp of the jargon the 
    domain experts are using, and base your DSL phrases on this vocabulary.</p><p>You may postpone implementation decisions concerning conditions
    and actions during this first design phase by leaving certain conditional
    elements and actions in their DRL form by prefixing a line with a
    greater sign ("&gt;"). (This is also handy for inserting debugging
    statements.)</p><p>During the next development phase, you should find that the DSL
    configuration stabilizes pretty quickly. New rules can be written by
    reusing the existing DSL definitions, or by adding a parameter to an
    existing condition or consequence entry.</p><p>Try to keep the number of DSL entries small. Using parameters
    lets you apply the same DSL sentence for similar rule patterns or
    constraints. But do not exaggerate: authors using the DSL should still
    be able to identify DSL phrases by some fixed text.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e7849"/>4.10.5. DSL and DSLR Reference</h3></div></div></div><p>A DSL file is a text file in a line-oriented format. Its
    entries are used for transforming a DSLR file into a file according
    to DRL syntax.</p><div class="itemizedlist"><ul><li><p>A line starting with "#" or "//"
        (with or without preceding white space) is treated as a comment.
        A comment line starting with "#/" is scanned for
        words requesting a debug option, see below.</p></li><li><p>Any line starting with an opening bracket ("[") is assumed to
        be the first line of a DSL entry definition.</p></li><li><p>Any other line is appended to the preceding DSL entry
        definition, with the line end replaced by a space.</p></li></ul></div><p>A DSL entry consists of the following four parts:</p><div class="itemizedlist"><ul><li><p>A scope definition, written as one of the keywords
        "when" or "condition", "then" or "consequence", "*"
        and "keyword", enclosed in brackets ("[" and "]"). This indicates
        whether the DSL entry is valid for the condition or the
        consequence of a rule, or both. A scope indication of "keyword"
        means that the entry has global significance, i.e., it is
        recognized anywhere in a DSLR file.</p></li><li><p>A type definition, written as a Java class name,
        enclosed in brackets. This part is optional unless the
        the next part begins with an opening bracket. An empty
        pair of brackets is valid, too.</p></li><li><p>A DSL expression consists of a (Java) regular expression,
        with any number of embedded <span class="emphasis"><em>variable definitions,</em></span>
        terminated by an equal sign ("="). A variable definition is enclosed
        in braces ("{" and "}"). It
        consists of a variable name and two optional attachments, separated
        by colons (":"). If there is one attachment, it is a regular expression
        for matching text that is to be assigned to the variable; if there
        are two attachments, the first one is a hint for the GUI
        editor and the second one the regular expression.</p><p>Note that all characters that are "magic" in regular
        expressions must be escaped with a preceding backslash ("\")
        if they should occur literally within the expression.</p></li><li><p>The remaining part of the line after the delimiting equal
        sign is the replacement text for any DSLR text matching the
        regular expression. It may contain variable references, i.e.,
        a variable name enclosed in braces. Optionally, the variable name
        may be followed by an exclamation mark ("!") and a transformation
        function, see below.</p><p>Note that braces ("{" and "}") must be escaped with a
        preceding backslash ("\") if they should occur literally
        within the replacement string.</p></li></ul></div><p>Debugging of DSL expansion can be turned on, selectively,
    by using a comment line starting with "#/" which
    may contain one or more words from the table presented below.
    The resulting output is written to standard output.</p><div class="table"><a id="d0e7888"/><p class="title"><b>Table 4.2. Debug options for DSL expansion</b></p><div class="table-contents"><table summary="Debug options for DSL expansion" border="1"><colgroup><col/><col/></colgroup><thead><tr><th>Word</th><th>Description</th></tr></thead><tbody><tr><td>result</td><td>Prints the resulting DRL text, with line numbers.</td></tr><tr><td>steps</td><td>Prints each expansion step of condition and consequence
            lines.</td></tr><tr><td>keyword</td><td>Dumps the internal representation of all DSL entries with
            scope "keyword".</td></tr><tr><td>when</td><td>Dumps the internal representation of all DSL entries with
            scope "when" or "*".</td></tr><tr><td>then</td><td>Dumps the internal representation of all DSL entries with
            scope "then" or "*".</td></tr><tr><td>usage</td><td>Displays a usage statistic of all DSL entries.</td></tr></tbody></table></div></div><br class="table-break"/><p>Below are some sample DSL definitions, with comments describing the
    language features they illustrate.</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class=""># Comment: DSL examples

#/ debug: display result and usage

# keyword definition: replaces "regula" by "rule"
[keyword][]regula=rule

# conditional element: "T" or "t", "a" or "an", convert matched word
[when][][Tt]here is an? {entity:\w+}=
        ${entity!lc}: {entity!ucfirst} ()

# consequence statement: convert matched word, literal braces
[then][]update {entity:\w+}=modify( ${entity!lc} )\{ \}
</pre><p>The transformation of a DSLR file proceeds as follows:</p><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="orderedlist"><ol><li><p>The text is read into memory.</p></li><li><p>Each of the "keyword" entries is applied to the entire text.
        First, the regular expression from the keyword definition is modified
        by replacing white space sequences with a pattern matching any number
        of white space characters, and by replacing variable definitions with
        a capture made from the regular expression provided with the definition,
        or with the default (".*?"). Then, the DSLR text is searched exhaustively
        for occurrences of strings matching the modified regular expression.
        Substrings of a matching string corresponding to variable captures are
        extracted and replace variable references in the corresponding
        replacement text, and this text replaces the matching string in the
        DSLR text.</p></li><li><p>Sections of the DSLR text between "when" and "then", and
        "then" and "end", respectively, are located and processed in a
        uniform manner, line by line, as described below.</p><p>For a line, each DSL entry pertaining to the line's section
        is taken in turn, in the order it appears in the DSL file. Its
        regular expression part is modified: white space is replaced by
        a pattern matching any number of white space characters; variable
        definitions with a regular expression are replaced by a capture
        with this regular expression, its default being ".*?".
        If the resulting regular expression matches all or part of the
        line, the matched part is replaced by the suitably modified
        replacement text.</p><p>Modification of the replacement text is done by replacing
        variable references with the text corresponding to the regular
        expression capture. This text may be modified according to the
        string transformation function given in the variable reference;
        see below for details.</p><p>If there is a variable reference naming a variable that is not
        defined in the same entry, the expander substitutes a value bound to
        a variable of that name, provided it was defined in one of the
        preceding lines of the current rule.</p></li><li><p>If a DSLR line in a condition is written with a leading
        hyphen, the expanded result is inserted into the last line, which
        should contain a pattern CE, i.e., a type name followed by a pair
        of parentheses. if this pair is empty, the expanded line (which
        should contain a valid constraint) is simply inserted, otherwise
        a comma (",") is inserted beforehand.  </p><p>If a DSLR line in a consequence is written with a leading
        hyphen, the expanded result is inserted into the last line, which
        should contain a "modify" statement, ending in a pair of braces
        ("{" and "}"). If this pair is empty, the expanded line (which
        should contain a valid method call) is simply inserted, otherwise
        a comma (",") is inserted beforehand.
        </p></li></ol></div><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>It is currently <span class="emphasis"><em>not</em></span> possible to use a line
    with a leading hyphen to insert text into other conditional element
    forms (e.g., "accumulate") or it may only work for the first insertion
    (e.g., "eval").</p></div><p>All string transformation functions are described in the following
    table.</p><div class="table"><a id="d0e7964"/><p class="title"><b>Table 4.3. String transformation functions</b></p><div class="table-contents"><table summary="String transformation functions" border="1"><colgroup><col/><col/></colgroup><thead><tr><th>Name</th><th>Description</th></tr></thead><tbody><tr><td>uc</td><td>Converts all letters to upper case.</td></tr><tr><td>lc</td><td>Converts all letters to lower case.</td></tr><tr><td>ucfirst</td><td>Converts the first letter to upper case, and
            all other letters to lower case.</td></tr><tr><td>num</td><td>Extracts all digits and "-" from the string. If the
            last two digits in the original string are preceded by "." or
            ",", a decimal period is inserted in the corresponding position.</td></tr><tr><td><span class="emphasis"><em>a</em></span>?<span class="emphasis"><em>b</em></span>/<span class="emphasis"><em>c</em></span></td><td>Compares the string with string <span class="emphasis"><em>a</em></span>, and if they
            are equal, replaces it with <span class="emphasis"><em>b</em></span>, otherwise with
            <span class="emphasis"><em>c</em></span>. But <span class="emphasis"><em>c</em></span> can be another triplet
            <span class="emphasis"><em>a</em></span>, <span class="emphasis"><em>b</em></span>, <span class="emphasis"><em>c</em></span>, so
            that the entire structure is, in fact, a translation table.</td></tr></tbody></table></div></div><br class="table-break"/><p>The following DSL examples show how to use string transformation functions.</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class=""># definitions for conditions
[when][]There is an? {entity}=${entity!lc}: {entity!ucfirst}()
[when][]- with an? {attr} greater than {amount}={attr} &lt;= {amount!num}
[when][]- with a {what} {attr}={attr} {what!positive?&gt;0/negative?%lt;0/zero?==0/ERROR}</pre><p>A file containing a DSL definition is customarily given the extension
    <code class="code">.dsl</code>. It is passed to the Knowledge Builder with 
    <code class="code">ResourceType.DSL</code>. For a file using DSL definition, the extension
    <code class="code">.dslr</code> should be used. The Knowledge Builder expects
    <code class="code">ResourceType.DSLR</code>. The IDE, however, relies on file extensions
    to correctly recognize and work with your rules file.</p><p>The DSL must be passed to the Knowledge Builder ahead of any rules
    file using the DSL.</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">KnowledgeBuilder kBuilder = new KnowledgeBuilder();
Resource dsl = ResourceFactory.newClassPathResource( dslPath, getClass() );
kBuilder.add( dsl, ResourceType.DSL );
Resource dslr = ResourceFactory.newClassPathResource( dslrPath, getClass() );
kBuilder.add( dslr, ResourceType.DSLR );
</pre><p>For parsing and expanding a DSLR file the DSL configuration is read
    and supplied to the parser. Thus, the parser can "recognize" the DSL
    expressions and transform them into native rule language expressions.</p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e8052"/>4.11. XML Rule Language</h2></div></div></div><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="warning"><h2>Warning</h2><p>The XML rule language has not been updated to support functionality
          introduced in Drools 5.x and is consider a deprecated feature.</p></div><p>As an option, Drools also supports a "native" <a id="d0e8060" class="indexterm"/> rule language as an alternative to DRL. This allows you to
  capture and manage your rules as XML data. Just like the non-XML DRL format,
  the XML format is parsed into the internal "AST" representation - as fast as
  possible (using a SAX parser). There is no external transformation step
  required. </p><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e8064"/>4.11.1. Legacy Drools 2.x XML rule format</h3></div></div></div><p>The Drools 2.x legacy XML format is no longer supported by Drools XML parser</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e8069"/>4.11.2. When to use XML</h3></div></div></div><p>There are several scenarios that XML is desirable. However, we
    recommend that it is not a default choice, as XML is not readily human
    readable (unless you like headaches) and can create visually bloated
    rules.</p><p>If you do want to edit XML by hand, use a good schema aware editor
    that provides nice hierarchical views of the XML, ideally visually
    (commercial tools like XMLSpy, Oxygen etc are good, but cost money, but
    then so do headache tablets).</p><p>Other scenarios where you may want to use the XML format are if you
    have a tool that generates rules from some input (programmatically
    generated rules), or perhaps interchange from another rule language, or
    from another tool that emits XML (using XSLT you can easily transform
    between XML formats). Note you can always generate normal DRL as
    well.</p><p>Alternatively you may be embedding Drools in a product that already
    uses XML for configuration, so you would like the rules to be in an XML
    format. You may be creating your own rule language on XML - note that you
    can always use the AST objects directly to create your own rule language
    as well (the options are many, due to the open architecture).</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e8080"/>4.11.3. The XML format</h3></div></div></div><p>A full W3C standards (XMLSchema) compliant XSD is provided that
    describes the XML language, which will not be repeated here verbatim. A
    summary of the language follows.</p><div class="example"><a id="d0e8085"/><p class="title"><b>Example 4.62. A rule in XML<a id="d0e8088" class="indexterm"/></b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_processing_instruction">&lt;?xml&nbsp;version=&quot;1.0&quot;&nbsp;encoding=&quot;UTF-8&quot;?&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">package</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;com.sample&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">xmlns</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;http://drools.org/drools-5.0&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">xmlns:xs</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">xs:schemaLocation</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;http://drools.org/drools-5.0&nbsp;drools-5.0.xsd&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">import</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;java.util.HashMap&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">import</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;org.drools.*&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">global</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">identifier</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;x&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">type</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;com.sample.X&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">global</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">identifier</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;yada&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">type</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;com.sample.Yada&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">function</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">return-type</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;void&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;myFunc&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">parameter</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">identifier</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;foo&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">type</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;Bar&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">parameter</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">identifier</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;bada&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">type</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;Bing&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">body</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;System.out.println(&quot;hello&nbsp;world&quot;);</span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">body</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">function</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">rule</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;simple_rule&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">rule-attribute</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;salience&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">value</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;10&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">rule-attribute</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;no-loop&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">value</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;true&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">rule-attribute</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;agenda-group&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">value</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;agenda-group&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">rule-attribute</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;activation-group&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">value</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;activation-group&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">lhs</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">pattern</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">identifier</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;foo2&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">object-type</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;Bar&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">or-constraint-connective</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">and-constraint-connective</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">field-constraint</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">field-name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;a&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">or-restriction-connective</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">and-restriction-connective</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">literal-restriction</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">evaluator</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_attribute_value">&quot;&nbsp;value=&quot;</span><span class="xml_plain">60</span><span class="xml_attribute_value">&quot;&nbsp;/</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;</span><span class="xml_attribute_name">literal-restriction</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">evaluator</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_attribute_value">&quot;&nbsp;value=&quot;</span><span class="xml_plain">70</span><span class="xml_attribute_value">&quot;&nbsp;/</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/</span><span class="xml_attribute_name">and-restriction-connective</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">and-restriction-connective</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">literal-restriction</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">evaluator</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_attribute_value">&quot;&nbsp;value=&quot;</span><span class="xml_plain">50</span><span class="xml_attribute_value">&quot;&nbsp;/</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;</span><span class="xml_attribute_name">literal-restriction</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">evaluator</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_attribute_value">&quot;&nbsp;value=&quot;</span><span class="xml_plain">55</span><span class="xml_attribute_value">&quot;&nbsp;/</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/</span><span class="xml_attribute_name">and-restriction-connective</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">or-restriction-connective</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">field-constraint</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">field-constraint</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">field-name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;a3&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">literal-restriction</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">evaluator</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;==&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">value</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;black&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">field-constraint</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">and-constraint-connective</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">and-constraint-connective</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">field-constraint</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">field-name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;a&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">literal-restriction</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">evaluator</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;==&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">value</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;40&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">field-constraint</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">field-constraint</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">field-name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;a3&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">literal-restriction</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">evaluator</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;==&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">value</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;pink&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">field-constraint</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">and-constraint-connective</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">and-constraint-connective</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">field-constraint</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">field-name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;a&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">literal-restriction</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">evaluator</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;==&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">value</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;12&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">field-constraint</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">field-constraint</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">field-name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;a3&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">or-restriction-connective</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">literal-restriction</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">evaluator</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;==&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">value</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;yellow&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">literal-restriction</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">evaluator</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;==&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">value</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;blue&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">or-restriction-connective</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">field-constraint</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">and-constraint-connective</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">or-constraint-connective</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">pattern</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">not</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">pattern</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">object-type</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;Person&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">field-constraint</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">field-name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;likes&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">variable-restriction</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">evaluator</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;==&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">identifier</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;type&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">field-constraint</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">pattern</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">exists</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">pattern</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">object-type</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;Person&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">field-constraint</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">field-name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;likes&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">variable-restriction</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">evaluator</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;==&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">identifier</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;type&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">field-constraint</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">pattern</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">exists</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">not</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">or-conditional-element</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">pattern</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">identifier</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;foo3&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">object-type</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;Bar&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">field-constraint</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">field-name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;a&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">or-restriction-connective</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">literal-restriction</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">evaluator</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;==&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">value</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;3&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">literal-restriction</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">evaluator</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;==&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">value</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;4&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">or-restriction-connective</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">field-constraint</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">field-constraint</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">field-name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;a3&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">literal-restriction</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">evaluator</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;==&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">value</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;hello&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">field-constraint</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">field-constraint</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">field-name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;a4&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">literal-restriction</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">evaluator</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;==&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">value</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;null&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">field-constraint</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">pattern</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">pattern</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">identifier</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;foo4&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">object-type</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;Bar&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">field-binding</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">field-name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;a&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">identifier</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;a4&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">field-constraint</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">field-name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;a&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">literal-restriction</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">evaluator</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;!=&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">value</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;4&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">literal-restriction</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">evaluator</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;!=&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">value</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;5&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">field-constraint</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">pattern</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">or-conditional-element</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">pattern</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">identifier</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;foo5&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">object-type</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;Bar&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">field-constraint</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">field-name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;b&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">or-restriction-connective</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">return-value-restriction</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">evaluator</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;==&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">a4&nbsp;+&nbsp;1</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">return-value-restriction</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">variable-restriction</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">evaluator</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_attribute_value">&quot;&nbsp;identifier=&quot;</span><span class="xml_attribute_name">a4</span><span class="xml_attribute_value">&quot;&nbsp;/</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;</span><span class="xml_attribute_name">qualified-identifier-restriction</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">evaluator</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;==&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;org.drools.Bar.BAR_ENUM_VALUE</span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">qualified-identifier-restriction</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">or-restriction-connective</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">field-constraint</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">pattern</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">pattern</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">identifier</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;foo6&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">object-type</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;Bar&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">field-binding</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">field-name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;a&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">identifier</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;a4&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">field-constraint</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">field-name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;b&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">literal-restriction</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">evaluator</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;==&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">value</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;6&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">field-constraint</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">pattern</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">lhs</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">rhs</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(&nbsp;a&nbsp;==&nbsp;b&nbsp;)&nbsp;{</span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert(&nbsp;foo3&nbsp;);</span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{</span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;retract(&nbsp;foo4&nbsp;);</span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;}</span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;System.out.println(&nbsp;a4&nbsp;);</span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">rhs</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">rule</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">package</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain"></span><br />
</pre></div></div><br class="example-break"/><p>In the preceding XML text you will see the typical XML
      element, the package declaration, imports, globals, functions,
      and the rule itself. Most of the elements are self explanatory
      if you have some  understanding of the Drools features.</p><p>The <code class="code">import</code> elements import the types you wish to
      use in the rule.</p><p>The <code class="code">global</code> elements define global objects that can
      be referred to in the rules.</p><p>The <code class="code">function</code> contains a function declaration, for
      a function to be used in the rules. You have to specify a return type,
      a unique name and parameters, in the body goes a snippet of code.</p><p>The rule is discussed below.</p><div class="example"><a id="d0e8112"/><p class="title"><b>Example 4.63. Detail of rule element</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">rule</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;simple_rule&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">rule-attribute</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;salience&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">value</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;10&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">rule-attribute</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;no-loop&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">value</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;true&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">rule-attribute</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;agenda-group&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">value</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;agenda-group&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">rule-attribute</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;activation-group&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">value</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;activation-group&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">lhs</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">pattern</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">identifier</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;cheese&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">object-type</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;Cheese&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">from</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">accumulate</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">pattern</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">object-type</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;Person&quot;</span><span class="xml_tag_symbols">&gt;&lt;/</span><span class="xml_tag_name">pattern</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">init</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;total&nbsp;=&nbsp;0;</span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">init</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">action</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;total&nbsp;+=&nbsp;$cheese.getPrice();</span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">action</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">result</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;new&nbsp;Integer(&nbsp;total&nbsp;)&nbsp;);</span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">result</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">accumulate</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">from</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">pattern</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">pattern</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">identifier</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;max&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">object-type</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;Number&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">from</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">accumulate</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">pattern</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">identifier</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;cheese&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">object-type</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;Cheese&quot;</span><span class="xml_tag_symbols">&gt;&lt;/</span><span class="xml_tag_name">pattern</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">external-function</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">evaluator</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;max&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">expression</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;$price&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">accumulate</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">from</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">pattern</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">lhs</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">rhs</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;list1.add(&nbsp;$cheese&nbsp;);</span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">rhs</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">rule</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;</span><br />
</pre></div></div><br class="example-break"/><p>In the above detail of the rule we see that the rule has LHS
      and RHS (conditions and consequence) sections.
    The RHS is simple, it is just a block of semantic code that will be
    executed when the rule is activated. The LHS is slightly more
    complicated as it contains nested elements for conditional elements,
    constraints and restrictions.</p><p>A key element of the LHS is the Pattern element. This allows you to
    specify a type (class) and perhaps bind a variable to an instance of that
    class. Nested under the pattern object are constraints and restrictions
  that have to be met. The Predicate and Return Value constraints
  allow Java expressions to be embedded.</p><p>That leaves the conditional elements, not, exists, and, or etc. They
    work like their DRL counterparts. Elements that are nested under and an
    "and" element are logically "anded" together. Likewise with "or" (and you
    can nest things further). "Exists" and "Not" work around patterns, to check
    for the existence or nonexistence of a fact meeting the pattern's
    constraints.</p><p>The Eval element allows the execution of a valid snippet of Java
    code - as long as it evaluates to a boolean (do not end it with a
    semi-colon, as it is just a fragment) - this can include calling a
    function. The Eval is less efficient than the columns, as the rule engine
    has to evaluate it each time, but it is a "catch all" feature for when you
    can express what you need to do with Column constraints.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e8126"/>4.11.4. Legacy Drools 2.x XML rule format</h3></div></div></div><p>The Drools 2.x legacy XML format is no longer supported by Drools XML parser</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e8131"/>4.11.5. Automatic transforming between formats (XML and DRL)</h3></div></div></div><p>Drools comes with some utility classes to transform between formats.
    This works by parsing the rules from the source format into the AST, and
    then "dumping" out to the appropriate target format. This allows you, for
    example, to write rules in DRL, and when needed, export to XML if
    necessary at some point in the future.</p><p>The classes to look at if you need to do this are: </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">XmlDumper - for exporting XML.
DrlDumper - for exporting DRL.
DrlParser - reading DRL.
XmlPackageReader - reading XML.
</pre><p> Using combinations of the above, you can convert between any
    format (including round trip). Note that DSLs will not be preserved (from
    DRLs that are using a DSL) - but they will be able to be converted.</p><p>Feel free to make use of XSLT to provide all sorts of possibilities
  for XML, XSLT and its ilk are what make XML powerful.</p></div></div></div><ul xmlns:d="http://docbook.org/ns/docbook" class="docnav"><li class="previous"><a accesskey="p" href="ch03.html"><strong>Prev</strong>Chapter 3. API Reference</a></li><li class="up"><a accesskey="u" href="#"><strong>Top of page</strong></a></li><li class="home"><a accesskey="h" href="index.html"><strong>Front page</strong></a></li><li class="next"><a accesskey="n" href="ch05.html"><strong>Next</strong>Chapter 5. The Java Rule Engine API (JSR94)</a></li></ul></body></html>